"use strict";(self.webpackChunklowcode_platform_docs=self.webpackChunklowcode_platform_docs||[]).push([["6207"],{1786:function(e,n,r){r.r(n),r.d(n,{default:()=>t});var a=r(2676),s=r(453),c=r(3054),d=r(2299),l=r(3281);function o(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",h3:"h3",ol:"ol",li:"li",code:"code",pre:"pre"},(0,s.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"服务部署",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#服务部署",children:"#"}),"服务部署"]}),"\n",(0,a.jsxs)(n.h2,{id:"容器化部署",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#容器化部署",children:"#"}),"容器化部署"]}),"\n",(0,a.jsxs)(n.h3,{id:"镜像构建",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#镜像构建",children:"#"}),"镜像构建"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["下载克隆代码，执行 ",(0,a.jsx)(n.code,{children:"install"})]}),"\n"]}),"\n",(0,a.jsx)(c.default,{}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["服务构建，执行 ",(0,a.jsx)(n.code,{children:"build:min"})]}),"\n"]}),"\n",(0,a.jsx)(d.default,{}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"构建镜像"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"docker build -t lowcode-center-server  .\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"服务启动",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#服务启动",children:"#"}),"服务启动"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"docker 启动服务（将对应的环境变量修改为真实的值）,容器启动后运行在 10009 端口"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'docker run -d \\\r\n  --name lowcode-center-server \\\r\n  -e MYSQL="127.0.0.1" \\\r\n  -e MYSQL_PORT="3306" \\\r\n  -e MYSQL_USER="root" \\\r\n  -e MYSQL_PASSWORD="password" \\\r\n  -e MYSQL_DATABASE_NAME="b_lowcode_center_database" \\\r\n  -e REDIS="127.0.0.1:6379" \\\r\n  -p 10009:10009 \\\r\n  lowcode-center-server:latest\r\n\n'})}),"\n",(0,a.jsxs)(n.h2,{id:"pm2",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#pm2",children:"#"}),"pm2"]}),"\n",(0,a.jsxs)(n.h3,{id:"服务构建",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#服务构建",children:"#"}),"服务构建"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["下载克隆代码，执行 ",(0,a.jsx)(n.code,{children:"install"})]}),"\n"]}),"\n",(0,a.jsx)(c.default,{}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["服务构建，执行 ",(0,a.jsx)(n.code,{children:"build:min"})]}),"\n"]}),"\n",(0,a.jsx)(d.default,{}),"\n",(0,a.jsxs)(n.h3,{id:"环境准备",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#环境准备",children:"#"}),"环境准备"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"使用以下命令全局安装 PM2："}),"\n"]}),"\n",(0,a.jsx)(l.default,{command:"install pm2 -g"}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"在项目根目录下创建一个 ecosystem.config.js 文件，并将以下内容添加到文件中"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"module.exports = {\r\n  apps: [\r\n    {\r\n      name: 'lowcode-center-server',\r\n      script: 'war/index.js',\r\n      instances: 'max',  // 根据需求设置实例数量\r\n      exec_mode: 'cluster',\r\n      autorestart: true,\r\n      watch: false,\r\n      max_memory_restart: '1G',\r\n      env: {\r\n        NODE_ENV: 'production',\r\n        MYSQL: \"127.0.0.1\",\r\n        MYSQL_PORT: 3306,\r\n        MYSQL_USER: \"root\",\r\n        MYSQL_PASSWORD: \"password\",\r\n        MYSQL_DATABASE_NAME: \"b_lowcode_center_database\",\r\n        REDIS: \"127.0.0.1:6379\",\r\n      },\r\n    },\r\n  ],\r\n};\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"服务启动-1",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#服务启动-1",children:"#"}),"服务启动"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"执行以下命令，使用 PM2 启动应用程序"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bin",children:"pm2 start ecosystem.config.js\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"使用以下命令来查看应用程序的运行状态"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bin",children:"pm2 status\n"})}),"\n",(0,a.jsxs)(n.h2,{id:"k8s-集群",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#k8s-集群",children:"#"}),"K8S 集群"]}),"\n",(0,a.jsxs)(n.h3,{id:"镜像构建-1",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#镜像构建-1",children:"#"}),"镜像构建"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"如上步骤构建镜像后推送到自己的镜像仓库"}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"集群部署",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#集群部署",children:"#"}),"集群部署"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"系定义修改 ymal 配置，尤其是 containers.env 必须配置正确"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ymal",children:'apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n    labels:\r\n        app: lowcode-center-server\r\n    name: lowcode-center-server\r\n    namespace: gpt\r\nspec:\r\n    replicas: 1\r\n    selector:\r\n        matchLabels:\r\n            app: lowcode-center-server\r\n    template:\r\n        metadata:\r\n            labels:\r\n                app: lowcode-center-server\r\n        spec:\r\n            containers:\r\n                - env:\r\n                      - name: APP_NAME\r\n                        value: "lowcode-center-server"\r\n                      - name: MYSQL_DATABASE_NAME\r\n                        value: b_lowcode_center_database\r\n                      - name: USER_CENTER_SERVER\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: user.server\r\n                      - name: MYSQL\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: mysql.host\r\n                      - name: MYSQL_PASSWORD\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: mysql.password\r\n                      - name: MYSQL_PORT\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: mysql.port\r\n                      - name: MYSQL_USER\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: mysql.user\r\n                      - name: REDIS\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: redis.url\r\n                      - name: REDIS_NAME\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: redis.name\r\n                      - name: REDIS_POST\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: redis.port\r\n                      - name: KAfKA\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: kafka.server\r\n                      - name: NACOS_SERVER_ADDR\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: nacos.server\r\n                      - name: NACOS_DISCOVERY_NAMESPACE\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: nacos.namespace\r\n                      - name: NACOS_DISCOVERY_GROUP\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: nacos.group\r\n                      - name: RABBITMQ\r\n                        valueFrom:\r\n                            configMapKeyRef:\r\n                                name: server-common-cm\r\n                                key: rabbitMq.server\r\n                  image: 替换成自己的镜像地址\r\n                  imagePullPolicy: IfNotPresent\r\n                  name: lowcode-center-server\r\n                  ports:\r\n                      - containerPort: 10009\r\n            imagePullSecrets:\r\n                - name: aliyun-register-pwd\r\n\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n    labels:\r\n        app: lowcode-center-server\r\n    name: lowcode-center-server-service\r\n    namespace: gpt\r\nspec:\r\n    #type: LoadBalancer\r\n    type: NodePort\r\n    ports:\r\n        - name: lowcode-center-server-port\r\n          port: 10009\r\n          protocol: TCP\r\n          targetPort: 10009\r\n    selector:\r\n        app: lowcode-center-server\r\n\n'})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,a.jsx)(n,Object.assign({},e,{children:(0,a.jsx)(o,e)})):o(e)}let t=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["deploy%2Fserver%2Fsummary.mdx"]={toc:[{id:"容器化部署",text:"容器化部署",depth:2},{id:"镜像构建",text:"镜像构建",depth:3},{id:"服务启动",text:"服务启动",depth:3},{id:"pm2",text:"pm2",depth:2},{id:"服务构建",text:"服务构建",depth:3},{id:"环境准备",text:"环境准备",depth:3},{id:"服务启动-1",text:"服务启动",depth:3},{id:"k8s-集群",text:"K8S 集群",depth:2},{id:"镜像构建-1",text:"镜像构建",depth:3},{id:"集群部署",text:"集群部署",depth:3}],title:"服务部署",headingTitle:"服务部署",frontmatter:{}}},2299:function(e,n,r){r.r(n),r.d(n,{default:()=>c});var a=r(2676),s=r(7489);let c=()=>(0,a.jsx)(s.SU,{command:"run build:min"})},3054:function(e,n,r){r.r(n),r.d(n,{default:()=>c});var a=r(2676),s=r(7489);let c=()=>(0,a.jsx)(s.SU,{command:"install"})},3281:function(e,n,r){r.r(n),r.d(n,{default:()=>c});var a=r(2676),s=r(7489);let c=e=>(0,a.jsx)(s.SU,{command:e.command})}}]);