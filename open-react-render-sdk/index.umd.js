(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".visual-dom .panel-container{box-sizing:border-box;border:1px solid #e9e9e9}.visual-dom .panel-container .title{display:block;font-size:12px;color:#333;background-color:#ebecf0;line-height:28px;padding:0 12px;border-bottom:1px solid #e9e9e9}.visual-dom .panel-container .content{min-height:20px;padding:5px}")),document.head.appendChild(e)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();
(function(t,h){typeof exports=="object"&&typeof module<"u"?h(exports,require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","react-dom"],h):(t=typeof globalThis<"u"?globalThis:t||self,h(t.OpenReactRenderSdk={},t.React,t.ReactDOM))})(this,function(exports,require$$0,ReactDOM){"use strict";var Xe=Object.defineProperty;var Ye=(t,h,E)=>h in t?Xe(t,h,{enumerable:!0,configurable:!0,writable:!0,value:E}):t[h]=E;var be=(t,h,E)=>(Ye(t,typeof h!="symbol"?h+"":h,E),E);var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$3=require$$0,k$2=Symbol.for("react.element"),l$2=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q$2(t,h,E){var R,Y={},Z=null,ee=null;E!==void 0&&(Z=""+E),h.key!==void 0&&(Z=""+h.key),h.ref!==void 0&&(ee=h.ref);for(R in h)m$2.call(h,R)&&!p$1.hasOwnProperty(R)&&(Y[R]=h[R]);if(t&&t.defaultProps)for(R in h=t.defaultProps,h)Y[R]===void 0&&(Y[R]=h[R]);return{$$typeof:k$2,type:t,key:Z,ref:ee,props:Y,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$2,reactJsxRuntime_production_min.jsx=q$2,reactJsxRuntime_production_min.jsxs=q$2,jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,extendStatics$1=function(t,h){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,R){E.__proto__=R}||function(E,R){for(var Y in R)Object.prototype.hasOwnProperty.call(R,Y)&&(E[Y]=R[Y])},extendStatics$1(t,h)};function __extends$I(t,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");extendStatics$1(t,h);function E(){this.constructor=t}t.prototype=h===null?Object.create(h):(E.prototype=h.prototype,new E)}var __assign$R=function(){return __assign$R=Object.assign||function(h){for(var E,R=1,Y=arguments.length;R<Y;R++){E=arguments[R];for(var Z in E)Object.prototype.hasOwnProperty.call(E,Z)&&(h[Z]=E[Z])}return h},__assign$R.apply(this,arguments)};function __rest$4(t,h){var E={};for(var R in t)Object.prototype.hasOwnProperty.call(t,R)&&h.indexOf(R)<0&&(E[R]=t[R]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,R=Object.getOwnPropertySymbols(t);Y<R.length;Y++)h.indexOf(R[Y])<0&&Object.prototype.propertyIsEnumerable.call(t,R[Y])&&(E[R[Y]]=t[R[Y]]);return E}function __awaiter(t,h,E,R){function Y(Z){return Z instanceof E?Z:new E(function(ee){ee(Z)})}return new(E||(E=Promise))(function(Z,ee){function te(ie){try{oe(R.next(ie))}catch(ae){ee(ae)}}function ne(ie){try{oe(R.throw(ie))}catch(ae){ee(ae)}}function oe(ie){ie.done?Z(ie.value):Y(ie.value).then(te,ne)}oe((R=R.apply(t,h||[])).next())})}function __values$3(t){var h=typeof Symbol=="function"&&Symbol.iterator,E=h&&t[h],R=0;if(E)return E.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&R>=t.length&&(t=void 0),{value:t&&t[R++],done:!t}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$B(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z}function __spreadArray$b(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))}typeof SuppressedError=="function"&&SuppressedError;var ErrorCode$1;(function(t){t[t.NONE_START_NODE=1e3]="NONE_START_NODE",t[t.NONE_NODE_ID=1001]="NONE_NODE_ID",t[t.NO_DOCUMENT_BODY=2001]="NO_DOCUMENT_BODY"})(ErrorCode$1||(ErrorCode$1={}));var WarningCode;(function(t){t[t.NONE_START_NODE_IN_DATA=2e3]="NONE_START_NODE_IN_DATA",t[t.START_NODE_INCOMING=2001]="START_NODE_INCOMING",t[t.EXPRESSION_EXEC_ERROR=3e3]="EXPRESSION_EXEC_ERROR"})(WarningCode||(WarningCode={}));const errorMsgMapCn={[ErrorCode$1.NONE_START_NODE]:"未找到入度为0的节点",[ErrorCode$1.NONE_NODE_ID]:"流程数据中存在没有此节点",[ErrorCode$1.NO_DOCUMENT_BODY]:"找不到document.body, 请在DOM加载完成后再执行"};WarningCode.NONE_START_NODE_IN_DATA+"",WarningCode.START_NODE_INCOMING+"",WarningCode.EXPRESSION_EXEC_ERROR+"";const getErrorMsg=t=>`error[${t}]: ${errorMsgMapCn[t]}`,EVENT_INSTANCE_COMPLETE="instance:complete",EVENT_INSTANCE_INTERRUPTED="instance:interrupted",EVENT_INSTANCE_ERROR="instance:error";var FlowStatus;(function(t){t.COMPLETED="completed",t.INTERRUPTED="interrupted",t.RUNNING="running",t.PENDING="pending",t.ERROR="error"})(FlowStatus||(FlowStatus={}));var ActionStatus;(function(t){t.SUCCESS="success",t.ERROR="error",t.INTERRUPTED="interrupted"})(ActionStatus||(ActionStatus={}));function parseHexToInt(t){return!t.match(/[^a-f0-9]/i)?parseInt(t,16):NaN}function validateAndParseHex(t,h,E){const R=parseHexToInt(t);if(Number.isNaN(R)||E!==void 0&&E!==t.length)throw new SyntaxError(h+": "+t);return R}function parseHexadecimalCode(t){const h=validateAndParseHex(t,"Malformed Hexadecimal",2);return String.fromCharCode(h)}function parseUnicodeCode(t,h){const E=validateAndParseHex(t,"Malformed Unicode",4);if(h!==void 0){const R=validateAndParseHex(h,"Malformed Unicode",4);return String.fromCharCode(E,R)}return String.fromCharCode(E)}function isCurlyBraced(t){return t.charAt(0)==="{"&&t.charAt(t.length-1)==="}"}function parseUnicodeCodePointCode(t){if(!isCurlyBraced(t))throw new SyntaxError("Malformed Unicode: +"+t);const h=t.slice(1,-1),E=validateAndParseHex(h,"Malformed Unicode");try{return String.fromCodePoint(E)}catch(R){throw R instanceof RangeError?new SyntaxError("Code Point Limit:"+E):R}}const singleCharacterEscapes=new Map([["b","\b"],["f","\f"],["n",`
`],["r","\r"],["t","	"],["v","\v"],["0","\0"]]);function parseSingleCharacterCode(t){return singleCharacterEscapes.get(t)||t}const escapeMatch=/\\(?:(\\)|x([\s\S]{0,2})|u(\{[^}]*\}?)|u([\s\S]{4})\\u([^{][\s\S]{0,3})|u([\s\S]{0,4})|([0-3]?[0-7]{1,2})|([\s\S])|$)/g;function unraw(t){return t.replace(escapeMatch,function(h,E,R,Y,Z,ee,te,ne,oe){if(E!==void 0)return"\\";if(R!==void 0)return parseHexadecimalCode(R);if(Y!==void 0)return parseUnicodeCodePointCode(Y);if(Z!==void 0)return parseUnicodeCode(Z,ee);if(te!==void 0)return parseUnicodeCode(te);if(ne==="0")return"\0";if(ne!==void 0)throw new SyntaxError("Octal Deprecation: "+ne);if(oe!==void 0)return parseSingleCharacterCode(oe);throw new SyntaxError("End of string")})}function createLisp(t){return[t.op,t.a,t.b]}let lispTypes=new Map;class ParseError extends Error{constructor(h,E){super(h+": "+E.substring(0,40)),this.code=E}}const inlineIfElse=/^:/,elseIf=/^else(?![\w\$])/,ifElse=/^if(?![\w\$])/,space=/^\s/;let expectTypes={splitter:{types:{opHigh:/^(\/|\*\*|\*(?!\*)|\%)(?!\=)/,op:/^(\+(?!(\+))|\-(?!(\-)))(?!\=)/,comparitor:/^(<=|>=|<(?!<)|>(?!>)|!==|!=(?!\=)|===|==)/,boolOp:/^(&&|\|\||instanceof(?![\w\$])|in(?![\w\$]))/,bitwise:/^(&(?!&)|\|(?!\|)|\^|<<|>>(?!>)|>>>)(?!\=)/},next:["modifier","value","prop","incrementerBefore"]},inlineIf:{types:{inlineIf:/^\?(?!\.(?!\d))/},next:["expEnd"]},assignment:{types:{assignModify:/^(\-=|\+=|\/=|\*\*=|\*=|%=|\^=|\&=|\|=|>>>=|>>=|<<=)/,assign:/^(=)(?!=)/},next:["modifier","value","prop","incrementerBefore"]},incrementerBefore:{types:{incrementerBefore:/^(\+\+|\-\-)/},next:["prop"]},expEdge:{types:{call:/^(\?\.)?[\(]/,incrementerAfter:/^(\+\+|\-\-)/},next:["splitter","expEdge","dot","inlineIf","expEnd"]},modifier:{types:{not:/^!/,inverse:/^~/,negative:/^\-(?!\-)/,positive:/^\+(?!\+)/,typeof:/^typeof(?![\w\$])/,delete:/^delete(?![\w\$])/},next:["modifier","value","prop","incrementerBefore"]},dot:{types:{arrayProp:/^(\?\.)?\[/,dot:/^(\?)?\.(?=\s*[a-zA-Z\$\_])/},next:["splitter","assignment","expEdge","dot","inlineIf","expEnd"]},prop:{types:{prop:/^[a-zA-Z\$\_][a-zA-Z\d\$\_]*/},next:["splitter","assignment","expEdge","dot","inlineIf","expEnd"]},value:{types:{createObject:/^\{/,createArray:/^\[/,number:/^(0x[\da-f]+(_[\da-f]+)*|(\d+(_\d+)*(\.\d+(_\d+)*)?|\.\d+(_\d+)*))(e[\+\-]?\d+(_\d+)*)?(n)?(?!\d)/i,string:/^"(\d+)"/,literal:/^`(\d+)`/,regex:/^\/(\d+)\/r(?![\w\$])/,boolean:/^(true|false)(?![\w\$])/,null:/^null(?![\w\$])/,und:/^undefined(?![\w\$])/,arrowFunctionSingle:/^(async\s+)?([a-zA-Z\$_][a-zA-Z\d\$_]*)\s*=>\s*({)?/,arrowFunction:/^(async\s*)?\(\s*((\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*(\s*,\s*(\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*)*)?\s*\)\s*=>\s*({)?/,inlineFunction:/^(async\s+)?function(\s*[a-zA-Z\$_][a-zA-Z\d\$_]*)?\s*\(\s*((\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*(\s*,\s*(\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*)*)?\s*\)\s*{/,group:/^\(/,NaN:/^NaN(?![\w\$])/,Infinity:/^Infinity(?![\w\$])/,void:/^void(?![\w\$])\s*/,await:/^await(?![\w\$])\s*/,new:/^new(?![\w\$])\s*/},next:["splitter","expEdge","dot","inlineIf","expEnd"]},initialize:{types:{initialize:/^(var|let|const)\s+([a-zA-Z\$_][a-zA-Z\d\$_]*)\s*(=)?/,return:/^return(?![\w\$])/,throw:/^throw(?![\w\$])\s*/},next:["modifier","value","prop","incrementerBefore","expEnd"]},spreadObject:{types:{spreadObject:/^\.\.\./},next:["value","prop"]},spreadArray:{types:{spreadArray:/^\.\.\./},next:["value","prop"]},expEnd:{types:{},next:[]},expFunction:{types:{function:/^(async\s+)?function(\s*[a-zA-Z\$_][a-zA-Z\d\$_]*)\s*\(\s*((\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*(\s*,\s*(\.\.\.)?\s*[a-zA-Z\$_][a-zA-Z\d\$_]*)*)?\s*\)\s*{/},next:["expEdge","expEnd"]},expSingle:{types:{for:/^(([a-zA-Z\$\_][\w\$]*)\s*:)?\s*for\s*\(/,do:/^(([a-zA-Z\$\_][\w\$]*)\s*:)?\s*do(?![\w\$])\s*(\{)?/,while:/^(([a-zA-Z\$\_][\w\$]*)\s*:)?\s*while\s*\(/,loopAction:/^(break|continue)(?![\w\$])\s*([a-zA-Z\$\_][\w\$]*)?/,if:/^((([a-zA-Z\$\_][\w\$]*)\s*:)?\s*)if\s*\(/,try:/^try\s*{/,block:/^{/,switch:/^(([a-zA-Z\$\_][\w\$]*)\s*:)?\s*switch\s*\(/},next:["expEnd"]}},closings={"(":")","[":"]","{":"}","'":"'",'"':'"',"`":"`"};function testMultiple(t,h){let E;for(let R=0;R<h.length&&(E=h[R].exec(t),!E);R++);return E}class CodeString{constructor(h){this.ref={str:""},h instanceof CodeString?(this.ref=h.ref,this.start=h.start,this.end=h.end):(this.ref.str=h,this.start=0,this.end=h.length)}substring(h,E){if(!this.length)return this;h=this.start+h,h<0&&(h=0),h>this.end&&(h=this.end),E=E===void 0?this.end:this.start+E,E<0&&(E=0),E>this.end&&(E=this.end);const R=new CodeString(this);return R.start=h,R.end=E,R}get length(){const h=this.end-this.start;return h<0?0:h}char(h){if(this.start!==this.end)return this.ref.str[this.start+h]}toString(){return this.ref.str.substring(this.start,this.end)}trimStart(){const h=/^\s+/.exec(this.toString()),E=new CodeString(this);return h&&(E.start+=h[0].length),E}slice(h,E){return h<0&&(h=this.end-this.start+h),h<0&&(h=0),E===void 0&&(E=this.end-this.start),E<0&&(E=this.end-this.start+E),E<0&&(E=0),this.substring(h,E)}trim(){const h=this.trimStart(),E=/\s+$/.exec(h.toString());return E&&(h.end-=E[0].length),h}valueOf(){return this.toString()}}const emptyString=new CodeString(""),okFirstChars=/^[\+\-~ !]/,aNumber=expectTypes.value.types.number,wordReg=/^((if|for|else|while|do|function)(?![\w\$])|[\w\$]+)/,semiColon=/^;/,insertedSemicolons=new WeakMap,quoteCache=new WeakMap;function restOfExp(t,h,E,R,Y,Z,ee={}){if(!h.length)return h;ee.words=ee.words||[];let te=!0;E=E||[];const ne=E.includes(semiColon);ne&&(E=E.filter(ce=>ce!==semiColon));const oe=insertedSemicolons.get(h.ref)||[],ie=quoteCache.get(h.ref)||new Map;if(quoteCache.set(h.ref,ie),R&&ie.has(h.start-1))return h.substring(0,ie.get(h.start-1)-h.start);let ae=!1,se=!1,ue="",fe=!1,le,de=!1;for(le=0;le<h.length&&!se;le++){let ce=h.char(le);if(R==='"'||R==="'"||R==="`"){if(R==="`"&&ce==="$"&&h.char(le+1)==="{"&&!ae){let pe=restOfExp(t,h.substring(le+2),[],"{");le+=pe.length+2}else if(ce===R&&!ae)return h.substring(0,le);ae=!ae&&ce==="\\"}else if(closings[ce]){if(!de&&oe[le+h.start]){if(de=!0,ne)break;le--,ue=";";continue}if(fe&&ce==="{"&&(fe=!1),ce===Y){se=!0;break}else{let pe=restOfExp(t,h.substring(le+1),[],ce);if(ie.set(pe.start-1,pe.end),le+=pe.length+1,te=!1,Z){let he=h.substring(le),ge;(ge=testMultiple(he.toString(),Z))&&(ee.regRes=ge,se=!0)}}}else if(R){if(ce===closings[R])return h.substring(0,le)}else{let pe=h.substring(le).toString(),he,ge;if(Z){let ve;if(ve=testMultiple(pe,Z)){ee.regRes=ve,le++,se=!0;break}}if(ge=aNumber.exec(pe))le+=ge[0].length-1,pe=h.substring(le).toString();else if(ue!=ce){let ve;if(ce===";"||oe[le+h.start]&&!te&&!de){if(ne)ve=[";"];else if(oe[le+h.start]){de=!0,le--,ue=";";continue}ce=pe=";"}else de=!1;ve||(ve=testMultiple(pe,E)),ve&&(se=!0),!se&&(he=wordReg.exec(pe))&&(fe=!0,he[0].length>1&&(ee.words.push(he[1]),ee.lastAnyWord=he[1],he[2]&&(ee.lastWord=he[2])),he[0].length>2&&(le+=he[0].length-2))}if(te&&(okFirstChars.test(pe)?se=!1:te=!1),se)break}ue=ce}if(R)throw new SyntaxError("Unclosed '"+R+"'");return ee&&(ee.oneliner=fe),h.substring(0,le)}restOfExp.next=["splitter","expEnd","inlineIf"];const startingExecpted=["initialize","expSingle","expFunction","value","modifier","prop","incrementerBefore","expEnd"],setLispType=(t,h)=>{t.forEach(E=>{lispTypes.set(E,h)})},closingsCreate={createArray:/^\]/,createObject:/^\}/,group:/^\)/,arrayProp:/^\]/,call:/^\)/},typesCreate={createArray:12,createObject:22,group:23,arrayProp:19,call:5,prop:1,"?prop":20,"?call":21};setLispType(["createArray","createObject","group","arrayProp","call"],(t,h,E,R,Y,Z)=>{let ee=emptyString,te=[],ne=!1,oe=R[0].length;const ie=oe;for(;oe<E.length&&!ne;)ee=restOfExp(t,E.substring(oe),[closingsCreate[h],/^,/]),oe+=ee.length,ee.trim().length&&te.push(ee),E.char(oe)!==","?ne=!0:oe++;const ae=["value","modifier","prop","incrementerBefore","expEnd"];let se,ue;switch(h){case"group":case"arrayProp":se=lispifyExpr(t,E.substring(ie,oe));break;case"call":case"createArray":se=te.map(le=>lispify(t,le,[...ae,"spreadArray"]));break;case"createObject":se=te.map(le=>{le=le.trimStart();let de,ce="";if(ue=expectTypes.expFunction.types.function.exec("function "+le),ue)ce=ue[2].trimStart(),de=lispify(t,new CodeString("function "+le.toString().replace(ce,"")));else{let pe=restOfExp(t,le,[/^:/]);ce=lispify(t,pe,[...ae,"spreadObject"]),ce[0]===1&&(ce=ce[2]),de=lispify(t,le.substring(pe.length+1))}return createLisp({op:6,a:ce,b:de})});break}let fe=h==="arrayProp"?R[1]?20:1:h==="call"?R[1]?21:5:typesCreate[h];Z.lispTree=lispify(t,E.substring(oe+1),expectTypes[Y].next,createLisp({op:fe,a:Z.lispTree,b:se}))});const modifierTypes={inverse:64,not:24,positive:59,negative:58,typeof:60,delete:61};setLispType(["inverse","not","negative","positive","typeof","delete"],(t,h,E,R,Y,Z)=>{let ee=restOfExp(t,E.substring(R[0].length),[/^([^\s\.\?\w\$]|\?[^\.])/]);Z.lispTree=lispify(t,E.substring(ee.length+R[0].length),restOfExp.next,createLisp({op:modifierTypes[h],a:Z.lispTree,b:lispify(t,ee,expectTypes[Y].next)}))});const incrementTypes={"++$":25,"--$":27,"$++":26,"$--":28};setLispType(["incrementerBefore"],(t,h,E,R,Y,Z)=>{let ee=restOfExp(t,E.substring(2),[/^[^\s\.\w\$]/]);Z.lispTree=lispify(t,E.substring(ee.length+2),restOfExp.next,createLisp({op:incrementTypes[R[0]+"$"],a:lispify(t,ee,expectTypes[Y].next),b:0}))}),setLispType(["incrementerAfter"],(t,h,E,R,Y,Z)=>{Z.lispTree=lispify(t,E.substring(R[0].length),expectTypes[Y].next,createLisp({op:incrementTypes["$"+R[0]],a:Z.lispTree,b:0}))});const adderTypes={"&&":29,"||":30,instanceof:62,in:63,"=":9,"-=":65,"+=":66,"/=":67,"**=":68,"*=":69,"%=":70,"^=":71,"&=":72,"|=":73,">>>=":74,"<<=":76,">>=":75};setLispType(["assign","assignModify","boolOp"],(t,h,E,R,Y,Z)=>{Z.lispTree=createLisp({op:adderTypes[R[0]],a:Z.lispTree,b:lispify(t,E.substring(R[0].length),expectTypes[Y].next)})});const opTypes={"&":77,"|":78,"^":79,"<<":80,">>":81,">>>":82,"<=":54,">=":55,"<":56,">":57,"!==":31,"!=":53,"===":32,"==":52,"+":33,"-":47,"/":48,"**":49,"*":50,"%":51};setLispType(["opHigh","op","comparitor","bitwise"],(t,h,E,R,Y,Z)=>{const ee=[expectTypes.inlineIf.types.inlineIf,inlineIfElse];switch(h){case"opHigh":ee.push(expectTypes.splitter.types.opHigh);case"op":ee.push(expectTypes.splitter.types.op);case"comparitor":ee.push(expectTypes.splitter.types.comparitor);case"bitwise":ee.push(expectTypes.splitter.types.bitwise),ee.push(expectTypes.splitter.types.boolOp)}let te=restOfExp(t,E.substring(R[0].length),ee);Z.lispTree=lispify(t,E.substring(te.length+R[0].length),restOfExp.next,createLisp({op:opTypes[R[0]],a:Z.lispTree,b:lispify(t,te,expectTypes[Y].next)}))}),setLispType(["inlineIf"],(t,h,E,R,Y,Z)=>{let ee=!1,te=E.substring(0,0),ne=1;for(;!ee&&te.length<E.length;)te.end=restOfExp(t,E.substring(te.length+1),[expectTypes.inlineIf.types.inlineIf,inlineIfElse]).end,E.char(te.length)==="?"?ne++:ne--,ne||(ee=!0);te.start=E.start+1,Z.lispTree=createLisp({op:15,a:Z.lispTree,b:createLisp({op:16,a:lispifyExpr(t,te),b:lispifyExpr(t,E.substring(R[0].length+te.length+1))})})});function extractIfElse(t,h){var oe;let E=0,R=h.substring(0,0),Y=emptyString,Z,ee=!0,te,ne={};for(;(R=restOfExp(t,h.substring(R.end-h.start),[elseIf,ifElse,semiColon],void 0,void 0,void 0,ne)).length||ee;){ee=!1;const ie=h.substring(R.end-h.start).toString();if(ie.startsWith("if"))R.end++,E++;else if(ie.startsWith("else"))Z=h.substring(0,R.end-h.start),R.end++,E--,E||R.end--;else if(te=/^;?\s*else(?![\w\$])/.exec(ie))Z=h.substring(0,R.end-h.start),R.end+=te[0].length-1,E--,E||(R.end-=te[0].length-1);else{Z=Y.length?Z:h.substring(0,R.end-h.start);break}if(!E){Y=extractIfElse(t,h.substring(R.end-h.start+((oe=/^;?\s*else(?![\w\$])/.exec(ie))==null?void 0:oe[0].length))).all;break}ne={}}return Z=Z||h.substring(0,R.end-h.start),{all:h.substring(0,Math.max(Z.end,Y.end)-h.start),true:Z,false:Y}}setLispType(["if"],(t,h,E,R,Y,Z)=>{let ee=restOfExp(t,E.substring(R[0].length),[],"(");const te=extractIfElse(t,E.substring(R[1].length));/^\s*\{/.exec(E.substring(R[0].length+ee.length+1).toString());const ne=R[0].length-R[1].length+ee.length+1;let oe=te.true.substring(ne),ie=te.false;ee=ee.trim(),oe=oe.trim(),ie=ie.trim(),oe.char(0)==="{"&&(oe=oe.slice(1,-1)),ie.char(0)==="{"&&(ie=ie.slice(1,-1)),Z.lispTree=createLisp({op:13,a:lispifyExpr(t,ee),b:createLisp({op:14,a:lispifyBlock(oe,t),b:lispifyBlock(ie,t)})})}),setLispType(["switch"],(t,h,E,R,Y,Z)=>{const ee=restOfExp(t,E.substring(R[0].length),[],"(");let te=E.toString().indexOf("{",R[0].length+ee.length+1);if(te===-1)throw new SyntaxError("Invalid switch");let ne=insertSemicolons(t,restOfExp(t,E.substring(te+1),[],"{")),oe;const ie=/^\s*(case\s|default)\s*/;let ae=[],se=!1;for(;oe=ie.exec(ne.toString());){if(oe[1]==="default"){if(se)throw new SyntaxError("Only one default switch case allowed");se=!0}let ue=restOfExp(t,ne.substring(oe[0].length),[/^:/]),fe=emptyString,le=te=oe[0].length+ue.length+1,de=/^\s*\{/.exec(ne.substring(le).toString()),ce=[];if(de)le+=de[0].length,fe=restOfExp(t,ne.substring(le),[],"{"),le+=fe.length+1,ce=lispifyBlock(fe,t);else{let pe=restOfExp(t,ne.substring(le),[ie]);if(!pe.trim().length)ce=[],le+=pe.length;else{for(;(fe=restOfExp(t,ne.substring(le),[semiColon])).length&&(le+=fe.length+(ne.char(le+fe.length)===";"?1:0),!ie.test(ne.substring(le).toString())););ce=lispifyBlock(ne.substring(te,fe.end-ne.start),t)}}ne=ne.substring(le),ae.push(createLisp({op:41,a:oe[1]==="default"?void 0:lispifyExpr(t,ue),b:ce}))}Z.lispTree=createLisp({op:40,a:lispifyExpr(t,ee),b:ae})}),setLispType(["dot","prop"],(t,h,E,R,Y,Z)=>{let ee=R[0],te=R[0].length,ne="prop";if(h==="dot"){R[1]&&(ne="?prop");let oe=E.substring(R[0].length).toString().match(expectTypes.prop.types.prop);if(oe&&oe.length)ee=oe[0],te=ee.length+R[0].length;else throw new SyntaxError("Hanging  dot")}Z.lispTree=lispify(t,E.substring(te),expectTypes[Y].next,createLisp({op:typesCreate[ne],a:Z.lispTree,b:ee}))}),setLispType(["spreadArray","spreadObject"],(t,h,E,R,Y,Z)=>{Z.lispTree=createLisp({op:h==="spreadArray"?18:17,a:0,b:lispify(t,E.substring(R[0].length),expectTypes[Y].next)})}),setLispType(["return","throw"],(t,h,E,R,Y,Z)=>{Z.lispTree=createLisp({op:h==="return"?8:46,a:0,b:lispifyExpr(t,E.substring(R[0].length))})}),setLispType(["number","boolean","null","und","NaN","Infinity"],(t,h,E,R,Y,Z)=>{Z.lispTree=lispify(t,E.substring(R[0].length),expectTypes[Y].next,createLisp({op:h==="number"?R[10]?83:7:35,a:0,b:R[10]?R[1]:R[0]}))}),setLispType(["string","literal","regex"],(t,h,E,R,Y,Z)=>{Z.lispTree=lispify(t,E.substring(R[0].length),expectTypes[Y].next,createLisp({op:h==="string"?2:h==="literal"?84:85,a:0,b:R[1]}))}),setLispType(["initialize"],(t,h,E,R,Y,Z)=>{const ee=R[1]==="var"?34:R[1]==="let"?3:4;R[3]?Z.lispTree=createLisp({op:ee,a:R[2],b:lispify(t,E.substring(R[0].length),expectTypes[Y].next)}):Z.lispTree=lispify(t,E.substring(R[0].length),expectTypes[Y].next,createLisp({op:ee,a:R[2],b:0}))}),setLispType(["function","inlineFunction","arrowFunction","arrowFunctionSingle"],(t,h,E,R,Y,Z)=>{const ee=h!=="function"&&h!=="inlineFunction",te=ee&&!R[R.length-1],ne=ee?2:3,oe=R[1]?88:0,ie=R[ne]?R[ne].replace(/\s+/g,"").split(/,/g):[];ee||ie.unshift((R[2]||"").trimStart());let ae=!1;ie.forEach(fe=>{if(ae)throw new SyntaxError("Rest parameter must be last formal parameter");fe.startsWith("...")&&(ae=!0)}),ie.unshift(oe);const se=restOfExp(t,E.substring(R[0].length),te?[/^[,\)\}\]]/,semiColon]:[/^}/]),ue=te?"return "+se:se.toString();Z.lispTree=lispify(t,E.substring(R[0].length+ue.length+1),expectTypes[Y].next,createLisp({op:ee?11:h==="function"?37:10,a:ie,b:t.eager?lispifyFunction(new CodeString(ue),t):ue}))});const iteratorRegex=/^((let|var|const)\s+)?\s*([a-zA-Z\$_][a-zA-Z\d\$_]*)\s+(in|of)(?![\w\$])/;setLispType(["for","do","while"],(t,h,E,R,Y,Z)=>{let ee=0,te=88,ne=[],oe,ie=0,ae=88,se,ue=88,fe;switch(h){case"while":ee=E.toString().indexOf("(")+1;let de=restOfExp(t,E.substring(ee),[],"(");se=lispifyReturnExpr(t,de),fe=restOfExp(t,E.substring(ee+de.length+1)).trim(),fe[0]==="{"&&(fe=fe.slice(1,-1));break;case"for":ee=E.toString().indexOf("(")+1;let ce=[],pe=emptyString;for(let ve=0;ve<3&&(pe=restOfExp(t,E.substring(ee),[/^[;\)]/]),ce.push(pe.trim()),ee+=pe.length+1,E.char(ee-1)!==")");ve++);let he;if(ce.length===1&&(he=iteratorRegex.exec(ce[0].toString())))he[4]==="of"?(oe=lispifyReturnExpr(t,ce[0].substring(he[0].length)),ne=[ofStart2,ofStart3],se=ofCondition,ue=ofStep,ie=lispify(t,new CodeString((he[1]||"let ")+he[3]+" = $$next.value"),["initialize"])):(oe=lispifyReturnExpr(t,ce[0].substring(he[0].length)),ne=[inStart2,inStart3],ue=inStep,se=inCondition,ie=lispify(t,new CodeString((he[1]||"let ")+he[3]+" = $$keys[$$keyIndex]"),["initialize"]));else if(ce.length===3)te=lispifyExpr(t,ce.shift(),startingExecpted),se=lispifyReturnExpr(t,ce.shift()),ue=lispifyExpr(t,ce.shift());else throw new SyntaxError("Invalid for loop definition");fe=restOfExp(t,E.substring(ee)).trim(),fe[0]==="{"&&(fe=fe.slice(1,-1));break;case"do":ae=0;const ge=!!R[3];fe=restOfExp(t,E.substring(R[0].length),ge?[/^\}/]:[semiColon]),se=lispifyReturnExpr(t,restOfExp(t,E.substring(E.toString().indexOf("(",R[0].length+fe.length)+1),[],"("));break}const le=[ae,ne,oe,te,ue,se,ie];Z.lispTree=createLisp({op:38,a:le,b:lispifyBlock(fe,t)})}),setLispType(["block"],(t,h,E,R,Y,Z)=>{Z.lispTree=createLisp({op:42,a:lispifyBlock(restOfExp(t,E.substring(1),[],"{"),t),b:0})}),setLispType(["loopAction"],(t,h,E,R,Y,Z)=>{Z.lispTree=createLisp({op:86,a:R[1],b:0})});const catchReg=/^\s*(catch\s*(\(\s*([a-zA-Z\$_][a-zA-Z\d\$_]*)\s*\))?|finally)\s*\{/;setLispType(["try"],(t,h,E,R,Y,Z)=>{const ee=restOfExp(t,E.substring(R[0].length),[],"{");let te=catchReg.exec(E.substring(R[0].length+ee.length+1).toString()),ne,oe="",ie,ae=0;te[1].startsWith("catch")?(te=catchReg.exec(E.substring(R[0].length+ee.length+1).toString()),oe=te[2],ie=restOfExp(t,E.substring(R[0].length+ee.length+1+te[0].length),[],"{"),ae=R[0].length+ee.length+1+te[0].length+ie.length+1,(te=catchReg.exec(E.substring(ae).toString()))&&te[1].startsWith("finally")&&(ne=restOfExp(t,E.substring(ae+te[0].length),[],"{"))):ne=restOfExp(t,E.substring(R[0].length+ee.length+1+te[0].length),[],"{");const se=[oe,lispifyBlock(insertSemicolons(t,ie||emptyString),t),lispifyBlock(insertSemicolons(t,ne||emptyString),t)];Z.lispTree=createLisp({op:39,a:lispifyBlock(insertSemicolons(t,ee),t),b:se})}),setLispType(["void","await"],(t,h,E,R,Y,Z)=>{const ee=restOfExp(t,E.substring(R[0].length),[/^([^\s\.\?\w\$]|\?[^\.])/]);Z.lispTree=lispify(t,E.substring(R[0].length+ee.length),expectTypes[Y].next,createLisp({op:h==="void"?87:44,a:lispify(t,ee),b:0}))}),setLispType(["new"],(t,h,E,R,Y,Z)=>{let ee=R[0].length;const te=restOfExp(t,E.substring(ee),[],void 0,"(");ee+=te.length+1;const ne=[];if(E.char(ee-1)==="("){const oe=restOfExp(t,E.substring(ee),[],"(");ee+=oe.length+1;let ie,ae=0;for(;(ie=restOfExp(t,oe.substring(ae),[/^,/])).length;)ae+=ie.length+1,ne.push(ie.trim())}Z.lispTree=lispify(t,E.substring(ee),expectTypes.expEdge.next,createLisp({op:45,a:lispify(t,te,expectTypes.initialize.next),b:ne.map(oe=>lispify(t,oe,expectTypes.initialize.next))}))});const ofStart2=lispify(void 0,new CodeString("let $$iterator = $$obj[Symbol.iterator]()"),["initialize"]),ofStart3=lispify(void 0,new CodeString("let $$next = $$iterator.next()"),["initialize"]),ofCondition=lispify(void 0,new CodeString("return !$$next.done"),["initialize"]),ofStep=lispify(void 0,new CodeString("$$next = $$iterator.next()")),inStart2=lispify(void 0,new CodeString("let $$keys = Object.keys($$obj)"),["initialize"]),inStart3=lispify(void 0,new CodeString("let $$keyIndex = 0"),["initialize"]),inStep=lispify(void 0,new CodeString("$$keyIndex++")),inCondition=lispify(void 0,new CodeString("return $$keyIndex < $$keys.length"),["initialize"]);var lastType;function lispify(t,h,E,R,Y=!1){if(R=R||[0,0,0],E=E||expectTypes.initialize.next,h===void 0)return R;h=h.trimStart();const Z=h.toString();if(!h.length&&!E.includes("expEnd"))throw new SyntaxError("Unexpected end of expression");if(!h.length)return R;let ee={lispTree:R},te;for(let ne of E)if(ne!=="expEnd"){for(let oe in expectTypes[ne].types)if(oe!=="expEnd"&&(te=expectTypes[ne].types[oe].exec(Z))){lastType=oe;try{lispTypes.get(oe)(t,oe,h,te,ne,ee)}catch(ie){throw Y&&ie instanceof SyntaxError?new ParseError(ie.message,Z):ie}break}if(te)break}if(!te&&h.length)throw`${lastType}${h.char(0)}`,Y?new ParseError(`Unexpected token after ${lastType}: ${h.char(0)}`,Z):new SyntaxError(`Unexpected token after ${lastType}: ${h.char(0)}`);return ee.lispTree}const startingExpectedWithoutSingle=startingExecpted.filter(t=>t!=="expSingle");function lispifyExpr(t,h,E){if(!h.trimStart().length)return;let R=[],Y,Z=0;if(E=E||expectTypes.initialize.next,E.includes("expSingle")&&testMultiple(h.toString(),Object.values(expectTypes.expSingle.types)))return lispify(t,h,["expSingle"],void 0,!0);for(E===startingExecpted&&(E=startingExpectedWithoutSingle);(Y=restOfExp(t,h.substring(Z),[/^,/])).length;)R.push(Y.trimStart()),Z+=Y.length+1;if(R.length===1)return lispify(t,h,E,void 0,!0);if(E.includes("initialize")){let te=expectTypes.initialize.types.initialize.exec(R[0].toString());if(te)return createLisp({op:42,a:R.map((ne,oe)=>lispify(t,oe?new CodeString(te[1]+" "+ne):ne,["initialize"],void 0,!0)),b:0});if(expectTypes.initialize.types.return.exec(R[0].toString()))return lispify(t,h,E,void 0,!0)}const ee=R.map((te,ne)=>lispify(t,te,E,void 0,!0));return createLisp({op:43,a:ee,b:0})}function lispifyReturnExpr(t,h){return createLisp({op:8,a:0,b:lispifyExpr(t,h)})}function lispifyBlock(t,h,E=!1){if(t=insertSemicolons(h,t),!t.trim().length)return[];let R=[],Y,Z=0,ee=0,te={},ne=!1,oe=!1;for(;(Y=restOfExp(h,t.substring(Z),[semiColon],void 0,void 0,void 0,te)).length&&(oe=t.char(Z+Y.length)&&t.char(Z+Y.length)!==";",Z+=Y.length+(oe?0:1),/^\s*else(?![\w\$])/.test(t.substring(Z).toString())||te.words.includes("do")&&/^\s*while(?![\w\$])/.test(t.substring(Z).toString())?ne=!0:(ne=!1,R.push(t.substring(ee,Z-(oe?0:1))),ee=Z),te={},!E););return ne&&R.push(t.substring(ee,Z-(oe?0:1))),R.map(ie=>ie.trimStart()).filter(ie=>ie.length).map((ie,ae)=>lispifyExpr(h,ie.trimStart(),startingExecpted))}function lispifyFunction(t,h,E=!1){if(!t.trim().length)return[];const R=lispifyBlock(t,h,E);let Y=[];return hoist(R,Y),Y.concat(R)}function isLisp(t){return Array.isArray(t)&&typeof t[0]=="number"&&t[0]!==0&&t[0]!==88}function hoist(t,h){if(isLisp(t)){const[E,R,Y]=t;if(E===39||E===13||E===38||E===40)hoist(R,h),hoist(Y,h);else if(E===34)h.push(createLisp({op:34,a:R,b:0}));else if(E===37&&R[1])return h.push(t),!0}else if(Array.isArray(t)){const E=[];for(let R of t)hoist(R,h)||E.push(R);E.length!==t.length&&(t.length=0,t.push(...E))}return!1}const closingsNoInsertion=/^(\})\s*(catch|finally|else|while|instanceof)(?![\w\$])/,colonsRegex=/^((([\w\$\]\)\"\'\`]|\+\+|\-\-)\s*\r?\n\s*([\w\$\+\-\!~]))|(\}\s*[\w\$\!~\+\-\{\(\"\'\`]))/;function insertSemicolons(t,h){let E=h,R=emptyString,Y={};const Z=insertedSemicolons.get(h.ref)||new Array(h.ref.str.length);for(;(R=restOfExp(t,E,[],void 0,void 0,[colonsRegex],Y)).length;){let ee=!1,te=R,ne=R.length;if(Y.regRes){ee=!0;const[,,oe,,,ie]=Y.regRes;if(ne=Y.regRes[3]==="++"||Y.regRes[3]==="--"?R.length+1:R.length,te=E.substring(0,ne),ie){let ae=closingsNoInsertion.exec(E.substring(R.length-1).toString());ae?ae[2]==="while"?ee=Y.lastWord!=="do":ee=!1:Y.lastWord==="function"&&Y.regRes[5][0]==="}"&&Y.regRes[5].slice(-1)==="("&&(ee=!1)}else oe&&(Y.lastWord==="if"||Y.lastWord==="while"||Y.lastWord==="for"||Y.lastWord==="else")&&(ee=!1)}ee&&(Z[te.end]=!0),E=E.substring(ne),Y={}}return insertedSemicolons.set(h.ref,Z),h}function checkRegex(t){let h=1,E=!1,R=!1,Y=!1;for(;h<t.length&&!R&&!Y;)R=t[h]==="/"&&!E,E=t[h]==="\\"&&!E,Y=t[h]===`
`,h++;let Z=t.substring(h);if(Y=Y||!R||/^\s*\d/.test(Z),Y)return null;let ee=/^[a-z]*/.exec(Z);return/^\s+[\w\$]/.test(t.substring(h+ee[0].length))?null:{regex:t.substring(1,h-1),flags:ee&&ee[0]||"",length:h+(ee&&ee[0].length||0)}}const notDivide=/(typeof|delete|instanceof|return|in|of|throw|new|void|do|if)$/,possibleDivide=/^([\w\$\]\)]|\+\+|\-\-)[\s\/]/;function extractConstants(t,h,E=""){let R,Y=[],Z=!1,ee,te="",ne=-1,oe=[],ie="";const ae=[],se=[];let ue;for(var fe=0;fe<h.length;fe++)if(ie=h[fe],te)ie===te&&(te==="*"&&h[fe+1]==="/"?(te="",fe++):te===`
`&&(te=""));else{if(Z){Z=!1,Y.push(ie);continue}if(R)if(R==="`"&&ie==="$"&&h[fe+1]==="{"){let le=extractConstants(t,h.substring(fe+2),"{");oe.push(le.str),Y.push("${",oe.length-1,"}"),fe+=le.length+2}else if(R===ie){if(R==="`"){const le=createLisp({op:36,a:unraw(Y.join("")),b:[]});le.tempJsStrings=oe,t.literals.push(le),ae.push("`",t.literals.length-1,"`")}else t.strings.push(unraw(Y.join(""))),ae.push('"',t.strings.length-1,'"');R=null,Y=[]}else Y.push(ie);else{if(ie==="'"||ie==='"'||ie==="`")oe=[],R=ie;else{if(closings[E]===ie&&!se.length)return{str:ae.join(""),length:fe};closings[ie]?(se.push(ie),ae.push(ie)):closings[se[se.length-1]]===ie?(se.pop(),ae.push(ie)):ie==="/"&&(h[fe+1]==="*"||h[fe+1]==="/")?(te=h[fe+1]==="*"?"*":`
`,ne=fe):ie==="/"&&!ue&&(ee=checkRegex(h.substring(fe)))?(t.regexes.push(ee),ae.push("/",t.regexes.length-1,"/r"),fe+=ee.length-1):ae.push(ie)}(!ue||!space.test(ie))&&(ue=possibleDivide.exec(h.substring(fe)))&&notDivide.test(h.substring(0,fe+ue[1].length))&&(ue=null)}Z=R&&ie==="\\"}if(te&&te==="*")throw new SyntaxError(`Unclosed comment '/*': ${h.substring(ne)}`);return{str:ae.join(""),length:fe}}function parse$1(t,h=!1,E=!1){if(typeof t!="string")throw new ParseError(`Cannot parse ${t}`,t);let R=" "+t;const Y={strings:[],literals:[],regexes:[],eager:h};R=extractConstants(Y,R).str;for(let Z of Y.literals)Z[2]=Z.tempJsStrings.map(ee=>lispifyExpr(Y,new CodeString(ee))),delete Z.tempJsStrings;return{tree:lispifyFunction(new CodeString(R),Y,E),constants:Y}}class ExecReturn{constructor(h,E,R,Y=!1,Z=!1){this.auditReport=h,this.result=E,this.returned=R,this.breakLoop=Y,this.continueLoop=Z}}class Prop{constructor(h,E,R=!1,Y=!1,Z=!1){this.context=h,this.prop=E,this.isConst=R,this.isGlobal=Y,this.isVariable=Z}get(h){if(this.context===void 0)throw new ReferenceError(`${this.prop} is not defined`);return h.getSubscriptions.forEach(E=>E(this.context,this.prop)),this.context[this.prop]}}const optional={},reservedWords=new Set(["instanceof","typeof","return","try","catch","if","finally","else","in","of","var","let","const","for","delete","false","true","while","do","break","continue","new","function","async","await","switch","case"]);var VarType;(function(t){t.let="let",t.const="const",t.var="var"})(VarType||(VarType={}));function keysOnly(t){const h=Object.assign({},t);for(let E in h)h[E]=!0;return h}class Scope{constructor(h,E={},R){this.const={},this.let={},this.var={};const Y=R!==void 0||h===null;this.parent=h,this.allVars=E,this.let=Y?this.let:keysOnly(E),this.var=Y?keysOnly(E):this.var,this.globals=h===null?keysOnly(E):{},this.functionThis=R}get(h,E=!1){if(h==="this"&&this.functionThis!==void 0)return new Prop({this:this.functionThis},h,!0,!1,!0);if(reservedWords.has(h))throw new SyntaxError("Unexepected token '"+h+"'");if(this.parent===null||!E||this.functionThis!==void 0){if(this.globals.hasOwnProperty(h))return new Prop(this.functionThis,h,!1,!0,!0);if(h in this.allVars&&(!(h in{})||this.allVars.hasOwnProperty(h)))return new Prop(this.allVars,h,this.const.hasOwnProperty(h),this.globals.hasOwnProperty(h),!0);if(this.parent===null)return new Prop(void 0,h)}return this.parent.get(h,E)}set(h,E){if(h==="this")throw new SyntaxError('"this" cannot be assigned');if(reservedWords.has(h))throw new SyntaxError("Unexepected token '"+h+"'");let R=this.get(h);if(R.context===void 0)throw new ReferenceError(`Variable '${h}' was not declared.`);if(R.isConst)throw new TypeError(`Cannot assign to const variable '${h}'`);if(R.isGlobal)throw new SandboxError(`Cannot override global variable '${h}'`);return R.context[R.prop]=E,R}declare(h,E=null,R=void 0,Y=!1){if(h==="this")throw new SyntaxError('"this" cannot be declared');if(reservedWords.has(h))throw new SyntaxError("Unexepected token '"+h+"'");if(E==="var"&&this.functionThis===void 0&&this.parent!==null)return this.parent.declare(h,E,R,Y);if(this[E].hasOwnProperty(h)&&E!=="const"&&!this.globals.hasOwnProperty(h)||!(h in this.allVars))Y&&(this.globals[h]=!0),this[E][h]=!0,this.allVars[h]=R;else throw new SandboxError(`Identifier '${h}' has already been declared`);return new Prop(this.allVars,h,this.const.hasOwnProperty(h),Y)}}class LocalScope{}class SandboxError extends Error{}let currentTicks;function sandboxFunction(t,h){return E;function E(...R){let Y=R.pop()||"",Z=parse$1(Y);return createFunction(R,Z.tree,currentTicks,{...t,constants:Z.constants,tree:Z.tree},void 0,"anonymous")}}function generateArgs(t,h){const E={};return t.forEach((R,Y)=>{R.startsWith("...")?E[R.substring(3)]=h.slice(Y):E[R]=h[Y]}),E}const sandboxedFunctions=new WeakSet;function createFunction(t,h,E,R,Y,Z){if(R.ctx.options.forbidFunctionCreation)throw new SandboxError("Function creation is forbidden");let ee;return Z===void 0?ee=(...te)=>{const ne=generateArgs(t,te);return executeTree(E,R,h,Y===void 0?[]:[new Scope(Y,ne)]).result}:ee=function(...ne){const oe=generateArgs(t,ne);return executeTree(E,R,h,Y===void 0?[]:[new Scope(Y,oe,this)]).result},R.registerSandboxFunction(ee),sandboxedFunctions.add(ee),ee}function createFunctionAsync(t,h,E,R,Y,Z){var te;if(R.ctx.options.forbidFunctionCreation)throw new SandboxError("Function creation is forbidden");if(!((te=R.ctx.prototypeWhitelist)!=null&&te.has(Promise.prototype)))throw new SandboxError("Async/await not permitted");let ee;return Z===void 0?ee=async(...ne)=>{const oe=generateArgs(t,ne);return(await executeTreeAsync(E,R,h,Y===void 0?[]:[new Scope(Y,oe)])).result}:ee=async function(...oe){const ie=generateArgs(t,oe);return(await executeTreeAsync(E,R,h,Y===void 0?[]:[new Scope(Y,ie,this)])).result},R.registerSandboxFunction(ee),sandboxedFunctions.add(ee),ee}function sandboxedEval(t){return h;function h(E){return t(E)()}}function sandboxedSetTimeout(t){return function(E,...R){return typeof E!="string"?setTimeout(E,...R):setTimeout(t(E),...R)}}function sandboxedSetInterval(t){return function(E,...R){return typeof E!="string"?setInterval(E,...R):setInterval(t(E),...R)}}function assignCheck(t,h,E="assign"){var R,Y,Z,ee,te,ne,oe,ie;if(t.context===void 0)throw new ReferenceError(`Cannot ${E} value to undefined.`);if(typeof t.context!="object"&&typeof t.context!="function")throw new SyntaxError(`Cannot ${E} value to a primitive.`);if(t.isConst)throw new TypeError(`Cannot set value to const variable '${t.prop}'`);if(t.isGlobal)throw new SandboxError(`Cannot ${E} property '${t.prop}' of a global object`);if(typeof t.context[t.prop]=="function"&&!t.context.hasOwnProperty(t.prop))throw new SandboxError(`Override prototype property '${t.prop}' not allowed`);E==="delete"?t.context.hasOwnProperty(t.prop)&&((R=h.changeSubscriptions.get(t.context))==null||R.forEach(ae=>ae({type:"delete",prop:t.prop})),(Y=h.changeSubscriptionsGlobal.get(t.context))==null||Y.forEach(ae=>ae({type:"delete",prop:t.prop}))):t.context.hasOwnProperty(t.prop)?((ee=(Z=h.setSubscriptions.get(t.context))==null?void 0:Z.get(t.prop))==null||ee.forEach(ae=>ae({type:"replace"})),(ne=(te=h.setSubscriptionsGlobal.get(t.context))==null?void 0:te.get(t.prop))==null||ne.forEach(ae=>ae({type:"replace"}))):((oe=h.changeSubscriptions.get(t.context))==null||oe.forEach(ae=>ae({type:"create",prop:t.prop})),(ie=h.changeSubscriptionsGlobal.get(t.context))==null||ie.forEach(ae=>ae({type:"create",prop:t.prop})))}const arrayChange=new Set([[].push,[].pop,[].shift,[].unshift,[].splice,[].reverse,[].sort,[].copyWithin]);class KeyVal{constructor(h,E){this.key=h,this.val=E}}class SpreadObject{constructor(h){this.item=h}}class SpreadArray{constructor(h){this.item=h}}class If{constructor(h,E){this.t=h,this.f=E}}const literalRegex=/(\$\$)*(\$)?\${(\d+)}/g,ops=new Map;function addOps(t,h){ops.set(t,h)}addOps(1,(t,h,E,R,Y,Z,ee,te)=>{if(R===null)throw new TypeError(`Cannot get property ${Y} of null`);const ne=typeof R;if(ne==="undefined"&&Z===void 0){let se=te.get(Y);if(se.context===ee.ctx.sandboxGlobal){ee.ctx.options.audit&&ee.ctx.auditReport.globalsAccess.add(Y);const ue=ee.ctx.globalsWhitelist.has(ee.ctx.sandboxGlobal[Y])?ee.evals.get(ee.ctx.sandboxGlobal[Y]):void 0;if(ue){h(void 0,ue);return}}if(se.context&&se.context[Y]===globalThis){h(void 0,ee.ctx.globalScope.get("this"));return}h(void 0,se);return}else if(R===void 0)throw new SandboxError("Cannot get property '"+Y+"' of undefined");if(ne!=="object")ne==="number"?R=new Number(R):ne==="string"?R=new String(R):ne==="boolean"&&(R=new Boolean(R));else if(typeof R.hasOwnProperty>"u"){h(void 0,new Prop(void 0,Y));return}const oe=ne==="function";let ie=oe||!(R.hasOwnProperty(Y)||typeof Y=="number");if(ee.ctx.options.audit&&ie&&typeof Y=="string"){let se=Object.getPrototypeOf(R);do se.hasOwnProperty(Y)&&(ee.ctx.auditReport.prototypeAccess[se.constructor.name]||(ee.ctx.auditReport.prototypeAccess[se.constructor.name]=new Set),ee.ctx.auditReport.prototypeAccess[se.constructor.name].add(Y));while(se=Object.getPrototypeOf(se))}if(ie){if(oe){if(!["name","length","constructor"].includes(Y)&&R.hasOwnProperty(Y)){const se=ee.ctx.prototypeWhitelist.get(R.prototype),ue=ee.ctx.options.prototypeReplacements.get(R);if(ue){h(void 0,new Prop(ue(R,!0),Y));return}if(!(se&&(!se.size||se.has(Y))))throw new SandboxError(`Static method or property access not permitted: ${R.name}.${Y}`)}}else if(Y!=="constructor"){let se=R;for(;se=Object.getPrototypeOf(se);)if(se.hasOwnProperty(Y)){const ue=ee.ctx.prototypeWhitelist.get(se),fe=ee.ctx.options.prototypeReplacements.get(se.constuctor);if(fe){h(void 0,new Prop(fe(R,!1),Y));return}if(ue&&(!ue.size||ue.has(Y)))break;throw new SandboxError(`Method or property access not permitted: ${se.constructor.name}.${Y}`)}}}if(ee.evals.has(R[Y])){h(void 0,ee.evals.get(R[Y]));return}if(R[Y]===globalThis){h(void 0,ee.ctx.globalScope.get("this"));return}let ae=Z.isGlobal||oe&&!sandboxedFunctions.has(R)||ee.ctx.globalsWhitelist.has(R);h(void 0,new Prop(R,Y,!1,ae))}),addOps(5,(t,h,E,R,Y,Z,ee,te)=>{var oe,ie;if(ee.ctx.options.forbidFunctionCalls)throw new SandboxError("Function invocations are not allowed");if(typeof R!="function")throw new TypeError(`${typeof Z.prop=="symbol"?"Symbol":Z.prop} is not a function`);const ne=Y.map(ae=>ae instanceof SpreadArray?[...ae.item]:[ae]).flat().map(ae=>valueOrProp(ae,ee));if(typeof Z=="function"){h(void 0,Z(...ne));return}if(Z.context[Z.prop]===JSON.stringify&&ee.getSubscriptions.size){const ae=new Set,se=ue=>{if(!(!ue||typeof ue!="object"||ae.has(ue))){ae.add(ue);for(let fe in ue)ee.getSubscriptions.forEach(le=>le(ue,fe)),se(ue[fe])}};se(ne[0])}if(Z.context instanceof Array&&arrayChange.has(Z.context[Z.prop])&&(ee.changeSubscriptions.get(Z.context)||ee.changeSubscriptionsGlobal.get(Z.context))){let ae,se=!1;if(Z.prop==="push")ae={type:"push",added:ne},se=!!ne.length;else if(Z.prop==="pop")ae={type:"pop",removed:Z.context.slice(-1)},se=!!ae.removed.length;else if(Z.prop==="shift")ae={type:"shift",removed:Z.context.slice(0,1)},se=!!ae.removed.length;else if(Z.prop==="unshift")ae={type:"unshift",added:ne},se=!!ne.length;else if(Z.prop==="splice")ae={type:"splice",startIndex:ne[0],deleteCount:ne[1]===void 0?Z.context.length:ne[1],added:ne.slice(2),removed:Z.context.slice(ne[0],ne[1]===void 0?void 0:ne[0]+ne[1])},se=!!ae.added.length||!!ae.removed.length;else if(Z.prop==="reverse"||Z.prop==="sort")ae={type:Z.prop},se=!!Z.context.length;else if(Z.prop==="copyWithin"){let ue=ne[2]===void 0?Z.context.length-ne[1]:Math.min(Z.context.length,ne[2]-ne[1]);ae={type:"copyWithin",startIndex:ne[0],endIndex:ne[0]+ue,added:Z.context.slice(ne[1],ne[1]+ue),removed:Z.context.slice(ne[0],ne[0]+ue)},se=!!ae.added.length||!!ae.removed.length}se&&((oe=ee.changeSubscriptions.get(Z.context))==null||oe.forEach(ue=>ue(ae)),(ie=ee.changeSubscriptionsGlobal.get(Z.context))==null||ie.forEach(ue=>ue(ae)))}Z.get(ee),h(void 0,Z.context[Z.prop](...ne))}),addOps(22,(t,h,E,R,Y,Z,ee,te)=>{let ne={};for(let oe of Y)oe.key instanceof SpreadObject?ne={...ne,...oe.key.item}:ne[oe.key]=oe.val;h(void 0,ne)}),addOps(6,(t,h,E,R,Y)=>h(void 0,new KeyVal(R,Y))),addOps(12,(t,h,E,R,Y,Z,ee,te)=>{const ne=Y.map(oe=>oe instanceof SpreadArray?[...oe.item]:[oe]).flat().map(oe=>valueOrProp(oe,ee));h(void 0,ne)}),addOps(23,(t,h,E,R,Y)=>h(void 0,Y)),addOps(35,(t,h,E,R,Y)=>{switch(Y){case"true":return h(void 0,!0);case"false":return h(void 0,!1);case"null":return h(void 0,null);case"undefined":return h(void 0,void 0);case"NaN":return h(void 0,NaN);case"Infinity":return h(void 0,1/0)}h(new Error("Unknown symbol: "+Y))}),addOps(7,(t,h,E,R,Y)=>h(void 0,Number(Y))),addOps(83,(t,h,E,R,Y)=>h(void 0,BigInt(Y))),addOps(2,(t,h,E,R,Y,Z,ee)=>h(void 0,ee.constants.strings[parseInt(Y)])),addOps(85,(t,h,E,R,Y,Z,ee)=>{const te=ee.constants.regexes[parseInt(Y)];if(ee.ctx.globalsWhitelist.has(RegExp))h(void 0,new RegExp(te.regex,te.flags));else throw new SandboxError("Regex not permitted")}),addOps(84,(t,h,E,R,Y,Z,ee,te)=>{let ne=ee.constants.literals[parseInt(Y)];const[,oe,ie]=ne;let ae=[],se,ue=[];for(;se=literalRegex.exec(oe);)se[2]||(ae.push(ie[parseInt(se[3],10)]),ue.push(se[3]));t(E,ae,te,ee,(fe,le)=>{const de={};if(fe){h(fe);return}for(let ce in ue){const pe=ue[ce];de[pe]=le[ce]}h(void 0,oe.replace(/(\\\\)*(\\)?\${(\d+)}/g,(ce,pe,he,ge)=>{if(he)return ce;let ve=de[ge];return(pe||"")+`${valueOrProp(ve,ee)}`}))})}),addOps(18,(t,h,E,R,Y,Z,ee,te)=>{h(void 0,new SpreadArray(Y))}),addOps(17,(t,h,E,R,Y,Z,ee,te)=>{h(void 0,new SpreadObject(Y))}),addOps(24,(t,h,E,R,Y)=>h(void 0,!Y)),addOps(64,(t,h,E,R,Y)=>h(void 0,~Y)),addOps(25,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,++Z.context[Z.prop])}),addOps(26,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]++)}),addOps(27,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,--Z.context[Z.prop])}),addOps(28,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]--)}),addOps(9,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]=Y)}),addOps(66,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]+=Y)}),addOps(65,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]-=Y)}),addOps(67,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]/=Y)}),addOps(69,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]*=Y)}),addOps(68,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]**=Y)}),addOps(70,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]%=Y)}),addOps(71,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]^=Y)}),addOps(72,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]&=Y)}),addOps(73,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]|=Y)}),addOps(76,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]<<=Y)}),addOps(75,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]>>=Y)}),addOps(74,(t,h,E,R,Y,Z,ee)=>{assignCheck(Z,ee),h(void 0,Z.context[Z.prop]>>=Y)}),addOps(57,(t,h,E,R,Y)=>h(void 0,R>Y)),addOps(56,(t,h,E,R,Y)=>h(void 0,R<Y)),addOps(55,(t,h,E,R,Y)=>h(void 0,R>=Y)),addOps(54,(t,h,E,R,Y)=>h(void 0,R<=Y)),addOps(52,(t,h,E,R,Y)=>h(void 0,R==Y)),addOps(32,(t,h,E,R,Y)=>h(void 0,R===Y)),addOps(53,(t,h,E,R,Y)=>h(void 0,R!=Y)),addOps(31,(t,h,E,R,Y)=>h(void 0,R!==Y)),addOps(29,(t,h,E,R,Y)=>h(void 0,R&&Y)),addOps(30,(t,h,E,R,Y)=>h(void 0,R||Y)),addOps(77,(t,h,E,R,Y)=>h(void 0,R&Y)),addOps(78,(t,h,E,R,Y)=>h(void 0,R|Y)),addOps(33,(t,h,E,R,Y)=>h(void 0,R+Y)),addOps(47,(t,h,E,R,Y)=>h(void 0,R-Y)),addOps(59,(t,h,E,R,Y)=>h(void 0,+Y)),addOps(58,(t,h,E,R,Y)=>h(void 0,-Y)),addOps(48,(t,h,E,R,Y)=>h(void 0,R/Y)),addOps(79,(t,h,E,R,Y)=>h(void 0,R^Y)),addOps(50,(t,h,E,R,Y)=>h(void 0,R*Y)),addOps(51,(t,h,E,R,Y)=>h(void 0,R%Y)),addOps(80,(t,h,E,R,Y)=>h(void 0,R<<Y)),addOps(81,(t,h,E,R,Y)=>h(void 0,R>>Y)),addOps(82,(t,h,E,R,Y)=>h(void 0,R>>>Y)),addOps(60,(t,h,E,R,Y,Z,ee,te)=>{t(E,Y,te,ee,(ne,oe)=>{h(void 0,typeof valueOrProp(oe,ee))})}),addOps(62,(t,h,E,R,Y)=>h(void 0,R instanceof Y)),addOps(63,(t,h,E,R,Y)=>h(void 0,R in Y)),addOps(61,(t,h,E,R,Y,Z,ee,te,ne)=>{if(ne.context===void 0){h(void 0,!0);return}if(assignCheck(ne,ee,"delete"),ne.isVariable){h(void 0,!1);return}h(void 0,delete ne.context[ne.prop])}),addOps(8,(t,h,E,R,Y,Z,ee)=>h(void 0,Y)),addOps(34,(t,h,E,R,Y,Z,ee,te,ne)=>{h(void 0,te.declare(R,VarType.var,Y))}),addOps(3,(t,h,E,R,Y,Z,ee,te,ne)=>{h(void 0,te.declare(R,VarType.let,Y,ne&&ne.isGlobal))}),addOps(4,(t,h,E,R,Y,Z,ee,te,ne)=>{h(void 0,te.declare(R,VarType.const,Y))}),addOps(11,(t,h,E,R,Y,Z,ee,te)=>{R=[...R],(typeof Z[2]=="string"||Z[2]instanceof CodeString)&&(Z[2]=Y=lispifyFunction(new CodeString(Z[2]),ee.constants)),R.shift()?h(void 0,createFunctionAsync(R,Y,E,ee,te)):h(void 0,createFunction(R,Y,E,ee,te))}),addOps(37,(t,h,E,R,Y,Z,ee,te)=>{(typeof Z[2]=="string"||Z[2]instanceof CodeString)&&(Z[2]=Y=lispifyFunction(new CodeString(Z[2]),ee.constants));let ne=R.shift(),oe=R.shift(),ie;ne===88?ie=createFunctionAsync(R,Y,E,ee,te,oe):ie=createFunction(R,Y,E,ee,te,oe),oe&&te.declare(oe,VarType.var,ie),h(void 0,ie)}),addOps(10,(t,h,E,R,Y,Z,ee,te)=>{(typeof Z[2]=="string"||Z[2]instanceof CodeString)&&(Z[2]=Y=lispifyFunction(new CodeString(Z[2]),ee.constants));let ne=R.shift(),oe=R.shift();oe&&(te=new Scope(te,{}));let ie;ne===88?ie=createFunctionAsync(R,Y,E,ee,te,oe):ie=createFunction(R,Y,E,ee,te,oe),oe&&te.declare(oe,VarType.let,ie),h(void 0,ie)}),addOps(38,(t,h,E,R,Y,Z,ee,te)=>{const[ne,oe,ie,ae,se,ue,fe]=R;let le=!0;const de=new Scope(te,{});let ce={$$obj:void 0};const pe=new Scope(de,ce);if(t===execAsync)(async()=>{let he;for(he=asyncDone(ge=>t(E,ae,de,ee,ge)),ce.$$obj=(he=asyncDone(ge=>t(E,ie,de,ee,ge))).isInstant===!0?he.instant:(await he.p).result,he=asyncDone(ge=>t(E,oe,pe,ee,ge)),ne&&(le=(he=asyncDone(ge=>t(E,ue,pe,ee,ge))).isInstant===!0?he.instant:(await he.p).result);le;){let ge={};he=asyncDone(_e=>t(E,fe,new Scope(pe,ge),ee,_e)),he.isInstant===!0?he.instant:(await he.p).result;let ve=await executeTreeAsync(E,ee,Y,[new Scope(de,ge)],"loop");if(ve instanceof ExecReturn&&ve.returned){h(void 0,ve);return}if(ve instanceof ExecReturn&&ve.breakLoop)break;he=asyncDone(_e=>t(E,se,pe,ee,_e)),le=(he=asyncDone(_e=>t(E,ue,pe,ee,_e))).isInstant===!0?he.instant:(await he.p).result}h()})().catch(h);else{for(syncDone(he=>t(E,ae,de,ee,he)),ce.$$obj=syncDone(he=>t(E,ie,de,ee,he)).result,syncDone(he=>t(E,oe,pe,ee,he)),ne&&(le=syncDone(he=>t(E,ue,pe,ee,he)).result);le;){let he={};syncDone(ve=>t(E,fe,new Scope(pe,he),ee,ve));let ge=executeTree(E,ee,Y,[new Scope(de,he)],"loop");if(ge instanceof ExecReturn&&ge.returned){h(void 0,ge);return}if(ge instanceof ExecReturn&&ge.breakLoop)break;syncDone(ve=>t(E,se,pe,ee,ve)),le=syncDone(ve=>t(E,ue,pe,ee,ve)).result}h()}}),addOps(86,(t,h,E,R,Y,Z,ee,te,ne,oe)=>{if(oe==="switch"&&R==="continue"||!oe)throw new SandboxError("Illegal "+R+" statement");h(void 0,new ExecReturn(ee.ctx.auditReport,void 0,!1,R==="break",R==="continue"))}),addOps(13,(t,h,E,R,Y,Z,ee,te,ne,oe)=>{t(E,valueOrProp(R,ee)?Y.t:Y.f,te,ee,h)}),addOps(15,(t,h,E,R,Y,Z,ee,te)=>{t(E,valueOrProp(R,ee)?Y.t:Y.f,te,ee,h)}),addOps(16,(t,h,E,R,Y)=>h(void 0,new If(R,Y))),addOps(14,(t,h,E,R,Y)=>h(void 0,new If(R,Y))),addOps(40,(t,h,E,R,Y,Z,ee,te)=>{t(E,R,te,ee,(ne,oe)=>{if(ne){h(ne);return}if(oe=valueOrProp(oe,ee),t===execSync){let ie,ae=!1;for(let se of Y)if(ae||(ae=!se[1]||oe===valueOrProp(syncDone(ue=>t(E,se[1],te,ee,ue)).result,ee))){if(!se[2])continue;if(ie=executeTree(E,ee,se[2],[te],"switch"),ie.breakLoop)break;if(ie.returned){h(void 0,ie);return}if(!se[1])break}h()}else(async()=>{let ie,ae=!1;for(let se of Y){let ue;if(ae||(ae=!se[1]||oe===valueOrProp((ue=asyncDone(fe=>t(E,se[1],te,ee,fe))).isInstant===!0?ue.instant:(await ue.p).result,ee))){if(!se[2])continue;if(ie=await executeTreeAsync(E,ee,se[2],[te],"switch"),ie.breakLoop)break;if(ie.returned){h(void 0,ie);return}if(!se[1])break}}h()})().catch(h)})}),addOps(39,(t,h,E,R,Y,Z,ee,te,ne,oe)=>{const[ie,ae,se]=Y;executeTreeWithDone(t,(ue,fe)=>{executeTreeWithDone(t,le=>{le?h(le):ue?executeTreeWithDone(t,h,E,ee,ae,[new Scope(te)],oe):h(void 0,fe)},E,ee,se,[new Scope(te,{})])},E,ee,R,[new Scope(te)],oe)}),addOps(87,(t,h,E,R)=>{h()}),addOps(45,(t,h,E,R,Y,Z,ee)=>{if(!ee.ctx.globalsWhitelist.has(R)&&!sandboxedFunctions.has(R))throw new SandboxError(`Object construction not allowed: ${R.constructor.name}`);h(void 0,new R(...Y))}),addOps(46,(t,h,E,R,Y)=>{h(Y)}),addOps(43,(t,h,E,R)=>h(void 0,R.pop())),addOps(0,(t,h,E,R)=>h());function valueOrProp(t,h){if(t instanceof Prop)return t.get(h);if(t!==optional)return t}function execMany(t,h,E,R,Y,Z,ee){h===execSync?_execManySync(t,E,R,Y,Z,ee):_execManyAsync(t,E,R,Y,Z,ee).catch(R)}function _execManySync(t,h,E,R,Y,Z){let ee=[];for(let te=0;te<h.length;te++){let ne;try{ne=syncDone(oe=>execSync(t,h[te],R,Y,oe,Z)).result}catch(oe){E(oe);return}if(ne instanceof ExecReturn&&(ne.returned||ne.breakLoop||ne.continueLoop)){E(void 0,ne);return}if(isLisp(h[te])&&h[te][0]===8){E(void 0,new ExecReturn(Y.ctx.auditReport,ne,!0));return}ee.push(ne)}E(void 0,ee)}async function _execManyAsync(t,h,E,R,Y,Z){let ee=[];for(let te=0;te<h.length;te++){let ne;try{let oe;ne=(oe=asyncDone(ie=>execAsync(t,h[te],R,Y,ie,Z))).isInstant===!0?oe.instant:(await oe.p).result}catch(oe){E(oe);return}if(ne instanceof ExecReturn&&(ne.returned||ne.breakLoop||ne.continueLoop)){E(void 0,ne);return}if(isLisp(h[te])&&h[te][0]===8){E(void 0,new ExecReturn(Y.ctx.auditReport,ne,!0));return}ee.push(ne)}E(void 0,ee)}function asyncDone(t){let h=!1,E;const R=new Promise((Y,Z)=>{t((ee,te)=>{ee?Z(ee):(h=!0,E=te,Y({result:te}))})});return{isInstant:h,instant:E,p:R}}function syncDone(t){let h,E;if(t((R,Y)=>{E=R,h=Y}),E)throw E;return{result:h}}async function execAsync(t,h,E,R,Y,Z){let ee=Y;const te=new Promise(ne=>{ee=(oe,ie)=>{Y(oe,ie),ne()}});if(!_execNoneRecurse(t,h,E,R,ee,!0,Z)){if(isLisp(h)){let ne=h[0],oe;try{let ue;oe=(ue=asyncDone(fe=>execAsync(t,h[1],E,R,fe,Z))).isInstant===!0?ue.instant:(await ue.p).result}catch(ue){ee(ue);return}let ie=oe;try{ie=oe instanceof Prop?oe.get(R):oe}catch(ue){ee(ue);return}if(ne===20||ne===21){if(ie==null){ee(void 0,optional);return}ne=ne===20?1:5}if(ie===optional)if(ne===1||ne===5){ee(void 0,ie);return}else ie=void 0;let ae;try{let ue;ae=(ue=asyncDone(fe=>execAsync(t,h[2],E,R,fe,Z))).isInstant===!0?ue.instant:(await ue.p).result}catch(ue){ee(ue);return}let se=ae;try{se=ae instanceof Prop?ae.get(R):ae}catch(ue){ee(ue);return}if(se===optional&&(se=void 0),ops.has(ne))try{ops.get(ne)(execAsync,ee,t,ie,se,oe,R,E,ae,Z)}catch(ue){ee(ue)}else ee(new SyntaxError("Unknown operator: "+ne))}}await te}function execSync(t,h,E,R,Y,Z){if(!_execNoneRecurse(t,h,E,R,Y,!1,Z)){if(isLisp(h)){let ee=h[0],te;try{te=syncDone(ae=>execSync(t,h[1],E,R,ae,Z)).result}catch(ae){Y(ae);return}let ne=te;try{ne=te instanceof Prop?te.get(R):te}catch(ae){Y(ae);return}if(ee===20||ee===21){if(ne==null){Y(void 0,optional);return}ee=ee===20?1:5}if(ne===optional)if(ee===1||ee===5){Y(void 0,ne);return}else ne=void 0;let oe;try{oe=syncDone(ae=>execSync(t,h[2],E,R,ae,Z)).result}catch(ae){Y(ae);return}let ie=oe;try{ie=oe instanceof Prop?oe.get(R):oe}catch(ae){Y(ae);return}if(ie===optional&&(ie=void 0),ops.has(ee))try{ops.get(ee)(execSync,Y,t,ne,ie,te,R,E,oe,Z)}catch(ae){Y(ae)}else Y(new SyntaxError("Unknown operator: "+ee))}}}const unexecTypes=new Set([11,37,10,38,39,40,14,16,60]);function _execNoneRecurse(t,h,E,R,Y,Z,ee){var ne;const te=Z?execAsync:execSync;if(R.ctx.options.executionQuota<=t.ticks&&!(typeof R.ctx.options.onExecutionQuotaReached=="function"&&R.ctx.options.onExecutionQuotaReached(t,E,R,h))){Y(new SandboxError("Execution quota exceeded"));return}if(t.ticks++,currentTicks=t,h instanceof Prop)try{Y(void 0,h.get(R))}catch(oe){Y(oe)}else if(h===optional)Y();else if(Array.isArray(h)&&!isLisp(h))h[0]===0?Y():execMany(t,te,h,Y,E,R,ee);else if(!isLisp(h))Y(void 0,h);else if(h[0]===42)execMany(t,te,h[1],Y,E,R,ee);else if(h[0]===44)Z?(ne=R.ctx.prototypeWhitelist)!=null&&ne.has(Promise.prototype)?execAsync(t,h[1],E,R,async(oe,ie)=>{if(oe)Y(oe);else try{Y(void 0,await valueOrProp(ie,R))}catch(ae){Y(ae)}},ee).catch(Y):Y(new SandboxError("Async/await is not permitted")):Y(new SandboxError("Illegal use of 'await', must be inside async function"));else if(unexecTypes.has(h[0]))try{ops.get(h[0])(te,Y,t,h[1],h[2],h,R,E,void 0,ee)}catch(oe){Y(oe)}else return!1;return!0}function executeTree(t,h,E,R=[],Y){return syncDone(Z=>executeTreeWithDone(execSync,Z,t,h,E,R,Y)).result}async function executeTreeAsync(t,h,E,R=[],Y){let Z;return(Z=asyncDone(ee=>executeTreeWithDone(execAsync,ee,t,h,E,R,Y))).isInstant===!0?Z.instant:(await Z.p).result}function executeTreeWithDone(t,h,E,R,Y,Z=[],ee){if(!Y){h();return}if(!(Y instanceof Array))throw new SyntaxError("Bad execution tree");let te=R.ctx.globalScope,ne;for(;ne=Z.shift();)typeof ne=="object"&&(ne instanceof Scope?te=ne:te=new Scope(te,ne,ne instanceof LocalScope?void 0:null));R.ctx.options.audit&&!R.ctx.auditReport&&(R.ctx.auditReport={globalsAccess:new Set,prototypeAccess:{}}),t===execSync?_executeWithDoneSync(h,E,R,Y,te,ee):_executeWithDoneAsync(h,E,R,Y,te,ee).catch(h)}function _executeWithDoneSync(t,h,E,R,Y,Z){if(!(R instanceof Array))throw new SyntaxError("Bad execution tree");let ee=0;for(ee=0;ee<R.length;ee++){let te,ne;const oe=R[ee];try{execSync(h,oe,Y,E,(ie,ae)=>{ne=ie,te=ae},Z)}catch(ie){ne=ie}if(ne){t(ne);return}if(te instanceof ExecReturn){t(void 0,te);return}if(isLisp(oe)&&oe[0]===8){t(void 0,new ExecReturn(E.ctx.auditReport,te,!0));return}}t(void 0,new ExecReturn(E.ctx.auditReport,void 0,!1))}async function _executeWithDoneAsync(t,h,E,R,Y,Z){if(!(R instanceof Array))throw new SyntaxError("Bad execution tree");let ee=0;for(ee=0;ee<R.length;ee++){let te,ne;const oe=R[ee];try{await execAsync(h,oe,Y,E,(ie,ae)=>{ne=ie,te=ae},Z)}catch(ie){ne=ie}if(ne){t(ne);return}if(te instanceof ExecReturn){t(void 0,te);return}if(isLisp(oe)&&oe[0]===8){t(void 0,new ExecReturn(E.ctx.auditReport,te,!0));return}}t(void 0,new ExecReturn(E.ctx.auditReport,void 0,!1))}class SandboxGlobal{constructor(h){if(h===globalThis)return globalThis;for(let E in h)this[E]=h[E]}}class ExecContext{constructor(h,E,R,Y,Z,ee,te,ne,oe,ie){this.ctx=h,this.constants=E,this.tree=R,this.getSubscriptions=Y,this.setSubscriptions=Z,this.changeSubscriptions=ee,this.setSubscriptionsGlobal=te,this.changeSubscriptionsGlobal=ne,this.evals=oe,this.registerSandboxFunction=ie}}function subscribeSet(t,h,E,R){const Y=R.setSubscriptions.get(t)||new Map;R.setSubscriptions.set(t,Y);const Z=Y.get(h)||new Set;Y.set(h,Z),Z.add(E);let ee;return t&&t[h]&&typeof t[h]=="object"&&(ee=R.changeSubscriptions.get(t[h])||new Set,ee.add(E),R.changeSubscriptions.set(t[h],ee)),{unsubscribe:()=>{Z.delete(E),ee==null||ee.delete(E)}}}class Sandbox{constructor(h){this.setSubscriptions=new WeakMap,this.changeSubscriptions=new WeakMap,this.sandboxFunctions=new WeakMap,h=Object.assign({audit:!1,forbidFunctionCalls:!1,forbidFunctionCreation:!1,globals:Sandbox.SAFE_GLOBALS,prototypeWhitelist:Sandbox.SAFE_PROTOTYPES,prototypeReplacements:new Map},h||{});const E=new SandboxGlobal(h.globals);this.context={sandbox:this,globalsWhitelist:new Set(Object.values(h.globals)),prototypeWhitelist:new Map([...h.prototypeWhitelist].map(R=>[R[0].prototype,R[1]])),options:h,globalScope:new Scope(null,h.globals,E),sandboxGlobal:E},this.context.prototypeWhitelist.set(Object.getPrototypeOf([][Symbol.iterator]()),new Set)}static get SAFE_GLOBALS(){return{Function,console:{debug:console.debug,error:console.error,info:console.info,log:console.log,table:console.table,warn:console.warn},isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,Boolean,Number,BigInt,String,Object,Array,Symbol,Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Map,Set,WeakMap,WeakSet,Promise,Intl,JSON,Math,Date,RegExp}}static get SAFE_PROTOTYPES(){let h=[SandboxGlobal,Function,Boolean,Number,BigInt,String,Date,Error,Array,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Map,Set,WeakMap,WeakSet,Promise,Symbol,Date,RegExp],E=new Map;return h.forEach(R=>{E.set(R,new Set)}),E.set(Object,new Set(["entries","fromEntries","getOwnPropertyNames","is","keys","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","values"])),E}subscribeGet(h,E){return E.getSubscriptions.add(h),{unsubscribe:()=>E.getSubscriptions.delete(h)}}subscribeSet(h,E,R,Y){return subscribeSet(h,E,R,Y)}subscribeSetGlobal(h,E,R){return subscribeSet(h,E,R,this)}static audit(h,E=[]){const R={};for(let Z of Object.getOwnPropertyNames(globalThis))R[Z]=globalThis[Z];const Y=new Sandbox({globals:R,audit:!0});return Y.executeTree(Y.createContext(Y.context,parse$1(h)),E)}static parse(h){return parse$1(h)}createContext(h,E){const R=new Map,Y=new ExecContext(h,E.constants,E.tree,new Set,new WeakMap,new WeakMap,this.setSubscriptions,this.changeSubscriptions,R,ee=>this.sandboxFunctions.set(ee,Y)),Z=sandboxFunction(Y);return R.set(Function,Z),R.set(eval,sandboxedEval(Z)),R.set(setTimeout,sandboxedSetTimeout(Z)),R.set(setInterval,sandboxedSetInterval(Z)),Y}getContext(h){return this.sandboxFunctions.get(h)}executeTree(h,E=[]){return executeTree({ticks:BigInt(0)},h,h.tree,E)}executeTreeAsync(h,E=[]){return executeTreeAsync({ticks:BigInt(0)},h,h.tree,E)}compile(h,E=!1){const R=parse$1(h,E);return(...Z)=>{const ee=this.createContext(this.context,R);return{context:ee,run:()=>this.executeTree(ee,[...Z]).result}}}compileAsync(h,E=!1){const R=parse$1(h,E);return(...Z)=>{const ee=this.createContext(this.context,R);return{context:ee,run:()=>this.executeTreeAsync(ee,[...Z]).then(te=>te.result)}}}compileExpression(h,E=!1){const R=parse$1(h,E,!0);return(...Z)=>{const ee=this.createContext(this.context,R);return{context:ee,run:()=>this.executeTree(ee,[...Z]).result}}}compileExpressionAsync(h,E=!1){const R=parse$1(h,E,!0);return(...Z)=>{const ee=this.createContext(this.context,R);return{context:ee,run:()=>this.executeTreeAsync(ee,[...Z]).then(te=>te.result)}}}}const runInBrowserContext=(t,...h)=>__awaiter(void 0,[t,...h],void 0,function*(E,R={}){try{return yield new Sandbox().compile(E)(R).run()}catch(Y){console.log("runInBrowserContext error --->>>",Y)}}),getExpressionResult=(t,h)=>__awaiter(void 0,void 0,void 0,function*(){return yield runInBrowserContext(t,h)});let BaseNode$1=class{constructor({nodeConfig:h,context:E,globalData:R}){const{outgoing:Y,incoming:Z,id:ee,type:te,properties:ne}=h;this.baseType="base",this.outgoing=Y,this.incoming=Z,this.nodeId=ee,this.type=te,this.properties=ne,this.context=E,this.globalData=R}action(h){return __awaiter(this,void 0,void 0,function*(){console.log("action param --->>>",h)})}onResume(h){return __awaiter(this,void 0,void 0,function*(){console.log("onResume params --->>>",h)})}isPass(h){return __awaiter(this,void 0,void 0,function*(){if(!h)return!0;const{conditionExpression:E}=h;if(!E)return!0;try{return yield getExpressionResult(`
          const isPassResult = (${E})
          return isPassResult
        `,Object.assign({},this.globalData))}catch{return!1}})}getOutgoing(){return __awaiter(this,void 0,void 0,function*(){const h=[],E=[];for(const Y of this.outgoing){const{properties:Z}=Y;E.push(this.isPass(Z))}return(yield Promise.all(E)).forEach((Y,Z)=>{const ee=this.outgoing[Z];ee.result=Y,h.push(ee)}),h})}execute(h){return __awaiter(this,void 0,void 0,function*(){const{executionId:E,actionId:R}=h,Y=yield this.action({nodeId:this.nodeId,executionId:E,actionId:R}),Z=Y?Y.status:"success";if(Z===ActionStatus.SUCCESS){const ee=yield this.getOutgoing(),te=Y?Y.detail:{};h.next({status:ActionStatus.SUCCESS,detail:te,nodeId:this.nodeId,nodeType:this.type,properties:this.properties,executionId:E,actionId:R,outgoing:ee})}return{status:Z,detail:Y==null?void 0:Y.detail,executionId:E,actionId:R,nodeId:this.nodeId,nodeType:this.type,properties:this.properties,outgoing:[]}})}resume(h){return __awaiter(this,void 0,void 0,function*(){const E=yield this.getOutgoing();yield this.onResume({executionId:h.executionId,actionId:h.actionId,nodeId:h.nodeId,data:h.data}),h.next({executionId:h.executionId,actionId:h.actionId,nodeId:this.nodeId,nodeType:this.type,properties:this.properties,outgoing:E,status:ActionStatus.SUCCESS})})}};BaseNode$1.nodeTypeName="BaseNode";let StartNode$1=class extends BaseNode$1{constructor(){super(...arguments),this.baseType="start"}};StartNode$1.nodeTypeName="StartNode";class TaskNode extends BaseNode$1{constructor(){super(...arguments),this.baseType="task"}}TaskNode.nodeTypeName="TaskNode";let EventEmitter$1=class{constructor(){this._events={}}on(h,E,R){h=h.trim(),this._events[h]||(this._events[h]=[]),this._events[h].push({callback:E,once:!!R})}off(h,E){if(h||(this._events={}),!E)delete this._events[h];else{const R=this._events[h]||[];let{length:Y}=R;for(let Z=0;Z<Y;Z++)R[Z].callback===E&&(R.splice(Z,1),Y--,Z--);R.length===0&&delete this._events[h]}}emit(h,E){const R=this._events[h]||[];(Z=>{let{length:ee}=Z;for(let te=0;te<ee;te++){if(!Z[te])continue;const{callback:ne,once:oe}=Z[te];oe&&(Z.splice(te,1),Z.length===0&&delete this._events[h],ee--,te--),ne.apply(this,[E])}})(R)}getEvents(){return this._events}};const isInBrowser=typeof window=="object"&&window.window===window,isInNodeJS=typeof global=="object"&&global.global===global,globalScope=isInBrowser?window:typeof self=="object"&&self.self===self?self:isInNodeJS?global:typeof globalThis=="object"?globalThis:{eval:()=>{}};if(!globalScope.sessionStorage){const t={data:{},setItem(h,E){t.data[h]=E},getItem(h){return t.data[h]},removeItem(h){delete t.data[h]},clear(){t.data={}}};globalScope.sessionStorage=t}const storage={setItem(t,h){typeof h=="object"&&(h=JSON.stringify(h)),globalScope.sessionStorage.setItem(t,h)},getItem(t){const h=globalScope.sessionStorage.getItem(t);try{return JSON.parse(h)}catch{return h}},removeItem(t){globalScope.sessionStorage.removeItem(t)},clear(){globalScope.sessionStorage.clear()}};var getRandomValues$1,rnds8$1=new Uint8Array(16);function rng$1(){if(!getRandomValues$1&&(getRandomValues$1=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues$1))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues$1(rnds8$1)}const REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(t){return typeof t=="string"&&REGEX.test(t)}for(var byteToHex$1=[],i$2=0;i$2<256;++i$2)byteToHex$1.push((i$2+256).toString(16).substr(1));function stringify(t){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,E=(byteToHex$1[t[h+0]]+byteToHex$1[t[h+1]]+byteToHex$1[t[h+2]]+byteToHex$1[t[h+3]]+"-"+byteToHex$1[t[h+4]]+byteToHex$1[t[h+5]]+"-"+byteToHex$1[t[h+6]]+byteToHex$1[t[h+7]]+"-"+byteToHex$1[t[h+8]]+byteToHex$1[t[h+9]]+"-"+byteToHex$1[t[h+10]]+byteToHex$1[t[h+11]]+byteToHex$1[t[h+12]]+byteToHex$1[t[h+13]]+byteToHex$1[t[h+14]]+byteToHex$1[t[h+15]]).toLowerCase();if(!validate(E))throw TypeError("Stringified UUID is invalid");return E}function v4$1(t,h,E){t=t||{};var R=t.random||(t.rng||rng$1)();return R[6]=R[6]&15|64,R[8]=R[8]&63|128,stringify(R)}const createExecId=()=>`exec-${v4$1()}`,createActionId=()=>`action-${v4$1()}`,createEngineId=()=>`engine-${v4$1()}`;class Scheduler extends EventEmitter$1{constructor(h){super(),this.nodeQueueMap=new Map,this.actionRunningMap=new Map,this.flowModel=h.flowModel,this.recorder=h.recorder}addAction(h){const{executionId:E}=h;this.nodeQueueMap.has(E)||this.nodeQueueMap.set(E,[]);const R=this.nodeQueueMap.get(E);R&&R.push(h),console.log("this.nodeQueueMap--->>>",this.nodeQueueMap)}pushActionToRunningMap(h){var E;const{executionId:R,actionId:Y}=h;if(!this.actionRunningMap.has(R)){const Z=new Map;this.actionRunningMap.set(R,Z)}Y&&((E=this.actionRunningMap.get(R))===null||E===void 0||E.set(Y,h))}removeActionFromRunningMap(h){const{executionId:E,actionId:R}=h;if(!R)return;const Y=this.actionRunningMap.get(E);Y&&Y.delete(R)}saveActionResult(h){var E;(E=this.recorder)===null||E===void 0||E.addActionRecord(Object.assign({timestamp:Date.now()},h))}hasRunningAction(h){const E=this.actionRunningMap.get(h);return E?E.size===0?(this.actionRunningMap.delete(h),!1):!0:!1}run(h){const E=this.nodeQueueMap.get(h.executionId);for(;E!=null&&E.length;){const R=E.pop(),Y=createActionId(),Z=Object.assign(Object.assign({},R),{actionId:Y});this.pushActionToRunningMap(Z),this.exec(Z)}this.hasRunningAction(h.executionId)||this.emit(EVENT_INSTANCE_COMPLETE,Object.assign(Object.assign({},h),{status:FlowStatus.COMPLETED}))}next(h){h.outgoing&&h.outgoing.length>0&&h.outgoing.forEach(E=>{E.result&&this.addAction({executionId:h.executionId,nodeId:E.target})}),this.saveActionResult(h),this.removeActionFromRunningMap(h),this.run(h)}resume(h){return __awaiter(this,void 0,void 0,function*(){const{executionId:E,actionId:R,nodeId:Y}=h;this.pushActionToRunningMap({executionId:E,actionId:R,nodeId:Y});const Z=this.flowModel.createAction(Y);yield Z==null?void 0:Z.resume(Object.assign(Object.assign({},h),{next:this.next.bind(this)}))})}interrupted(h){this.emit(EVENT_INSTANCE_INTERRUPTED,h)}error(h){this.emit(EVENT_INSTANCE_ERROR,h)}exec(h){return __awaiter(this,void 0,void 0,function*(){const{executionId:E,actionId:R,nodeId:Y}=h,Z=this.flowModel.createAction(Y),ee=yield Z==null?void 0:Z.execute({executionId:E,actionId:R,nodeId:Y,next:this.next.bind(this)});if(ee){const{nodeType:te,properties:ne,outgoing:oe,status:ie,detail:ae}=ee,se={executionId:E,actionId:R,nodeId:Y,nodeType:te,properties:ne,outgoing:oe,status:ie,detail:ae};(ee==null?void 0:ee.status)===FlowStatus.INTERRUPTED&&(this.interrupted(ee),this.saveActionResult(se),this.removeActionFromRunningMap(h)),(ee==null?void 0:ee.status)===FlowStatus.ERROR&&(this.error(ee),this.saveActionResult(se),this.removeActionFromRunningMap(h))}})}}class FlowModel{constructor({nodeModelMap:h,recorder:E,context:R={},globalData:Y={},startNodeType:Z="StartNode"}){this.nodeConfigMap=new Map,this.startNodes=[],this.globalData={},this.nodeModelMap=h,this.executeList=[],this.executingInstance=null,this.context=R,this.globalData=Y,this.startNodeType=Z,this.isRunning=!1,this.scheduler=new Scheduler({flowModel:this,recorder:E}),this.scheduler.on(EVENT_INSTANCE_COMPLETE,ee=>{this.onExecuteFinished(ee)}),this.scheduler.on(EVENT_INSTANCE_INTERRUPTED,ee=>{this.onExecuteFinished(ee)}),this.scheduler.on(EVENT_INSTANCE_ERROR,ee=>{this.onExecuteFinished(ee)})}load(h){const{nodes:E=[],edges:R=[]}=h;E.forEach(Y=>{if(this.nodeModelMap.has(Y.type)){const Z={id:Y.id,type:Y.type,properties:Y.properties,incoming:[],outgoing:[]};this.nodeConfigMap.set(Y.id,Z),Y.type===this.startNodeType&&this.startNodes.push(Z)}else console.warn(`未识别的节点类型：${Y.type}`)}),R.forEach(Y=>{const Z=this.nodeConfigMap.get(Y.sourceNodeId),ee=this.nodeConfigMap.get(Y.targetNodeId);Z&&Z.outgoing.push({id:Y.id,properties:Y.properties,target:Y.targetNodeId}),ee&&ee.type!==this.startNodeType&&ee.incoming.push({id:Y.id,properties:Y.properties,source:Y.sourceNodeId})})}createExecution(h){var E;if(this.executeList.push(h),h.actionId&&h.nodeId&&h.executionId){this.scheduler.resume({executionId:h.executionId,actionId:h.actionId,nodeId:h.nodeId,data:h.data});return}const R=createExecId();if(h.executionId=R,h!=null&&h.nodeId){const Y=this.nodeConfigMap.get(h.nodeId);if(!Y){(E=h==null?void 0:h.onError)===null||E===void 0||E.call(h,new Error(`${getErrorMsg(ErrorCode$1.NONE_NODE_ID)}(${h.nodeId})`));return}this.startNodes=[Y]}this.startNodes.forEach(Y=>{this.scheduler.addAction({executionId:R,nodeId:Y.id})}),this.scheduler.run({executionId:R})}execute(h){return __awaiter(this,void 0,void 0,function*(){this.createExecution(h)})}resume(h){return __awaiter(this,void 0,void 0,function*(){this.createExecution(h)})}createAction(h){const E=this.nodeConfigMap.get(h);if(E){const R=this.nodeModelMap.get(E.type);if(!R)throw new Error("该 NodeModel 不存在，抛出异常");return new R({nodeConfig:E,globalData:this.globalData,context:this.context})}}setStartNodeType(h){this.startNodeType=h}updateGlobalData(h){return this.globalData=Object.assign(Object.assign({},this.globalData),h),this.globalData}onExecuteFinished(h){const E=this.executeList.findIndex(R=>R.executionId===h.executionId);if(E>-1){const{callback:R}=this.executeList[E];this.executeList.splice(E,1),R==null||R(h)}}}const MAX_RECORDER=100,MAX_INSTANCE=100,LOGICFLOW_ENGINE_INSTANCES="LOGICFLOW_ENGINE_INSTANCES";class Recorder{constructor({instanceId:h}){this.instanceId=h,this.maxRecorder=MAX_RECORDER;const E=this.getItem(LOGICFLOW_ENGINE_INSTANCES)||[];if(E.indexOf(h)===-1&&E.push(h),E.length>MAX_INSTANCE){const R=E.shift();this.clearInstance(R)}this.setItem(LOGICFLOW_ENGINE_INSTANCES,E)}setMaxRecorderNumber(h){this.maxRecorder=h}setItem(h,E){try{storage.setItem(h,E)}catch{console.error("Ops, something wrong with storage.setItem !!!"),storage.clear(),storage.setItem(h,E)}}getItem(h){return storage.getItem(h)}getExecutionActions(h){return __awaiter(this,void 0,void 0,function*(){return this.getItem(h)})}getExecutionList(){return __awaiter(this,void 0,void 0,function*(){return this.getItem(this.instanceId)||[]})}addExecution(h){const E=this.getItem(this.instanceId)||[];if(E.length>=this.maxRecorder){const R=E.shift();this.popExecution(R)}E.push(h),this.setItem(this.instanceId,E)}popExecution(h){(this.getItem(h)||[]).forEach(R=>{storage.removeItem(R)}),storage.removeItem(h)}pushActionToExecution(h,E){const R=this.getItem(h)||[];R.push(E),this.setItem(h,R)}addActionRecord(h){return __awaiter(this,void 0,void 0,function*(){const{executionId:E,actionId:R}=h;(yield this.getExecutionActions(E))||this.addExecution(E),this.pushActionToExecution(E,R),this.setItem(R,h)})}getActionRecord(h){return __awaiter(this,void 0,void 0,function*(){return this.getItem(h)})}clear(){this.clearInstance(this.instanceId)}clearInstance(h){(this.getItem(h)||[]).forEach(R=>{storage.removeItem(R),(this.getItem(R)||[]).forEach(Z=>{storage.removeItem(Z)})}),storage.removeItem(h)}}class Engine{constructor(h){this.nodeModelMap=new Map,this.instanceId=createEngineId(),h!=null&&h.debug&&(this.recorder=new Recorder({instanceId:this.instanceId})),this.register({type:StartNode$1.nodeTypeName,model:StartNode$1}),this.register({type:TaskNode.nodeTypeName,model:TaskNode}),this.context=(h==null?void 0:h.context)||{}}register(h){this.nodeModelMap.set(h.type,h.model)}setCustomRecorder(h){this.recorder=h}load({graphData:h,startNodeType:E="StartNode",globalData:R={}}){this.graphData=h;const Y=new FlowModel({nodeModelMap:this.nodeModelMap,recorder:this.recorder,context:this.context,globalData:R,startNodeType:E});return Y.load(h),this.flowModel=Y,Y}execute(h){return __awaiter(this,void 0,void 0,function*(){return new Promise((E,R)=>{var Y;let Z=h;h||(Z={}),(Y=this.flowModel)===null||Y===void 0||Y.execute(Object.assign(Object.assign({},Z),{callback:ee=>{E(ee)},onError:ee=>{R(ee)}}))})})}resume(h){return __awaiter(this,void 0,void 0,function*(){return new Promise((E,R)=>{var Y;(Y=this.flowModel)===null||Y===void 0||Y.resume(Object.assign(Object.assign({},h),{callback:Z=>{E(Z)},onError:Z=>{R(Z)}}))})})}getExecutionList(){return __awaiter(this,void 0,void 0,function*(){var h;return yield(h=this.recorder)===null||h===void 0?void 0:h.getExecutionList()})}getExecutionRecord(h){return __awaiter(this,void 0,void 0,function*(){var E,R;const Y=yield(E=this.recorder)===null||E===void 0?void 0:E.getExecutionActions(h);if(!Y)return null;const Z=[];for(let ee=0;ee<(Y==null?void 0:Y.length);ee++){const te=Y[ee];this.recorder&&Z.push((R=this.recorder)===null||R===void 0?void 0:R.getActionRecord(te))}return Promise.all(Z)})}destroy(){var h;(h=this.recorder)===null||h===void 0||h.clear()}getGlobalData(){var h;return(h=this.flowModel)===null||h===void 0?void 0:h.globalData}setGlobalData(h){this.flowModel&&(this.flowModel.globalData=h)}updateGlobalData(h){this.flowModel&&Object.assign(this.flowModel.globalData,h)}}const evaluateCondition=(t,h,E)=>{switch(E){case"=":case"===":return t===h;case"!=":case"!==":return t!==h;case">":return t>h;case">=":return t>=h;case"<":return t<h;case"<=":return t<=h;default:throw new Error(`Unsupported operator: ${E}`)}},parseData$2=(t,h,E,R,Y={})=>{var Z,ee;return t!=null&&t.value&&((Z=h==null?void 0:h.isJSExpression)!=null&&Z.call(h,t.value))&&t.valueType==="flowRunningTime"?h==null?void 0:h.parseData(t.value,R,Y):t!=null&&t.value&&((ee=h==null?void 0:h.isJSExpression)!=null&&ee.call(h,t.value))?h==null?void 0:h.parseData(t.value,E,Y):t.type==="number"?Number(t.value):t.type==="boolean"?t.value==="true"||t.value===!0:t.value},evaluate=(t,h,E)=>{const R=h==null?void 0:h.utils,{relation:Y="AND",conditions:Z=[],value:ee=[]}=t,te=Z.map(ie=>evaluate(ie,h,E)),ne=ee.map(({operate:ie,source:ae,target:se})=>{const ue=parseData$2(ae,R,h,E,{thisRequiredInJSE:!0,errCallback:le=>{console.log(le)}}),fe=parseData$2(se,R,h,E,{thisRequiredInJSE:!0,errCallback:le=>{console.log(le)}});return evaluateCondition(ue,fe,ie)}),oe=[...te,...ne];if(Y==="AND")return oe.every(Boolean);if(Y==="OR")return oe.some(Boolean);throw new Error(`Unknown relation: ${Y}`)},updateState=(t,h,E)=>{const R=h==null?void 0:h.utils,Y=(ee,te={})=>{var ne,oe;return ee!=null&&ee.value&&((ne=R==null?void 0:R.isJSExpression)!=null&&ne.call(R,ee.value))&&ee.valueType==="flowRunningTime"?R==null?void 0:R.parseData(ee.value,E,te):ee!=null&&ee.value&&((oe=R==null?void 0:R.isJSExpression)!=null&&oe.call(R,ee.value))?R==null?void 0:R.parseData(ee.value,h,te):ee.type==="number"?Number(ee.value):ee.type==="boolean"?ee.value==="true"||ee.value===!0:ee.value},Z=(ee,te)=>{var ne;console.log("updatePageState"),console.log(ee,te),(ne=h==null?void 0:h.setState)==null||ne.call(h,oe=>{const ie={...oe},ae=ee.split(".");return ae.reduce((se,ue,fe)=>(fe===ae.length-1?se[ue]=te:se[ue]||(se[ue]={}),se[ue]),ie),ie})};t.map(({source:ee,target:te})=>{var ae,se,ue,fe;const ne=ee.valueType,oe=(fe=(ue=(se=(ae=ee.value)==null?void 0:ae.value)==null?void 0:se.split(".").slice(2))==null?void 0:ue.join)==null?void 0:fe.call(ue,"."),ie=Y(te,{thisRequiredInJSE:!0,errCallback:le=>{console.log(le)}});ne==="pageState"&&Z(oe,ie)})};function objectToQueryString(t){return Object.entries(t).map(([h,E])=>E==null?"":Array.isArray(E)?E.map(R=>`${h}=${R}`).join("&"):`${h}=${E}`).filter(Boolean).join("&")}class CommonNode extends TaskNode{parseData(h){const E={};return h.forEach(R=>{const Y=R.value.valueType,Z=R.value.type;if(Y==="input"){let ee=R.value.value;Z==="number"&&(ee=Number(ee)),Z==="boolean"&&(ee=[!0,"true"].includes(ee)),E[R.key]=ee}else E[R.key]=R.value.value}),E}async fetchDataSource(){console.log(this.context),console.log(this);const E=(this.properties||{}).biz||{},{value:R={},onFailureConfig:Y={}}=E,{continueOnFailure:Z}=Y,{bodyList:ee=[],paramsList:te=[],requestMethod:ne="GET",requestUrl:oe=""}=R;return new Promise(async(ie,ae)=>{try{const se=await this.context.pageInstance.utils.request({method:ne.toLowerCase(),url:oe,data:this.parseData(ee),params:this.parseData(te)});ie({continueOnFailure:Z,bodyList:ee,res:se,paramsList:te,requestMethod:ne})}catch(se){ae(se)}})}async pageJump(){return new Promise(async(h,E)=>{const Z=((this.properties||{}).biz||{value:{}}).value;try{const te=(oe=>{const ie={},ae=this.context.pageInstance;return oe.forEach(se=>{ie[se.key]=parseData$2(se.value,ae.utils,ae,this,{thisRequiredInJSE:!0,errCallback:ue=>{console.log(ue)}})}),ie})(Z.routeParams||[]),ne=objectToQueryString(te);Z.target==="_blank"&&Z.path&&window.open(`${Z.path}?${ne}`,"_blank"),Z.target==="_self"&&Z.path&&(window.location.href=`${Z.path}?${ne}`),h(!0)}catch(ee){E(ee)}})}async action(){var h,E,R,Y;try{console.log("runner:CommonNode",this);const Z=(h=this.properties)==null?void 0:h.value;let ee;if(Z==="DataSource"&&(ee=await this.fetchDataSource()),Z==="PageJump"&&(await this.pageJump(),ee=!0),Z==="Condition"){const te=await this.getConditionIsPass();console.log("执行action",te),ee=te}return Z==="UpdateState"&&(ee=await this.updateState()),this.globalData.actionResponse=ee,{detail:ee,status:ActionStatus.SUCCESS}}catch(Z){const ee=(Y=(R=(E=this.properties)==null?void 0:E.biz)==null?void 0:R.onFailureConfig)==null?void 0:Y.continueOnFailure;return console.log(Z),ee?{detail:Z,status:ActionStatus.SUCCESS}:{detail:Z,status:ActionStatus.ERROR}}}runConditions(h){try{const E=this.context.pageInstance;return evaluate(h,E,this)}catch(E){return console.log(E),!1}}async getConditionIsPass(){if(!this.properties)return!0;const{biz:h}=this.properties||{};try{const E=h.value;return this.runConditions(E)}catch{return!1}}async updateState(){if(!this.properties)return!0;const{biz:h}=this.properties||{};try{const E=h.value,R=this.context.pageInstance;return console.log("updateState",E),updateState(E,R,this),!0}catch{return!1}}async isPass(h){if(!this.properties)return!0;const{value:E}=this.properties||{};return E==="Condition"?this.globalData.actionResponse!==void 0&&typeof this.globalData.actionResponse=="boolean"?this.globalData.actionResponse:(this.globalData.actionResponse=await this.getConditionIsPass(),this.globalData.actionResponse):!0}}class StartNode extends TaskNode{async action(){return console.log("runner:StartNode",this),{status:ActionStatus.SUCCESS,detail:{}}}}class ComponentNode extends TaskNode{async action(){return console.log("runner:ComponentNode",this),{status:ActionStatus.SUCCESS,detail:{}}}}var n,l$1,u$2,i$1,r$1,o,e$1,f$2,c$1,s$1,a$1,p={},v$1=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,d=Array.isArray;function w$1(t,h){for(var E in h)t[E]=h[E];return t}function _(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function g$2(t,h,E){var R,Y,Z,ee={};for(Z in h)Z=="key"?R=h[Z]:Z=="ref"?Y=h[Z]:ee[Z]=h[Z];if(arguments.length>2&&(ee.children=arguments.length>3?n.call(arguments,2):E),typeof t=="function"&&t.defaultProps!=null)for(Z in t.defaultProps)ee[Z]===void 0&&(ee[Z]=t.defaultProps[Z]);return m$1(t,ee,R,Y,null)}function m$1(t,h,E,R,Y){var Z={type:t,props:h,key:E,ref:R,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:Y??++u$2,__i:-1,__u:0};return Y==null&&l$1.vnode!=null&&l$1.vnode(Z),Z}function b(){return{current:null}}function k$1(t){return t.children}function x(t,h){this.props=t,this.context=h}function C(t,h){if(h==null)return t.__?C(t.__,t.__i+1):null;for(var E;h<t.__k.length;h++)if((E=t.__k[h])!=null&&E.__e!=null)return E.__e;return typeof t.type=="function"?C(t):null}function S(t){var h,E;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,h=0;h<t.__k.length;h++)if((E=t.__k[h])!=null&&E.__e!=null){t.__e=t.__c.base=E.__e;break}return S(t)}}function M$1(t){(!t.__d&&(t.__d=!0)&&i$1.push(t)&&!P$1.__r++||r$1!==l$1.debounceRendering)&&((r$1=l$1.debounceRendering)||o)(P$1)}function P$1(){var t,h,E,R,Y,Z,ee,te;for(i$1.sort(e$1);t=i$1.shift();)t.__d&&(h=i$1.length,R=void 0,Z=(Y=(E=t).__v).__e,ee=[],te=[],E.__P&&((R=w$1({},Y)).__v=Y.__v+1,l$1.vnode&&l$1.vnode(R),j$1(E.__P,R,Y,E.__n,E.__P.namespaceURI,32&Y.__u?[Z]:null,ee,Z??C(Y),!!(32&Y.__u),te),R.__v=Y.__v,R.__.__k[R.__i]=R,z$2(ee,R,te),R.__e!=Z&&S(R)),i$1.length>h&&i$1.sort(e$1));P$1.__r=0}function $$1(t,h,E,R,Y,Z,ee,te,ne,oe,ie){var ae,se,ue,fe,le,de,ce=R&&R.__k||v$1,pe=h.length;for(ne=I$1(E,h,ce,ne),ae=0;ae<pe;ae++)(ue=E.__k[ae])!=null&&(se=ue.__i===-1?p:ce[ue.__i]||p,ue.__i=ae,de=j$1(t,ue,se,Y,Z,ee,te,ne,oe,ie),fe=ue.__e,ue.ref&&se.ref!=ue.ref&&(se.ref&&V$1(se.ref,null,ue),ie.push(ue.ref,ue.__c||fe,ue)),le==null&&fe!=null&&(le=fe),4&ue.__u||se.__k===ue.__k?ne=H(ue,ne,t):typeof ue.type=="function"&&de!==void 0?ne=de:fe&&(ne=fe.nextSibling),ue.__u&=-7);return E.__e=le,ne}function I$1(t,h,E,R){var Y,Z,ee,te,ne,oe=h.length,ie=E.length,ae=ie,se=0;for(t.__k=[],Y=0;Y<oe;Y++)(Z=h[Y])!=null&&typeof Z!="boolean"&&typeof Z!="function"?(te=Y+se,(Z=t.__k[Y]=typeof Z=="string"||typeof Z=="number"||typeof Z=="bigint"||Z.constructor==String?m$1(null,Z,null,null,null):d(Z)?m$1(k$1,{children:Z},null,null,null):Z.constructor===void 0&&Z.__b>0?m$1(Z.type,Z.props,Z.key,Z.ref?Z.ref:null,Z.__v):Z).__=t,Z.__b=t.__b+1,ee=null,(ne=Z.__i=T(Z,E,te,ae))!==-1&&(ae--,(ee=E[ne])&&(ee.__u|=2)),ee==null||ee.__v===null?(ne==-1&&se--,typeof Z.type!="function"&&(Z.__u|=4)):ne!==te&&(ne==te-1?se--:ne==te+1?se++:(ne>te?se--:se++,Z.__u|=4))):Z=t.__k[Y]=null;if(ae)for(Y=0;Y<ie;Y++)(ee=E[Y])!=null&&!(2&ee.__u)&&(ee.__e==R&&(R=C(ee)),q$1(ee,ee));return R}function H(t,h,E){var R,Y;if(typeof t.type=="function"){for(R=t.__k,Y=0;R&&Y<R.length;Y++)R[Y]&&(R[Y].__=t,h=H(R[Y],h,E));return h}t.__e!=h&&(h&&t.type&&!E.contains(h)&&(h=C(t)),E.insertBefore(t.__e,h||null),h=t.__e);do h=h&&h.nextSibling;while(h!=null&&h.nodeType===8);return h}function L(t,h){return h=h||[],t==null||typeof t=="boolean"||(d(t)?t.some(function(E){L(E,h)}):h.push(t)),h}function T(t,h,E,R){var Y=t.key,Z=t.type,ee=E-1,te=E+1,ne=h[E];if(ne===null||ne&&Y==ne.key&&Z===ne.type&&!(2&ne.__u))return E;if((typeof Z!="function"||Z===k$1||Y)&&R>(ne!=null&&!(2&ne.__u)?1:0))for(;ee>=0||te<h.length;){if(ee>=0){if((ne=h[ee])&&!(2&ne.__u)&&Y==ne.key&&Z===ne.type)return ee;ee--}if(te<h.length){if((ne=h[te])&&!(2&ne.__u)&&Y==ne.key&&Z===ne.type)return te;te++}}return-1}function A(t,h,E){h[0]==="-"?t.setProperty(h,E??""):t[h]=E==null?"":typeof E!="number"||y.test(h)?E:E+"px"}function F$1(t,h,E,R,Y){var Z;e:if(h==="style")if(typeof E=="string")t.style.cssText=E;else{if(typeof R=="string"&&(t.style.cssText=R=""),R)for(h in R)E&&h in E||A(t.style,h,"");if(E)for(h in E)R&&E[h]===R[h]||A(t.style,h,E[h])}else if(h[0]==="o"&&h[1]==="n")Z=h!==(h=h.replace(f$2,"$1")),h=h.toLowerCase()in t||h==="onFocusOut"||h==="onFocusIn"?h.toLowerCase().slice(2):h.slice(2),t.l||(t.l={}),t.l[h+Z]=E,E?R?E.u=R.u:(E.u=c$1,t.addEventListener(h,Z?a$1:s$1,Z)):t.removeEventListener(h,Z?a$1:s$1,Z);else{if(Y=="http://www.w3.org/2000/svg")h=h.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(h!="width"&&h!="height"&&h!="href"&&h!="list"&&h!="form"&&h!="tabIndex"&&h!="download"&&h!="rowSpan"&&h!="colSpan"&&h!="role"&&h!="popover"&&h in t)try{t[h]=E??"";break e}catch{}typeof E=="function"||(E==null||E===!1&&h[4]!=="-"?t.removeAttribute(h):t.setAttribute(h,h=="popover"&&E==1?"":E))}}function O$1(t){return function(h){if(this.l){var E=this.l[h.type+t];if(h.t==null)h.t=c$1++;else if(h.t<E.u)return;return E(l$1.event?l$1.event(h):h)}}}function j$1(t,h,E,R,Y,Z,ee,te,ne,oe){var ie,ae,se,ue,fe,le,de,ce,pe,he,ge,ve,_e,ye,me,Ee,Oe,Te=h.type;if(h.constructor!==void 0)return null;128&E.__u&&(ne=!!(32&E.__u),Z=[te=h.__e=E.__e]),(ie=l$1.__b)&&ie(h);e:if(typeof Te=="function")try{if(ce=h.props,pe="prototype"in Te&&Te.prototype.render,he=(ie=Te.contextType)&&R[ie.__c],ge=ie?he?he.props.value:ie.__:R,E.__c?de=(ae=h.__c=E.__c).__=ae.__E:(pe?h.__c=ae=new Te(ce,ge):(h.__c=ae=new x(ce,ge),ae.constructor=Te,ae.render=B$2),he&&he.sub(ae),ae.props=ce,ae.state||(ae.state={}),ae.context=ge,ae.__n=R,se=ae.__d=!0,ae.__h=[],ae._sb=[]),pe&&ae.__s==null&&(ae.__s=ae.state),pe&&Te.getDerivedStateFromProps!=null&&(ae.__s==ae.state&&(ae.__s=w$1({},ae.__s)),w$1(ae.__s,Te.getDerivedStateFromProps(ce,ae.__s))),ue=ae.props,fe=ae.state,ae.__v=h,se)pe&&Te.getDerivedStateFromProps==null&&ae.componentWillMount!=null&&ae.componentWillMount(),pe&&ae.componentDidMount!=null&&ae.__h.push(ae.componentDidMount);else{if(pe&&Te.getDerivedStateFromProps==null&&ce!==ue&&ae.componentWillReceiveProps!=null&&ae.componentWillReceiveProps(ce,ge),!ae.__e&&(ae.shouldComponentUpdate!=null&&ae.shouldComponentUpdate(ce,ae.__s,ge)===!1||h.__v===E.__v)){for(h.__v!==E.__v&&(ae.props=ce,ae.state=ae.__s,ae.__d=!1),h.__e=E.__e,h.__k=E.__k,h.__k.some(function(Pe){Pe&&(Pe.__=h)}),ve=0;ve<ae._sb.length;ve++)ae.__h.push(ae._sb[ve]);ae._sb=[],ae.__h.length&&ee.push(ae);break e}ae.componentWillUpdate!=null&&ae.componentWillUpdate(ce,ae.__s,ge),pe&&ae.componentDidUpdate!=null&&ae.__h.push(function(){ae.componentDidUpdate(ue,fe,le)})}if(ae.context=ge,ae.props=ce,ae.__P=t,ae.__e=!1,_e=l$1.__r,ye=0,pe){for(ae.state=ae.__s,ae.__d=!1,_e&&_e(h),ie=ae.render(ae.props,ae.state,ae.context),me=0;me<ae._sb.length;me++)ae.__h.push(ae._sb[me]);ae._sb=[]}else do ae.__d=!1,_e&&_e(h),ie=ae.render(ae.props,ae.state,ae.context),ae.state=ae.__s;while(ae.__d&&++ye<25);ae.state=ae.__s,ae.getChildContext!=null&&(R=w$1(w$1({},R),ae.getChildContext())),pe&&!se&&ae.getSnapshotBeforeUpdate!=null&&(le=ae.getSnapshotBeforeUpdate(ue,fe)),te=$$1(t,d(Ee=ie!=null&&ie.type===k$1&&ie.key==null?ie.props.children:ie)?Ee:[Ee],h,E,R,Y,Z,ee,te,ne,oe),ae.base=h.__e,h.__u&=-161,ae.__h.length&&ee.push(ae),de&&(ae.__E=ae.__=null)}catch(Pe){if(h.__v=null,ne||Z!=null)if(Pe.then){for(h.__u|=ne?160:128;te&&te.nodeType===8&&te.nextSibling;)te=te.nextSibling;Z[Z.indexOf(te)]=null,h.__e=te}else for(Oe=Z.length;Oe--;)_(Z[Oe]);else h.__e=E.__e,h.__k=E.__k;l$1.__e(Pe,h,E)}else Z==null&&h.__v===E.__v?(h.__k=E.__k,h.__e=E.__e):te=h.__e=N(E.__e,h,E,R,Y,Z,ee,ne,oe);return(ie=l$1.diffed)&&ie(h),128&h.__u?void 0:te}function z$2(t,h,E){for(var R=0;R<E.length;R++)V$1(E[R],E[++R],E[++R]);l$1.__c&&l$1.__c(h,t),t.some(function(Y){try{t=Y.__h,Y.__h=[],t.some(function(Z){Z.call(Y)})}catch(Z){l$1.__e(Z,Y.__v)}})}function N(t,h,E,R,Y,Z,ee,te,ne){var oe,ie,ae,se,ue,fe,le,de=E.props,ce=h.props,pe=h.type;if(pe==="svg"?Y="http://www.w3.org/2000/svg":pe==="math"?Y="http://www.w3.org/1998/Math/MathML":Y||(Y="http://www.w3.org/1999/xhtml"),Z!=null){for(oe=0;oe<Z.length;oe++)if((ue=Z[oe])&&"setAttribute"in ue==!!pe&&(pe?ue.localName===pe:ue.nodeType===3)){t=ue,Z[oe]=null;break}}if(t==null){if(pe===null)return document.createTextNode(ce);t=document.createElementNS(Y,pe,ce.is&&ce),te&&(l$1.__m&&l$1.__m(h,Z),te=!1),Z=null}if(pe===null)de===ce||te&&t.data===ce||(t.data=ce);else{if(Z=Z&&n.call(t.childNodes),de=E.props||p,!te&&Z!=null)for(de={},oe=0;oe<t.attributes.length;oe++)de[(ue=t.attributes[oe]).name]=ue.value;for(oe in de)if(ue=de[oe],oe!="children"){if(oe=="dangerouslySetInnerHTML")ae=ue;else if(!(oe in ce)){if(oe=="value"&&"defaultValue"in ce||oe=="checked"&&"defaultChecked"in ce)continue;F$1(t,oe,null,ue,Y)}}for(oe in ce)ue=ce[oe],oe=="children"?se=ue:oe=="dangerouslySetInnerHTML"?ie=ue:oe=="value"?fe=ue:oe=="checked"?le=ue:te&&typeof ue!="function"||de[oe]===ue||F$1(t,oe,ue,de[oe],Y);if(ie)te||ae&&(ie.__html===ae.__html||ie.__html===t.innerHTML)||(t.innerHTML=ie.__html),h.__k=[];else if(ae&&(t.innerHTML=""),$$1(t,d(se)?se:[se],h,E,R,pe==="foreignObject"?"http://www.w3.org/1999/xhtml":Y,Z,ee,Z?Z[0]:E.__k&&C(E,0),te,ne),Z!=null)for(oe=Z.length;oe--;)_(Z[oe]);te||(oe="value",pe==="progress"&&fe==null?t.removeAttribute("value"):fe!==void 0&&(fe!==t[oe]||pe==="progress"&&!fe||pe==="option"&&fe!==de[oe])&&F$1(t,oe,fe,de[oe],Y),oe="checked",le!==void 0&&le!==t[oe]&&F$1(t,oe,le,de[oe],Y))}return t}function V$1(t,h,E){try{if(typeof t=="function"){var R=typeof t.__u=="function";R&&t.__u(),R&&h==null||(t.__u=t(h))}else t.current=h}catch(Y){l$1.__e(Y,E)}}function q$1(t,h,E){var R,Y;if(l$1.unmount&&l$1.unmount(t),(R=t.ref)&&(R.current&&R.current!==t.__e||V$1(R,null,h)),(R=t.__c)!=null){if(R.componentWillUnmount)try{R.componentWillUnmount()}catch(Z){l$1.__e(Z,h)}R.base=R.__P=null}if(R=t.__k)for(Y=0;Y<R.length;Y++)R[Y]&&q$1(R[Y],h,E||typeof t.type!="function");E||_(t.__e),t.__c=t.__=t.__e=void 0}function B$2(t,h,E){return this.constructor(t,E)}function D(t,h,E){var R,Y,Z,ee;h===document&&(h=document.documentElement),l$1.__&&l$1.__(t,h),Y=(R=typeof E=="function")?null:h.__k,Z=[],ee=[],j$1(h,t=(!R&&E||h).__k=g$2(k$1,null,[t]),Y||p,p,h.namespaceURI,!R&&E?[E]:Y?null:h.firstChild?n.call(h.childNodes):null,Z,!R&&E?E:Y?Y.__e:h.firstChild,R,ee),z$2(Z,t,ee)}n=v$1.slice,l$1={__e:function(t,h,E,R){for(var Y,Z,ee;h=h.__;)if((Y=h.__c)&&!Y.__)try{if((Z=Y.constructor)&&Z.getDerivedStateFromError!=null&&(Y.setState(Z.getDerivedStateFromError(t)),ee=Y.__d),Y.componentDidCatch!=null&&(Y.componentDidCatch(t,R||{}),ee=Y.__d),ee)return Y.__E=Y}catch(te){t=te}throw t}},u$2=0,x.prototype.setState=function(t,h){var E;E=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=w$1({},this.state),typeof t=="function"&&(t=t(w$1({},E),this.props)),t&&w$1(E,t),t!=null&&this.__v&&(h&&this._sb.push(h),M$1(this))},x.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),M$1(this))},x.prototype.render=k$1,i$1=[],o=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e$1=function(t,h){return t.__v.__b-h.__v.__b},P$1.__r=0,f$2=/(PointerCapture)$|Capture$/i,c$1=0,s$1=O$1(!1),a$1=O$1(!0);var OBFUSCATED_ERROR="An invariant failed, however the error is obfuscated because this is a production build.",EMPTY_ARRAY=[];Object.freeze(EMPTY_ARRAY);var EMPTY_OBJECT={};Object.freeze(EMPTY_OBJECT);function getNextId(){return++globalState.mobxGuid}function fail(t){throw invariant$1(!1,t),"X"}function invariant$1(t,h){if(!t)throw new Error("[mobx] "+(h||OBFUSCATED_ERROR))}function once(t){var h=!1;return function(){if(!h)return h=!0,t.apply(this,arguments)}}var noop$3=function(){};function unique(t){var h=[];return t.forEach(function(E){h.indexOf(E)===-1&&h.push(E)}),h}function isObject$4(t){return t!==null&&typeof t=="object"}function isPlainObject$2(t){if(t===null||typeof t!="object")return!1;var h=Object.getPrototypeOf(t);return h===Object.prototype||h===null}function convertToMap(t){if(isES6Map(t)||isObservableMap(t))return t;if(Array.isArray(t))return new Map(t);if(isPlainObject$2(t)){var h=new Map;for(var E in t)h.set(E,t[E]);return h}else return fail("Cannot convert to map from '"+t+"'")}function addHiddenProp(t,h,E){Object.defineProperty(t,h,{enumerable:!1,writable:!0,configurable:!0,value:E})}function addHiddenFinalProp(t,h,E){Object.defineProperty(t,h,{enumerable:!1,writable:!1,configurable:!0,value:E})}function isPropertyConfigurable(t,h){var E=Object.getOwnPropertyDescriptor(t,h);return!E||E.configurable!==!1&&E.writable!==!1}function createInstanceofPredicate(t,h){var E="isMobX"+t;return h.prototype[E]=!0,function(R){return isObject$4(R)&&R[E]===!0}}function isES6Map(t){return t instanceof Map}function isES6Set(t){return t instanceof Set}function getPlainObjectKeys(t){var h=new Set;for(var E in t)h.add(E);return Object.getOwnPropertySymbols(t).forEach(function(R){Object.getOwnPropertyDescriptor(t,R).enumerable&&h.add(R)}),Array.from(h)}function stringifyKey(t){return t&&t.toString?t.toString():new String(t).toString()}function toPrimitive(t){return t===null?null:typeof t=="object"?""+t:t}var ownKeys=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,$mobx=Symbol("mobx administration"),Atom=function(){function t(h){h===void 0&&(h="Atom@"+getNextId()),this.name=h,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=IDerivationState.NOT_TRACKING}return t.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(h){return h()})},t.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(h){return h()})},t.prototype.reportObserved=function(){return reportObserved(this)},t.prototype.reportChanged=function(){startBatch(),propagateChanged(this),endBatch()},t.prototype.toString=function(){return this.name},t}(),isAtom=createInstanceofPredicate("Atom",Atom);function createAtom(t,h,E){h===void 0&&(h=noop$3),E===void 0&&(E=noop$3);var R=new Atom(t);return h!==noop$3&&onBecomeObserved(R,h),E!==noop$3&&onBecomeUnobserved(R,E),R}function identityComparer(t,h){return t===h}function structuralComparer(t,h){return deepEqual(t,h)}function shallowComparer(t,h){return deepEqual(t,h,1)}function defaultComparer(t,h){return Object.is(t,h)}var comparer={identity:identityComparer,structural:structuralComparer,default:defaultComparer,shallow:shallowComparer};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var extendStatics=function(t,h){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,R){E.__proto__=R}||function(E,R){for(var Y in R)R.hasOwnProperty(Y)&&(E[Y]=R[Y])},extendStatics(t,h)};function __extends$H(t,h){extendStatics(t,h);function E(){this.constructor=t}t.prototype=h===null?Object.create(h):(E.prototype=h.prototype,new E)}var __assign$Q=function(){return __assign$Q=Object.assign||function(h){for(var E,R=1,Y=arguments.length;R<Y;R++){E=arguments[R];for(var Z in E)Object.prototype.hasOwnProperty.call(E,Z)&&(h[Z]=E[Z])}return h},__assign$Q.apply(this,arguments)};function __values$2(t){var h=typeof Symbol=="function"&&t[Symbol.iterator],E=0;return h?h.call(t):{next:function(){return t&&E>=t.length&&(t=void 0),{value:t&&t[E++],done:!t}}}}function __read$A(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z}function __spread(){for(var t=[],h=0;h<arguments.length;h++)t=t.concat(__read$A(arguments[h]));return t}var mobxDidRunLazyInitializersSymbol=Symbol("mobx did run lazy initializers"),mobxPendingDecorators=Symbol("mobx pending decorators"),enumerableDescriptorCache={},nonEnumerableDescriptorCache={};function createPropertyInitializerDescriptor(t,h){var E=h?enumerableDescriptorCache:nonEnumerableDescriptorCache;return E[t]||(E[t]={configurable:!0,enumerable:h,get:function(){return initializeInstance(this),this[t]},set:function(R){initializeInstance(this),this[t]=R}})}function initializeInstance(t){var h,E;if(t[mobxDidRunLazyInitializersSymbol]!==!0){var R=t[mobxPendingDecorators];if(R){addHiddenProp(t,mobxDidRunLazyInitializersSymbol,!0);var Y=__spread(Object.getOwnPropertySymbols(R),Object.keys(R));try{for(var Z=__values$2(Y),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value,ne=R[te];ne.propertyCreator(t,ne.prop,ne.descriptor,ne.decoratorTarget,ne.decoratorArguments)}}catch(oe){h={error:oe}}finally{try{ee&&!ee.done&&(E=Z.return)&&E.call(Z)}finally{if(h)throw h.error}}}}}function createPropDecorator(t,h){return function(){var R,Y=function(ee,te,ne,oe){if(oe===!0)return h(ee,te,ne,ee,R),null;if(!Object.prototype.hasOwnProperty.call(ee,mobxPendingDecorators)){var ie=ee[mobxPendingDecorators];addHiddenProp(ee,mobxPendingDecorators,__assign$Q({},ie))}return ee[mobxPendingDecorators][te]={prop:te,propertyCreator:h,descriptor:ne,decoratorTarget:ee,decoratorArguments:R},createPropertyInitializerDescriptor(te,t)};return quacksLikeADecorator(arguments)?(R=EMPTY_ARRAY,Y.apply(null,arguments)):(R=Array.prototype.slice.call(arguments),Y)}}function quacksLikeADecorator(t){return(t.length===2||t.length===3)&&(typeof t[1]=="string"||typeof t[1]=="symbol")||t.length===4&&t[3]===!0}function deepEnhancer(t,h,E){return isObservable(t)?t:Array.isArray(t)?observable$1.array(t,{name:E}):isPlainObject$2(t)?observable$1.object(t,void 0,{name:E}):isES6Map(t)?observable$1.map(t,{name:E}):isES6Set(t)?observable$1.set(t,{name:E}):t}function shallowEnhancer(t,h,E){return t==null||isObservableObject(t)||isObservableArray(t)||isObservableMap(t)||isObservableSet(t)?t:Array.isArray(t)?observable$1.array(t,{name:E,deep:!1}):isPlainObject$2(t)?observable$1.object(t,void 0,{name:E,deep:!1}):isES6Map(t)?observable$1.map(t,{name:E,deep:!1}):isES6Set(t)?observable$1.set(t,{name:E,deep:!1}):fail(!1)}function referenceEnhancer(t){return t}function refStructEnhancer(t,h,E){return deepEqual(t,h)?h:t}function createDecoratorForEnhancer(t){invariant$1(t);var h=createPropDecorator(!0,function(R,Y,Z,ee,te){var ne=Z?Z.initializer?Z.initializer.call(R):Z.value:void 0;asObservableObject(R).addObservableProp(Y,ne,t)}),E=(typeof process<"u"&&process.env,h);return E.enhancer=t,E}var defaultCreateObservableOptions={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(defaultCreateObservableOptions);function asCreateObservableOptions(t){return t==null?defaultCreateObservableOptions:typeof t=="string"?{name:t,deep:!0,proxy:!0}:t}var deepDecorator=createDecoratorForEnhancer(deepEnhancer),shallowDecorator=createDecoratorForEnhancer(shallowEnhancer),refDecorator=createDecoratorForEnhancer(referenceEnhancer),refStructDecorator=createDecoratorForEnhancer(refStructEnhancer);function getEnhancerFromOptions(t){return t.defaultDecorator?t.defaultDecorator.enhancer:t.deep===!1?referenceEnhancer:deepEnhancer}function createObservable(t,h,E){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return deepDecorator.apply(null,arguments);if(isObservable(t))return t;var R=isPlainObject$2(t)?observable$1.object(t,h,E):Array.isArray(t)?observable$1.array(t,h):isES6Map(t)?observable$1.map(t,h):isES6Set(t)?observable$1.set(t,h):t;if(R!==t)return R;fail(!1)}var observableFactories={box:function(t,h){arguments.length>2&&incorrectlyUsedAsDecorator("box");var E=asCreateObservableOptions(h);return new ObservableValue(t,getEnhancerFromOptions(E),E.name,!0,E.equals)},array:function(t,h){arguments.length>2&&incorrectlyUsedAsDecorator("array");var E=asCreateObservableOptions(h);return createObservableArray(t,getEnhancerFromOptions(E),E.name)},map:function(t,h){arguments.length>2&&incorrectlyUsedAsDecorator("map");var E=asCreateObservableOptions(h);return new ObservableMap(t,getEnhancerFromOptions(E),E.name)},set:function(t,h){arguments.length>2&&incorrectlyUsedAsDecorator("set");var E=asCreateObservableOptions(h);return new ObservableSet(t,getEnhancerFromOptions(E),E.name)},object:function(t,h,E){typeof arguments[1]=="string"&&incorrectlyUsedAsDecorator("object");var R=asCreateObservableOptions(E);if(R.proxy===!1)return extendObservable({},t,h,R);var Y=getDefaultDecoratorFromObjectOptions(R),Z=extendObservable({},void 0,void 0,R),ee=createDynamicObservableObject(Z);return extendObservableObjectWithProperties(ee,t,h,Y),ee},ref:refDecorator,shallow:shallowDecorator,deep:deepDecorator,struct:refStructDecorator},observable$1=createObservable;Object.keys(observableFactories).forEach(function(t){return observable$1[t]=observableFactories[t]});function incorrectlyUsedAsDecorator(t){fail("Expected one or two arguments to observable."+t+". Did you accidentally try to use observable."+t+" as decorator?")}var computedDecorator=createPropDecorator(!1,function(t,h,E,R,Y){var Z=E.get,ee=E.set,te=Y[0]||{};asObservableObject(t).addComputedProp(t,h,__assign$Q({get:Z,set:ee,context:t},te))}),computedStructDecorator=computedDecorator({equals:comparer.structural}),computed=function(h,E,R){if(typeof E=="string"||h!==null&&typeof h=="object"&&arguments.length===1)return computedDecorator.apply(null,arguments);var Y=typeof E=="object"?E:{};return Y.get=h,Y.set=typeof E=="function"?E:Y.set,Y.name=Y.name||h.name||"",new ComputedValue(Y)};computed.struct=computedStructDecorator;var IDerivationState;(function(t){t[t.NOT_TRACKING=-1]="NOT_TRACKING",t[t.UP_TO_DATE=0]="UP_TO_DATE",t[t.POSSIBLY_STALE=1]="POSSIBLY_STALE",t[t.STALE=2]="STALE"})(IDerivationState||(IDerivationState={}));var TraceMode;(function(t){t[t.NONE=0]="NONE",t[t.LOG=1]="LOG",t[t.BREAK=2]="BREAK"})(TraceMode||(TraceMode={}));var CaughtException=function(){function t(h){this.cause=h}return t}();function isCaughtException(t){return t instanceof CaughtException}function shouldCompute(t){switch(t.dependenciesState){case IDerivationState.UP_TO_DATE:return!1;case IDerivationState.NOT_TRACKING:case IDerivationState.STALE:return!0;case IDerivationState.POSSIBLY_STALE:{for(var h=allowStateReadsStart(!0),E=untrackedStart(),R=t.observing,Y=R.length,Z=0;Z<Y;Z++){var ee=R[Z];if(isComputedValue(ee)){if(globalState.disableErrorBoundaries)ee.get();else try{ee.get()}catch{return untrackedEnd(E),allowStateReadsEnd(h),!0}if(t.dependenciesState===IDerivationState.STALE)return untrackedEnd(E),allowStateReadsEnd(h),!0}}return changeDependenciesStateTo0(t),untrackedEnd(E),allowStateReadsEnd(h),!1}}}function checkIfStateModificationsAreAllowed(t){var h=t.observers.size>0;globalState.computationDepth>0&&h&&fail(!1),!globalState.allowStateChanges&&(h||globalState.enforceActions==="strict")&&fail(!1)}function trackDerivedFunction(t,h,E){var R=allowStateReadsStart(!0);changeDependenciesStateTo0(t),t.newObserving=new Array(t.observing.length+100),t.unboundDepsCount=0,t.runId=++globalState.runId;var Y=globalState.trackingDerivation;globalState.trackingDerivation=t;var Z;if(globalState.disableErrorBoundaries===!0)Z=h.call(E);else try{Z=h.call(E)}catch(ee){Z=new CaughtException(ee)}return globalState.trackingDerivation=Y,bindDependencies(t),allowStateReadsEnd(R),Z}function bindDependencies(t){for(var h=t.observing,E=t.observing=t.newObserving,R=IDerivationState.UP_TO_DATE,Y=0,Z=t.unboundDepsCount,ee=0;ee<Z;ee++){var te=E[ee];te.diffValue===0&&(te.diffValue=1,Y!==ee&&(E[Y]=te),Y++),te.dependenciesState>R&&(R=te.dependenciesState)}for(E.length=Y,t.newObserving=null,Z=h.length;Z--;){var te=h[Z];te.diffValue===0&&removeObserver(te,t),te.diffValue=0}for(;Y--;){var te=E[Y];te.diffValue===1&&(te.diffValue=0,addObserver(te,t))}R!==IDerivationState.UP_TO_DATE&&(t.dependenciesState=R,t.onBecomeStale())}function clearObserving(t){var h=t.observing;t.observing=[];for(var E=h.length;E--;)removeObserver(h[E],t);t.dependenciesState=IDerivationState.NOT_TRACKING}function untracked(t){var h=untrackedStart();try{return t()}finally{untrackedEnd(h)}}function untrackedStart(){var t=globalState.trackingDerivation;return globalState.trackingDerivation=null,t}function untrackedEnd(t){globalState.trackingDerivation=t}function allowStateReadsStart(t){var h=globalState.allowStateReads;return globalState.allowStateReads=t,h}function allowStateReadsEnd(t){globalState.allowStateReads=t}function changeDependenciesStateTo0(t){if(t.dependenciesState!==IDerivationState.UP_TO_DATE){t.dependenciesState=IDerivationState.UP_TO_DATE;for(var h=t.observing,E=h.length;E--;)h[E].lowestObserverState=IDerivationState.UP_TO_DATE}}var currentActionId=0,nextActionId=1,functionNameDescriptor=Object.getOwnPropertyDescriptor(function(){},"name");functionNameDescriptor&&functionNameDescriptor.configurable;function createAction(t,h,E){var R=function(){return executeAction(t,h,E||this,arguments)};return R.isMobxAction=!0,R}function executeAction(t,h,E,R){var Y=_startAction();try{return h.apply(E,R)}catch(Z){throw Y.error=Z,Z}finally{_endAction(Y)}}function _startAction(t,h,E){var R=isSpyEnabled(),Y=0,Z=untrackedStart();startBatch();var ee=allowStateChangesStart$1(!0),te=allowStateReadsStart(!0),ne={prevDerivation:Z,prevAllowStateChanges:ee,prevAllowStateReads:te,notifySpy:R,startTime:Y,actionId:nextActionId++,parentActionId:currentActionId};return currentActionId=ne.actionId,ne}function _endAction(t){currentActionId!==t.actionId&&fail("invalid action stack. did you forget to finish an action?"),currentActionId=t.parentActionId,t.error!==void 0&&(globalState.suppressReactionErrors=!0),allowStateChangesEnd$1(t.prevAllowStateChanges),allowStateReadsEnd(t.prevAllowStateReads),endBatch(),untrackedEnd(t.prevDerivation),t.notifySpy,globalState.suppressReactionErrors=!1}function allowStateChangesStart$1(t){var h=globalState.allowStateChanges;return globalState.allowStateChanges=t,h}function allowStateChangesEnd$1(t){globalState.allowStateChanges=t}var ObservableValue=function(t){__extends$H(h,t);function h(E,R,Y,Z,ee){Y===void 0&&(Y="ObservableValue@"+getNextId()),Z===void 0&&(Z=!0),ee===void 0&&(ee=comparer.default);var te=t.call(this,Y)||this;return te.enhancer=R,te.name=Y,te.equals=ee,te.hasUnreportedChange=!1,te.value=R(E,void 0,Y),Z&&isSpyEnabled(),te}return h.prototype.dehanceValue=function(E){return this.dehancer!==void 0?this.dehancer(E):E},h.prototype.set=function(E){var R=this.value;if(E=this.prepareNewValue(E),E!==globalState.UNCHANGED){var Y=isSpyEnabled();this.setNewValue(E)}},h.prototype.prepareNewValue=function(E){if(checkIfStateModificationsAreAllowed(this),hasInterceptors(this)){var R=interceptChange(this,{object:this,type:"update",newValue:E});if(!R)return globalState.UNCHANGED;E=R.newValue}return E=this.enhancer(E,this.value,this.name),this.equals(this.value,E)?globalState.UNCHANGED:E},h.prototype.setNewValue=function(E){var R=this.value;this.value=E,this.reportChanged(),hasListeners(this)&&notifyListeners(this,{type:"update",object:this,newValue:E,oldValue:R})},h.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},h.prototype.intercept=function(E){return registerInterceptor(this,E)},h.prototype.observe=function(E,R){return R&&E({object:this,type:"update",newValue:this.value,oldValue:void 0}),registerListener(this,E)},h.prototype.toJSON=function(){return this.get()},h.prototype.toString=function(){return this.name+"["+this.value+"]"},h.prototype.valueOf=function(){return toPrimitive(this.get())},h.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},h}(Atom),isObservableValue=createInstanceofPredicate("ObservableValue",ObservableValue),ComputedValue=function(){function t(h){this.dependenciesState=IDerivationState.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=IDerivationState.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+getNextId(),this.value=new CaughtException(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=TraceMode.NONE,invariant$1(h.get,"missing option for computed: get"),this.derivation=h.get,this.name=h.name||"ComputedValue@"+getNextId(),h.set&&(this.setter=createAction(this.name+"-setter",h.set)),this.equals=h.equals||(h.compareStructural||h.struct?comparer.structural:comparer.default),this.scope=h.context,this.requiresReaction=!!h.requiresReaction,this.keepAlive=!!h.keepAlive}return t.prototype.onBecomeStale=function(){propagateMaybeChanged(this)},t.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(h){return h()})},t.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(h){return h()})},t.prototype.get=function(){this.isComputing&&fail("Cycle detected in computation "+this.name+": "+this.derivation),globalState.inBatch===0&&this.observers.size===0&&!this.keepAlive?shouldCompute(this)&&(this.warnAboutUntrackedRead(),startBatch(),this.value=this.computeValue(!1),endBatch()):(reportObserved(this),shouldCompute(this)&&this.trackAndCompute()&&propagateChangeConfirmed(this));var h=this.value;if(isCaughtException(h))throw h.cause;return h},t.prototype.peek=function(){var h=this.computeValue(!1);if(isCaughtException(h))throw h.cause;return h},t.prototype.set=function(h){if(this.setter){invariant$1(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,h)}finally{this.isRunningSetter=!1}}else invariant$1(!1,!1)},t.prototype.trackAndCompute=function(){var h=this.value,E=this.dependenciesState===IDerivationState.NOT_TRACKING,R=this.computeValue(!0),Y=E||isCaughtException(h)||isCaughtException(R)||!this.equals(h,R);return Y&&(this.value=R),Y},t.prototype.computeValue=function(h){this.isComputing=!0,globalState.computationDepth++;var E;if(h)E=trackDerivedFunction(this,this.derivation,this.scope);else if(globalState.disableErrorBoundaries===!0)E=this.derivation.call(this.scope);else try{E=this.derivation.call(this.scope)}catch(R){E=new CaughtException(R)}return globalState.computationDepth--,this.isComputing=!1,E},t.prototype.suspend=function(){this.keepAlive||(clearObserving(this),this.value=void 0)},t.prototype.observe=function(h,E){var R=this,Y=!0,Z=void 0;return autorun(function(){var ee=R.get();if(!Y||E){var te=untrackedStart();h({type:"update",object:R,newValue:ee,oldValue:Z}),untrackedEnd(te)}Y=!1,Z=ee})},t.prototype.warnAboutUntrackedRead=function(){},t.prototype.toJSON=function(){return this.get()},t.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},t.prototype.valueOf=function(){return toPrimitive(this.get())},t.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},t}(),isComputedValue=createInstanceofPredicate("ComputedValue",ComputedValue),MobXGlobals=function(){function t(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return t}(),mockGlobal={};function getGlobal(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:mockGlobal}var canMergeGlobalState=!0,isolateCalled=!1,globalState=function(){var t=getGlobal();return t.__mobxInstanceCount>0&&!t.__mobxGlobals&&(canMergeGlobalState=!1),t.__mobxGlobals&&t.__mobxGlobals.version!==new MobXGlobals().version&&(canMergeGlobalState=!1),canMergeGlobalState?t.__mobxGlobals?(t.__mobxInstanceCount+=1,t.__mobxGlobals.UNCHANGED||(t.__mobxGlobals.UNCHANGED={}),t.__mobxGlobals):(t.__mobxInstanceCount=1,t.__mobxGlobals=new MobXGlobals):(setTimeout(function(){isolateCalled||fail("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new MobXGlobals)}();function isolateGlobalState(){(globalState.pendingReactions.length||globalState.inBatch||globalState.isRunningReactions)&&fail("isolateGlobalState should be called before MobX is running any reactions"),isolateCalled=!0,canMergeGlobalState&&(--getGlobal().__mobxInstanceCount===0&&(getGlobal().__mobxGlobals=void 0),globalState=new MobXGlobals)}function getGlobalState(){return globalState}function addObserver(t,h){t.observers.add(h),t.lowestObserverState>h.dependenciesState&&(t.lowestObserverState=h.dependenciesState)}function removeObserver(t,h){t.observers.delete(h),t.observers.size===0&&queueForUnobservation(t)}function queueForUnobservation(t){t.isPendingUnobservation===!1&&(t.isPendingUnobservation=!0,globalState.pendingUnobservations.push(t))}function startBatch(){globalState.inBatch++}function endBatch(){if(--globalState.inBatch===0){runReactions();for(var t=globalState.pendingUnobservations,h=0;h<t.length;h++){var E=t[h];E.isPendingUnobservation=!1,E.observers.size===0&&(E.isBeingObserved&&(E.isBeingObserved=!1,E.onBecomeUnobserved()),E instanceof ComputedValue&&E.suspend())}globalState.pendingUnobservations=[]}}function reportObserved(t){var h=globalState.trackingDerivation;return h!==null?(h.runId!==t.lastAccessedBy&&(t.lastAccessedBy=h.runId,h.newObserving[h.unboundDepsCount++]=t,t.isBeingObserved||(t.isBeingObserved=!0,t.onBecomeObserved())),!0):(t.observers.size===0&&globalState.inBatch>0&&queueForUnobservation(t),!1)}function propagateChanged(t){t.lowestObserverState!==IDerivationState.STALE&&(t.lowestObserverState=IDerivationState.STALE,t.observers.forEach(function(h){h.dependenciesState===IDerivationState.UP_TO_DATE&&(h.isTracing!==TraceMode.NONE&&logTraceInfo(h,t),h.onBecomeStale()),h.dependenciesState=IDerivationState.STALE}))}function propagateChangeConfirmed(t){t.lowestObserverState!==IDerivationState.STALE&&(t.lowestObserverState=IDerivationState.STALE,t.observers.forEach(function(h){h.dependenciesState===IDerivationState.POSSIBLY_STALE?h.dependenciesState=IDerivationState.STALE:h.dependenciesState===IDerivationState.UP_TO_DATE&&(t.lowestObserverState=IDerivationState.UP_TO_DATE)}))}function propagateMaybeChanged(t){t.lowestObserverState===IDerivationState.UP_TO_DATE&&(t.lowestObserverState=IDerivationState.POSSIBLY_STALE,t.observers.forEach(function(h){h.dependenciesState===IDerivationState.UP_TO_DATE&&(h.dependenciesState=IDerivationState.POSSIBLY_STALE,h.isTracing!==TraceMode.NONE&&logTraceInfo(h,t),h.onBecomeStale())}))}function logTraceInfo(t,h){if(console.log("[mobx.trace] '"+t.name+"' is invalidated due to a change in: '"+h.name+"'"),t.isTracing===TraceMode.BREAK){var E=[];printDepTree(getDependencyTree(t),E,1),new Function(`debugger;
/*
Tracing '`+t.name+`'

You are entering this break point because derivation '`+t.name+"' is being traced and '"+h.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(t instanceof ComputedValue?t.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+E.join(`
`)+`
*/
    `)()}}function printDepTree(t,h,E){if(h.length>=1e3){h.push("(and many more)");return}h.push(""+new Array(E).join("	")+t.name),t.dependencies&&t.dependencies.forEach(function(R){return printDepTree(R,h,E+1)})}var Reaction=function(){function t(h,E,R,Y){h===void 0&&(h="Reaction@"+getNextId()),Y===void 0&&(Y=!1),this.name=h,this.onInvalidate=E,this.errorHandler=R,this.requiresObservable=Y,this.observing=[],this.newObserving=[],this.dependenciesState=IDerivationState.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+getNextId(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=TraceMode.NONE}return t.prototype.onBecomeStale=function(){this.schedule()},t.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,globalState.pendingReactions.push(this),runReactions())},t.prototype.isScheduled=function(){return this._isScheduled},t.prototype.runReaction=function(){if(!this.isDisposed){if(startBatch(),this._isScheduled=!1,shouldCompute(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&isSpyEnabled()}catch(h){this.reportExceptionInDerivation(h)}}endBatch()}},t.prototype.track=function(h){if(!this.isDisposed){startBatch(),this._isRunning=!0;var E=trackDerivedFunction(this,h,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&clearObserving(this),isCaughtException(E)&&this.reportExceptionInDerivation(E.cause),endBatch()}},t.prototype.reportExceptionInDerivation=function(h){var E=this;if(this.errorHandler){this.errorHandler(h,this);return}if(globalState.disableErrorBoundaries)throw h;var R="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";globalState.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(R,h),globalState.globalReactionErrorHandlers.forEach(function(Y){return Y(h,E)})},t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(startBatch(),clearObserving(this),endBatch()))},t.prototype.getDisposer=function(){var h=this.dispose.bind(this);return h[$mobx]=this,h},t.prototype.toString=function(){return"Reaction["+this.name+"]"},t.prototype.trace=function(h){h===void 0&&(h=!1),trace(this,h)},t}(),MAX_REACTION_ITERATIONS=100,reactionScheduler=function(t){return t()};function runReactions(){globalState.inBatch>0||globalState.isRunningReactions||reactionScheduler(runReactionsHelper)}function runReactionsHelper(){globalState.isRunningReactions=!0;for(var t=globalState.pendingReactions,h=0;t.length>0;){++h===MAX_REACTION_ITERATIONS&&(console.error("Reaction doesn't converge to a stable state after "+MAX_REACTION_ITERATIONS+" iterations."+(" Probably there is a cycle in the reactive function: "+t[0])),t.splice(0));for(var E=t.splice(0),R=0,Y=E.length;R<Y;R++)E[R].runReaction()}globalState.isRunningReactions=!1}var isReaction=createInstanceofPredicate("Reaction",Reaction);function setReactionScheduler(t){var h=reactionScheduler;reactionScheduler=function(E){return t(function(){return h(E)})}}function isSpyEnabled(){return!1}function spyReport(t){}function spyReportStart(t){}function spyReportEnd(t){}function spy(t){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function dontReassignFields(){fail(!1)}function namedActionDecorator(t){return function(h,E,R){if(R){if(R.value)return{value:createAction(t,R.value),enumerable:!1,configurable:!0,writable:!0};var Y=R.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return createAction(t,Y.call(this))}}}return actionFieldDecorator(t).apply(this,arguments)}}function actionFieldDecorator(t){return function(h,E,R){Object.defineProperty(h,E,{configurable:!0,enumerable:!1,get:function(){},set:function(Y){addHiddenProp(this,E,action(t,Y))}})}}function boundActionDecorator(t,h,E,R){return R===!0?(defineBoundAction(t,h,E.value),null):E?{configurable:!0,enumerable:!1,get:function(){return defineBoundAction(this,h,E.value||E.initializer.call(this)),this[h]},set:dontReassignFields}:{enumerable:!1,configurable:!0,set:function(Y){defineBoundAction(this,h,Y)},get:function(){}}}var action=function(h,E,R,Y){if(arguments.length===1&&typeof h=="function")return createAction(h.name||"<unnamed action>",h);if(arguments.length===2&&typeof E=="function")return createAction(h,E);if(arguments.length===1&&typeof h=="string")return namedActionDecorator(h);if(Y===!0)addHiddenProp(h,E,createAction(h.name||E,R.value,this));else return namedActionDecorator(E).apply(null,arguments)};action.bound=boundActionDecorator;function runInAction(t,h){var E=typeof t=="string"?t:t.name||"<unnamed action>",R=typeof t=="function"?t:h;return executeAction(E,R,this,void 0)}function defineBoundAction(t,h,E){addHiddenProp(t,h,createAction(h,E.bind(t)))}function autorun(t,h){h===void 0&&(h=EMPTY_OBJECT);var E=h&&h.name||t.name||"Autorun@"+getNextId(),R=!h.scheduler&&!h.delay,Y;if(R)Y=new Reaction(E,function(){this.track(te)},h.onError,h.requiresObservable);else{var Z=createSchedulerFromOptions(h),ee=!1;Y=new Reaction(E,function(){ee||(ee=!0,Z(function(){ee=!1,Y.isDisposed||Y.track(te)}))},h.onError,h.requiresObservable)}function te(){t(Y)}return Y.schedule(),Y.getDisposer()}var run=function(t){return t()};function createSchedulerFromOptions(t){return t.scheduler?t.scheduler:t.delay?function(h){return setTimeout(h,t.delay)}:run}function reaction(t,h,E){E===void 0&&(E=EMPTY_OBJECT);var R=E.name||"Reaction@"+getNextId(),Y=action(R,E.onError?wrapErrorHandler(E.onError,h):h),Z=!E.scheduler&&!E.delay,ee=createSchedulerFromOptions(E),te=!0,ne=!1,oe,ie=E.compareStructural?comparer.structural:E.equals||comparer.default,ae=new Reaction(R,function(){te||Z?se():ne||(ne=!0,ee(se))},E.onError,E.requiresObservable);function se(){if(ne=!1,!ae.isDisposed){var ue=!1;ae.track(function(){var fe=t(ae);ue=te||!ie(oe,fe),oe=fe}),te&&E.fireImmediately&&Y(oe,ae),!te&&ue===!0&&Y(oe,ae),te&&(te=!1)}}return ae.schedule(),ae.getDisposer()}function wrapErrorHandler(t,h){return function(){try{return h.apply(this,arguments)}catch(E){t.call(this,E)}}}function onBecomeObserved(t,h,E){return interceptHook("onBecomeObserved",t,h)}function onBecomeUnobserved(t,h,E){return interceptHook("onBecomeUnobserved",t,h)}function interceptHook(t,h,E,R){var Y=getAtom(h),Z=E,ee=t+"Listeners";Y[ee]?Y[ee].add(Z):Y[ee]=new Set([Z]);var te=Y[t];return typeof te!="function"?fail(!1):function(){var ne=Y[ee];ne&&(ne.delete(Z),ne.size===0&&delete Y[ee])}}function configure(t){var h=t.enforceActions,E=t.computedRequiresReaction,R=t.computedConfigurable,Y=t.disableErrorBoundaries,Z=t.reactionScheduler,ee=t.reactionRequiresObservable,te=t.observableRequiresReaction;if(t.isolateGlobalState===!0&&isolateGlobalState(),h!==void 0){var ne=void 0;switch(h){case!0:case"observed":ne=!0;break;case!1:case"never":ne=!1;break;case"strict":case"always":ne="strict";break;default:fail("Invalid value for 'enforceActions': '"+h+"', expected 'never', 'always' or 'observed'")}globalState.enforceActions=ne,globalState.allowStateChanges=!(ne===!0||ne==="strict")}E!==void 0&&(globalState.computedRequiresReaction=!!E),ee!==void 0&&(globalState.reactionRequiresObservable=!!ee),te!==void 0&&(globalState.observableRequiresReaction=!!te,globalState.allowStateReads=!globalState.observableRequiresReaction),R!==void 0&&(globalState.computedConfigurable=!!R),Y!==void 0&&(Y===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),globalState.disableErrorBoundaries=!!Y),Z&&setReactionScheduler(Z)}function extendObservable(t,h,E,R){R=asCreateObservableOptions(R);var Y=getDefaultDecoratorFromObjectOptions(R);return initializeInstance(t),asObservableObject(t,R.name,Y.enhancer),h&&extendObservableObjectWithProperties(t,h,E,Y),t}function getDefaultDecoratorFromObjectOptions(t){return t.defaultDecorator||(t.deep===!1?refDecorator:deepDecorator)}function extendObservableObjectWithProperties(t,h,E,R){var Y,Z,ee,te;startBatch();try{var ee=ownKeys(h);try{for(var ne=__values$2(ee),oe=ne.next();!oe.done;oe=ne.next()){var te=oe.value,ie=Object.getOwnPropertyDescriptor(h,te),ae=E&&te in E?E[te]:ie.get?computedDecorator:R,se=ae(t,te,ie,!0);se&&Object.defineProperty(t,te,se)}}catch(fe){Y={error:fe}}finally{try{oe&&!oe.done&&(Z=ne.return)&&Z.call(ne)}finally{if(Y)throw Y.error}}}finally{endBatch()}}function getDependencyTree(t,h){return nodeToDependencyTree(getAtom(t,h))}function nodeToDependencyTree(t){var h={name:t.name};return t.observing&&t.observing.length>0&&(h.dependencies=unique(t.observing).map(nodeToDependencyTree)),h}function _isComputed(t,h){if(t==null)return!1;if(h!==void 0){if(isObservableObject(t)===!1||!t[$mobx].values.has(h))return!1;var E=getAtom(t,h);return isComputedValue(E)}return isComputedValue(t)}function isComputed(t){return arguments.length>1?fail(!1):_isComputed(t)}function isComputedProp(t,h){return typeof h!="string"?fail(!1):_isComputed(t,h)}function _isObservable(t,h){return t==null?!1:isObservableObject(t)||!!t[$mobx]||isAtom(t)||isReaction(t)||isComputedValue(t)}function isObservable(t){return arguments.length!==1&&fail(!1),_isObservable(t)}function keys$1(t){return isObservableObject(t)?t[$mobx].getKeys():isObservableMap(t)||isObservableSet(t)?Array.from(t.keys()):isObservableArray(t)?t.map(function(h,E){return E}):fail(!1)}function values(t){return isObservableObject(t)?keys$1(t).map(function(h){return t[h]}):isObservableMap(t)?keys$1(t).map(function(h){return t.get(h)}):isObservableSet(t)?Array.from(t.values()):isObservableArray(t)?t.slice():fail(!1)}function entries(t){return isObservableObject(t)?keys$1(t).map(function(h){return[h,t[h]]}):isObservableMap(t)?keys$1(t).map(function(h){return[h,t.get(h)]}):isObservableSet(t)?Array.from(t.entries()):isObservableArray(t)?t.map(function(h,E){return[E,h]}):fail(!1)}function set$1(t,h,E){if(arguments.length===2&&!isObservableSet(t)){startBatch();var R=h;try{for(var Y in R)set$1(t,Y,R[Y])}finally{endBatch()}return}if(isObservableObject(t)){var Z=t[$mobx],ee=Z.values.get(h);ee?Z.write(h,E):Z.addObservableProp(h,E,Z.defaultEnhancer)}else if(isObservableMap(t))t.set(h,E);else if(isObservableSet(t))t.add(h);else if(isObservableArray(t))typeof h!="number"&&(h=parseInt(h,10)),invariant$1(h>=0,"Not a valid index: '"+h+"'"),startBatch(),h>=t.length&&(t.length=h+1),t[h]=E,endBatch();else return fail(!1)}function observe(t,h,E,R){return observeObservable(t,h,E)}function observeObservable(t,h,E){return getAdministration(t).observe(h,E)}var defaultOptions$1={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function cache$2(t,h,E,R){return R.detectCycles&&t.set(h,E),E}function toJSHelper(t,h,E){if(!h.recurseEverything&&!isObservable(t)||typeof t!="object")return t;if(t===null)return null;if(t instanceof Date)return t;if(isObservableValue(t))return toJSHelper(t.get(),h,E);isObservable(t)&&keys$1(t);var R=h.detectCycles===!0;if(R&&t!==null&&E.has(t))return E.get(t);if(isObservableArray(t)||Array.isArray(t)){var Y=cache$2(E,t,[],h),Z=t.map(function(ue){return toJSHelper(ue,h,E)});Y.length=Z.length;for(var ee=0,te=Z.length;ee<te;ee++)Y[ee]=Z[ee];return Y}if(isObservableSet(t)||Object.getPrototypeOf(t)===Set.prototype)if(h.exportMapsAsObjects===!1){var ne=cache$2(E,t,new Set,h);return t.forEach(function(ue){ne.add(toJSHelper(ue,h,E))}),ne}else{var oe=cache$2(E,t,[],h);return t.forEach(function(ue){oe.push(toJSHelper(ue,h,E))}),oe}if(isObservableMap(t)||Object.getPrototypeOf(t)===Map.prototype)if(h.exportMapsAsObjects===!1){var ie=cache$2(E,t,new Map,h);return t.forEach(function(ue,fe){ie.set(fe,toJSHelper(ue,h,E))}),ie}else{var ae=cache$2(E,t,{},h);return t.forEach(function(ue,fe){ae[fe]=toJSHelper(ue,h,E)}),ae}var se=cache$2(E,t,{},h);return getPlainObjectKeys(t).forEach(function(ue){se[ue]=toJSHelper(t[ue],h,E)}),se}function toJS(t,h){typeof h=="boolean"&&(h={detectCycles:h}),h||(h=defaultOptions$1),h.detectCycles=h.detectCycles===void 0?h.recurseEverything===!0:h.detectCycles===!0;var E;return h.detectCycles&&(E=new Map),toJSHelper(t,h,E)}function trace(){for(var t=[],h=0;h<arguments.length;h++)t[h]=arguments[h];var E=!1;typeof t[t.length-1]=="boolean"&&(E=t.pop());var R=getAtomFromArgs(t);if(!R)return fail(!1);R.isTracing===TraceMode.NONE&&console.log("[mobx.trace] '"+R.name+"' tracing enabled"),R.isTracing=E?TraceMode.BREAK:TraceMode.LOG}function getAtomFromArgs(t){switch(t.length){case 0:return globalState.trackingDerivation;case 1:return getAtom(t[0]);case 2:return getAtom(t[0],t[1])}}function transaction(t,h){h===void 0&&(h=void 0),startBatch();try{return t.apply(h)}finally{endBatch()}}function getAdm(t){return t[$mobx]}function isPropertyKey(t){return typeof t=="string"||typeof t=="number"||typeof t=="symbol"}var objectProxyTraps={has:function(t,h){if(h===$mobx||h==="constructor"||h===mobxDidRunLazyInitializersSymbol)return!0;var E=getAdm(t);return isPropertyKey(h)?E.has(h):h in t},get:function(t,h){if(h===$mobx||h==="constructor"||h===mobxDidRunLazyInitializersSymbol)return t[h];var E=getAdm(t),R=E.values.get(h);if(R instanceof Atom){var Y=R.get();return Y===void 0&&E.has(h),Y}return isPropertyKey(h)&&E.has(h),t[h]},set:function(t,h,E){return isPropertyKey(h)?(set$1(t,h,E),!0):!1},deleteProperty:function(t,h){if(!isPropertyKey(h))return!1;var E=getAdm(t);return E.remove(h),!0},ownKeys:function(t){var h=getAdm(t);return h.keysAtom.reportObserved(),Reflect.ownKeys(t)},preventExtensions:function(t){return fail("Dynamic observable objects cannot be frozen"),!1}};function createDynamicObservableObject(t){var h=new Proxy(t,objectProxyTraps);return t[$mobx].proxy=h,h}function hasInterceptors(t){return t.interceptors!==void 0&&t.interceptors.length>0}function registerInterceptor(t,h){var E=t.interceptors||(t.interceptors=[]);return E.push(h),once(function(){var R=E.indexOf(h);R!==-1&&E.splice(R,1)})}function interceptChange(t,h){var E=untrackedStart();try{for(var R=__spread(t.interceptors||[]),Y=0,Z=R.length;Y<Z&&(h=R[Y](h),invariant$1(!h||h.type,"Intercept handlers should return nothing or a change object"),!!h);Y++);return h}finally{untrackedEnd(E)}}function hasListeners(t){return t.changeListeners!==void 0&&t.changeListeners.length>0}function registerListener(t,h){var E=t.changeListeners||(t.changeListeners=[]);return E.push(h),once(function(){var R=E.indexOf(h);R!==-1&&E.splice(R,1)})}function notifyListeners(t,h){var E=untrackedStart(),R=t.changeListeners;if(R){R=R.slice();for(var Y=0,Z=R.length;Y<Z;Y++)R[Y](h);untrackedEnd(E)}}var MAX_SPLICE_SIZE=1e4,arrayTraps={get:function(t,h){return h===$mobx?t[$mobx]:h==="length"?t[$mobx].getArrayLength():typeof h=="number"?arrayExtensions.get.call(t,h):typeof h=="string"&&!isNaN(h)?arrayExtensions.get.call(t,parseInt(h)):arrayExtensions.hasOwnProperty(h)?arrayExtensions[h]:t[h]},set:function(t,h,E){return h==="length"&&t[$mobx].setArrayLength(E),typeof h=="number"&&arrayExtensions.set.call(t,h,E),typeof h=="symbol"||isNaN(h)?t[h]=E:arrayExtensions.set.call(t,parseInt(h),E),!0},preventExtensions:function(t){return fail("Observable arrays cannot be frozen"),!1}};function createObservableArray(t,h,E,R){E===void 0&&(E="ObservableArray@"+getNextId()),R===void 0&&(R=!1);var Y=new ObservableArrayAdministration(E,h,R);addHiddenFinalProp(Y.values,$mobx,Y);var Z=new Proxy(Y.values,arrayTraps);if(Y.proxy=Z,t&&t.length){var ee=allowStateChangesStart$1(!0);Y.spliceWithArray(0,0,t),allowStateChangesEnd$1(ee)}return Z}var ObservableArrayAdministration=function(){function t(h,E,R){this.owned=R,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new Atom(h||"ObservableArray@"+getNextId()),this.enhancer=function(Y,Z){return E(Y,Z,h+"[..]")}}return t.prototype.dehanceValue=function(h){return this.dehancer!==void 0?this.dehancer(h):h},t.prototype.dehanceValues=function(h){return this.dehancer!==void 0&&h.length>0?h.map(this.dehancer):h},t.prototype.intercept=function(h){return registerInterceptor(this,h)},t.prototype.observe=function(h,E){return E===void 0&&(E=!1),E&&h({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),registerListener(this,h)},t.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},t.prototype.setArrayLength=function(h){if(typeof h!="number"||h<0)throw new Error("[mobx.array] Out of range: "+h);var E=this.values.length;if(h!==E)if(h>E){for(var R=new Array(h-E),Y=0;Y<h-E;Y++)R[Y]=void 0;this.spliceWithArray(E,0,R)}else this.spliceWithArray(h,E-h)},t.prototype.updateArrayLength=function(h,E){if(h!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=E},t.prototype.spliceWithArray=function(h,E,R){var Y=this;checkIfStateModificationsAreAllowed(this.atom);var Z=this.values.length;if(h===void 0?h=0:h>Z?h=Z:h<0&&(h=Math.max(0,Z+h)),arguments.length===1?E=Z-h:E==null?E=0:E=Math.max(0,Math.min(E,Z-h)),R===void 0&&(R=EMPTY_ARRAY),hasInterceptors(this)){var ee=interceptChange(this,{object:this.proxy,type:"splice",index:h,removedCount:E,added:R});if(!ee)return EMPTY_ARRAY;E=ee.removedCount,R=ee.added}R=R.length===0?R:R.map(function(ne){return Y.enhancer(ne,void 0)});var te=this.spliceItemsIntoValues(h,E,R);return(E!==0||R.length!==0)&&this.notifyArraySplice(h,R,te),this.dehanceValues(te)},t.prototype.spliceItemsIntoValues=function(h,E,R){var Y;if(R.length<MAX_SPLICE_SIZE)return(Y=this.values).splice.apply(Y,__spread([h,E],R));var Z=this.values.slice(h,h+E);return this.values=this.values.slice(0,h).concat(R,this.values.slice(h+E)),Z},t.prototype.notifyArrayChildUpdate=function(h,E,R){var Y=!this.owned&&isSpyEnabled(),Z=hasListeners(this),ee=Z||Y?{object:this.proxy,type:"update",index:h,newValue:E,oldValue:R}:null;this.atom.reportChanged(),Z&&notifyListeners(this,ee)},t.prototype.notifyArraySplice=function(h,E,R){var Y=!this.owned&&isSpyEnabled(),Z=hasListeners(this),ee=Z||Y?{object:this.proxy,type:"splice",index:h,removed:R,added:E,removedCount:R.length,addedCount:E.length}:null;this.atom.reportChanged(),Z&&notifyListeners(this,ee)},t}(),arrayExtensions={intercept:function(t){return this[$mobx].intercept(t)},observe:function(t,h){h===void 0&&(h=!1);var E=this[$mobx];return E.observe(t,h)},clear:function(){return this.splice(0)},replace:function(t){var h=this[$mobx];return h.spliceWithArray(0,h.values.length,t)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(t,h){for(var E=[],R=2;R<arguments.length;R++)E[R-2]=arguments[R];var Y=this[$mobx];switch(arguments.length){case 0:return[];case 1:return Y.spliceWithArray(t);case 2:return Y.spliceWithArray(t,h)}return Y.spliceWithArray(t,h,E)},spliceWithArray:function(t,h,E){var R=this[$mobx];return R.spliceWithArray(t,h,E)},push:function(){for(var t=[],h=0;h<arguments.length;h++)t[h]=arguments[h];var E=this[$mobx];return E.spliceWithArray(E.values.length,0,t),E.values.length},pop:function(){return this.splice(Math.max(this[$mobx].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var t=[],h=0;h<arguments.length;h++)t[h]=arguments[h];var E=this[$mobx];return E.spliceWithArray(0,0,t),E.values.length},reverse:function(){var t=this.slice();return t.reverse.apply(t,arguments)},sort:function(t){var h=this.slice();return h.sort.apply(h,arguments)},remove:function(t){var h=this[$mobx],E=h.dehanceValues(h.values).indexOf(t);return E>-1?(this.splice(E,1),!0):!1},get:function(t){var h=this[$mobx];if(h){if(t<h.values.length)return h.atom.reportObserved(),h.dehanceValue(h.values[t]);console.warn("[mobx.array] Attempt to read an array index ("+t+") that is out of bounds ("+h.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(t,h){var E=this[$mobx],R=E.values;if(t<R.length){checkIfStateModificationsAreAllowed(E.atom);var Y=R[t];if(hasInterceptors(E)){var Z=interceptChange(E,{type:"update",object:E.proxy,index:t,newValue:h});if(!Z)return;h=Z.newValue}h=E.enhancer(h,Y);var ee=h!==Y;ee&&(R[t]=h,E.notifyArrayChildUpdate(t,h,Y))}else if(t===R.length)E.spliceWithArray(t,0,[h]);else throw new Error("[mobx.array] Index out of bounds, "+t+" is larger than "+R.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(t){typeof Array.prototype[t]=="function"&&(arrayExtensions[t]=function(){var h=this[$mobx];h.atom.reportObserved();var E=h.dehanceValues(h.values);return E[t].apply(E,arguments)})}),["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(t){typeof Array.prototype[t]=="function"&&(arrayExtensions[t]=function(h,E){var R=this,Y=this[$mobx];Y.atom.reportObserved();var Z=Y.dehanceValues(Y.values);return Z[t](function(ee,te){return h.call(E,ee,te,R)},E)})}),["reduce","reduceRight"].forEach(function(t){arrayExtensions[t]=function(){var h=this,E=this[$mobx];E.atom.reportObserved();var R=arguments[0];return arguments[0]=function(Y,Z,ee){return Z=E.dehanceValue(Z),R(Y,Z,ee,h)},E.values[t].apply(E.values,arguments)}});var isObservableArrayAdministration=createInstanceofPredicate("ObservableArrayAdministration",ObservableArrayAdministration);function isObservableArray(t){return isObject$4(t)&&isObservableArrayAdministration(t[$mobx])}var _a$1,ObservableMapMarker={},ObservableMap=function(){function t(h,E,R){if(E===void 0&&(E=deepEnhancer),R===void 0&&(R="ObservableMap@"+getNextId()),this.enhancer=E,this.name=R,this[_a$1]=ObservableMapMarker,this._keysAtom=createAtom(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(h)}return t.prototype._has=function(h){return this._data.has(h)},t.prototype.has=function(h){var E=this;if(!globalState.trackingDerivation)return this._has(h);var R=this._hasMap.get(h);if(!R){var Y=R=new ObservableValue(this._has(h),referenceEnhancer,this.name+"."+stringifyKey(h)+"?",!1);this._hasMap.set(h,Y),onBecomeUnobserved(Y,function(){return E._hasMap.delete(h)})}return R.get()},t.prototype.set=function(h,E){var R=this._has(h);if(hasInterceptors(this)){var Y=interceptChange(this,{type:R?"update":"add",object:this,newValue:E,name:h});if(!Y)return this;E=Y.newValue}return R?this._updateValue(h,E):this._addValue(h,E),this},t.prototype.delete=function(h){var E=this;if(checkIfStateModificationsAreAllowed(this._keysAtom),hasInterceptors(this)){var R=interceptChange(this,{type:"delete",object:this,name:h});if(!R)return!1}if(this._has(h)){var Y=isSpyEnabled(),Z=hasListeners(this),R=Z||Y?{type:"delete",object:this,oldValue:this._data.get(h).value,name:h}:null;return transaction(function(){E._keysAtom.reportChanged(),E._updateHasMapEntry(h,!1);var te=E._data.get(h);te.setNewValue(void 0),E._data.delete(h)}),Z&&notifyListeners(this,R),!0}return!1},t.prototype._updateHasMapEntry=function(h,E){var R=this._hasMap.get(h);R&&R.setNewValue(E)},t.prototype._updateValue=function(h,E){var R=this._data.get(h);if(E=R.prepareNewValue(E),E!==globalState.UNCHANGED){var Y=isSpyEnabled(),Z=hasListeners(this),ee=Z||Y?{type:"update",object:this,oldValue:R.value,name:h,newValue:E}:null;R.setNewValue(E),Z&&notifyListeners(this,ee)}},t.prototype._addValue=function(h,E){var R=this;checkIfStateModificationsAreAllowed(this._keysAtom),transaction(function(){var te=new ObservableValue(E,R.enhancer,R.name+"."+stringifyKey(h),!1);R._data.set(h,te),E=te.value,R._updateHasMapEntry(h,!0),R._keysAtom.reportChanged()});var Y=isSpyEnabled(),Z=hasListeners(this),ee=Z||Y?{type:"add",object:this,name:h,newValue:E}:null;Z&&notifyListeners(this,ee)},t.prototype.get=function(h){return this.has(h)?this.dehanceValue(this._data.get(h).get()):this.dehanceValue(void 0)},t.prototype.dehanceValue=function(h){return this.dehancer!==void 0?this.dehancer(h):h},t.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},t.prototype.values=function(){var h=this,E=this.keys();return makeIterable({next:function(){var R=E.next(),Y=R.done,Z=R.value;return{done:Y,value:Y?void 0:h.get(Z)}}})},t.prototype.entries=function(){var h=this,E=this.keys();return makeIterable({next:function(){var R=E.next(),Y=R.done,Z=R.value;return{done:Y,value:Y?void 0:[Z,h.get(Z)]}}})},t.prototype[_a$1=$mobx,Symbol.iterator]=function(){return this.entries()},t.prototype.forEach=function(h,E){var R,Y;try{for(var Z=__values$2(this),ee=Z.next();!ee.done;ee=Z.next()){var te=__read$A(ee.value,2),ne=te[0],oe=te[1];h.call(E,oe,ne,this)}}catch(ie){R={error:ie}}finally{try{ee&&!ee.done&&(Y=Z.return)&&Y.call(Z)}finally{if(R)throw R.error}}},t.prototype.merge=function(h){var E=this;return isObservableMap(h)&&(h=h.toJS()),transaction(function(){var R=allowStateChangesStart$1(!0);try{isPlainObject$2(h)?getPlainObjectKeys(h).forEach(function(Y){return E.set(Y,h[Y])}):Array.isArray(h)?h.forEach(function(Y){var Z=__read$A(Y,2),ee=Z[0],te=Z[1];return E.set(ee,te)}):isES6Map(h)?(h.constructor!==Map&&fail("Cannot initialize from classes that inherit from Map: "+h.constructor.name),h.forEach(function(Y,Z){return E.set(Z,Y)})):h!=null&&fail("Cannot initialize map from "+h)}finally{allowStateChangesEnd$1(R)}}),this},t.prototype.clear=function(){var h=this;transaction(function(){untracked(function(){var E,R;try{for(var Y=__values$2(h.keys()),Z=Y.next();!Z.done;Z=Y.next()){var ee=Z.value;h.delete(ee)}}catch(te){E={error:te}}finally{try{Z&&!Z.done&&(R=Y.return)&&R.call(Y)}finally{if(E)throw E.error}}})})},t.prototype.replace=function(h){var E=this;return transaction(function(){var R,Y,Z,ee,te=convertToMap(h),ne=new Map,oe=!1;try{for(var ie=__values$2(E._data.keys()),ae=ie.next();!ae.done;ae=ie.next()){var se=ae.value;if(!te.has(se)){var ue=E.delete(se);if(ue)oe=!0;else{var fe=E._data.get(se);ne.set(se,fe)}}}}catch(me){R={error:me}}finally{try{ae&&!ae.done&&(Y=ie.return)&&Y.call(ie)}finally{if(R)throw R.error}}try{for(var le=__values$2(te.entries()),de=le.next();!de.done;de=le.next()){var ce=__read$A(de.value,2),se=ce[0],fe=ce[1],pe=E._data.has(se);if(E.set(se,fe),E._data.has(se)){var he=E._data.get(se);ne.set(se,he),pe||(oe=!0)}}}catch(me){Z={error:me}}finally{try{de&&!de.done&&(ee=le.return)&&ee.call(le)}finally{if(Z)throw Z.error}}if(!oe)if(E._data.size!==ne.size)E._keysAtom.reportChanged();else for(var ge=E._data.keys(),ve=ne.keys(),_e=ge.next(),ye=ve.next();!_e.done;){if(_e.value!==ye.value){E._keysAtom.reportChanged();break}_e=ge.next(),ye=ve.next()}E._data=ne}),this},Object.defineProperty(t.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),t.prototype.toPOJO=function(){var h,E,R={};try{for(var Y=__values$2(this),Z=Y.next();!Z.done;Z=Y.next()){var ee=__read$A(Z.value,2),te=ee[0],ne=ee[1];R[typeof te=="symbol"?te:stringifyKey(te)]=ne}}catch(oe){h={error:oe}}finally{try{Z&&!Z.done&&(E=Y.return)&&E.call(Y)}finally{if(h)throw h.error}}return R},t.prototype.toJS=function(){return new Map(this)},t.prototype.toJSON=function(){return this.toPOJO()},t.prototype.toString=function(){var h=this;return this.name+"[{ "+Array.from(this.keys()).map(function(E){return stringifyKey(E)+": "+(""+h.get(E))}).join(", ")+" }]"},t.prototype.observe=function(h,E){return registerListener(this,h)},t.prototype.intercept=function(h){return registerInterceptor(this,h)},t}(),isObservableMap=createInstanceofPredicate("ObservableMap",ObservableMap),_a$1$1,ObservableSetMarker={},ObservableSet=function(){function t(h,E,R){if(E===void 0&&(E=deepEnhancer),R===void 0&&(R="ObservableSet@"+getNextId()),this.name=R,this[_a$1$1]=ObservableSetMarker,this._data=new Set,this._atom=createAtom(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(Y,Z){return E(Y,Z,R)},h&&this.replace(h)}return t.prototype.dehanceValue=function(h){return this.dehancer!==void 0?this.dehancer(h):h},t.prototype.clear=function(){var h=this;transaction(function(){untracked(function(){var E,R;try{for(var Y=__values$2(h._data.values()),Z=Y.next();!Z.done;Z=Y.next()){var ee=Z.value;h.delete(ee)}}catch(te){E={error:te}}finally{try{Z&&!Z.done&&(R=Y.return)&&R.call(Y)}finally{if(E)throw E.error}}})})},t.prototype.forEach=function(h,E){var R,Y;try{for(var Z=__values$2(this),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;h.call(E,te,te,this)}}catch(ne){R={error:ne}}finally{try{ee&&!ee.done&&(Y=Z.return)&&Y.call(Z)}finally{if(R)throw R.error}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),t.prototype.add=function(h){var E=this;if(checkIfStateModificationsAreAllowed(this._atom),hasInterceptors(this)){var R=interceptChange(this,{type:"add",object:this,newValue:h});if(!R)return this}if(!this.has(h)){transaction(function(){E._data.add(E.enhancer(h,void 0)),E._atom.reportChanged()});var Y=isSpyEnabled(),Z=hasListeners(this),R=Z||Y?{type:"add",object:this,newValue:h}:null;Z&&notifyListeners(this,R)}return this},t.prototype.delete=function(h){var E=this;if(hasInterceptors(this)){var R=interceptChange(this,{type:"delete",object:this,oldValue:h});if(!R)return!1}if(this.has(h)){var Y=isSpyEnabled(),Z=hasListeners(this),R=Z||Y?{type:"delete",object:this,oldValue:h}:null;return transaction(function(){E._atom.reportChanged(),E._data.delete(h)}),Z&&notifyListeners(this,R),!0}return!1},t.prototype.has=function(h){return this._atom.reportObserved(),this._data.has(this.dehanceValue(h))},t.prototype.entries=function(){var h=0,E=Array.from(this.keys()),R=Array.from(this.values());return makeIterable({next:function(){var Y=h;return h+=1,Y<R.length?{value:[E[Y],R[Y]],done:!1}:{done:!0}}})},t.prototype.keys=function(){return this.values()},t.prototype.values=function(){this._atom.reportObserved();var h=this,E=0,R=Array.from(this._data.values());return makeIterable({next:function(){return E<R.length?{value:h.dehanceValue(R[E++]),done:!1}:{done:!0}}})},t.prototype.replace=function(h){var E=this;return isObservableSet(h)&&(h=h.toJS()),transaction(function(){var R=allowStateChangesStart$1(!0);try{Array.isArray(h)?(E.clear(),h.forEach(function(Y){return E.add(Y)})):isES6Set(h)?(E.clear(),h.forEach(function(Y){return E.add(Y)})):h!=null&&fail("Cannot initialize set from "+h)}finally{allowStateChangesEnd$1(R)}}),this},t.prototype.observe=function(h,E){return registerListener(this,h)},t.prototype.intercept=function(h){return registerInterceptor(this,h)},t.prototype.toJS=function(){return new Set(this)},t.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},t.prototype[_a$1$1=$mobx,Symbol.iterator]=function(){return this.values()},t}(),isObservableSet=createInstanceofPredicate("ObservableSet",ObservableSet),ObservableObjectAdministration=function(){function t(h,E,R,Y){E===void 0&&(E=new Map),this.target=h,this.values=E,this.name=R,this.defaultEnhancer=Y,this.keysAtom=new Atom(R+".keys")}return t.prototype.read=function(h){return this.values.get(h).get()},t.prototype.write=function(h,E){var R=this.target,Y=this.values.get(h);if(Y instanceof ComputedValue){Y.set(E);return}if(hasInterceptors(this)){var Z=interceptChange(this,{type:"update",object:this.proxy||R,name:h,newValue:E});if(!Z)return;E=Z.newValue}if(E=Y.prepareNewValue(E),E!==globalState.UNCHANGED){var ee=hasListeners(this),te=isSpyEnabled(),Z=ee||te?{type:"update",object:this.proxy||R,oldValue:Y.value,name:h,newValue:E}:null;Y.setNewValue(E),ee&&notifyListeners(this,Z)}},t.prototype.has=function(h){var E=this.pendingKeys||(this.pendingKeys=new Map),R=E.get(h);if(R)return R.get();var Y=!!this.values.get(h);return R=new ObservableValue(Y,referenceEnhancer,this.name+"."+stringifyKey(h)+"?",!1),E.set(h,R),R.get()},t.prototype.addObservableProp=function(h,E,R){R===void 0&&(R=this.defaultEnhancer);var Y=this.target;if(hasInterceptors(this)){var Z=interceptChange(this,{object:this.proxy||Y,name:h,type:"add",newValue:E});if(!Z)return;E=Z.newValue}var ee=new ObservableValue(E,R,this.name+"."+stringifyKey(h),!1);this.values.set(h,ee),E=ee.value,Object.defineProperty(Y,h,generateObservablePropConfig(h)),this.notifyPropertyAddition(h,E)},t.prototype.addComputedProp=function(h,E,R){var Y=this.target;R.name=R.name||this.name+"."+stringifyKey(E),this.values.set(E,new ComputedValue(R)),(h===Y||isPropertyConfigurable(h,E))&&Object.defineProperty(h,E,generateComputedPropConfig(E))},t.prototype.remove=function(h){if(this.values.has(h)){var E=this.target;if(hasInterceptors(this)){var R=interceptChange(this,{object:this.proxy||E,name:h,type:"remove"});if(!R)return}try{startBatch();var Y=hasListeners(this),Z=isSpyEnabled(),ee=this.values.get(h),te=ee&&ee.get();if(ee&&ee.set(void 0),this.keysAtom.reportChanged(),this.values.delete(h),this.pendingKeys){var ne=this.pendingKeys.get(h);ne&&ne.set(!1)}delete this.target[h];var R=Y||Z?{type:"remove",object:this.proxy||E,oldValue:te,name:h}:null;Y&&notifyListeners(this,R)}finally{endBatch()}}},t.prototype.illegalAccess=function(h,E){console.warn("Property '"+E+"' of '"+h+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},t.prototype.observe=function(h,E){return registerListener(this,h)},t.prototype.intercept=function(h){return registerInterceptor(this,h)},t.prototype.notifyPropertyAddition=function(h,E){var R=hasListeners(this),Y=isSpyEnabled(),Z=R||Y?{type:"add",object:this.proxy||this.target,name:h,newValue:E}:null;if(R&&notifyListeners(this,Z),this.pendingKeys){var ee=this.pendingKeys.get(h);ee&&ee.set(!0)}this.keysAtom.reportChanged()},t.prototype.getKeys=function(){var h,E;this.keysAtom.reportObserved();var R=[];try{for(var Y=__values$2(this.values),Z=Y.next();!Z.done;Z=Y.next()){var ee=__read$A(Z.value,2),te=ee[0],ne=ee[1];ne instanceof ObservableValue&&R.push(te)}}catch(oe){h={error:oe}}finally{try{Z&&!Z.done&&(E=Y.return)&&E.call(Y)}finally{if(h)throw h.error}}return R},t}();function asObservableObject(t,h,E){if(h===void 0&&(h=""),E===void 0&&(E=deepEnhancer),Object.prototype.hasOwnProperty.call(t,$mobx))return t[$mobx];isPlainObject$2(t)||(h=(t.constructor.name||"ObservableObject")+"@"+getNextId()),h||(h="ObservableObject@"+getNextId());var R=new ObservableObjectAdministration(t,new Map,stringifyKey(h),E);return addHiddenProp(t,$mobx,R),R}var observablePropertyConfigs=Object.create(null),computedPropertyConfigs=Object.create(null);function generateObservablePropConfig(t){return observablePropertyConfigs[t]||(observablePropertyConfigs[t]={configurable:!0,enumerable:!0,get:function(){return this[$mobx].read(t)},set:function(h){this[$mobx].write(t,h)}})}function getAdministrationForComputedPropOwner(t){var h=t[$mobx];return h||(initializeInstance(t),t[$mobx])}function generateComputedPropConfig(t){return computedPropertyConfigs[t]||(computedPropertyConfigs[t]={configurable:globalState.computedConfigurable,enumerable:!1,get:function(){return getAdministrationForComputedPropOwner(this).read(t)},set:function(h){getAdministrationForComputedPropOwner(this).write(t,h)}})}var isObservableObjectAdministration=createInstanceofPredicate("ObservableObjectAdministration",ObservableObjectAdministration);function isObservableObject(t){return isObject$4(t)?(initializeInstance(t),isObservableObjectAdministration(t[$mobx])):!1}function getAtom(t,h){if(typeof t=="object"&&t!==null){if(isObservableArray(t))return h!==void 0&&fail(!1),t[$mobx].atom;if(isObservableSet(t))return t[$mobx];if(isObservableMap(t)){var E=t;if(h===void 0)return E._keysAtom;var R=E._data.get(h)||E._hasMap.get(h);return R||fail(!1),R}if(initializeInstance(t),h&&!t[$mobx]&&t[h],isObservableObject(t)){if(!h)return fail(!1);var R=t[$mobx].values.get(h);return R||fail(!1),R}if(isAtom(t)||isComputedValue(t)||isReaction(t))return t}else if(typeof t=="function"&&isReaction(t[$mobx]))return t[$mobx];return fail(!1)}function getAdministration(t,h){if(t||fail("Expecting some object"),h!==void 0)return getAdministration(getAtom(t,h));if(isAtom(t)||isComputedValue(t)||isReaction(t)||isObservableMap(t)||isObservableSet(t))return t;if(initializeInstance(t),t[$mobx])return t[$mobx];fail(!1)}function getDebugName(t,h){var E;return h!==void 0?E=getAtom(t,h):isObservableObject(t)||isObservableMap(t)||isObservableSet(t)?E=getAdministration(t):E=getAtom(t),E.name}var toString$3=Object.prototype.toString;function deepEqual(t,h,E){return E===void 0&&(E=-1),eq$1(t,h,E)}function eq$1(t,h,E,R,Y){if(t===h)return t!==0||1/t===1/h;if(t==null||h==null)return!1;if(t!==t)return h!==h;var Z=typeof t;if(Z!=="function"&&Z!=="object"&&typeof h!="object")return!1;var ee=toString$3.call(t);if(ee!==toString$3.call(h))return!1;switch(ee){case"[object RegExp]":case"[object String]":return""+t==""+h;case"[object Number]":return+t!=+t?+h!=+h:+t==0?1/+t===1/h:+t==+h;case"[object Date]":case"[object Boolean]":return+t==+h;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(t)===Symbol.valueOf.call(h);case"[object Map]":case"[object Set]":E>=0&&E++;break}t=unwrap(t),h=unwrap(h);var te=ee==="[object Array]";if(!te){if(typeof t!="object"||typeof h!="object")return!1;var ne=t.constructor,oe=h.constructor;if(ne!==oe&&!(typeof ne=="function"&&ne instanceof ne&&typeof oe=="function"&&oe instanceof oe)&&"constructor"in t&&"constructor"in h)return!1}if(E===0)return!1;E<0&&(E=-1),R=R||[],Y=Y||[];for(var ie=R.length;ie--;)if(R[ie]===t)return Y[ie]===h;if(R.push(t),Y.push(h),te){if(ie=t.length,ie!==h.length)return!1;for(;ie--;)if(!eq$1(t[ie],h[ie],E-1,R,Y))return!1}else{var ae=Object.keys(t),se=void 0;if(ie=ae.length,Object.keys(h).length!==ie)return!1;for(;ie--;)if(se=ae[ie],!(has$1(h,se)&&eq$1(t[se],h[se],E-1,R,Y)))return!1}return R.pop(),Y.pop(),!0}function unwrap(t){return isObservableArray(t)?t.slice():isES6Map(t)||isObservableMap(t)||isES6Set(t)||isObservableSet(t)?Array.from(t.entries()):t}function has$1(t,h){return Object.prototype.hasOwnProperty.call(t,h)}function makeIterable(t){return t[Symbol.iterator]=getSelf,t}function getSelf(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");(function(){function t(){}if(t.name!=="testCodeMinification"&&!1)var h})(),typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy,extras:{getDebugName},$mobx});function isStateless(t){return!(t.prototype&&t.prototype.render)&&!x.isPrototypeOf(t)}function makeDisplayName(t){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=h.prefix,R=E===void 0?"":E,Y=h.suffix,Z=Y===void 0?"":Y,ee=t.displayName||t.name||t.constructor&&t.constructor.name||"<component>";return R+ee+Z}var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(h,E){for(var R=0;R<E.length;R++){var Y=E[R];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(h,Y.key,Y)}}return function(h,E,R){return E&&t(h.prototype,E),R&&t(h,R),h}}(),inherits$1=function(t,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);t.prototype=Object.create(h&&h.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(t,h):t.__proto__=h)},possibleConstructorReturn=function(t,h){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:t},logger$3=console;function allowStateChangesStart(t){var h=getGlobalState().allowStateChanges;return getGlobalState().allowStateChanges=t,h}function allowStateChangesEnd(t){getGlobalState().allowStateChanges=t}function allowStateChanges(t,h,E,R,Y){var Z=allowStateChangesStart(t),ee=void 0;try{ee=h(E,R,Y)}finally{allowStateChangesEnd(Z)}return ee}function patch(t,h){var E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,R=t[h],Y=reactiveMixin[h],Z=R?E===!0?function(){Y.apply(this,arguments),R.apply(this,arguments)}:function(){R.apply(this,arguments),Y.apply(this,arguments)}:Y;t[h]=Z}function isObjectShallowModified(t,h){if(t==null||h==null||(typeof t>"u"?"undefined":_typeof(t))!=="object"||(typeof h>"u"?"undefined":_typeof(h))!=="object")return t!==h;var E=Object.keys(t);if(E.length!==Object.keys(h).length)return!0;for(var R=void 0,Y=E.length-1;R=E[Y];Y--)if(h[R]!==t[R])return!0;return!1}var reactiveMixin={componentWillMount:function(){var h=this,E=makeDisplayName(this),R=!1,Y=!1;function Z(ae){var se=this[ae],ue=createAtom("reactive "+ae);Object.defineProperty(this,ae,{configurable:!0,enumerable:!0,get:function(){return ue.reportObserved(),se},set:function(le){!Y&&isObjectShallowModified(se,le)?(se=le,R=!0,ue.reportChanged(),R=!1):se=le}})}Z.call(this,"props"),Z.call(this,"state");var ee=this.render.bind(this),te=null,ne=!1,oe=function(){return te=new Reaction(E+".render()",function(){if(!ne&&(ne=!0,typeof h.componentWillReact=="function"&&h.componentWillReact(),h.__$mobxIsUnmounted!==!0)){var se=!0;try{Y=!0,R||x.prototype.forceUpdate.call(h),se=!1}finally{Y=!1,se&&te.dispose()}}}),te.reactComponent=h,ie.$mobx=te,h.render=ie,ie(h.props,h.state,h.context)},ie=function(se,ue,fe){ne=!1;var le=void 0,de=void 0;if(te.track(function(){try{de=allowStateChanges(!1,ee,se,ue,fe)}catch(ce){le=ce}}),le)throw le;return de};this.render=oe},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(h,E){return this.state!==E?!0:isObjectShallowModified(this.props,h)}};function observer$1(t){if(arguments.length>1&&logger$3.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),t.isMobxInjector===!0&&logger$3.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),isStateless(t)){var h,E;return observer$1((E=h=function(Y){inherits$1(Z,Y);function Z(){return classCallCheck(this,Z),possibleConstructorReturn(this,(Z.__proto__||Object.getPrototypeOf(Z)).apply(this,arguments))}return createClass(Z,[{key:"render",value:function(){return t.call(this,this.props,this.context)}}]),Z}(x),h.displayName=makeDisplayName(t),E))}if(!t)throw new Error("Please pass a valid component to 'observer'");var R=t.prototype||t;return mixinLifecycleEvents(R),t.isMobXReactObserver=!0,t}function mixinLifecycleEvents(t){patch(t,"componentWillMount",!0),patch(t,"componentDidMount"),t.shouldComponentUpdate||(t.shouldComponentUpdate=reactiveMixin.shouldComponentUpdate)}var Observer=observer$1(function(t){var h=t.children;return h[0]()});Observer.displayName="Observer";var commonjsGlobal=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function createCommonjsModule(t,h){return h={exports:{}},t(h,h.exports),h.exports}createCommonjsModule(function(t,h){(function(E,R){t.exports=R()})(commonjsGlobal,function(){var E={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},R={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Y=Object.defineProperty,Z=Object.getOwnPropertyNames,ee=Object.getOwnPropertySymbols,te=Object.getOwnPropertyDescriptor,ne=Object.getPrototypeOf,oe=ne&&ne(Object);return function ie(ae,se,ue){if(typeof se!="string"){if(oe){var fe=ne(se);fe&&fe!==oe&&ie(ae,fe,ue)}var le=Z(se);ee&&(le=le.concat(ee(se)));for(var de=0;de<le.length;++de){var ce=le[de];if(!E[ce]&&!R[ce]&&(!ue||!ue[ce])){var pe=te(se,ce);try{Y(ae,ce,pe)}catch{}}}return ae}return ae}})});var specialReactKeys={children:!0,key:!0,ref:!0},logger$1$1=console;if(function(t){inherits$1(h,t);function h(){return classCallCheck(this,h),possibleConstructorReturn(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return createClass(h,[{key:"render",value:function(R){var Y=R.children;return Y.length>1?g$2("div",null," ",Y," "):Y[0]}},{key:"getChildContext",value:function(){var R={},Y=this.context.mobxStores;if(Y)for(var Z in Y)R[Z]=Y[Z];for(var ee in this.props)!specialReactKeys[ee]&&ee!=="suppressChangedStoreWarning"&&(R[ee]=this.props[ee]);return{mobxStores:R}}},{key:"componentWillReceiveProps",value:function(R){if(Object.keys(R).length!==Object.keys(this.props).length&&logger$1$1.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!R.suppressChangedStoreWarning)for(var Y in R)!specialReactKeys[Y]&&this.props[Y]!==R[Y]&&logger$1$1.warn("MobX Provider: Provided store '"+Y+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),h}(x),!x)throw new Error("mobx-preact requires Preact to be available");var r,u$1,i,f$1=[],c=l$1,e=c.__b,a=c.__r,v=c.diffed,l=c.__c,m=c.unmount,s=c.__;function j(){for(var t;t=f$1.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(z$1),t.__H.__h.forEach(B$1),t.__H.__h=[]}catch(h){t.__H.__h=[],c.__e(h,t.__v)}}c.__b=function(t){r=null,e&&e(t)},c.__=function(t,h){t&&h.__k&&h.__k.__m&&(t.__m=h.__k.__m),s&&s(t,h)},c.__r=function(t){a&&a(t);var h=(r=t.__c).__H;h&&(u$1===r?(h.__h=[],r.__h=[],h.__.forEach(function(E){E.__N&&(E.__=E.__N),E.i=E.__N=void 0})):(h.__h.forEach(z$1),h.__h.forEach(B$1),h.__h=[])),u$1=r},c.diffed=function(t){v&&v(t);var h=t.__c;h&&h.__H&&(h.__H.__h.length&&(f$1.push(h)!==1&&i===c.requestAnimationFrame||((i=c.requestAnimationFrame)||w)(j)),h.__H.__.forEach(function(E){E.i&&(E.__H=E.i),E.i=void 0})),u$1=r=null},c.__c=function(t,h){h.some(function(E){try{E.__h.forEach(z$1),E.__h=E.__h.filter(function(R){return!R.__||B$1(R)})}catch(R){h.some(function(Y){Y.__h&&(Y.__h=[])}),h=[],c.__e(R,E.__v)}}),l&&l(t,h)},c.unmount=function(t){m&&m(t);var h,E=t.__c;E&&E.__H&&(E.__H.__.forEach(function(R){try{z$1(R)}catch(Y){h=Y}}),E.__H=void 0,h&&c.__e(h,E.__v))};var k=typeof requestAnimationFrame=="function";function w(t){var h,E=function(){clearTimeout(R),k&&cancelAnimationFrame(h),setTimeout(t)},R=setTimeout(E,100);k&&(h=requestAnimationFrame(E))}function z$1(t){var h=r,E=t.__c;typeof E=="function"&&(t.__c=void 0,E()),r=h}function B$1(t){var h=r;t.__c=t.__(),r=h}function g$1(t,h){for(var E in t)if(E!=="__source"&&!(E in h))return!0;for(var R in h)if(R!=="__source"&&t[R]!==h[R])return!0;return!1}function I(t,h){this.props=t,this.context=h}(I.prototype=new x).isPureReactComponent=!0,I.prototype.shouldComponentUpdate=function(t,h){return g$1(this.props,t)||g$1(this.state,h)};var M=l$1.__b;l$1.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),M&&M(t)};var O=l$1.__e;l$1.__e=function(t,h,E,R){if(t.then){for(var Y,Z=h;Z=Z.__;)if((Y=Z.__c)&&Y.__c)return h.__e==null&&(h.__e=E.__e,h.__k=E.__k),Y.__c(t,h)}O(t,h,E,R)};var F=l$1.unmount;function U(t,h,E){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(R){typeof R.__c=="function"&&R.__c()}),t.__c.__H=null),(t=function(R,Y){for(var Z in Y)R[Z]=Y[Z];return R}({},t)).__c!=null&&(t.__c.__P===E&&(t.__c.__P=h),t.__c=null),t.__k=t.__k&&t.__k.map(function(R){return U(R,h,E)})),t}function V(t,h,E){return t&&E&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(R){return V(R,h,E)}),t.__c&&t.__c.__P===h&&(t.__e&&E.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=E)),t}function W(){this.__u=0,this.o=null,this.__b=null}function P(t){var h=t.__.__c;return h&&h.__a&&h.__a(t)}function z(){this.i=null,this.l=null}l$1.unmount=function(t){var h=t.__c;h&&h.__R&&h.__R(),h&&32&t.__u&&(t.type=null),F&&F(t)},(W.prototype=new x).__c=function(t,h){var E=h.__c,R=this;R.o==null&&(R.o=[]),R.o.push(E);var Y=P(R.__v),Z=!1,ee=function(){Z||(Z=!0,E.__R=null,Y?Y(te):te())};E.__R=ee;var te=function(){if(!--R.__u){if(R.state.__a){var ne=R.state.__a;R.__v.__k[0]=V(ne,ne.__c.__P,ne.__c.__O)}var oe;for(R.setState({__a:R.__b=null});oe=R.o.pop();)oe.forceUpdate()}};R.__u++||32&h.__u||R.setState({__a:R.__b=R.__v.__k[0]}),t.then(ee,ee)},W.prototype.componentWillUnmount=function(){this.o=[]},W.prototype.render=function(t,h){if(this.__b){if(this.__v.__k){var E=document.createElement("div"),R=this.__v.__k[0].__c;this.__v.__k[0]=U(this.__b,E,R.__O=R.__P)}this.__b=null}var Y=h.__a&&g$2(k$1,null,t.fallback);return Y&&(Y.__u&=-33),[g$2(k$1,null,h.__a?null:t.children),Y]};var B=function(t,h,E){if(++E[1]===E[0]&&t.l.delete(h),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(E=t.i;E;){for(;E.length>3;)E.pop()();if(E[1]<E[0])break;t.i=E=E[2]}};(z.prototype=new x).__a=function(t){var h=this,E=P(h.__v),R=h.l.get(t);return R[0]++,function(Y){var Z=function(){h.props.revealOrder?(R.push(Y),B(h,t,R)):Y()};E?E(Z):Z()}},z.prototype.render=function(t){this.i=null,this.l=new Map;var h=L(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&h.reverse();for(var E=h.length;E--;)this.l.set(h[E],this.i=[1,0,this.i]);return t.children},z.prototype.componentDidUpdate=z.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(h,E){B(t,E,h)})};var $=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,q=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,G=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,J=/[A-Z0-9]/g,K=typeof document<"u",Q=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function X(t,h,E){return h.__k==null&&(h.textContent=""),D(t,h),typeof E=="function"&&E(),t?t.__c:null}x.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(x.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(h){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:h})}})});var tn=l$1.event;function en(){}function rn(){return this.cancelBubble}function un(){return this.defaultPrevented}l$1.event=function(t){return tn&&(t=tn(t)),t.persist=en,t.isPropagationStopped=rn,t.isDefaultPrevented=un,t.nativeEvent=t};var cn={enumerable:!1,configurable:!0,get:function(){return this.class}},fn=l$1.vnode;l$1.vnode=function(t){typeof t.type=="string"&&function(h){var E=h.props,R=h.type,Y={},Z=R.indexOf("-")===-1;for(var ee in E){var te=E[ee];if(!(ee==="value"&&"defaultValue"in E&&te==null||K&&ee==="children"&&R==="noscript"||ee==="class"||ee==="className")){var ne=ee.toLowerCase();ee==="defaultValue"&&"value"in E&&E.value==null?ee="value":ee==="download"&&te===!0?te="":ne==="translate"&&te==="no"?te=!1:ne[0]==="o"&&ne[1]==="n"?ne==="ondoubleclick"?ee="ondblclick":ne!=="onchange"||R!=="input"&&R!=="textarea"||Q(E.type)?ne==="onfocus"?ee="onfocusin":ne==="onblur"?ee="onfocusout":G.test(ee)&&(ee=ne):ne=ee="oninput":Z&&q.test(ee)?ee=ee.replace(J,"-$&").toLowerCase():te===null&&(te=void 0),ne==="oninput"&&Y[ee=ne]&&(ee="oninputCapture"),Y[ee]=te}}R=="select"&&Y.multiple&&Array.isArray(Y.value)&&(Y.value=L(E.children).forEach(function(oe){oe.props.selected=Y.value.indexOf(oe.props.value)!=-1})),R=="select"&&Y.defaultValue!=null&&(Y.value=L(E.children).forEach(function(oe){oe.props.selected=Y.multiple?Y.defaultValue.indexOf(oe.props.value)!=-1:Y.defaultValue==oe.props.value})),E.class&&!E.className?(Y.class=E.class,Object.defineProperty(Y,"className",cn)):(E.className&&!E.class||E.class&&E.className)&&(Y.class=Y.className=E.className),h.props=Y}(t),t.$$typeof=$,fn&&fn(t)};var ln=l$1.__r;l$1.__r=function(t){ln&&ln(t),t.__c};var an=l$1.diffed;l$1.diffed=function(t){an&&an(t);var h=t.props,E=t.__e;E!=null&&t.type==="textarea"&&"value"in h&&h.value!==E.value&&(E.value=h.value==null?"":h.value)};var f=0;function u(t,h,E,R,Y,Z){h||(h={});var ee,te,ne=h;"ref"in h&&(ee=h.ref,delete h.ref);var oe={type:t,props:ne,key:E,ref:ee,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--f,__i:-1,__u:0,__source:Y,__self:Z};if(typeof t=="function"&&(ee=t.defaultProps))for(te in ee)ne[te]===void 0&&(ne[te]=ee[te]);return l$1.vnode&&l$1.vnode(oe),oe}var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$i=Object.prototype,hasOwnProperty$g=objectProto$i.hasOwnProperty,nativeObjectToString$1=objectProto$i.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(t){var h=hasOwnProperty$g.call(t,symToStringTag$1),E=t[symToStringTag$1];try{t[symToStringTag$1]=void 0;var R=!0}catch{}var Y=nativeObjectToString$1.call(t);return R&&(h?t[symToStringTag$1]=E:delete t[symToStringTag$1]),Y}var objectProto$h=Object.prototype,nativeObjectToString=objectProto$h.toString;function objectToString(t){return nativeObjectToString.call(t)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(t){return t==null?t===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(t)?getRawTag(t):objectToString(t)}function isObjectLike(t){return t!=null&&typeof t=="object"}var symbolTag$3="[object Symbol]";function isSymbol(t){return typeof t=="symbol"||isObjectLike(t)&&baseGetTag(t)==symbolTag$3}function arrayMap(t,h){for(var E=-1,R=t==null?0:t.length,Y=Array(R);++E<R;)Y[E]=h(t[E],E,t);return Y}var isArray$2=Array.isArray,INFINITY$2=1/0,symbolProto$2=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(t){if(typeof t=="string")return t;if(isArray$2(t))return arrayMap(t,baseToString)+"";if(isSymbol(t))return symbolToString?symbolToString.call(t):"";var h=t+"";return h=="0"&&1/t==-INFINITY$2?"-0":h}var reWhitespace=/\s/;function trimmedEndIndex(t){for(var h=t.length;h--&&reWhitespace.test(t.charAt(h)););return h}var reTrimStart=/^\s+/;function baseTrim(t){return t&&t.slice(0,trimmedEndIndex(t)+1).replace(reTrimStart,"")}function isObject$3(t){var h=typeof t;return t!=null&&(h=="object"||h=="function")}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(t){if(typeof t=="number")return t;if(isSymbol(t))return NAN;if(isObject$3(t)){var h=typeof t.valueOf=="function"?t.valueOf():t;t=isObject$3(h)?h+"":h}if(typeof t!="string")return t===0?t:+t;t=baseTrim(t);var E=reIsBinary.test(t);return E||reIsOctal.test(t)?freeParseInt(t.slice(2),E?2:8):reIsBadHex.test(t)?NAN:+t}var INFINITY$1=1/0,MAX_INTEGER=17976931348623157e292;function toFinite(t){if(!t)return t===0?t:0;if(t=toNumber(t),t===INFINITY$1||t===-INFINITY$1){var h=t<0?-1:1;return h*MAX_INTEGER}return t===t?t:0}function toInteger(t){var h=toFinite(t),E=h%1;return h===h?E?h-E:h:0}function identity$1(t){return t}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(t){if(!isObject$3(t))return!1;var h=baseGetTag(t);return h==funcTag$2||h==genTag$1||h==asyncTag||h==proxyTag}var coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var t=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function isMasked(t){return!!maskSrcKey&&maskSrcKey in t}var funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource(t){if(t!=null){try{return funcToString$2.call(t)}catch{}try{return t+""}catch{}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$g=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$f=objectProto$g.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$f).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(t){if(!isObject$3(t)||isMasked(t))return!1;var h=isFunction$2(t)?reIsNative:reIsHostCtor;return h.test(toSource(t))}function getValue$1(t,h){return t==null?void 0:t[h]}function getNative(t,h){var E=getValue$1(t,h);return baseIsNative(E)?E:void 0}var WeakMap$1=getNative(root,"WeakMap"),objectCreate=Object.create,baseCreate=function(){function t(){}return function(h){if(!isObject$3(h))return{};if(objectCreate)return objectCreate(h);t.prototype=h;var E=new t;return t.prototype=void 0,E}}();function apply(t,h,E){switch(E.length){case 0:return t.call(h);case 1:return t.call(h,E[0]);case 2:return t.call(h,E[0],E[1]);case 3:return t.call(h,E[0],E[1],E[2])}return t.apply(h,E)}function noop$2(){}function copyArray(t,h){var E=-1,R=t.length;for(h||(h=Array(R));++E<R;)h[E]=t[E];return h}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(t){var h=0,E=0;return function(){var R=nativeNow(),Y=HOT_SPAN-(R-E);if(E=R,Y>0){if(++h>=HOT_COUNT)return arguments[0]}else h=0;return t.apply(void 0,arguments)}}function constant(t){return function(){return t}}var defineProperty=function(){try{var t=getNative(Object,"defineProperty");return t({},"",{}),t}catch{}}(),baseSetToString=defineProperty?function(t,h){return defineProperty(t,"toString",{configurable:!0,enumerable:!1,value:constant(h),writable:!0})}:identity$1,setToString=shortOut(baseSetToString);function arrayEach(t,h){for(var E=-1,R=t==null?0:t.length;++E<R&&h(t[E],E,t)!==!1;);return t}function baseFindIndex(t,h,E,R){for(var Y=t.length,Z=E+-1;++Z<Y;)if(h(t[Z],Z,t))return Z;return-1}function baseIsNaN(t){return t!==t}function strictIndexOf(t,h,E){for(var R=E-1,Y=t.length;++R<Y;)if(t[R]===h)return R;return-1}function baseIndexOf(t,h,E){return h===h?strictIndexOf(t,h,E):baseFindIndex(t,baseIsNaN,E)}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(t,h){var E=typeof t;return h=h??MAX_SAFE_INTEGER$1,!!h&&(E=="number"||E!="symbol"&&reIsUint.test(t))&&t>-1&&t%1==0&&t<h}function baseAssignValue(t,h,E){h=="__proto__"&&defineProperty?defineProperty(t,h,{configurable:!0,enumerable:!0,value:E,writable:!0}):t[h]=E}function eq(t,h){return t===h||t!==t&&h!==h}var objectProto$f=Object.prototype,hasOwnProperty$e=objectProto$f.hasOwnProperty;function assignValue(t,h,E){var R=t[h];(!(hasOwnProperty$e.call(t,h)&&eq(R,E))||E===void 0&&!(h in t))&&baseAssignValue(t,h,E)}function copyObject(t,h,E,R){var Y=!E;E||(E={});for(var Z=-1,ee=h.length;++Z<ee;){var te=h[Z],ne=void 0;ne===void 0&&(ne=t[te]),Y?baseAssignValue(E,te,ne):assignValue(E,te,ne)}return E}var nativeMax$2=Math.max;function overRest(t,h,E){return h=nativeMax$2(h===void 0?t.length-1:h,0),function(){for(var R=arguments,Y=-1,Z=nativeMax$2(R.length-h,0),ee=Array(Z);++Y<Z;)ee[Y]=R[h+Y];Y=-1;for(var te=Array(h+1);++Y<h;)te[Y]=R[Y];return te[h]=E(ee),apply(t,this,te)}}function baseRest(t,h){return setToString(overRest(t,h,identity$1),t+"")}var MAX_SAFE_INTEGER=9007199254740991;function isLength(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER}function isArrayLike(t){return t!=null&&isLength(t.length)&&!isFunction$2(t)}function isIterateeCall(t,h,E){if(!isObject$3(E))return!1;var R=typeof h;return(R=="number"?isArrayLike(E)&&isIndex(h,E.length):R=="string"&&h in E)?eq(E[h],t):!1}function createAssigner(t){return baseRest(function(h,E){var R=-1,Y=E.length,Z=Y>1?E[Y-1]:void 0,ee=Y>2?E[2]:void 0;for(Z=t.length>3&&typeof Z=="function"?(Y--,Z):void 0,ee&&isIterateeCall(E[0],E[1],ee)&&(Z=Y<3?void 0:Z,Y=1),h=Object(h);++R<Y;){var te=E[R];te&&t(h,te,R,Z)}return h})}var objectProto$e=Object.prototype;function isPrototype(t){var h=t&&t.constructor,E=typeof h=="function"&&h.prototype||objectProto$e;return t===E}function baseTimes(t,h){for(var E=-1,R=Array(t);++E<t;)R[E]=h(E);return R}var argsTag$3="[object Arguments]";function baseIsArguments(t){return isObjectLike(t)&&baseGetTag(t)==argsTag$3}var objectProto$d=Object.prototype,hasOwnProperty$d=objectProto$d.hasOwnProperty,propertyIsEnumerable$1=objectProto$d.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(t){return isObjectLike(t)&&hasOwnProperty$d.call(t,"callee")&&!propertyIsEnumerable$1.call(t,"callee")};function stubFalse(){return!1}var freeExports$2=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$2=moduleExports$2?root.Buffer:void 0,nativeIsBuffer=Buffer$2?Buffer$2.isBuffer:void 0,isBuffer$1=nativeIsBuffer||stubFalse,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$4="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$7="[object Map]",numberTag$3="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$7="[object Set]",stringTag$3="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$4]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$7]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$4]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$7]=typedArrayTags[stringTag$3]=typedArrayTags[weakMapTag$2]=!1;function baseIsTypedArray(t){return isObjectLike(t)&&isLength(t.length)&&!!typedArrayTags[baseGetTag(t)]}function baseUnary(t){return function(h){return t(h)}}var freeExports$1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{var t=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return t||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch{}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$1=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$c=Object.prototype,hasOwnProperty$c=objectProto$c.hasOwnProperty;function arrayLikeKeys(t,h){var E=isArray$2(t),R=!E&&isArguments(t),Y=!E&&!R&&isBuffer$1(t),Z=!E&&!R&&!Y&&isTypedArray$1(t),ee=E||R||Y||Z,te=ee?baseTimes(t.length,String):[],ne=te.length;for(var oe in t)(h||hasOwnProperty$c.call(t,oe))&&!(ee&&(oe=="length"||Y&&(oe=="offset"||oe=="parent")||Z&&(oe=="buffer"||oe=="byteLength"||oe=="byteOffset")||isIndex(oe,ne)))&&te.push(oe);return te}function overArg(t,h){return function(E){return t(h(E))}}var nativeKeys=overArg(Object.keys,Object),objectProto$b=Object.prototype,hasOwnProperty$b=objectProto$b.hasOwnProperty;function baseKeys(t){if(!isPrototype(t))return nativeKeys(t);var h=[];for(var E in Object(t))hasOwnProperty$b.call(t,E)&&E!="constructor"&&h.push(E);return h}function keys(t){return isArrayLike(t)?arrayLikeKeys(t):baseKeys(t)}var objectProto$a=Object.prototype,hasOwnProperty$a=objectProto$a.hasOwnProperty,assign=createAssigner(function(t,h){if(isPrototype(h)||isArrayLike(h)){copyObject(h,keys(h),t);return}for(var E in h)hasOwnProperty$a.call(h,E)&&assignValue(t,E,h[E])});function nativeKeysIn(t){var h=[];if(t!=null)for(var E in Object(t))h.push(E);return h}var objectProto$9=Object.prototype,hasOwnProperty$9=objectProto$9.hasOwnProperty;function baseKeysIn(t){if(!isObject$3(t))return nativeKeysIn(t);var h=isPrototype(t),E=[];for(var R in t)R=="constructor"&&(h||!hasOwnProperty$9.call(t,R))||E.push(R);return E}function keysIn(t){return isArrayLike(t)?arrayLikeKeys(t,!0):baseKeysIn(t)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(t,h){if(isArray$2(t))return!1;var E=typeof t;return E=="number"||E=="symbol"||E=="boolean"||t==null||isSymbol(t)?!0:reIsPlainProp.test(t)||!reIsDeepProp.test(t)||h!=null&&t in Object(h)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(t){var h=this.has(t)&&delete this.__data__[t];return this.size-=h?1:0,h}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$8=Object.prototype,hasOwnProperty$8=objectProto$8.hasOwnProperty;function hashGet(t){var h=this.__data__;if(nativeCreate){var E=h[t];return E===HASH_UNDEFINED$2?void 0:E}return hasOwnProperty$8.call(h,t)?h[t]:void 0}var objectProto$7=Object.prototype,hasOwnProperty$7=objectProto$7.hasOwnProperty;function hashHas(t){var h=this.__data__;return nativeCreate?h[t]!==void 0:hasOwnProperty$7.call(h,t)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(t,h){var E=this.__data__;return this.size+=this.has(t)?0:1,E[t]=nativeCreate&&h===void 0?HASH_UNDEFINED$1:h,this}function Hash(t){var h=-1,E=t==null?0:t.length;for(this.clear();++h<E;){var R=t[h];this.set(R[0],R[1])}}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(t,h){for(var E=t.length;E--;)if(eq(t[E][0],h))return E;return-1}var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(t){var h=this.__data__,E=assocIndexOf(h,t);if(E<0)return!1;var R=h.length-1;return E==R?h.pop():splice.call(h,E,1),--this.size,!0}function listCacheGet(t){var h=this.__data__,E=assocIndexOf(h,t);return E<0?void 0:h[E][1]}function listCacheHas(t){return assocIndexOf(this.__data__,t)>-1}function listCacheSet(t,h){var E=this.__data__,R=assocIndexOf(E,t);return R<0?(++this.size,E.push([t,h])):E[R][1]=h,this}function ListCache(t){var h=-1,E=t==null?0:t.length;for(this.clear();++h<E;){var R=t[h];this.set(R[0],R[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(t){var h=typeof t;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?t!=="__proto__":t===null}function getMapData(t,h){var E=t.__data__;return isKeyable(h)?E[typeof h=="string"?"string":"hash"]:E.map}function mapCacheDelete(t){var h=getMapData(this,t).delete(t);return this.size-=h?1:0,h}function mapCacheGet(t){return getMapData(this,t).get(t)}function mapCacheHas(t){return getMapData(this,t).has(t)}function mapCacheSet(t,h){var E=getMapData(this,t),R=E.size;return E.set(t,h),this.size+=E.size==R?0:1,this}function MapCache(t){var h=-1,E=t==null?0:t.length;for(this.clear();++h<E;){var R=t[h];this.set(R[0],R[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize$1(t,h){if(typeof t!="function"||h!=null&&typeof h!="function")throw new TypeError(FUNC_ERROR_TEXT$2);var E=function(){var R=arguments,Y=h?h.apply(this,R):R[0],Z=E.cache;if(Z.has(Y))return Z.get(Y);var ee=t.apply(this,R);return E.cache=Z.set(Y,ee)||Z,ee};return E.cache=new(memoize$1.Cache||MapCache),E}memoize$1.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(t){var h=memoize$1(t,function(R){return E.size===MAX_MEMOIZE_SIZE&&E.clear(),R}),E=h.cache;return h}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(t){var h=[];return t.charCodeAt(0)===46&&h.push(""),t.replace(rePropName,function(E,R,Y,Z){h.push(Y?Z.replace(reEscapeChar,"$1"):R||E)}),h});function toString$2(t){return t==null?"":baseToString(t)}function castPath(t,h){return isArray$2(t)?t:isKey(t,h)?[t]:stringToPath(toString$2(t))}var INFINITY=1/0;function toKey(t){if(typeof t=="string"||isSymbol(t))return t;var h=t+"";return h=="0"&&1/t==-INFINITY?"-0":h}function baseGet(t,h){h=castPath(h,t);for(var E=0,R=h.length;t!=null&&E<R;)t=t[toKey(h[E++])];return E&&E==R?t:void 0}function get$1(t,h,E){var R=t==null?void 0:baseGet(t,h);return R===void 0?E:R}function arrayPush(t,h){for(var E=-1,R=h.length,Y=t.length;++E<R;)t[Y+E]=h[E];return t}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(t){return isArray$2(t)||isArguments(t)||!!(spreadableSymbol&&t&&t[spreadableSymbol])}function baseFlatten(t,h,E,R,Y){var Z=-1,ee=t.length;for(E||(E=isFlattenable),Y||(Y=[]);++Z<ee;){var te=t[Z];E(te)?arrayPush(Y,te):Y[Y.length]=te}return Y}function flatten(t){var h=t==null?0:t.length;return h?baseFlatten(t):[]}function flatRest(t){return setToString(overRest(t,void 0,flatten),t+"")}var getPrototype=overArg(Object.getPrototypeOf,Object),objectTag$3="[object Object]",funcProto=Function.prototype,objectProto$6=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$6=objectProto$6.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject$1(t){if(!isObjectLike(t)||baseGetTag(t)!=objectTag$3)return!1;var h=getPrototype(t);if(h===null)return!0;var E=hasOwnProperty$6.call(h,"constructor")&&h.constructor;return typeof E=="function"&&E instanceof E&&funcToString.call(E)==objectCtorString}function arrayReduce(t,h,E,R){var Y=-1,Z=t==null?0:t.length;for(R&&Z&&(E=t[++Y]);++Y<Z;)E=h(E,t[Y],Y,t);return E}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(t){var h=this.__data__,E=h.delete(t);return this.size=h.size,E}function stackGet(t){return this.__data__.get(t)}function stackHas(t){return this.__data__.has(t)}var LARGE_ARRAY_SIZE=200;function stackSet(t,h){var E=this.__data__;if(E instanceof ListCache){var R=E.__data__;if(!Map$1||R.length<LARGE_ARRAY_SIZE-1)return R.push([t,h]),this.size=++E.size,this;E=this.__data__=new MapCache(R)}return E.set(t,h),this.size=E.size,this}function Stack(t){var h=this.__data__=new ListCache(t);this.size=h.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;function baseAssign(t,h){return t&&copyObject(h,keys(h),t)}function baseAssignIn(t,h){return t&&copyObject(h,keysIn(h),t)}var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer$1=moduleExports?root.Buffer:void 0,allocUnsafe=Buffer$1?Buffer$1.allocUnsafe:void 0;function cloneBuffer(t,h){if(h)return t.slice();var E=t.length,R=allocUnsafe?allocUnsafe(E):new t.constructor(E);return t.copy(R),R}function arrayFilter(t,h){for(var E=-1,R=t==null?0:t.length,Y=0,Z=[];++E<R;){var ee=t[E];h(ee,E,t)&&(Z[Y++]=ee)}return Z}function stubArray(){return[]}var objectProto$5=Object.prototype,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(t){return t==null?[]:(t=Object(t),arrayFilter(nativeGetSymbols$1(t),function(h){return propertyIsEnumerable.call(t,h)}))}:stubArray;function copySymbols(t,h){return copyObject(t,getSymbols(t),h)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(t){for(var h=[];t;)arrayPush(h,getSymbols(t)),t=getPrototype(t);return h}:stubArray;function copySymbolsIn(t,h){return copyObject(t,getSymbolsIn(t),h)}function baseGetAllKeys(t,h,E){var R=h(t);return isArray$2(t)?R:arrayPush(R,E(t))}function getAllKeys(t){return baseGetAllKeys(t,keys,getSymbols)}function getAllKeysIn(t){return baseGetAllKeys(t,keysIn,getSymbolsIn)}var DataView$1=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),mapTag$6="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$6="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView$1&&getTag(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$3||Map$1&&getTag(new Map$1)!=mapTag$6||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$6||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(t){var h=baseGetTag(t),E=h==objectTag$2?t.constructor:void 0,R=E?toSource(E):"";if(R)switch(R){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$6;case promiseCtorString:return promiseTag;case setCtorString:return setTag$6;case weakMapCtorString:return weakMapTag$1}return h});var objectProto$4=Object.prototype,hasOwnProperty$5=objectProto$4.hasOwnProperty;function initCloneArray(t){var h=t.length,E=new t.constructor(h);return h&&typeof t[0]=="string"&&hasOwnProperty$5.call(t,"index")&&(E.index=t.index,E.input=t.input),E}var Uint8Array$1=root.Uint8Array;function cloneArrayBuffer(t){var h=new t.constructor(t.byteLength);return new Uint8Array$1(h).set(new Uint8Array$1(t)),h}function cloneDataView(t,h){var E=h?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(E,t.byteOffset,t.byteLength)}var reFlags=/\w*$/;function cloneRegExp(t){var h=new t.constructor(t.source,reFlags.exec(t));return h.lastIndex=t.lastIndex,h}var symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(t){return symbolValueOf$1?Object(symbolValueOf$1.call(t)):{}}function cloneTypedArray(t,h){var E=h?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(E,t.byteOffset,t.length)}var boolTag$3="[object Boolean]",dateTag$2="[object Date]",mapTag$5="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$5="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(t,h,E){var R=t.constructor;switch(h){case arrayBufferTag$2:return cloneArrayBuffer(t);case boolTag$3:case dateTag$2:return new R(+t);case dataViewTag$2:return cloneDataView(t,E);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(t,E);case mapTag$5:return new R;case numberTag$2:case stringTag$2:return new R(t);case regexpTag$2:return cloneRegExp(t);case setTag$5:return new R;case symbolTag$2:return cloneSymbol(t)}}function initCloneObject(t){return typeof t.constructor=="function"&&!isPrototype(t)?baseCreate(getPrototype(t)):{}}var mapTag$4="[object Map]";function baseIsMap(t){return isObjectLike(t)&&getTag(t)==mapTag$4}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap$1=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$4="[object Set]";function baseIsSet(t){return isObjectLike(t)&&getTag(t)==setTag$4}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet$1=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$1=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$2="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$3="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$3="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$2]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$3]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$3]=cloneableTags[stringTag$1]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;function baseClone(t,h,E,R,Y,Z){var ee,te=h&CLONE_DEEP_FLAG$1,ne=h&CLONE_FLAT_FLAG,oe=h&CLONE_SYMBOLS_FLAG$1;if(ee!==void 0)return ee;if(!isObject$3(t))return t;var ie=isArray$2(t);if(ie){if(ee=initCloneArray(t),!te)return copyArray(t,ee)}else{var ae=getTag(t),se=ae==funcTag||ae==genTag;if(isBuffer$1(t))return cloneBuffer(t,te);if(ae==objectTag$1||ae==argsTag$1||se&&!Y){if(ee=ne||se?{}:initCloneObject(t),!te)return ne?copySymbolsIn(t,baseAssignIn(ee,t)):copySymbols(t,baseAssign(ee,t))}else{if(!cloneableTags[ae])return Y?t:{};ee=initCloneByTag(t,ae,te)}}Z||(Z=new Stack);var ue=Z.get(t);if(ue)return ue;Z.set(t,ee),isSet$1(t)?t.forEach(function(de){ee.add(baseClone(de,h,E,de,t,Z))}):isMap$1(t)&&t.forEach(function(de,ce){ee.set(ce,baseClone(de,h,E,ce,t,Z))});var fe=oe?ne?getAllKeysIn:getAllKeys:ne?keysIn:keys,le=ie?void 0:fe(t);return arrayEach(le||t,function(de,ce){le&&(ce=de,de=t[ce]),assignValue(ee,ce,baseClone(de,h,E,ce,t,Z))}),ee}var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(t){return baseClone(t,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(t){return this.__data__.set(t,HASH_UNDEFINED),this}function setCacheHas(t){return this.__data__.has(t)}function SetCache(t){var h=-1,E=t==null?0:t.length;for(this.__data__=new MapCache;++h<E;)this.add(t[h])}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;function arraySome(t,h){for(var E=-1,R=t==null?0:t.length;++E<R;)if(h(t[E],E,t))return!0;return!1}function cacheHas(t,h){return t.has(h)}var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays(t,h,E,R,Y,Z){var ee=E&COMPARE_PARTIAL_FLAG$5,te=t.length,ne=h.length;if(te!=ne&&!(ee&&ne>te))return!1;var oe=Z.get(t),ie=Z.get(h);if(oe&&ie)return oe==h&&ie==t;var ae=-1,se=!0,ue=E&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(Z.set(t,h),Z.set(h,t);++ae<te;){var fe=t[ae],le=h[ae];if(R)var de=ee?R(le,fe,ae,h,t,Z):R(fe,le,ae,t,h,Z);if(de!==void 0){if(de)continue;se=!1;break}if(ue){if(!arraySome(h,function(ce,pe){if(!cacheHas(ue,pe)&&(fe===ce||Y(fe,ce,E,R,Z)))return ue.push(pe)})){se=!1;break}}else if(!(fe===le||Y(fe,le,E,R,Z))){se=!1;break}}return Z.delete(t),Z.delete(h),se}function mapToArray(t){var h=-1,E=Array(t.size);return t.forEach(function(R,Y){E[++h]=[Y,R]}),E}function setToArray(t){var h=-1,E=Array(t.size);return t.forEach(function(R){E[++h]=R}),E}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag$1="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag$2="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag$2="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(t,h,E,R,Y,Z,ee){switch(E){case dataViewTag:if(t.byteLength!=h.byteLength||t.byteOffset!=h.byteOffset)return!1;t=t.buffer,h=h.buffer;case arrayBufferTag:return!(t.byteLength!=h.byteLength||!Z(new Uint8Array$1(t),new Uint8Array$1(h)));case boolTag$1:case dateTag:case numberTag:return eq(+t,+h);case errorTag:return t.name==h.name&&t.message==h.message;case regexpTag:case stringTag:return t==h+"";case mapTag$2:var te=mapToArray;case setTag$2:var ne=R&COMPARE_PARTIAL_FLAG$4;if(te||(te=setToArray),t.size!=h.size&&!ne)return!1;var oe=ee.get(t);if(oe)return oe==h;R|=COMPARE_UNORDERED_FLAG$2,ee.set(t,h);var ie=equalArrays(te(t),te(h),R,Y,Z,ee);return ee.delete(t),ie;case symbolTag:if(symbolValueOf)return symbolValueOf.call(t)==symbolValueOf.call(h)}return!1}var COMPARE_PARTIAL_FLAG$3=1,objectProto$3=Object.prototype,hasOwnProperty$4=objectProto$3.hasOwnProperty;function equalObjects(t,h,E,R,Y,Z){var ee=E&COMPARE_PARTIAL_FLAG$3,te=getAllKeys(t),ne=te.length,oe=getAllKeys(h),ie=oe.length;if(ne!=ie&&!ee)return!1;for(var ae=ne;ae--;){var se=te[ae];if(!(ee?se in h:hasOwnProperty$4.call(h,se)))return!1}var ue=Z.get(t),fe=Z.get(h);if(ue&&fe)return ue==h&&fe==t;var le=!0;Z.set(t,h),Z.set(h,t);for(var de=ee;++ae<ne;){se=te[ae];var ce=t[se],pe=h[se];if(R)var he=ee?R(pe,ce,se,h,t,Z):R(ce,pe,se,t,h,Z);if(!(he===void 0?ce===pe||Y(ce,pe,E,R,Z):he)){le=!1;break}de||(de=se=="constructor")}if(le&&!de){var ge=t.constructor,ve=h.constructor;ge!=ve&&"constructor"in t&&"constructor"in h&&!(typeof ge=="function"&&ge instanceof ge&&typeof ve=="function"&&ve instanceof ve)&&(le=!1)}return Z.delete(t),Z.delete(h),le}var COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto$2=Object.prototype,hasOwnProperty$3=objectProto$2.hasOwnProperty;function baseIsEqualDeep(t,h,E,R,Y,Z){var ee=isArray$2(t),te=isArray$2(h),ne=ee?arrayTag:getTag(t),oe=te?arrayTag:getTag(h);ne=ne==argsTag?objectTag:ne,oe=oe==argsTag?objectTag:oe;var ie=ne==objectTag,ae=oe==objectTag,se=ne==oe;if(se&&isBuffer$1(t)){if(!isBuffer$1(h))return!1;ee=!0,ie=!1}if(se&&!ie)return Z||(Z=new Stack),ee||isTypedArray$1(t)?equalArrays(t,h,E,R,Y,Z):equalByTag(t,h,ne,E,R,Y,Z);if(!(E&COMPARE_PARTIAL_FLAG$2)){var ue=ie&&hasOwnProperty$3.call(t,"__wrapped__"),fe=ae&&hasOwnProperty$3.call(h,"__wrapped__");if(ue||fe){var le=ue?t.value():t,de=fe?h.value():h;return Z||(Z=new Stack),Y(le,de,E,R,Z)}}return se?(Z||(Z=new Stack),equalObjects(t,h,E,R,Y,Z)):!1}function baseIsEqual(t,h,E,R,Y){return t===h?!0:t==null||h==null||!isObjectLike(t)&&!isObjectLike(h)?t!==t&&h!==h:baseIsEqualDeep(t,h,E,R,baseIsEqual,Y)}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(t,h,E,R){var Y=E.length,Z=Y;if(t==null)return!Z;for(t=Object(t);Y--;){var ee=E[Y];if(ee[2]?ee[1]!==t[ee[0]]:!(ee[0]in t))return!1}for(;++Y<Z;){ee=E[Y];var te=ee[0],ne=t[te],oe=ee[1];if(ee[2]){if(ne===void 0&&!(te in t))return!1}else{var ie=new Stack,ae;if(!(ae===void 0?baseIsEqual(oe,ne,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,R,ie):ae))return!1}}return!0}function isStrictComparable(t){return t===t&&!isObject$3(t)}function getMatchData(t){for(var h=keys(t),E=h.length;E--;){var R=h[E],Y=t[R];h[E]=[R,Y,isStrictComparable(Y)]}return h}function matchesStrictComparable(t,h){return function(E){return E==null?!1:E[t]===h&&(h!==void 0||t in Object(E))}}function baseMatches(t){var h=getMatchData(t);return h.length==1&&h[0][2]?matchesStrictComparable(h[0][0],h[0][1]):function(E){return E===t||baseIsMatch(E,t,h)}}function baseHasIn(t,h){return t!=null&&h in Object(t)}function hasPath(t,h,E){h=castPath(h,t);for(var R=-1,Y=h.length,Z=!1;++R<Y;){var ee=toKey(h[R]);if(!(Z=t!=null&&E(t,ee)))break;t=t[ee]}return Z||++R!=Y?Z:(Y=t==null?0:t.length,!!Y&&isLength(Y)&&isIndex(ee,Y)&&(isArray$2(t)||isArguments(t)))}function hasIn(t,h){return t!=null&&hasPath(t,h,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(t,h){return isKey(t)&&isStrictComparable(h)?matchesStrictComparable(toKey(t),h):function(E){var R=get$1(E,t);return R===void 0&&R===h?hasIn(E,t):baseIsEqual(h,R,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(t){return function(h){return h==null?void 0:h[t]}}function basePropertyDeep(t){return function(h){return baseGet(h,t)}}function property(t){return isKey(t)?baseProperty(toKey(t)):basePropertyDeep(t)}function baseIteratee(t){return typeof t=="function"?t:t==null?identity$1:typeof t=="object"?isArray$2(t)?baseMatchesProperty(t[0],t[1]):baseMatches(t):property(t)}function createBaseFor(t){return function(h,E,R){for(var Y=-1,Z=Object(h),ee=R(h),te=ee.length;te--;){var ne=ee[++Y];if(E(Z[ne],ne,Z)===!1)break}return h}}var baseFor=createBaseFor();function baseForOwn(t,h){return t&&baseFor(t,h,keys)}function createBaseEach(t,h){return function(E,R){if(E==null)return E;if(!isArrayLike(E))return t(E,R);for(var Y=E.length,Z=-1,ee=Object(E);++Z<Y&&R(ee[Z],Z,ee)!==!1;);return E}}var baseEach=createBaseEach(baseForOwn),now=function(){return root.Date.now()},FUNC_ERROR_TEXT$1="Expected a function",nativeMax$1=Math.max,nativeMin=Math.min;function debounce(t,h,E){var R,Y,Z,ee,te,ne,oe=0,ie=!1,ae=!1,se=!0;if(typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT$1);h=toNumber(h)||0,isObject$3(E)&&(ie=!!E.leading,ae="maxWait"in E,Z=ae?nativeMax$1(toNumber(E.maxWait)||0,h):Z,se="trailing"in E?!!E.trailing:se);function ue(_e){var ye=R,me=Y;return R=Y=void 0,oe=_e,ee=t.apply(me,ye),ee}function fe(_e){return oe=_e,te=setTimeout(ce,h),ie?ue(_e):ee}function le(_e){var ye=_e-ne,me=_e-oe,Ee=h-ye;return ae?nativeMin(Ee,Z-me):Ee}function de(_e){var ye=_e-ne,me=_e-oe;return ne===void 0||ye>=h||ye<0||ae&&me>=Z}function ce(){var _e=now();if(de(_e))return pe(_e);te=setTimeout(ce,le(_e))}function pe(_e){return te=void 0,se&&R?ue(_e):(R=Y=void 0,ee)}function he(){te!==void 0&&clearTimeout(te),oe=0,R=ne=Y=te=void 0}function ge(){return te===void 0?ee:pe(now())}function ve(){var _e=now(),ye=de(_e);if(R=arguments,Y=this,ne=_e,ye){if(te===void 0)return fe(ne);if(ae)return clearTimeout(te),te=setTimeout(ce,h),ue(ne)}return te===void 0&&(te=setTimeout(ce,h)),ee}return ve.cancel=he,ve.flush=ge,ve}function assignMergeValue(t,h,E){(E!==void 0&&!eq(t[h],E)||E===void 0&&!(h in t))&&baseAssignValue(t,h,E)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}function safeGet(t,h){if(!(h==="constructor"&&typeof t[h]=="function")&&h!="__proto__")return t[h]}function toPlainObject(t){return copyObject(t,keysIn(t))}function baseMergeDeep(t,h,E,R,Y,Z,ee){var te=safeGet(t,E),ne=safeGet(h,E),oe=ee.get(ne);if(oe){assignMergeValue(t,E,oe);return}var ie=Z?Z(te,ne,E+"",t,h,ee):void 0,ae=ie===void 0;if(ae){var se=isArray$2(ne),ue=!se&&isBuffer$1(ne),fe=!se&&!ue&&isTypedArray$1(ne);ie=ne,se||ue||fe?isArray$2(te)?ie=te:isArrayLikeObject(te)?ie=copyArray(te):ue?(ae=!1,ie=cloneBuffer(ne,!0)):fe?(ae=!1,ie=cloneTypedArray(ne,!0)):ie=[]:isPlainObject$1(ne)||isArguments(ne)?(ie=te,isArguments(te)?ie=toPlainObject(te):(!isObject$3(te)||isFunction$2(te))&&(ie=initCloneObject(ne))):ae=!1}ae&&(ee.set(ne,ie),Y(ie,ne,R,Z,ee),ee.delete(ne)),assignMergeValue(t,E,ie)}function baseMerge(t,h,E,R,Y){t!==h&&baseFor(h,function(Z,ee){if(Y||(Y=new Stack),isObject$3(Z))baseMergeDeep(t,h,ee,E,baseMerge,R,Y);else{var te=R?R(safeGet(t,ee),Z,ee+"",t,h,Y):void 0;te===void 0&&(te=Z),assignMergeValue(t,ee,te)}},keysIn)}function last(t){var h=t==null?0:t.length;return h?t[h-1]:void 0}function castFunction(t){return typeof t=="function"?t:identity$1}function forEach$3(t,h){var E=isArray$2(t)?arrayEach:baseEach;return E(t,castFunction(h))}function baseToPairs(t,h){return arrayMap(h,function(E){return[E,t[E]]})}function setToPairs(t){var h=-1,E=Array(t.size);return t.forEach(function(R){E[++h]=[R,R]}),E}var mapTag$1="[object Map]",setTag$1="[object Set]";function createToPairs(t){return function(h){var E=getTag(h);return E==mapTag$1?mapToArray(h):E==setTag$1?setToPairs(h):baseToPairs(h,t(h))}}var toPairs=createToPairs(keys);function createFind(t){return function(h,E,R){var Y=Object(h);if(!isArrayLike(h)){var Z=baseIteratee(E);h=keys(h),E=function(te){return Z(Y[te],te,Y)}}var ee=t(h,E,R);return ee>-1?Y[Z?h[ee]:ee]:void 0}}var nativeMax=Math.max;function findIndex(t,h,E){var R=t==null?0:t.length;if(!R)return-1;var Y=E==null?0:toInteger(E);return Y<0&&(Y=nativeMax(R+Y,0)),baseFindIndex(t,baseIteratee(h),Y)}var find=createFind(findIndex);function baseMap(t,h){var E=-1,R=isArrayLike(t)?Array(t.length):[];return baseEach(t,function(Y,Z,ee){R[++E]=h(Y,Z,ee)}),R}function map(t,h){var E=isArray$2(t)?arrayMap:baseMap;return E(t,baseIteratee(h))}var objectProto$1=Object.prototype,hasOwnProperty$2=objectProto$1.hasOwnProperty;function baseHas(t,h){return t!=null&&hasOwnProperty$2.call(t,h)}function has(t,h){return t!=null&&hasPath(t,h,baseHas)}function indexOf(t,h,E){var R=t==null?0:t.length;if(!R)return-1;var Y=0;return baseIndexOf(t,h,Y)}var boolTag="[object Boolean]";function isBoolean$1(t){return t===!0||t===!1||isObjectLike(t)&&baseGetTag(t)==boolTag}var mapTag="[object Map]",setTag="[object Set]",objectProto=Object.prototype,hasOwnProperty$1=objectProto.hasOwnProperty;function isEmpty$1(t){if(t==null)return!0;if(isArrayLike(t)&&(isArray$2(t)||typeof t=="string"||typeof t.splice=="function"||isBuffer$1(t)||isTypedArray$1(t)||isArguments(t)))return!t.length;var h=getTag(t);if(h==mapTag||h==setTag)return!t.size;if(isPrototype(t))return!baseKeys(t).length;for(var E in t)if(hasOwnProperty$1.call(t,E))return!1;return!0}function isEqual(t,h){return baseIsEqual(t,h)}function isNil(t){return t==null}function isUndefined$1(t){return t===void 0}function mapKeys(t,h){var E={};return h=baseIteratee(h),baseForOwn(t,function(R,Y,Z){baseAssignValue(E,h(R,Y,Z),R)}),E}var merge$1=createAssigner(function(t,h,E){baseMerge(t,h,E)});function baseSet(t,h,E,R){if(!isObject$3(t))return t;h=castPath(h,t);for(var Y=-1,Z=h.length,ee=Z-1,te=t;te!=null&&++Y<Z;){var ne=toKey(h[Y]),oe=E;if(ne==="__proto__"||ne==="constructor"||ne==="prototype")return t;if(Y!=ee){var ie=te[ne];oe=void 0,oe===void 0&&(oe=isObject$3(ie)?ie:isIndex(h[Y+1])?[]:{})}assignValue(te,ne,oe),te=te[ne]}return t}function basePickBy(t,h,E){for(var R=-1,Y=h.length,Z={};++R<Y;){var ee=h[R],te=baseGet(t,ee);E(te,ee)&&baseSet(Z,castPath(ee,t),te)}return Z}function basePick(t,h){return basePickBy(t,h,function(E,R){return hasIn(t,R)})}var pick=flatRest(function(t,h){return t==null?{}:basePick(t,h)});function baseReduce(t,h,E,R,Y){return Y(t,function(Z,ee,te){E=R?(R=!1,Z):h(E,Z,ee,te)}),E}function reduce(t,h,E){var R=isArray$2(t)?arrayReduce:baseReduce,Y=arguments.length<3;return R(t,baseIteratee(h),E,Y,baseEach)}function set(t,h,E){return t==null?t:baseSet(t,h,E)}var FUNC_ERROR_TEXT="Expected a function";function throttle$1(t,h,E){var R=!0,Y=!0;if(typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);return isObject$3(E)&&(R="leading"in E?!!E.leading:R,Y="trailing"in E?!!E.trailing:Y),debounce(t,h,{leading:R,maxWait:h,trailing:Y})}var __rest$3=function(t,h){var E={};for(var R in t)Object.prototype.hasOwnProperty.call(t,R)&&h.indexOf(R)<0&&(E[R]=t[R]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,R=Object.getOwnPropertySymbols(t);Y<R.length;Y++)h.indexOf(R[Y])<0&&Object.prototype.propertyIsEnumerable.call(t,R[Y])&&(E[R[Y]]=t[R[Y]]);return E},Options;(function(t){function h(E){var R=__rest$3(E,[]),Y=E.container;if(!Y)throw new Error("Ensure the container of LogicFlow is specified and valid.");return assign({},t.defaults,R)}t.get=h})(Options||(Options={})),function(t){t.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}}(Options||(Options={}));var defaultAnimationOffConfig={node:!1,edge:!1},defaultAnimationOnConfig={node:!0,edge:!0},setupAnimation=function(t){return!t||typeof t=="boolean"?cloneDeep(t===!0?defaultAnimationOnConfig:defaultAnimationOffConfig):merge$1(cloneDeep(defaultAnimationOffConfig),t)},isIe=function(){return get$1(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function formatData(t){try{return JSON.parse(JSON.stringify(t))}catch{return t}}var DEFAULT_VISIBLE_SPACE=200,ELEMENT_MAX_Z_INDEX=9999,DEFAULT_GRID_SIZE=10,ElementState;(function(t){t[t.DEFAULT=1]="DEFAULT",t[t.TEXT_EDIT=2]="TEXT_EDIT",t[t.SHOW_MENU=3]="SHOW_MENU",t[t.ALLOW_CONNECT=4]="ALLOW_CONNECT",t[t.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(ElementState||(ElementState={}));var ElementType;(function(t){t.NODE="node",t.EDGE="edge",t.GRAPH="graph"})(ElementType||(ElementType={}));var ModelType;(function(t){t.NODE="node",t.CIRCLE_NODE="circle-node",t.POLYGON_NODE="polygon-node",t.RECT_NODE="rect-node",t.TEXT_NODE="text-node",t.ELLIPSE_NODE="ellipse-node",t.DIAMOND_NODE="diamond-node",t.HTML_NODE="html-node",t.CUSTOM_HTML_NODE="custom-html-node",t.EDGE="edge",t.LINE_EDGE="line-edge",t.POLYLINE_EDGE="polyline-edge",t.BEZIER_EDGE="bezier-edge",t.GRAPH="graph"})(ModelType||(ModelType={}));var EventType;(function(t){t.ELEMENT_CLICK="element:click",t.NODE_ADD="node:add",t.NODE_DELETE="node:delete",t.NODE_CLICK="node:click",t.NODE_DBCLICK="node:dbclick",t.NODE_GROUP_COPY="node:group-copy-add",t.NODE_DND_ADD="node:dnd-add",t.NODE_DND_DRAG="node:dnd-drag",t.NODE_MOUSEDOWN="node:mousedown",t.NODE_DRAGSTART="node:dragstart",t.NODE_DRAG="node:drag",t.NODE_DROP="node:drop",t.NODE_MOUSEUP="node:mouseup",t.NODE_MOUSEMOVE="node:mousemove",t.NODE_MOUSEENTER="node:mouseenter",t.NODE_MOUSELEAVE="node:mouseleave",t.NODE_CONTEXTMENU="node:contextmenu",t.NODE_ROTATE="node:rotate",t.NODE_RESIZE="node:resize",t.NODE_FOCUS="node:focus",t.NODE_BLUR="node:blur",t.NODE_PROPERTIES_CHANGE="node:properties-change",t.NODE_PROPERTIES_DELETE="node:properties-delete",t.EDGE_ADD="edge:add",t.EDGE_DELETE="edge:delete",t.EDGE_CLICK="edge:click",t.EDGE_DBCLICK="edge:dbclick",t.EDGE_FOCUS="edge:focus",t.EDGE_BLUR="edge:blur",t.EDGE_MOUSEENTER="edge:mouseenter",t.EDGE_MOUSELEAVE="edge:mouseleave",t.EDGE_CONTEXTMENU="edge:contextmenu",t.EDGE_ADJUST="edge:adjust",t.EDGE_EXCHANGE_NODE="edge:exchange-node",t.ANCHOR_DRAGSTART="anchor:dragstart",t.ANCHOR_DRAG="anchor:drag",t.ANCHOR_DROP="anchor:drop",t.ANCHOR_DRAGEND="anchor:dragend",t.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",t.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",t.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",t.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",t.ADJUST_POINT_DRAG="adjustPoint:drag",t.ADJUST_POINT_DROP="adjustPoint:drop",t.ADJUST_POINT_DRAGEND="adjustPoint:dragend",t.BLANK_MOUSEDOWN="blank:mousedown",t.BLANK_DRAGSTART="blank:dragstart",t.BLANK_DRAG="blank:drag",t.BLANK_DROP="blank:drop",t.BLANK_MOUSEMOVE="blank:mousemove",t.BLANK_MOUSEUP="blank:mouseup",t.BLANK_CLICK="blank:click",t.BLANK_CONTEXTMENU="blank:contextmenu",t.SELECTION_MOUSEDOWN="selection:mousedown",t.SELECTION_DRAGSTART="selection:dragstart",t.SELECTION_DRAG="selection:drag",t.SELECTION_DROP="selection:drop",t.SELECTION_MOUSEMOVE="selection:mousemove",t.SELECTION_MOUSEUP="selection:mouseup",t.SELECTION_CONTEXTMENU="selection:contextmenu",t.CONNECTION_NOT_ALLOWED="connection:not-allowed",t.TEXT_MOUSEDOWN="text:mousedown",t.TEXT_DRAGSTART="text:dragstart",t.TEXT_DRAG="text:drag",t.TEXT_DROP="text:drop",t.TEXT_CLICK="text:click",t.TEXT_DBCLICK="text:dbclick",t.TEXT_BLUR="text:blur",t.TEXT_MOUSEMOVE="text:mousemove",t.TEXT_MOUSEUP="text:mouseup",t.TEXT_FOCUS="text:focus",t.TEXT_ADD="text:add",t.TEXT_UPDATE="text:update",t.TEXT_CLEAR="text:clear",t.LABEL_MOUSEDOWN="label:mousedown",t.LABEL_DRAGSTART="label:dragstart",t.LABEL_DRAG="label:drag",t.LABEL_DROP="label:drop",t.LABEL_CLICK="label:click",t.LABEL_DBCLICK="label:dbclick",t.LABEL_BLUR="label:blur",t.LABEL_MOUSEMOVE="label:mousemove",t.LABEL_MOUSEUP="label:mouseup",t.LABEL_FOCUS="label:focus",t.LABEL_ADD="label:add",t.LABEL_UPDATE="label:update",t.LABEL_CLEAR="label:clear",t.LABEL_DELETE="label:delete",t.LABEL_SHOULD_ADD="label:should-add",t.LABEL_BATCH_ADD="label:batch-add",t.LABEL_SHOULD_UPDATE="label:should-update",t.LABEL_SHOULD_DELETE="label:should-delete",t.LABEL_BATCH_DELETE="label:batch-delete",t.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",t.HISTORY_CHANGE="history:change",t.GRAPH_TRANSFORM="graph:transform",t.GRAPH_RENDERED="graph:rendered",t.GRAPH_UPDATED="graph:updated"})(EventType||(EventType={}));var OverlapMode;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.INCREASE=1]="INCREASE"})(OverlapMode||(OverlapMode={}));var SegmentDirection;(function(t){t.HORIZONTAL="horizontal",t.VERTICAL="vertical"})(SegmentDirection||(SegmentDirection={}));var TextMode;(function(t){t.TEXT="text",t.LABEL="label"})(TextMode||(TextMode={}));var LEFT_MOUSE_BUTTON_CODE=0,StepDrag=function(){function t(h){var E=h.onDragStart,R=E===void 0?noop$2:E,Y=h.onDragging,Z=Y===void 0?noop$2:Y,ee=h.onDragEnd,te=ee===void 0?noop$2:ee,ne=h.eventType,oe=ne===void 0?"":ne,ie=h.eventCenter,ae=h.step,se=ae===void 0?1:ae,ue=h.isStopPropagation,fe=ue===void 0?!0:ue,le=h.model,de=h.data,ce=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(pe){var he,ge,ve=window==null?void 0:window.document;if(pe.button===LEFT_MOUSE_BUTTON_CODE){ce.isStopPropagation&&pe.stopPropagation(),ce.isStartDragging=!0,ce.startX=pe.clientX,ce.startY=pe.clientY,ve.addEventListener("mousemove",ce.handleMouseMove,!1),ve.addEventListener("mouseup",ce.handleMouseUp,!1);var _e=(he=ce.model)===null||he===void 0?void 0:he.getData();(ge=ce.eventCenter)===null||ge===void 0||ge.emit(EventType["".concat(ce.eventType,"_MOUSEDOWN")],{e:pe,data:ce.data||_e}),ce.startTime=new Date().getTime()}},this.handleMouseMove=function(pe){var he,ge;if(ce.isStopPropagation&&pe.stopPropagation(),!!ce.isStartDragging&&(ce.sumDeltaX+=pe.clientX-ce.startX,ce.sumDeltaY+=pe.clientY-ce.startY,ce.startX=pe.clientX,ce.startY=pe.clientY,ce.step<=1||Math.abs(ce.sumDeltaX)>ce.step||Math.abs(ce.sumDeltaY)>ce.step)){var ve=ce.sumDeltaX%ce.step,_e=ce.sumDeltaY%ce.step,ye=ce.sumDeltaX-ve,me=ce.sumDeltaY-_e;ce.sumDeltaX=ve,ce.sumDeltaY=_e;var Ee=(he=ce.model)===null||he===void 0?void 0:he.getData();ce.isDragging||((ge=ce.eventCenter)===null||ge===void 0||ge.emit(EventType["".concat(ce.eventType,"_DRAGSTART")],{e:pe,data:ce.data||Ee}),ce.onDragStart({event:pe})),ce.isDragging=!0,Promise.resolve().then(function(){var Oe,Te;ce.onDragging({deltaX:ye,deltaY:me,event:pe}),(Oe=ce.eventCenter)===null||Oe===void 0||Oe.emit(EventType["".concat(ce.eventType,"_MOUSEMOVE")],{deltaX:ye,deltaY:me,e:pe,data:ce.data||Ee}),(Te=ce.eventCenter)===null||Te===void 0||Te.emit(EventType["".concat(ce.eventType,"_DRAG")],{e:pe,data:ce.data||Ee})})}},this.handleMouseUp=function(pe){var he=window.document;ce.isStartDragging=!1,ce.isStopPropagation&&pe.stopPropagation(),Promise.resolve().then(function(){var ge,ve,_e;he.removeEventListener("mousemove",ce.handleMouseMove,!1),he.removeEventListener("mouseup",ce.handleMouseUp,!1);var ye=(ge=ce.model)===null||ge===void 0?void 0:ge.getData();(ve=ce.eventCenter)===null||ve===void 0||ve.emit(EventType["".concat(ce.eventType,"_MOUSEUP")],{e:pe,data:ce.data||ye}),ce.isDragging&&(ce.isDragging=!1,ce.onDragEnd({event:pe}),(_e=ce.eventCenter)===null||_e===void 0||_e.emit(EventType["".concat(ce.eventType,"_DROP")],{e:pe,data:ce.data||ye}))})},this.cancelDrag=function(){var pe=window==null?void 0:window.document;pe.removeEventListener("mousemove",ce.handleMouseMove,!1),pe.removeEventListener("mouseup",ce.handleMouseUp,!1),ce.onDragEnd({event:void 0}),ce.isDragging=!1},this.destroy=function(){ce.isStartDragging&&ce.cancelDrag()},this.onDragStart=R,this.onDragging=Z,this.onDragEnd=te,this.step=se,this.isStopPropagation=fe,this.eventType=oe,this.eventCenter=ie,this.model=le,this.data=de}return t.prototype.setStep=function(h){this.step=h},t.prototype.setModel=function(h){this.model=h},t}(),getNodeOutline=function(t){var h=t.x,E=t.y,R=t.width,Y=t.height;return{x:h-R/2,y:E-Y/2,x1:h+R/2,y1:E+Y/2}},getLineOutline=function(t){var h=t.startPoint,E=t.endPoint,R=(h.x+E.x)/2,Y=(h.y+E.y)/2,Z=Math.abs(h.x-E.x)+10,ee=Math.abs(h.y-E.y)+10;return{x:R-Z/2,y:Y-ee/2,x1:R+Z/2,y1:Y+ee/2}},getPolylineOutline=function(t){var h=t.points,E=points2PointsList(h),R=getBBoxOfPoints(E,8),Y=R.x,Z=R.y,ee=R.width,te=R.height;return{x:Y-ee/2,y:Z-te/2,x1:Y+ee/2,y1:Z+te/2}},getBezierOutline=function(t){var h=t.path,E=getBezierPoints(h),R=getBBoxOfPoints(E,8),Y=R.x,Z=R.y,ee=R.width,te=R.height;return{x:Y-ee/2,y:Z-te/2,x1:Y+ee/2,y1:Z+te/2}},getEdgeOutline=function(t){if(t.modelType===ModelType.LINE_EDGE)return getLineOutline(t);if(t.modelType===ModelType.POLYLINE_EDGE)return getPolylineOutline(t);if(t.modelType===ModelType.BEZIER_EDGE)return getBezierOutline(t)},getCrossPointOfLine=function(t,h,E,R){var Y=(h.y-t.y)*(R.x-E.x)-(t.x-h.x)*(E.y-R.y);if(Y===0)return!1;var Z=((h.x-t.x)*(R.x-E.x)*(E.y-t.y)+(h.y-t.y)*(R.x-E.x)*t.x-(R.y-E.y)*(h.x-t.x)*E.x)/Y,ee=-((h.y-t.y)*(R.y-E.y)*(E.x-t.x)+(h.x-t.x)*(R.y-E.y)*t.y-(R.x-E.x)*(h.y-t.y)*E.y)/Y;return(Z-t.x)*(Z-h.x)<=0&&(ee-t.y)*(ee-h.y)<=0&&(Z-E.x)*(Z-R.x)<=0&&(ee-E.y)*(ee-R.y)<=0?{x:Z,y:ee}:!1},isInSegment=function(t,h,E){var R=t.x,Y=t.y,Z=h.x,ee=h.y,te=E.x,ne=E.y,oe=(ne-ee)/(te-Z),ie=ee-oe*Z;return(R>=Z&&R<=te||R<=Z&&R>=te)&&(Y>=ee&&Y<=ne||Y<=ee&&Y>=ne)&&Math.abs(Y-oe*R-ie)<Number.EPSILON},getVerticalPointOfLine=function(t){var h=t.start,E=t.end,R=t.offset,Y=t.verticalLength,Z=t.type,ee={leftX:0,leftY:0,rightX:0,rightY:0},te=Math.atan((E.y-h.y)/(E.x-h.x)),ne=Math.atan(R/Y),oe=Math.sqrt(Y*Y+R*R);return Z==="start"?E.x>=h.x?(ee.leftX=h.x+oe*Math.sin(te+ne),ee.leftY=h.y-oe*Math.cos(te+ne),ee.rightX=h.x-oe*Math.sin(te-ne),ee.rightY=h.y+oe*Math.cos(te-ne)):(ee.leftX=h.x-oe*Math.sin(te+ne),ee.leftY=h.y+oe*Math.cos(te+ne),ee.rightX=h.x+oe*Math.sin(te-ne),ee.rightY=h.y-oe*Math.cos(te-ne)):Z==="end"&&(E.x>=h.x?(ee.leftX=E.x+oe*Math.sin(te-ne),ee.leftY=E.y-oe*Math.cos(te-ne),ee.rightX=E.x-oe*Math.sin(te+ne),ee.rightY=E.y+oe*Math.cos(te+ne)):(ee.leftX=E.x-oe*Math.sin(te-ne),ee.leftY=E.y+oe*Math.cos(te-ne),ee.rightX=E.x+oe*Math.sin(te+ne),ee.rightY=E.y-oe*Math.cos(te+ne))),ee},__assign$P=function(){return __assign$P=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$P.apply(this,arguments)},__read$z=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$a=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},isBboxOverLapping=function(t,h){return Math.abs(t.centerX-h.centerX)*2<t.width+h.width&&Math.abs(t.centerY-h.centerY)*2<t.height+h.height},filterRepeatPoints=function(t){var h=[],E={};return t.forEach(function(R){var Y="".concat(R.x,"-").concat(R.y);R.id=Y,E[Y]=R}),Object.keys(E).forEach(function(R){h.push(E[R])}),h},getExpandedBBox=function(t,h){return t.width===0&&t.height===0?t:{x:t.x,y:t.y,centerX:t.centerX,centerY:t.centerY,minX:t.minX-h,minY:t.minY-h,maxX:t.maxX+h,maxY:t.maxY+h,height:t.height+2*h,width:t.width+2*h}},pointDirection=function(t,h){var E=Math.abs(t.x-h.centerX),R=Math.abs(t.y-h.centerY);return E/h.width>R/h.height?SegmentDirection.HORIZONTAL:SegmentDirection.VERTICAL},getExpandedBBoxPoint=function(t,h,E){var R=pointDirection(E,h);return R===SegmentDirection.HORIZONTAL?{x:E.x>t.centerX?t.maxX:t.minX,y:E.y}:{x:E.x,y:E.y>t.centerY?t.maxY:t.minY}},mergeBBox=function(t,h){var E=Math.min(t.minX,h.minX),R=Math.min(t.minY,h.minY),Y=Math.max(t.maxX,h.maxX),Z=Math.max(t.maxY,h.maxY);return{x:(E+Y)/2,y:(R+Z)/2,centerX:(E+Y)/2,centerY:(R+Z)/2,minX:E,minY:R,maxX:Y,maxY:Z,height:Z-R,width:Y-E}},getBBoxOfPoints=function(t,h){t===void 0&&(t=[]);var E=[],R=[];t.forEach(function(ie){E.push(ie.x),R.push(ie.y)});var Y=Math.min.apply(Math,__spreadArray$a([],__read$z(E),!1)),Z=Math.max.apply(Math,__spreadArray$a([],__read$z(E),!1)),ee=Math.min.apply(Math,__spreadArray$a([],__read$z(R),!1)),te=Math.max.apply(Math,__spreadArray$a([],__read$z(R),!1)),ne=Z-Y,oe=te-ee;return h&&(ne+=h,oe+=h),{centerX:(Y+Z)/2,centerY:(ee+te)/2,maxX:Z,maxY:te,minX:Y,minY:ee,x:(Y+Z)/2,y:(ee+te)/2,height:oe,width:ne}},getPointsFromBBox=function(t){var h=t.minX,E=t.minY,R=t.maxX,Y=t.maxY;return[{x:h,y:E},{x:R,y:E},{x:R,y:Y},{x:h,y:Y}]},isPointOutsideBBox=function(t,h){var E=t.x,R=t.y;return E<h.minX||E>h.maxX||R<h.minY||R>h.maxY},getBBoxXCrossPoints=function(t,h){return h<t.minX||h>t.maxX?[]:[{x:h,y:t.minY},{x:h,y:t.maxY}]},getBBoxYCrossPoints=function(t,h){return h<t.minY||h>t.maxY?[]:[{x:t.minX,y:h},{x:t.maxX,y:h}]},getBBoxCrossPointsByPoint=function(t,h){return __spreadArray$a(__spreadArray$a([],__read$z(getBBoxXCrossPoints(t,h.x)),!1),__read$z(getBBoxYCrossPoints(t,h.y)),!1)},estimateDistance=function(t,h){return Math.abs(t.x-h.x)+Math.abs(t.y-h.y)},costByPoints=function(t,h){var E=-2,R=0;return h.forEach(function(Y){Y&&(t.x===Y.x&&(R+=E),t.y===Y.y&&(R+=E))}),R},heuristicCostEstimate=function(t,h,E,R,Y){return estimateDistance(t,h)+estimateDistance(t,E)+costByPoints(t,[h,E,R,Y])},rebuildPath=function(t,h,E,R,Y){Y||(Y=0),t.unshift(h[R]),E[R]&&E[R]!==R&&Y<=100&&rebuildPath(t,h,E,E[R],Y+1)},removeClosePointFromOpenList=function(t,h){var E=t.indexOf(h);E>-1&&t.splice(E,1)},isSegmentsIntersected=function(t,h,E,R){var Y=h.x-t.x,Z=h.y-t.y,ee=R.x-E.x,te=R.y-E.y,ne=(-Z*(t.x-E.x)+Y*(t.y-E.y))/(-ee*Z+Y*te),oe=(ee*(t.y-E.y)-te*(t.x-E.x))/(-ee*Z+Y*te);return ne>=0&&ne<=1&&oe>=0&&oe<=1},isSegmentCrossingBBox=function(t,h,E){if(E.width===0&&E.height===0)return!1;var R=__read$z(getPointsFromBBox(E),4),Y=R[0],Z=R[1],ee=R[2],te=R[3];return isSegmentsIntersected(t,h,Y,Z)||isSegmentsIntersected(t,h,Y,te)||isSegmentsIntersected(t,h,Z,ee)||isSegmentsIntersected(t,h,ee,te)},getNextNeighborPoints=function(t,h,E,R){var Y=[];return t.forEach(function(Z){Z!==h&&(Z.x===h.x||Z.y===h.y)&&!isSegmentCrossingBBox(Z,h,E)&&!isSegmentCrossingBBox(Z,h,R)&&Y.push(Z)}),filterRepeatPoints(Y)},pathFinder=function(t,h,E,R,Y,Z,ee){var te=[],ne=[h],oe={},ie={},ae={};h.id&&(ie[h.id]=0,ae[h.id]=heuristicCostEstimate(h,E,h));var se={};t.forEach(function(le){le.id&&(se[le.id]=le)});for(var ue=function(){var le,de=1/0;if(ne.forEach(function(pe){pe.id&&ae[pe.id]<de&&(de=ae[pe.id],le=pe)}),le===E&&E.id){var ce=[];return rebuildPath(ce,se,oe,E.id),{value:ce}}if(!le)return{value:[h,E]};removeClosePointFromOpenList(ne,le),te.push(le),getNextNeighborPoints(t,le,R,Y).forEach(function(pe){if(te.indexOf(pe)===-1&&(ne.indexOf(pe)===-1&&ne.push(pe),le!=null&&le.id&&(pe!=null&&pe.id))){var he=ae[le.id]+estimateDistance(le,pe);if(ie[pe.id]&&he>=ie[pe.id])return;oe[pe.id]=le.id,ie[pe.id]=he,ae[pe.id]=ie[pe.id]+heuristicCostEstimate(pe,E,h,Z,ee)}})};ne.length;){var fe=ue();if(typeof fe=="object")return fe.value}return[h,E]},getBoxByOriginNode=function(t){return getNodeBBox(t)},pointFilter=function(t){for(var h=1;h<t.length-1;){var E=t[h-1],R=t[h],Y=t[h+1];E.x===R.x&&R.x===Y.x||E.y===R.y&&R.y===Y.y?t.splice(h,1):h++}return t},getPolylinePoints=function(t,h,E,R,Y){var Z=getBoxByOriginNode(E),ee=getBoxByOriginNode(R),te=getExpandedBBox(Z,Y),ne=getExpandedBBox(ee,Y),oe=getExpandedBBoxPoint(te,Z,t),ie=getExpandedBBoxPoint(ne,ee,h);if(isBboxOverLapping(te,ne)){var ae=getSimplePoints(t,h,oe,ie);return __spreadArray$a(__spreadArray$a([t,oe],__read$z(ae),!1),[ie,h],!1)}var se=getBBoxOfPoints([oe,ie]),ue=mergeBBox(te,se),fe=mergeBBox(ne,se),le=[];le=le.concat(getPointsFromBBox(ue)),le=le.concat(getPointsFromBBox(fe));var de={x:(t.x+h.x)/2,y:(t.y+h.y)/2};[se,ue,fe].forEach(function(pe){le=le.concat(getBBoxCrossPointsByPoint(pe,de).filter(function(he){return isPointOutsideBBox(he,te)&&isPointOutsideBBox(he,ne)}))}),[{x:oe.x,y:ie.y},{x:ie.x,y:oe.y}].forEach(function(pe){isPointOutsideBBox(pe,te)&&isPointOutsideBBox(pe,ne)&&le.push(pe)}),le.unshift(oe),le.push(ie),le=filterRepeatPoints(le);var ce=pathFinder(le,oe,ie,Z,ee,t,h);return ce.unshift(t),ce.push(h),ce.length>2&&(ce=pointFilter(ce)),filterRepeatPoints(ce)},getLongestEdge=function(t){if(t.length===1){var h=__read$z(t,1),E=h[0];return[E,E]}else{for(var R=t[0],Y=t[1],Z=distance(R.x,R.y,Y.x,Y.y),ee=1;ee<t.length-1;ee++){var te=t[ee],ne=t[ee+1],oe=distance(te.x,te.y,ne.x,ne.y);oe>Z&&(Z=oe,R=te,Y=ne)}return[R,Y]}},isSegmentsInNode=function(t,h,E){var R=isInNode(t,E),Y=isInNode(h,E);return R&&Y},isSegmentsCrossNode=function(t,h,E){var R=isInNode(t,E),Y=isInNode(h,E),Z=R&&Y,ee=R||Y;return!Z&&ee},getCrossPointInRect=function(t,h,E){for(var R=void 0,Y=getNodeBBox(E),Z=getPointsFromBBox(Y),ee=0;ee<Z.length;ee++){var te=isSegmentsIntersected(t,h,Z[ee],Z[(ee+1)%Z.length]);te&&(R=[Z[ee],Z[(ee+1)%Z.length]])}if(R)return getCrossPointOfLine(t,h,R[0],R[1])},segmentDirection=function(t,h){var E=void 0;return t.x===h.x?E=SegmentDirection.VERTICAL:t.y===h.y&&(E=SegmentDirection.HORIZONTAL),E},points2PointsList=function(t){var h=t.split(" "),E=[];return h&&h.forEach(function(R){var Y=__read$z(R.split(","),2),Z=Y[0],ee=Y[1];E.push({x:Number(Z),y:Number(ee)})}),E},getSimplePoints=function(t,h,E,R){var Y=[],Z=segmentDirection(t,E),ee=segmentDirection(h,R);if(Z===ee)t.y===E.y?(Y.push({x:E.x,y:(E.y+R.y)/2}),Y.push({x:R.x,y:(E.y+R.y)/2})):(Y.push({x:(E.x+R.x)/2,y:E.y}),Y.push({x:(E.x+R.x)/2,y:R.y}));else{var te={x:E.x,y:R.y},ne=isInSegment(te,t,E),oe=isInSegment(te,h,R);if(ne||oe)te={x:R.x,y:E.y};else{var ie=isOnLine(te,t,E),ae=isOnLine(te,h,R);ie&&ae&&(te={x:R.x,y:E.y})}Y.push(te)}return Y},isOnLine=function(t,h,E){return t.x===h.x&&t.x===E.x||t.y===h.y&&t.y===E.y},getBytesLength=function(t){if(!t)return 0;for(var h=0,E=0;E<t.length;E++){var R=t.charCodeAt(E);t.match(/[A-Z]/)?h+=1.5:R>=1&&R<=126||R>=65376&&R<=65439?h+=1:h+=2}return h},getAppendAttributes=function(t){var h=t.start,E=t.end,R;if(h.x===E.x&&h.y===E.y)R="";else{var Y={start:h,end:E,offset:10,verticalLength:5},Z=getVerticalPointOfLine(__assign$P(__assign$P({},Y),{type:"start"})),ee=getVerticalPointOfLine(__assign$P(__assign$P({},Y),{type:"end"}));R="M".concat(Z.leftX," ").concat(Z.leftY,`
    L`).concat(Z.rightX," ").concat(Z.rightY,`
    L`).concat(ee.rightX," ").concat(ee.rightY,`
    L`).concat(ee.leftX," ").concat(ee.leftY," z")}return{d:R,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},getBezierControlPoints=function(t){var h=t.start,E=t.end,R=t.sourceNode,Y=t.targetNode,Z=t.offset,ee=getNodeBBox(R),te=getNodeBBox(Y),ne=getExpandedBBox(ee,Z),oe=getExpandedBBox(te,Z),ie=getExpandedBBoxPoint(ne,ee,h),ae=getExpandedBBoxPoint(oe,te,E);return{sNext:ie,ePre:ae}},getBezierPoints=function(t){var h=t.replace(/M/g,"").replace(/C/g,",").split(","),E=getBezierPoint(h[0]),R=getBezierPoint(h[1]),Y=getBezierPoint(h[2]),Z=getBezierPoint(h[3]);return[E,R,Y,Z]},getBezierPoint=function(t){var h=__read$z(t.replace(/(^\s*)/g,"").split(" "),2),E=h[0],R=h[1];return{x:+E,y:+R}},getEndTangent=function(t,h){var E=__read$z(t,4),R=E[0],Y=E[1],Z=E[2],ee=E[3],te=sampleCubic(R,Y,Z,ee,h);return[te,t[3]]},getClosestPointOfPolyline=function(t,h){for(var E=t.x,R=t.y,Y=points2PointsList(h),Z=Number.MAX_SAFE_INTEGER,ee,te=[],ne=0;ne<Y.length;ne++)te.push({start:Y[ne],end:Y[(ne+1)%Y.length]});if(te.forEach(function(se){var ue=se.start,fe=se.end;if(ue.x===fe.x){var le={x:ue.x,y:R},de=isInSegment(le,ue,fe);if(de){var ce=Math.abs(ue.x-E);ce<Z&&(Z=ce,ee=le)}}else if(ue.y===fe.y){var le={x:E,y:ue.y},de=isInSegment(le,ue,fe);if(de){var ce=Math.abs(ue.y-R);ce<Z&&(Z=ce,ee=le)}}}),!ee){var oe=te[0],ie=oe.start,ae=oe.end;ee={x:ie.x+(ae.x-ie.x)/2,y:ie.y+(ae.y-ie.y)/2}}return ee},pickEdgeConfig=function(t){return pick(t,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},twoPointDistance=function(t,h){return Math.sqrt(Math.pow(t.x-h.x,2)+Math.pow(t.y-h.y,2))};function createEdgeGenerator(t,h){return typeof h!="function"?function(E,R,Y){return Object.assign({type:t.edgeType},Y)}:function(E,R,Y){var Z=h(E,R,Y);return Z?typeof Z=="string"?Object.assign({},Y,{type:Z}):Object.assign({type:Z},Y):{type:t.edgeType}}}var getSvgTextSize=function(t){var h=t.rows,E=t.rowsLength,R=t.fontSize,Y=0;return forEach$3(h,function(Z){var ee=getBytesLength(Z);Y=ee>Y?ee:Y}),{width:Math.ceil(Y/2)*R+R/4,height:E*(R+2)+R/4}},__read$y=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$9=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))};function snapToGrid(t,h){return h*Math.round(t/h)||t}function normalizePolygon(t,h,E){if(!t)return[];var R=Math.min.apply(Math,__spreadArray$9([],__read$y(t.map(function(le){return le[0]})),!1)),Y=Math.max.apply(Math,__spreadArray$9([],__read$y(t.map(function(le){return le[0]})),!1)),Z=Math.min.apply(Math,__spreadArray$9([],__read$y(t.map(function(le){return le[1]})),!1)),ee=Math.max.apply(Math,__spreadArray$9([],__read$y(t.map(function(le){return le[1]})),!1)),te=-R,ne=-Z,oe=t.map(function(le){var de=__read$y(le,2),ce=de[0],pe=de[1];return[ce+te,pe+ne]}),ie=Y-R,ae=ee-Z,se=h?h/ie:1,ue=E?E/ae:1,fe=Math.min(se,ue);return oe.map(function(le){var de=__read$y(le,2),ce=de[0],pe=de[1];return[ce*fe,pe*fe]})}var __read$x=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},isPointInArea=function(t,h,E){var R=__read$x(t,2),Y=R[0],Z=R[1],ee=__read$x(h,2),te=ee[0],ne=ee[1],oe=__read$x(E,2),ie=oe[0],ae=oe[1];return Y>te&&Y<ie&&Z>ne&&Z<ae},isMultipleSelect=function(t,h){var E=h.multipleSelectKey,R=!1;switch(E){case"meta":R=t.metaKey;break;case"alt":R=t.altKey;break;case"shift":R=t.shiftKey;break;case"ctrl":R=t.ctrlKey;break;default:R=!1;break}return R},__extends$G=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}();function isVector(t,h){return t instanceof Vector&&h instanceof Vector}var Base=function(t){__extends$G(h,t);function h(E,R,Y){var Z=t.call(this,3)||this;return Z[0]=E,Z[1]=R,Z[2]=Y,Z.x=E,Z.y=R,Z.z=Y,Object.setPrototypeOf(Z,h.prototype),Z}return h.prototype.add=function(E){if(isVector(this,E))return new Vector(this.x+E.x,this.y+E.y);var R=this.z+E.z;return new Point((this.x+E.x)/R,(this.y+E.y)/R)},h.prototype.subtract=function(E){if(isVector(this,E))return new Vector(this.x-E.x,this.y-E.y);var R=this.z-E.z;return R===0?new Vector(this.x-E.x,this.y-E.y):new Point((this.x-E.x)/R,(this.y-E.y)/R)},h}(Array),Vector=function(t){__extends$G(h,t);function h(E,R,Y){var Z=t.call(this,E,R,Y??0)||this;return Object.setPrototypeOf(Z,h.prototype),Z}return h.prototype.toString=function(){return"Vector"},h.prototype.dot=function(E){var R=this;return E.reduce(function(Y,Z,ee){return Y+Z*R[ee]})},h.prototype.cross=function(E){return new h(this.y*E.z-this.z*E.y,this.z*E.x-this.x*E.z,this.x*E.y-this.y*E.x)},h.prototype.getLength=function(){return Math.hypot(this.x,this.y)},h.prototype.normalize=function(){var E=this.getLength();return new h(this.x/E,this.y/E)},h.prototype.crossZ=function(E){return this.x*E.y-this.y*E.x},h.prototype.angle=function(E){var R=this.crossZ(E),Y=Math.acos(this.normalize().dot(E.normalize()));return R>=0?Y:-Y},h}(Base),Point=function(t){__extends$G(h,t);function h(E,R){var Y=t.call(this,E,R,1)||this;return Object.setPrototypeOf(Y,h.prototype),Y}return h.prototype.toString=function(){return"Point"},h}(Base),__extends$F=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__read$w=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$8=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},Matrix=function(t){__extends$F(h,t);function h(){for(var E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];var Y=t.call(this,E.length)||this;return Y.fill(new Array(3)),E.forEach(function(Z,ee){Y[ee]=Z}),Y.columns=E[0].length,Y.rows=E.length,Object.setPrototypeOf(Y,h.prototype),Y}return h.prototype.getRow=function(E){return this[E]},h.prototype.getColumn=function(E){return __spreadArray$8([],__read$w(this.map(function(R){return R[E]})),!1)},h.prototype.transpose=function(){for(var E=[],R=0;R<this.columns;R++)E.push(this.getColumn(R));return new(h.bind.apply(h,__spreadArray$8([void 0],__read$w(E),!1)))},h.prototype.cross=function(E){var R=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===E.rows)for(var Y=0;Y<this.rows;Y++)for(var Z=this.getRow(Y),ee=function(ne){var oe=E.getColumn(ne);R[Y][ne]=Z.reduce(function(ie,ae,se){return ie+ae*oe[se]},0)},te=0;te<E.columns;te++)ee(te);return new(h.bind.apply(h,__spreadArray$8([void 0],__read$w(R),!1)))},h.prototype.to2D=function(){return this.map(function(E){return[E[0],E[1]]})},h.prototype.toPoints=function(){return this.map(function(E){return new Point(E[0],E[1])})},h.prototype.toString=function(){var E=__read$w(this[0],2),R=E[0],Y=E[1],Z=__read$w(this[1],2),ee=Z[0],te=Z[1],ne=__read$w(this[2],2),oe=ne[0],ie=ne[1];return"matrix(".concat(R," ").concat(Y," ").concat(ee," ").concat(te," ").concat(oe," ").concat(ie,")")},h.prototype.translate=function(E,R){return this.cross(new TranslateMatrix(E,R))},h.prototype.rotate=function(E){return this.cross(new RotateMatrix(E))},h.prototype.scale=function(E,R){return this.cross(new ScaleMatrix(E,R))},h}(Array),RotateMatrix=function(t){__extends$F(h,t);function h(E){var R=t.call(this,new Vector(+Math.cos(E).toFixed(2),+Math.sin(E).toFixed(2),0),new Vector(-Math.sin(E).toFixed(2),+Math.cos(E).toFixed(2),0),new Vector(0,0,1))||this;return Object.setPrototypeOf(R,h.prototype),R}return h.prototype.inverse=function(){return this.transpose()},h}(Matrix),ScaleMatrix=function(t){__extends$F(h,t);function h(E,R){var Y=t.call(this,new Vector(E,0,0),new Vector(0,R,0),new Vector(0,0,1))||this;return Y.sx=E,Y.sy=R,Object.setPrototypeOf(Y,h.prototype),Y}return h.prototype.inverse=function(){return new h(1/this.sx,1/this.sy)},h}(Matrix),TranslateMatrix=function(t){__extends$F(h,t);function h(E,R){var Y=t.call(this,new Vector(1,0,0),new Vector(0,1,0),new Vector(E,R,1))||this;return Y.tx=E,Y.ty=R,Object.setPrototypeOf(Y,h.prototype),Y}return h.prototype.inverse=function(){return new h(-this.tx,-this.ty)},h}(Matrix);configure({isolateGlobalState:!0});var __assign$O=function(){return __assign$O=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$O.apply(this,arguments)},getAnchors=function(t){var h=t.anchors;return h},targetNodeInfo=function(t,h){for(var E=h.nodes,R,Y=E.length-1;Y>=0;Y--){var Z=E[Y],ee=isInNodeBbox(t,Z);if(ee){var te=Z.getTargetAnchor(t);if(te){var ne={node:Z,anchorIndex:te.index,anchor:te.anchor};(!R||isNodeHigher(Z,R.node,h))&&(R=ne)}}}return R},isNodeHigher=function(t,h,E){return t.zIndex>h.zIndex?!0:E.nodesMap[t.id].index>E.nodesMap[h.id].index},getClosestAnchor=function(t,h){for(var E=getAnchors(h),R,Y=Number.MAX_SAFE_INTEGER,Z=0;Z<E.length;Z++){var ee=distance(t.x,t.y,E[Z].x,E[Z].y);ee<Y&&(Y=ee,R={index:Z,anchor:__assign$O(__assign$O({},E[Z]),{x:E[Z].x,y:E[Z].y,id:E[Z].id})})}return R},distance=function(t,h,E,R){return Math.hypot(t-E,h-R)},isInNode=function(t,h){var E=!1,R=0,Y=getNodeBBox(h);return t.x>=Y.minX-R&&t.x<=Y.maxX+R&&t.y>=Y.minY-R&&t.y<=Y.maxY+R&&(E=!0),E},isInNodeBbox=function(t,h){var E=!1,R=5,Y=getNodeBBox(h);return t.x>=Y.minX-R&&t.x<=Y.maxX+R&&t.y>=Y.minY-R&&t.y<=Y.maxY+R&&(E=!0),E},getNodeBBox=function(t){var h=t.x,E=t.y,R=t.width,Y=t.height;return{minX:h-R/2,minY:E-Y/2,maxX:h+R/2,maxY:E+Y/2,x:h,y:E,width:R,height:Y,centerX:h,centerY:E}},getRectRadiusCircle=function(t){var h=t,E=h.x,R=h.y,Y=h.width,Z=h.height,ee=h.radius;return[{x:E-Y/2+ee,y:R-Z/2+ee,r:ee},{x:E+Y/2-ee,y:R-Z/2+ee,r:ee},{x:E-Y/2+ee,y:R+Z/2-ee,r:ee},{x:E+Y/2-ee,y:R+Z/2-ee,r:ee}]},getClosestRadiusCenter=function(t,h,E){var R=getRectRadiusCircle(E),Y,Z=Number.MAX_SAFE_INTEGER;return R.forEach(function(ee){var te=distance(t.x,t.y,ee.x,ee.y);te<Z&&(Z=te,Y=ee)}),getCrossPointWithCircle(t,h,Y)},getCrossPointWithCircle=function(t,h,E){var R,Y=E.x,Z=E.y,ee=E.r;if(h===SegmentDirection.HORIZONTAL){var te=Y-Math.sqrt(ee*ee-(t.y-Z)*(t.y-Z)),ne=Y+Math.sqrt(ee*ee-(t.y-Z)*(t.y-Z)),oe=Math.abs(te-t.x)<Math.abs(ne-t.x)?te:ne;R={x:oe,y:t.y}}else if(h===SegmentDirection.VERTICAL){var ie=Z-Math.sqrt(ee*ee-(t.x-Y)*(t.x-Y)),ae=Z+Math.sqrt(ee*ee-(t.x-Y)*(t.x-Y)),se=Math.abs(ie-t.y)<Math.abs(ae-t.y)?ie:ae;R={x:t.x,y:se}}return R},inStraightLineOfRect=function(t,h){var E=h,R=!1,Y=E.x,Z=E.y,ee=E.width,te=E.height,ne=E.radius,oe={minX:Y-ee/2+ne,maxX:Y+ee/2-ne,minY:Z-te/2+ne,maxY:Z+te/2-ne};return t.y===Z+te/2||t.y===Z-te/2?R=t.x>oe.minX&&t.x<oe.maxX:(t.x===Y+ee/2||t.x===Y-ee/2)&&(R=t.y>oe.minY&&t.y<oe.maxY),R},getCrossPointWithEllipse=function(t,h,E){var R,Y=E,Z=Y.x,ee=Y.y,te=Y.rx,ne=Y.ry;if(h===SegmentDirection.HORIZONTAL){var oe=Z-Math.sqrt(te*te-(t.y-ee)*(t.y-ee)*te*te/(ne*ne)),ie=Z+Math.sqrt(te*te-(t.y-ee)*(t.y-ee)*te*te/(ne*ne)),ae=Math.abs(oe-t.x)<Math.abs(ie-t.x)?oe:ie;R={x:ae,y:t.y}}else if(h===SegmentDirection.VERTICAL){var se=ee-Math.sqrt(ne*ne-(t.x-Z)*(t.x-Z)*ne*ne/(te*te)),ue=ee+Math.sqrt(ne*ne-(t.x-Z)*(t.x-Z)*ne*ne/(te*te)),fe=Math.abs(se-t.y)<Math.abs(ue-t.y)?se:ue;R={x:t.x,y:fe}}return R},getCrossPointWithPolygon=function(t,h,E){for(var R=E.pointsPosition,Y=Number.MAX_SAFE_INTEGER,Z,ee=[],te=0;te<R.length;te++)ee.push({start:R[te],end:R[(te+1)%R.length]});return ee.forEach(function(ne){var oe=ne.start,ie=ne.end,ae=oe,se=ie;oe.x>ie.x&&(ae=ie,se=oe);var ue={x:t.x,y:t.y};if(ae.x===se.x&&h===SegmentDirection.HORIZONTAL&&(ue={x:ae.x,y:t.y}),ae.y===se.y&&h===SegmentDirection.VERTICAL&&(ue={x:t.x,y:ae.y}),ae.x!==se.x&&ae.y!==se.y){var fe=(se.y-ae.y)/(se.x-ae.x),le=(ae.x*se.y-se.x*ae.y)/(ae.x-se.x);h===SegmentDirection.HORIZONTAL?ue={x:(t.y-le)/fe,y:t.y}:h===SegmentDirection.VERTICAL&&(ue={x:t.x,y:fe*t.x+le})}var de=isInSegment(ue,oe,ie);if(de){var ce=distance(ue.x,ue.y,t.x,t.y);ce<Y&&(Y=ce,Z=ue)}}),Z},pickNodeConfig=function(t){var h=pick(t,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return h},getNodeAnchorPosition=function(t,h,E,R){var Y=t.x,Z=t.y;return h.x>t.x?Y=t.x+E/2:h.x<t.x&&(Y=t.x-E/2),h.y>t.y?Z=t.y+R/2:h.y<t.y&&(Z=t.y-R/2),{x:Y,y:Z}},getHtmlTextHeight=function(t){var h=t.rows,E=t.style,R=t.rowsLength,Y=t.className,Z=document.createElement("div");Z.className=Y,Z.style.fontSize="".concat(E.fontSize),Z.style.width="".concat(E.width),Z.style.lineHeight="".concat(E.lineHeight),Z.style.padding="".concat(E.padding),E.fontFamily&&(Z.style.fontFamily="".concat(E.fontFamily)),R>1?h.forEach(function(te){var ne=document.createElement("div");ne.textContent=te,Z.appendChild(ne)}):Z.textContent=h[0],document.body.appendChild(Z);var ee=Z.clientHeight;return document.body.removeChild(Z),ee},getSvgTextWidthHeight=function(t){var h=t.rows,E=t.rowsLength,R=t.fontSize,Y=0;return h&&h.forEach(function(Z){var ee=getBytesLength(Z);Y=ee>Y?ee:Y}),{width:Math.ceil(Y/2)*R+R/4,height:E*(R+2)+R/4}},formatAnchorConnectValidateData=function(t){return typeof t!="object"?{isAllPass:!!t,msg:t?"":"不允许连接"}:t};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let t=0;t<256;++t)byteToHex.push((t+256).toString(16).slice(1));function unsafeStringify(t,h=0){return byteToHex[t[h+0]]+byteToHex[t[h+1]]+byteToHex[t[h+2]]+byteToHex[t[h+3]]+"-"+byteToHex[t[h+4]]+byteToHex[t[h+5]]+"-"+byteToHex[t[h+6]]+byteToHex[t[h+7]]+"-"+byteToHex[t[h+8]]+byteToHex[t[h+9]]+"-"+byteToHex[t[h+10]]+byteToHex[t[h+11]]+byteToHex[t[h+12]]+byteToHex[t[h+13]]+byteToHex[t[h+14]]+byteToHex[t[h+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(t,h,E){if(native.randomUUID&&!h&&!t)return native.randomUUID();t=t||{};const R=t.random||(t.rng||rng)();return R[6]=R[6]&15|64,R[8]=R[8]&63|128,unsafeStringify(R)}var createUuid=function(){return v4()},rafIdMap=new Map,createRaf=function(t){var h=createUuid();function E(){t();var Y=rafIdMap.get(h);if(Y){var Z=window.requestAnimationFrame(E);rafIdMap.set(h,Z)}}var R=window.requestAnimationFrame(E);return rafIdMap.set(h,R),h},cancelRaf=function(t){var h=rafIdMap.get(t);h&&(window.cancelAnimationFrame(h),rafIdMap.delete(t))},__assign$N=function(){return __assign$N=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$N.apply(this,arguments)},__read$v=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Text(t){var h=t.x,E=h===void 0?0:h,R=t.y,Y=R===void 0?0:R,Z=t.value,ee=t.fontSize,te=ee===void 0?12:ee,ne=t.fill,oe=ne===void 0?"currentColor":ne,ie=t.overflowMode,ae=ie===void 0?"default":ie,se=t.textWidth,ue=se===void 0?void 0:se,fe=t.model,le={x:E,y:Y,fill:oe,fontSize:te,textAnchor:"middle",dominantBaseline:"central"};if(forEach$3(toPairs(t),function(ve){var _e=__read$v(ve,2),ye=_e[0],me=_e[1];typeof me!="object"&&(le[ye]=me)}),Z){var de=String(Z).split(/[\r\n]/g),ce=de.length;if(ae!=="default"){var pe=fe.BaseType,he=fe.modelType;if(pe===ElementType.NODE&&he!==ModelType.TEXT_NODE||pe===ElementType.EDGE&&ue)return renderHtmlText(t)}if(ce>1){var ge=de.map(function(ve,_e){var ye=te+2,me=(_e-(ce-1)/2)*ye;return u("tspan",{className:"lf-text-tspan",x:E,y:Y+me,children:ve})});return u("text",__assign$N({},le,{children:ge}))}return u("text",__assign$N({},le,{children:Z}))}return null}function renderHtmlText(t){var h=t.x,E=t.y,R=t.value,Y=t.model,Z=t.textWidth,ee=t.fontSize,te=ee===void 0?12:ee,ne=t.lineHeight,oe=t.fontFamily,ie=oe===void 0?"":oe,ae=t.wrapPadding,se=ae===void 0?"0, 0":ae,ue=t.overflowMode,fe=Y.width,le=Y.height,de=Y.textHeight,ce=Z||fe,pe=String(R).split(/[\r\n]/g),he=pe.length,ge=getHtmlTextHeight({rows:pe,style:{fontSize:"".concat(te,"px"),width:"".concat(ce,"px"),fontFamily:ie,lineHeight:ne,padding:se},rowsLength:he,className:"lf-get-text-height"}),ve=le>ge?le:ge;de&&(ve=de);var _e=ue==="ellipsis";return _e&&(ve=te+2),u("g",{children:u("foreignObject",{width:ce,height:ve,x:h-ce/2,y:E-ve/2,style:{overflow:"visible",textAlign:"left"},children:u("div",{className:"lf-node-text-auto-wrap",style:{minHeight:ve,width:ce,padding:se},children:u("div",{className:_e?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:_e?pe.join(""):"",style:__assign$N({},t),children:pe.map(function(ye){return u("div",{className:"lf-node-text--auto-wrap-inner",children:ye})})})})})})}var __assign$M=function(){return __assign$M=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$M.apply(this,arguments)},__read$u=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Line(t){var h={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return forEach$3(toPairs(t),function(E){var R=__read$u(E,2),Y=R[0],Z=R[1];(Y==="style"||typeof Z!="object")&&(h[Y]=Z)}),u("line",__assign$M({},h))}var __assign$L=function(){return __assign$L=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$L.apply(this,arguments)},__read$t=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Rect(t){var h=t.x,E=t.y,R=t.width,Y=t.height,Z=t.className,ee=t.strokeWidth,te=t.radius,ne=te===void 0?0:te,oe=h-R/2,ie=E-Y/2,ae={};return ae["stroke-width"]=ee,forEach$3(toPairs(t),function(se){var ue=__read$t(se,2),fe=ue[0],le=ue[1];typeof le!="object"&&(ae[fe]=le)}),Z?ae.className="lf-basic-shape ".concat(Z):ae.className="lf-basic-shape",ne&&(ae.rx=ne,ae.ry=ne),ae.x=oe,ae.y=ie,u("rect",__assign$L({},ae))}var __assign$K=function(){return __assign$K=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$K.apply(this,arguments)},__read$s=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Path(t){var h={d:""};return forEach$3(toPairs(t),function(E){var R=__read$s(E,2),Y=R[0],Z=R[1];(Y==="style"||typeof Z!="object")&&(h[Y]=Z)}),u("path",__assign$K({},h))}var __assign$J=function(){return __assign$J=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$J.apply(this,arguments)},__read$r=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Circle(t){var h=t.x,E=h===void 0?0:h,R=t.y,Y=R===void 0?0:R,Z=t.r,ee=Z===void 0?4:Z,te=t.className,ne={cx:E,cy:Y,r:ee,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return forEach$3(toPairs(t),function(oe){var ie=__read$r(oe,2),ae=ie[0],se=ie[1];typeof se!="object"&&(ne[ae]=se)}),te?ne.className="lf-basic-shape ".concat(te):ne.className="lf-basic-shape",u("circle",__assign$J({},ne))}var __assign$I=function(){return __assign$I=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$I.apply(this,arguments)},__read$q=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Ellipse(t){var h=t.x,E=h===void 0?0:h,R=t.y,Y=R===void 0?0:R,Z=t.rx,ee=Z===void 0?4:Z,te=t.ry,ne=te===void 0?4:te,oe=t.className,ie={cx:E,cy:Y,rx:ee,ry:ne,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return forEach$3(toPairs(t),function(ae){var se=__read$q(ae,2),ue=se[0],fe=se[1];typeof fe!="object"&&(ie[ue]=fe)}),oe?ie.className="lf-basic-shape ".concat(oe):ie.className="lf-basic-shape",u("ellipse",__assign$I({},ie))}var __assign$H=function(){return __assign$H=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$H.apply(this,arguments)},__read$p=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Polygon(t){var h=t.points,E=h===void 0?[]:h,R=t.className,Y={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};return forEach$3(toPairs(t),function(Z){var ee=__read$p(Z,2),te=ee[0],ne=ee[1];typeof ne!="object"&&(Y[te]=ne)}),R?Y.classNmae="lf-basic-shape ".concat(R):Y.className="lf-basic-shape",Y.points=E.map(function(Z){return Z.join(",")}).join(" "),u("polygon",__assign$H({},Y))}var __assign$G=function(){return __assign$G=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$G.apply(this,arguments)},__read$o=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z};function Polyline(t){var h=t.className,E={points:"",fill:"none"};return forEach$3(toPairs(t),function(R){var Y=__read$o(R,2),Z=Y[0],ee=Y[1];(Z==="style"||typeof ee!="object")&&(E[Z]=ee)}),h&&(E.className="".concat(h)),u("polyline",__assign$G({},E))}var __extends$E=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$F=function(){return __assign$F=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$F.apply(this,arguments)},__rest$2=function(t,h){var E={};for(var R in t)Object.prototype.hasOwnProperty.call(t,R)&&h.indexOf(R)<0&&(E[R]=t[R]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,R=Object.getOwnPropertySymbols(t);Y<R.length;Y++)h.indexOf(R[Y])<0&&Object.prototype.propertyIsEnumerable.call(t,R[Y])&&(E[R[Y]]=t[R[Y]]);return E},__read$n=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},ResizeControlIndex;(function(t){t[t.LEFT_TOP=0]="LEFT_TOP",t[t.RIGHT_TOP=1]="RIGHT_TOP",t[t.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",t[t.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(ResizeControlIndex||(ResizeControlIndex={}));var ResizeControl=function(t){__extends$E(h,t);function h(E){var R=t.call(this)||this;R.updateEdgePointByAnchors=function(){var te=R.nodeModel,ne=te.id,oe=te.anchors,ie=R.graphModel.getNodeEdges(ne);forEach$3(ie,function(ae){if(ae.sourceNodeId===ne){var se=find(oe,function(ue){return ue.id===ae.sourceAnchorId});se&&ae.updateStartPoint({x:se.x,y:se.y})}else if(ae.targetNodeId===ne){var se=find(oe,function(fe){return fe.id===ae.targetAnchorId});se&&ae.updateEndPoint({x:se.x,y:se.y})}})},R.triggerResizeEvent=function(te,ne,oe,ie,ae,se){R.graphModel.eventCenter.emit(EventType.NODE_RESIZE,{preData:te,data:ne,deltaX:oe,deltaY:ie,index:ae,model:se})},R.recalcResizeInfo=function(te,ne,oe,ie,ae){oe===void 0&&(oe=1),ie===void 0&&(ie=!1),ae===void 0&&(ae=!1);var se=cloneDeep(ne),ue=se.deltaX,fe=se.deltaY,le=se.width,de=se.height,ce=se.PCTResizeInfo;if(ce){var pe=4,he=0,ge=0;switch(te){case ResizeControlIndex.LEFT_TOP:ge=(ue*-1-fe)/pe;break;case ResizeControlIndex.RIGHT_TOP:ge=(ue-fe)/pe;break;case ResizeControlIndex.RIGHT_BOTTOM:ge=(ue+fe)/pe;break;case ResizeControlIndex.LEFT_BOTTOM:ge=(ue*-1+fe)/pe;break}ge!==0&&(he=Math.round(ge/ce.ResizeBasis.basisHeight*1e5)/1e3),ce.ResizePCT.widthPCT=Math.max(Math.min(ce.ResizePCT.widthPCT+he,ce.ScaleLimit.maxScaleLimit),ce.ScaleLimit.minScaleLimit),ce.ResizePCT.heightPCT=Math.max(Math.min(ce.ResizePCT.heightPCT+he,ce.ScaleLimit.maxScaleLimit),ce.ScaleLimit.minScaleLimit);var ve=Math.round(ce.ResizePCT.widthPCT*ce.ResizeBasis.basisWidth/100),_e=Math.round(ce.ResizePCT.heightPCT*ce.ResizeBasis.basisHeight/100);switch(te){case ResizeControlIndex.LEFT_TOP:ue=le-ve,fe=de-_e;break;case ResizeControlIndex.RIGHT_TOP:ue=ve-le,fe=de-_e;break;case ResizeControlIndex.RIGHT_BOTTOM:ue=ve-le,fe=_e-de;break;case ResizeControlIndex.LEFT_BOTTOM:ue=le-ve,fe=_e-de;break}return se}switch(te){case ResizeControlIndex.LEFT_TOP:se.width=ie?le:le-ue*oe,se.height=ae?de:de-fe*oe;break;case ResizeControlIndex.RIGHT_TOP:se.width=ie?le:le+ue*oe,se.height=ae?de:de-fe*oe;break;case ResizeControlIndex.RIGHT_BOTTOM:se.width=ie?le:le+ue*oe,se.height=ae?de:de+fe*oe;break;case ResizeControlIndex.LEFT_BOTTOM:se.width=ie?le:le-ue*oe,se.height=ae?de:de+fe*oe;break}return se},R.resizeNode=function(te){var ne=te.deltaX,oe=te.deltaY,ie=R.index,ae=R.props,se=ae.model,ue=ae.graphModel,fe=ae.x,le=ae.y;handleResize({x:fe,y:le,deltaX:ne,deltaY:oe,index:ie,nodeModel:se,graphModel:ue,cancelCallback:function(){R.dragHandler.cancelDrag()}})},R.onDragging=function(te){var ne=te.deltaX,oe=te.deltaY,ie=R.graphModel.transformModel,ae=__read$n(ie.fixDeltaXY(ne,oe),2),se=ae[0],ue=ae[1];R.resizeNode({deltaX:se,deltaY:ue})},R.onDragEnd=function(){var te=R.nodeModel.x,ne=R.nodeModel.y;R.nodeModel.moveTo(te,ne),R.updateEdgePointByAnchors()};var Y=E.index,Z=E.model,ee=E.graphModel;return R.index=Y,R.nodeModel=Z,R.graphModel=ee,R.dragHandler=new StepDrag({onDragging:R.onDragging,onDragEnd:R.onDragEnd,step:ee.gridSize}),R}return h.prototype.componentWillUnmount=function(){this.dragHandler.destroy()},h.prototype.render=function(){var E=this.props,R=E.x,Y=E.y,Z=E.direction,ee=E.model,te=ee.getResizeControlStyle(),ne=te.width,oe=te.height,ie=__rest$2(te,["width","height"]);return u("g",{className:"lf-resize-control lf-resize-control-".concat(Z),children:[u(Rect,__assign$F({className:"lf-resize-control-content",x:R,y:Y,width:ne??7,height:oe??7},ie)),u(Rect,{className:"lf-resize-control-content",x:R,y:Y,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},h}(x),ResizeControlGroup=function(t){__extends$E(h,t);function h(){return t.call(this)||this}return h.prototype.getResizeControl=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=getNodeBBox(R),ee=Z.minX,te=Z.minY,ne=Z.maxX,oe=Z.maxY,ie=[{index:ResizeControlIndex.LEFT_TOP,direction:"nw",x:ee,y:te},{index:ResizeControlIndex.RIGHT_TOP,direction:"ne",x:ne,y:te},{index:ResizeControlIndex.RIGHT_BOTTOM,direction:"se",x:ne,y:oe},{index:ResizeControlIndex.LEFT_BOTTOM,direction:"sw",x:ee,y:oe}];return map(ie,function(ae){return u(ResizeControl,__assign$F({},ae,{model:R,graphModel:Y}))})},h.prototype.getResizeOutline=function(){var E=this.props.model,R=E.x,Y=E.y,Z=E.width,ee=E.height,te=E.getResizeOutlineStyle();return u(Rect,__assign$F({},te,{x:R,y:Y,width:Z,height:ee}))},h.prototype.render=function(){return u("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},h}(x);function getNewCenter(t,h){var E=t.x,R=t.y,Y=h.x,Z=h.y,ee={x:E+(Y-E)/2,y:R+(Z-R)/2};return ee}function calculatePointAfterRotateAngle(t,h,E){var R=angleToRadian(E),Y=t.x-h.x,Z=t.y-h.y,ee=Y*Math.cos(R)-Z*Math.sin(R)+h.x,te=Y*Math.sin(R)+Z*Math.cos(R)+h.y;return{x:ee,y:te}}function angleToRadian(t){return t*Math.PI/180}function radianToAngle(t){return t/Math.PI*180}function recalcRotatedResizeInfo(t,h,E,R,Y,Z,ee,te,ne){te===void 0&&(te=!1),ne===void 0&&(ne=!1);var oe=h.deltaX,ie=h.deltaY,ae=h.width,se=h.height,ue=radianToAngle(E),fe={x:R,y:Y},le={x:Z,y:ee},de=calculatePointAfterRotateAngle(fe,le,ue),ce={x:de.x+oe,y:de.y+ie},pe=calculateWidthAndHeight(de,ce,le,ue,te,ne,ae,se),he=pe.width,ge=pe.height,ve=pe.center;return h.width=he*t,h.height=ge*t,h.deltaX=(ve.x-le.x)*2,h.deltaY=(ve.y-le.y)*2,h}var recalcResizeInfo=function(t,h,E,R,Y,Z,ee,te,ne,oe){E===void 0&&(E=1),R===void 0&&(R=!1),Y===void 0&&(Y=!1),Z===void 0&&(Z=0);var ie=cloneDeep(h),ae=ie.deltaX,se=ie.deltaY,ue=ie.width,fe=ie.height,le=ie.PCTResizeInfo;if(le){var de=4,ce=0,pe=0;switch(t){case ResizeControlIndex.LEFT_TOP:pe=(ae*-1-se)/de;break;case ResizeControlIndex.RIGHT_TOP:pe=(ae-se)/de;break;case ResizeControlIndex.RIGHT_BOTTOM:pe=(ae+se)/de;break;case ResizeControlIndex.LEFT_BOTTOM:pe=(ae*-1+se)/de;break}pe!==0&&(ce=Math.round(pe/le.ResizeBasis.basisHeight*1e5)/1e3),le.ResizePCT.widthPCT=Math.max(Math.min(le.ResizePCT.widthPCT+ce,le.ScaleLimit.maxScaleLimit),le.ScaleLimit.minScaleLimit),le.ResizePCT.heightPCT=Math.max(Math.min(le.ResizePCT.heightPCT+ce,le.ScaleLimit.maxScaleLimit),le.ScaleLimit.minScaleLimit);var he=Math.round(le.ResizePCT.widthPCT*le.ResizeBasis.basisWidth/100),ge=Math.round(le.ResizePCT.heightPCT*le.ResizeBasis.basisHeight/100);switch(t){case ResizeControlIndex.LEFT_TOP:ae=ue-he,se=fe-ge;break;case ResizeControlIndex.RIGHT_TOP:ae=he-ue,se=fe-ge;break;case ResizeControlIndex.RIGHT_BOTTOM:ae=he-ue,se=ge-fe;break;case ResizeControlIndex.LEFT_BOTTOM:ae=ue-he,se=ge-fe;break}return ie}if(Z%(2*Math.PI)!==0&&ee!==void 0&&te!==void 0)return recalcRotatedResizeInfo(E,ie,Z,ee,te,ne,oe,R,Y);switch(t){case ResizeControlIndex.LEFT_TOP:ie.width=R?ue:ue-ae*E,ie.height=Y?fe:fe-se*E;break;case ResizeControlIndex.RIGHT_TOP:ie.width=R?ue:ue+ae*E,ie.height=Y?fe:fe-se*E;break;case ResizeControlIndex.RIGHT_BOTTOM:ie.width=R?ue:ue+ae*E,ie.height=Y?fe:fe+se*E;break;case ResizeControlIndex.LEFT_BOTTOM:ie.width=R?ue:ue-ae*E,ie.height=Y?fe:fe+se*E;break}return ie},updateEdgePointByAnchors=function(t,h){var E=t.id,R=t.anchors,Y=h.getNodeEdges(E);forEach$3(Y,function(Z){if(Z.sourceNodeId===E){var ee=find(R,function(te){return te.id===Z.sourceAnchorId});ee&&Z.updateStartPoint({x:ee.x,y:ee.y})}else if(Z.targetNodeId===E){var ee=find(R,function(ne){return ne.id===Z.targetAnchorId});ee&&Z.updateEndPoint({x:ee.x,y:ee.y})}})},triggerResizeEvent=function(t,h,E,R,Y,Z,ee){ee.eventCenter.emit(EventType.NODE_RESIZE,{preData:t,data:h,deltaX:E,deltaY:R,index:Y,model:Z})},handleResize=function(t){var h=t.x,E=t.y,R=t.deltaX,Y=t.deltaY,Z=t.index,ee=t.nodeModel,te=t.graphModel,ne=t.cancelCallback,oe=ee.r,ie=ee.rx,ae=ee.ry,se=ee.width,ue=ee.height,fe=ee.PCTResizeInfo,le=ee.minWidth,de=ee.minHeight,ce=ee.maxWidth,pe=ee.maxHeight,he=ee.rotate,ge=ee.x,ve=ee.y,_e=le===ce,ye=de===pe,me={width:oe||ie||se,height:oe||ae||ue,deltaX:R,deltaY:Y,PCTResizeInfo:fe},Ee=oe||ie&&ae?1/2:1,Oe=h,Te=E,Pe=recalcResizeInfo(Z,me,Ee,_e,ye,he,Oe,Te,ge,ve);if(Pe.width<le||Pe.width>ce||Pe.height<de||Pe.height>pe){ne==null||ne();return}(he%(2*Math.PI)==0||fe||Oe===void 0||Te===void 0)&&(Pe.deltaX=_e?0:Pe.deltaX,Pe.deltaY=ye?0:Pe.deltaY);var Re=ee.getData(),De=ee.resize(Pe);Re.x===De.x&&Re.y===De.y||(updateEdgePointByAnchors(ee,te),triggerResizeEvent(Re,De,R,Y,Z,ee,te))};function calculateWidthAndHeight(t,h,E,R,Y,Z,ee,te){Y===void 0&&(Y=!1),Z===void 0&&(Z=!1);var ne={x:E.x-(t.x-E.x),y:E.y-(t.y-E.y)},oe=getNewCenter(ne,h),ie=calculatePointAfterRotateAngle(h,oe,-R),ae=calculatePointAfterRotateAngle(ne,oe,-R);if(Y){var se=Math.abs(ie.x-ae.x),ue=se-ee;oe.x>ie.x?oe.x=oe.x+ue/2:oe.x=oe.x-ue/2}if(Z){var fe=Math.abs(ie.y-ae.y),le=fe-te;oe.y>ie.y?oe.y=oe.y+le/2:oe.y=oe.y-le/2}if(Y||Z){var de=calculatePointAfterRotateAngle(ae,oe,R),ce=de.x-ne.x,pe=de.y-ne.y;oe.x=oe.x-ce,oe.y=oe.y-pe,ae=calculatePointAfterRotateAngle(ne,oe,-R),ie={x:oe.x-(ae.x-oe.x),y:oe.y-(ae.y-oe.y)}}var he=Math.abs(ie.x-ae.x),ge=Math.abs(ie.y-ae.y);return Y&&(he=ee),Z&&(ge=te),{width:he,height:ge,center:oe}}var SAMPLING_FREQUENCY=100,normal={x:1,y:0,z:0};function sampleCubic(t,h,E,R,Y){for(var Z=function(ue){if(ue<0||ue>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:t.x*Math.pow(1-ue,3)+3*h.x*ue*Math.pow(1-ue,2)+3*E.x*Math.pow(ue,2)*(1-ue)+R.x*Math.pow(ue,3),y:t.y*Math.pow(1-ue,3)+3*h.y*ue*Math.pow(1-ue,2)+3*E.y*Math.pow(ue,2)*(1-ue)+R.y*Math.pow(ue,3)}},ee=0,te=2,ne=R.x,oe=R.y,ie=R;ee<Y&&te<50;){ie=Z(1-te/SAMPLING_FREQUENCY);var ae=ie.x,se=ie.y;ee=distance(ne,oe,ae,se),te++}return ie}function crossByZ(t,h){return t.x*h.y-t.y*h.x}function dot(t,h){var E=[t.x,t.y,t.z],R=[h.x,h.y,h.z];return R.reduce(function(Y,Z,ee){return Y+Z*E[ee]})}function angle(t,h){var E=crossByZ(t,h),R=Math.acos(dot(normalize(t),normalize(h)));return E>=0?R:-R}function normalize(t){var h=Math.hypot(t.x,t.y);return{x:t.x/h,y:t.y/h,z:0}}function getThetaOfVector(t){return angle(normal,t)}function degrees(t){return t*(180/Math.PI)}var defaultTheme={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},setupTheme=function(t){var h=cloneDeep(defaultTheme);return t&&(h=merge$1(h,t)),h},updateTheme=setupTheme,maxIndex=1e3,minIndex=999,getZIndex=function(){return++maxIndex},getMinIndex=function(){return--minIndex},__assign$E=function(){return __assign$E=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$E.apply(this,arguments)},__decorate$r=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},BaseEdgeModel=function(){function t(h,E){var R;this.BaseType=ElementType.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=TextMode.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=ElementState.DEFAULT,this.modelType=ModelType.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=E,this.properties=(R=h.properties)!==null&&R!==void 0?R:{},this.initEdgeData(h),this.setAttributes()}return t.prototype.initEdgeData=function(h){if(h.properties||(h.properties={}),!h.id){var E=this.graphModel.idGenerator,R=E&&E(h.type),Y=this.createId();h.id=Y||R||createUuid()}this.arrowConfig.markerEnd="url(#marker-end-".concat(h.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(h.id,")");var Z=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=Z,assign(this,pickEdgeConfig(h));var ee=this.graphModel.overlapMode;ee===OverlapMode.INCREASE&&(this.zIndex=h.zIndex||getZIndex()),this.setAnchors(),this.initPoints(),this.formatText(h)},t.prototype.setAttributes=function(){},t.prototype.createId=function(){return null},t.prototype.getEdgeStyle=function(){return __assign$E(__assign$E({},this.graphModel.theme.baseEdge),this.style)},t.prototype.getAdjustPointStyle=function(){return __assign$E({},this.graphModel.theme.edgeAdjust)},t.prototype.getTextStyle=function(){var h=this.graphModel.theme.edgeText;return cloneDeep(h)},t.prototype.getEdgeAnimationStyle=function(){var h=this.graphModel.theme.edgeAnimation;return cloneDeep(h)},t.prototype.getArrowStyle=function(){var h=this.getEdgeStyle(),E=this.getEdgeAnimationStyle(),R=this.graphModel.theme.arrow,Y=this.isAnimation?E.stroke:h.stroke;return __assign$E(__assign$E(__assign$E({},h),{fill:Y,stroke:Y}),R)},t.prototype.getOutlineStyle=function(){var h=this.graphModel,E=h.theme.outline;return cloneDeep(E)},t.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(t.prototype,"sourceNode",{get:function(){var h,E;return(E=(h=this.graphModel)===null||h===void 0?void 0:h.nodesMap[this.sourceNodeId])===null||E===void 0?void 0:E.model},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetNode",{get:function(){var h,E;return(E=(h=this.graphModel)===null||h===void 0?void 0:h.nodesMap[this.targetNodeId])===null||E===void 0?void 0:E.model},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),t.prototype.getBeginAnchor=function(h,E,R){var Y,Z,ee=getAnchors(h);if(R){if(Y=find(ee,function(te){return te.id===R}),Y)return Y;console.warn("未在节点上找到指定的起点锚点".concat(R,"，已使用默认锚点作为起点"))}return ee.forEach(function(te){var ne=twoPointDistance(te,E);(Z===void 0||ne<Z)&&(Z=ne,Y=te)}),Y},t.prototype.getEndAnchor=function(h,E){var R=this,Y,Z,ee=getAnchors(h);if(E){if(Y=find(ee,function(te){return te.id===E}),Y)return Y;console.warn("未在节点上找到指定的终点锚点".concat(E,"，已使用默认锚点作为终点"))}return ee.forEach(function(te){if(R.startPoint){var ne=twoPointDistance(te,R.startPoint);(Z===void 0||ne<Z)&&(Z=ne,Y=te)}}),Y},t.prototype.getProperties=function(){return toJS(this.properties)},t.prototype.getData=function(){var h=this.properties;isObservable(h)&&(h=toJS(h));var E={id:this.id,type:this.type,properties:h,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,startPoint:assign({},this.startPoint),endPoint:assign({},this.endPoint)};this.graphModel.overlapMode===OverlapMode.INCREASE&&(E.zIndex=this.zIndex);var R=this.text,Y=R.x,Z=R.y,ee=R.value;return ee&&(E.text={x:Y,y:Z,value:ee}),E},t.prototype.getHistoryData=function(){return this.getData()},t.prototype.setProperty=function(h,E){set$1(this.properties,h,formatData(E)),this.setAttributes()},t.prototype.deleteProperty=function(h){delete this.properties[h],this.setAttributes()},t.prototype.setProperties=function(h){this.properties=__assign$E(__assign$E({},toJS(this.properties)),formatData(h)),this.setAttributes()},t.prototype.changeEdgeId=function(h){var E=this.arrowConfig,R=E.markerEnd,Y=E.markerStart;Y&&Y==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(h,")")),R&&R==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(h,")")),this.id=h},t.prototype.setStyle=function(h,E){var R;this.style=__assign$E(__assign$E({},this.style),(R={},R[h]=formatData(E),R))},t.prototype.setStyles=function(h){this.style=__assign$E(__assign$E({},this.style),formatData(h))},t.prototype.updateStyles=function(h){this.style=__assign$E({},formatData(h))},t.prototype.setTextMode=function(h){this.textMode=h},t.prototype.formatText=function(h){var E,R,Y,Z=this.textPosition,ee=Z.x,te=Z.y,ne=h.text,oe={value:"",x:ee,y:te,draggable:!1,editable:!0};ne&&(typeof ne=="string"?oe=__assign$E(__assign$E({},oe),{value:ne}):(oe=__assign$E(__assign$E({},oe),{x:(E=ne.x)!==null&&E!==void 0?E:ee,y:(R=ne.y)!==null&&R!==void 0?R:te,value:(Y=ne.value)!==null&&Y!==void 0?Y:""}),isUndefined$1(ne.draggable)||(oe.draggable=ne.draggable),isUndefined$1(ne.editable)||(oe.editable=ne.editable))),this.text=oe},t.prototype.resetTextPosition=function(){var h=this.textPosition,E=h.x,R=h.y;this.text.x=E,this.text.y=R},t.prototype.moveText=function(h,E){var R=this.text,Y=R.x,Z=R.y,ee=R.value,te=R.draggable,ne=R.editable;this.text={value:ee,editable:ne,draggable:te,x:Y+h,y:Z+E}},t.prototype.setText=function(h){h&&assign(this.text,h)},t.prototype.updateText=function(h){this.text=__assign$E(__assign$E({},toJS(this.text)),{value:h})},t.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var h=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!h)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:h.x,y:h.y}),this.sourceAnchorId||(this.sourceAnchorId=h.id)}if(!this.targetAnchorId||!this.endPoint){var h=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!h)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:h.x,y:h.y}),this.targetAnchorId||(this.targetAnchorId=h.id)}},t.prototype.setSelected=function(h){h===void 0&&(h=!0),this.isSelected=h},t.prototype.setHovered=function(h){h===void 0&&(h=!0),this.isHovered=h},t.prototype.setHitable=function(h){h===void 0&&(h=!0),this.isHitable=h},t.prototype.setHittable=function(h){h===void 0&&(h=!0),this.isHittable=h},t.prototype.openEdgeAnimation=function(){this.isAnimation=!0},t.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},t.prototype.setElementState=function(h,E){this.state=h,this.additionStateData=E},t.prototype.updateStartPoint=function(h){this.startPoint=h},t.prototype.moveStartPoint=function(h,E){this.startPoint&&(this.startPoint.x+=h,this.startPoint.y+=E)},t.prototype.updateEndPoint=function(h){this.endPoint=h},t.prototype.moveEndPoint=function(h,E){this.endPoint&&(this.endPoint.x+=h,this.endPoint.y+=E)},t.prototype.setZIndex=function(h){h===void 0&&(h=0),this.zIndex=h},t.prototype.initPoints=function(){},t.prototype.updateAttributes=function(h){assign(this,h)},t.prototype.getAdjustStart=function(){return this.startPoint},t.prototype.getAdjustEnd=function(){return this.endPoint},t.prototype.updateAfterAdjustStartAndEnd=function(h){var E=h.startPoint,R=h.endPoint;this.updateStartPoint({x:E.x,y:E.y}),this.updateEndPoint({x:R.x,y:R.y})},t.BaseType=ElementType.EDGE,__decorate$r([observable$1],t.prototype,"type",void 0),__decorate$r([observable$1],t.prototype,"sourceNodeId",void 0),__decorate$r([observable$1],t.prototype,"targetNodeId",void 0),__decorate$r([observable$1],t.prototype,"startPoint",void 0),__decorate$r([observable$1],t.prototype,"endPoint",void 0),__decorate$r([observable$1],t.prototype,"textMode",void 0),__decorate$r([observable$1],t.prototype,"text",void 0),__decorate$r([observable$1],t.prototype,"properties",void 0),__decorate$r([observable$1],t.prototype,"points",void 0),__decorate$r([observable$1],t.prototype,"pointsList",void 0),__decorate$r([observable$1],t.prototype,"isSelected",void 0),__decorate$r([observable$1],t.prototype,"isHovered",void 0),__decorate$r([observable$1],t.prototype,"isHitable",void 0),__decorate$r([observable$1],t.prototype,"isHittable",void 0),__decorate$r([observable$1],t.prototype,"draggable",void 0),__decorate$r([observable$1],t.prototype,"visible",void 0),__decorate$r([observable$1],t.prototype,"isAnimation",void 0),__decorate$r([observable$1],t.prototype,"isShowAdjustPoint",void 0),__decorate$r([observable$1],t.prototype,"zIndex",void 0),__decorate$r([observable$1],t.prototype,"state",void 0),__decorate$r([observable$1],t.prototype,"style",void 0),__decorate$r([observable$1],t.prototype,"arrowConfig",void 0),__decorate$r([computed],t.prototype,"sourceNode",null),__decorate$r([computed],t.prototype,"targetNode",null),__decorate$r([computed],t.prototype,"textPosition",null),__decorate$r([action],t.prototype,"setProperty",null),__decorate$r([action],t.prototype,"deleteProperty",null),__decorate$r([action],t.prototype,"setProperties",null),__decorate$r([action],t.prototype,"changeEdgeId",null),__decorate$r([action],t.prototype,"setStyle",null),__decorate$r([action],t.prototype,"setStyles",null),__decorate$r([action],t.prototype,"updateStyles",null),__decorate$r([action],t.prototype,"setTextMode",null),__decorate$r([action],t.prototype,"formatText",null),__decorate$r([action],t.prototype,"resetTextPosition",null),__decorate$r([action],t.prototype,"moveText",null),__decorate$r([action],t.prototype,"setText",null),__decorate$r([action],t.prototype,"updateText",null),__decorate$r([action],t.prototype,"setAnchors",null),__decorate$r([action],t.prototype,"setSelected",null),__decorate$r([action],t.prototype,"setHovered",null),__decorate$r([action],t.prototype,"setHitable",null),__decorate$r([action],t.prototype,"setHittable",null),__decorate$r([action],t.prototype,"openEdgeAnimation",null),__decorate$r([action],t.prototype,"closeEdgeAnimation",null),__decorate$r([action],t.prototype,"setElementState",null),__decorate$r([action],t.prototype,"updateStartPoint",null),__decorate$r([action],t.prototype,"moveStartPoint",null),__decorate$r([action],t.prototype,"updateEndPoint",null),__decorate$r([action],t.prototype,"moveEndPoint",null),__decorate$r([action],t.prototype,"setZIndex",null),__decorate$r([action],t.prototype,"initPoints",null),__decorate$r([action],t.prototype,"updateAttributes",null),__decorate$r([action],t.prototype,"getAdjustStart",null),__decorate$r([action],t.prototype,"getAdjustEnd",null),__decorate$r([action],t.prototype,"updateAfterAdjustStartAndEnd",null),t}(),__extends$D=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$D=function(){return __assign$D=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$D.apply(this,arguments)},__decorate$q=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$m=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BezierEdgeModel=function(t){__extends$D(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.BEZIER_EDGE,Y.path="",Y.initEdgeData(E),Y.setAttributes(),Y}return h.prototype.initEdgeData=function(E){this.offset=100,t.prototype.initEdgeData.call(this,E)},h.prototype.getEdgeStyle=function(){var E=this.graphModel.theme.bezier,R=t.prototype.getEdgeStyle.call(this),Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$D(__assign$D(__assign$D({},R),cloneDeep(E)),cloneDeep(Z))},h.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var E=0,R=0;return this.pointsList.forEach(function(Y){var Z=Y.x,ee=Y.y;E+=Z,R+=ee}),{x:E/this.pointsList.length,y:R/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},h.prototype.getData=function(){var E=t.prototype.getData.call(this),R=this.pointsList.map(function(Y){var Z=Y.x,ee=Y.y;return{x:Z,y:ee}});return __assign$D(__assign$D({},E),{pointsList:R})},h.prototype.getControls=function(){var E=this.startPoint,R=this.endPoint,Y=getBezierControlPoints({start:E,end:R,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return Y},h.prototype.getPath=function(E){var R=__read$m(E,4),Y=R[0],Z=R[1],ee=R[2],te=R[3];return"M ".concat(Y.x," ").concat(Y.y,`
    C `).concat(Z.x," ").concat(Z.y,`,
    `).concat(ee.x," ").concat(ee.y,`,
    `).concat(te.x," ").concat(te.y)},h.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},h.prototype.updatePoints=function(){var E=this.getControls(),R=E.sNext,Y=E.ePre;this.updatePath(R,Y)},h.prototype.updatePath=function(E,R){E=cloneDeep(E),R=cloneDeep(R);var Y={x:this.startPoint.x,y:this.startPoint.y},Z={x:this.endPoint.x,y:this.endPoint.y};if(!E||!R){var ee=this.getControls();E=ee.sNext,R=ee.ePre}this.pointsList=[Y,E,R,Z],this.path=this.getPath(this.pointsList)},h.prototype.updateStartPoint=function(E){this.startPoint=Object.assign({},E),this.updatePoints()},h.prototype.updateEndPoint=function(E){this.endPoint=Object.assign({},E),this.updatePoints()},h.prototype.moveStartPoint=function(E,R){this.startPoint.x+=E,this.startPoint.y+=R;var Y=__read$m(this.pointsList,3),Z=Y[1],ee=Y[2];Z.x+=E,Z.y+=R,this.updatePath(Z,ee)},h.prototype.moveEndPoint=function(E,R){this.endPoint.x+=E,this.endPoint.y+=R;var Y=__read$m(this.pointsList,3),Z=Y[1],ee=Y[2];ee.x+=E,ee.y+=R,this.updatePath(Z,ee)},h.prototype.updateAdjustAnchor=function(E,R){var Y;R==="sNext"?this.pointsList[1]=E:R==="ePre"&&(this.pointsList[2]=E),this.path=this.getPath(this.pointsList),!((Y=this.text)===null||Y===void 0)&&Y.value&&this.setText(assign({},this.text,this.textPosition))},h.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},h.prototype.getAdjustEnd=function(){var E=this.pointsList;return E[E.length-1]||this.endPoint},h.prototype.updateAfterAdjustStartAndEnd=function(E){var R=E.startPoint,Y=E.endPoint,Z=E.sourceNode,ee=E.targetNode,te=getBezierControlPoints({start:R,end:Y,sourceNode:Z,targetNode:ee,offset:this.offset}),ne=te.sNext,oe=te.ePre;this.pointsList=[R,ne,oe,Y],this.initPoints()},__decorate$q([observable$1],h.prototype,"path",void 0),__decorate$q([action],h.prototype,"initPoints",null),__decorate$q([action],h.prototype,"updatePoints",null),__decorate$q([action],h.prototype,"updateStartPoint",null),__decorate$q([action],h.prototype,"updateEndPoint",null),__decorate$q([action],h.prototype,"moveStartPoint",null),__decorate$q([action],h.prototype,"moveEndPoint",null),__decorate$q([action],h.prototype,"updateAdjustAnchor",null),__decorate$q([action],h.prototype,"getAdjustStart",null),__decorate$q([action],h.prototype,"getAdjustEnd",null),__decorate$q([action],h.prototype,"updateAfterAdjustStartAndEnd",null),h}(BaseEdgeModel),__extends$C=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$C=function(){return __assign$C=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$C.apply(this,arguments)},__read$l=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$7=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},LineEdgeModel=function(t){__extends$C(h,t);function h(){var E=t.apply(this,__spreadArray$7([],__read$l(arguments),!1))||this;return E.modelType=ModelType.LINE_EDGE,E}return h.prototype.getEdgeStyle=function(){var E=this.graphModel.theme.line,R=t.prototype.getEdgeStyle.call(this),Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$C(__assign$C(__assign$C({},R),cloneDeep(E)),cloneDeep(Z))},h.prototype.initEdgeData=function(E){t.prototype.initEdgeData.call(this,E),this.points=this.getPath([this.startPoint,this.endPoint])},h.prototype.getPath=function(E){var R=__read$l(E,2),Y=R[0],Z=R[1];return"".concat(Y.x,",").concat(Y.y," ").concat(Z.x,",").concat(Z.y)},h.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},h}(BaseEdgeModel),__extends$B=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$B=function(){return __assign$B=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$B.apply(this,arguments)},__decorate$p=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$k=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$6=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},PolylineEdgeModel=function(t){__extends$B(h,t);function h(){var E=t.apply(this,__spreadArray$6([],__read$k(arguments),!1))||this;return E.modelType=ModelType.POLYLINE_EDGE,E.draggingPointList=[],E}return h.prototype.initEdgeData=function(E){this.offset=30,t.prototype.initEdgeData.call(this,E)},h.prototype.getEdgeStyle=function(){var E=this.graphModel.theme.polyline,R=t.prototype.getEdgeStyle.call(this),Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$B(__assign$B(__assign$B({},R),cloneDeep(E)),cloneDeep(Z))},h.prototype.getTextPosition=function(){var E,R=(E=this.text)===null||E===void 0?void 0:E.value;if(this.dbClickPosition&&!R){var Y=this.dbClickPosition,Z=Y.x,ee=Y.y;return{x:Z,y:ee}}var te=points2PointsList(this.points),ne=__read$k(getLongestEdge(te),2),oe=ne[0],ie=ne[1];return{x:(oe.x+ie.x)/2,y:(oe.y+ie.y)/2}},h.prototype.getAfterAnchor=function(E,R,Y){var Z,ee;return Y.forEach(function(te){var ne;E===SegmentDirection.HORIZONTAL?ne=Math.abs(R.y-te.y):E===SegmentDirection.VERTICAL&&(ne=Math.abs(R.x-te.x)),(!ee||ee>ne)&&(ee=ne,Z=te)}),Z},h.prototype.getCrossPoint=function(E,R,Y){var Z;return E===SegmentDirection.HORIZONTAL?Z={x:Y.x,y:R.y}:E===SegmentDirection.VERTICAL&&(Z={x:R.x,y:Y.y}),Z},h.prototype.removeCrossPoints=function(E,R,Y){var Z=Y.map(function(ce){return ce});if(E===1){var ee=Z[E],te=Z[R],ne=Z[E-1],oe=isSegmentsInNode(ne,ee,this.sourceNode);if(oe){var ie=isSegmentsCrossNode(ee,te,this.sourceNode);if(ie){var ae=getCrossPointInRect(ee,te,this.sourceNode);ae&&(Z[E]=ae,Z.splice(E-1,1),E--,R--)}}else{var se=this.sourceNode.anchors;se.forEach(function(ce){if(ce.x===ne.x&&ce.x===ee.x||ce.y===ne.y&&ce.y===ee.y){var pe=distance(ce.x,ce.y,ee.x,ee.y),he=distance(ne.x,ne.y,ee.x,ee.y);pe<he&&(Z[E-1]=ce)}})}}if(R===Y.length-2){var ue=Z[E],fe=Z[R],le=Z[R+1],de=isSegmentsInNode(fe,le,this.targetNode);if(de){var ie=isSegmentsCrossNode(ue,fe,this.targetNode);if(ie){var ae=getCrossPointInRect(ue,fe,this.targetNode);ae&&(Z[R]=ae,Z.splice(R+1,1))}}else{var se=this.targetNode.anchors;se.forEach(function(pe){if(pe.x===le.x&&pe.x===fe.x||pe.y===le.y&&pe.y===fe.y){var he=distance(pe.x,pe.y,fe.x,fe.y),ge=distance(le.x,le.y,fe.x,fe.y);he<ge&&(Z[R+1]=pe)}})}}return Z},h.prototype.getDraggingPoints=function(E,R,Y,Z,ee){var te=ee.map(function(ie){return ie}),ne=this.getAfterAnchor(E,Y,Z),oe=this.getCrossPoint(E,Y,ne);return R==="start"?(te.unshift(oe),te.unshift(ne)):(te.push(oe),te.push(ne)),te},h.prototype.updateCrossPoints=function(E){var R=E.map(function(pe){return pe}),Y=E[0],Z=E[1],ee=E[R.length-2],te=E[R.length-1],ne=this,oe=ne.sourceNode,ie=ne.targetNode,ae=oe.modelType,se=ie.modelType,ue=segmentDirection(Y,Z),fe=R[0];switch(ae){case ModelType.RECT_NODE:if(oe.radius!==0){var le=inStraightLineOfRect(Y,oe);le||(fe=getClosestRadiusCenter(Y,ue,oe))}break;case ModelType.CIRCLE_NODE:fe=getCrossPointWithCircle(Y,ue,oe);break;case ModelType.ELLIPSE_NODE:fe=getCrossPointWithEllipse(Y,ue,oe);break;case ModelType.DIAMOND_NODE:fe=getCrossPointWithPolygon(Y,ue,oe);break;case ModelType.POLYGON_NODE:fe=getCrossPointWithPolygon(Y,ue,oe);break}fe&&(R[0]=fe);var de=segmentDirection(ee,te),ce=R[R.length-1];switch(se){case ModelType.RECT_NODE:if(ie.radius!==0){var le=inStraightLineOfRect(te,ie);le||(ce=getClosestRadiusCenter(te,de,ie))}break;case ModelType.CIRCLE_NODE:ce=getCrossPointWithCircle(te,de,ie);break;case ModelType.ELLIPSE_NODE:ce=getCrossPointWithEllipse(te,de,ie);break;case ModelType.DIAMOND_NODE:ce=getCrossPointWithPolygon(te,de,ie);break;case ModelType.POLYGON_NODE:ce=getCrossPointWithPolygon(te,de,ie);break}return ce&&(R[R.length-1]=ce),R},h.prototype.getData=function(){var E=t.prototype.getData.call(this),R=this.pointsList.map(function(Y){var Z=Y.x,ee=Y.y;return{x:Z,y:ee}});return Object.assign({},E,{pointsList:R})},h.prototype.getPath=function(E){return E.map(function(R){return"".concat(R.x,",").concat(R.y)}).join(" ")},h.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},h.prototype.updatePoints=function(){var E=getPolylinePoints({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=E,this.points=E.map(function(R){return"".concat(R.x,",").concat(R.y)}).join(" ")},h.prototype.updateStartPoint=function(E){this.startPoint=Object.assign({},E),this.updatePoints()},h.prototype.moveStartPoint=function(E,R){this.startPoint.x+=E,this.startPoint.y+=R,this.updatePoints()},h.prototype.updateEndPoint=function(E){this.endPoint=Object.assign({},E),this.updatePoints()},h.prototype.moveEndPoint=function(E,R){this.endPoint.x+=E,this.endPoint.y+=R,this.updatePoints()},h.prototype.updatePointsList=function(E,R){this.pointsList.forEach(function(ee){ee.x+=E,ee.y+=R});var Y=this.pointsList[0];this.startPoint=Object.assign({},Y);var Z=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},Z),this.initPoints()},h.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(E){return E})},h.prototype.dragAppendSimple=function(E,R){var Y;this.isDragging=!0;var Z=E.start,ee=E.end,te=E.startIndex,ne=E.endIndex,oe=E.direction,ie=this.pointsList,ae=ie;return oe===SegmentDirection.HORIZONTAL?(ie[te]={x:Z.x,y:Z.y+R.y},ie[ne]={x:ee.x,y:ee.y+R.y},ae=this.pointsList.map(function(se){return se})):oe===SegmentDirection.VERTICAL&&(ie[te]={x:Z.x+R.x,y:Z.y},ie[ne]={x:ee.x+R.x,y:ee.y},ae=this.pointsList.map(function(se){return se})),this.updatePointsAfterDrag(ae),this.draggingPointList=ae,!((Y=this.text)===null||Y===void 0)&&Y.value&&this.setText(assign({},this.text,this.textPosition)),{start:assign({},ie[te]),end:assign({},ie[ne]),startIndex:te,endIndex:ne,direction:oe}},h.prototype.dragAppend=function(E,R){var Y;this.isDragging=!0;var Z=E.start,ee=E.end,te=E.startIndex,ne=E.endIndex,oe=E.direction,ie=this.pointsList;if(oe===SegmentDirection.HORIZONTAL){ie[te]={x:Z.x,y:Z.y+R.y},ie[ne]={x:ee.x,y:ee.y+R.y};var ae=this.pointsList.map(function(de){return de});if(te!==0&&ne!==this.pointsList.length-1&&(ae=this.removeCrossPoints(te,ne,ae)),te===0){var se={x:Z.x,y:Z.y+R.y},ue=isInNode(se,this.sourceNode);if(!ue){var fe=this.sourceNode.anchors;ae=this.getDraggingPoints(oe,"start",se,fe,ae)}}if(ne===this.pointsList.length-1){var le={x:ee.x,y:ee.y+R.y},ue=isInNode(le,this.targetNode);if(!ue){var fe=this.targetNode.anchors;ae=this.getDraggingPoints(oe,"end",le,fe,ae)}}this.updatePointsAfterDrag(ae),this.draggingPointList=ae}else if(oe===SegmentDirection.VERTICAL){ie[te]={x:Z.x+R.x,y:Z.y},ie[ne]={x:ee.x+R.x,y:ee.y};var ae=this.pointsList.map(function(ce){return ce});if(te!==0&&ne!==this.pointsList.length-1&&(ae=this.removeCrossPoints(te,ne,ae)),te===0){var se={x:Z.x+R.x,y:Z.y},ue=isInNode(se,this.sourceNode);if(!ue){var fe=this.sourceNode.anchors;ae=this.getDraggingPoints(oe,"start",se,fe,ae)}}if(ne===this.pointsList.length-1){var le={x:ee.x+R.x,y:ee.y},ue=isInNode(le,this.targetNode);if(!ue){var fe=this.targetNode.anchors;ae=this.getDraggingPoints(oe,"end",le,fe,ae)}}this.updatePointsAfterDrag(ae),this.draggingPointList=ae}return!((Y=this.text)===null||Y===void 0)&&Y.value&&this.setText(assign({},this.text,this.textPosition)),{start:assign({},ie[te]),end:assign({},ie[ne]),startIndex:te,endIndex:ne,direction:oe}},h.prototype.dragAppendEnd=function(){if(this.draggingPointList){var E=pointFilter(points2PointsList(this.points));this.pointsList=E.map(function(Z){return Z}),this.draggingPointList=[];var R=E[0];this.startPoint=assign({},R);var Y=E[E.length-1];this.endPoint=assign({},Y)}this.isDragging=!1},h.prototype.updatePointsAfterDrag=function(E){var R=this.updateCrossPoints(E);this.points=R.map(function(Y){return"".concat(Y.x,",").concat(Y.y)}).join(" ")},h.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},h.prototype.getAdjustEnd=function(){var E=this.pointsList;return E[E.length-1]||this.endPoint},h.prototype.updateAfterAdjustStartAndEnd=function(E){var R=E.startPoint,Y=E.endPoint,Z=E.sourceNode,ee=E.targetNode;this.pointsList=getPolylinePoints({x:R.x,y:R.y},{x:Y.x,y:Y.y},Z,ee,this.offset||0),this.initPoints()},__decorate$p([observable$1],h.prototype,"dbClickPosition",void 0),__decorate$p([action],h.prototype,"initPoints",null),__decorate$p([action],h.prototype,"updatePoints",null),__decorate$p([action],h.prototype,"updateStartPoint",null),__decorate$p([action],h.prototype,"moveStartPoint",null),__decorate$p([action],h.prototype,"updateEndPoint",null),__decorate$p([action],h.prototype,"moveEndPoint",null),__decorate$p([action],h.prototype,"updatePointsList",null),__decorate$p([action],h.prototype,"dragAppendStart",null),__decorate$p([action],h.prototype,"dragAppendSimple",null),__decorate$p([action],h.prototype,"dragAppend",null),__decorate$p([action],h.prototype,"dragAppendEnd",null),__decorate$p([action],h.prototype,"updatePointsAfterDrag",null),__decorate$p([action],h.prototype,"getAdjustStart",null),__decorate$p([action],h.prototype,"getAdjustEnd",null),__decorate$p([action],h.prototype,"updateAfterAdjustStartAndEnd",null),h}(BaseEdgeModel),__assign$A=function(){return __assign$A=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$A.apply(this,arguments)},__decorate$o=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__values$1=function(t){var h=typeof Symbol=="function"&&Symbol.iterator,E=h&&t[h],R=0;if(E)return E.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&R>=t.length&&(t=void 0),{value:t&&t[R++],done:!t}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$j=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BaseNodeModel=function(){function t(h,E){var R;this.BaseType=ElementType.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=TextMode.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=ElementState.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=ModelType.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=E,this.properties=(R=h.properties)!==null&&R!==void 0?R:{},this.initNodeData(h),this.setAttributes()}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(h){this._width=h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(h){this._height=h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(h){this._rotate=h;var E=this,R=E.x,Y=R===void 0?0:R,Z=E.y,ee=Z===void 0?0:Z;this.transform=new TranslateMatrix(-Y,-ee).rotate(h).translate(Y,ee).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),t.prototype.initNodeData=function(h){if(h.properties||(h.properties={}),!h.id){var E=this.graphModel.idGenerator,R=E&&E(h.type),Y=this.createId();h.id=Y||R||createUuid()}this.formatText(h),assign(this,pickNodeConfig(h));var Z=this.graphModel.overlapMode;Z===OverlapMode.INCREASE&&(this.zIndex=h.zIndex||getZIndex())},t.prototype.setAttributes=function(){},t.prototype.createId=function(){return null},t.prototype.setTextMode=function(h){this.textMode=h},t.prototype.formatText=function(h){var E,R,Y,Z=h.x,ee=h.y,te=h.text,ne={value:"",x:Z,y:ee,draggable:!1,editable:!0};te&&(typeof te=="string"?ne.value=te:(ne=__assign$A(__assign$A({},ne),{x:(E=te.x)!==null&&E!==void 0?E:Z,y:(R=te.y)!==null&&R!==void 0?R:ee,value:(Y=te.value)!==null&&Y!==void 0?Y:""}),isUndefined$1(te.draggable)||(ne.draggable=te.draggable),isUndefined$1(te.editable)||(ne.editable=te.editable))),h.text=ne},t.prototype.resize=function(h){var E=h.width,R=h.height,Y=h.deltaX,Z=h.deltaY,ee=this.isAllowResizeNode(Y,Z,E,R);return ee?(this.move(Y/2,Z/2),this.width=E,this.height=R,this.setProperties({width:E,height:R}),this.getData()):this.getData()},t.prototype.proportionalResize=function(){},t.prototype.getData=function(){var h=this.text,E=h.x,R=h.y,Y=h.value,Z=this.properties;isObservable(Z)&&(Z=toJS(Z)),isNil(Z.width)&&(Z.width=this.width),isNil(Z.height)&&(Z.height=this.height);var ee={id:this.id,type:this.type,x:this.x,y:this.y,properties:Z};return this.rotate&&(ee.rotate=this.rotate),this.graphModel.overlapMode===OverlapMode.INCREASE&&(ee.zIndex=this.zIndex),Y&&(ee.text={x:E,y:R,value:Y}),ee},t.prototype.getHistoryData=function(){return this.getData()},t.prototype.getProperties=function(){return toJS(this.properties)},t.prototype.getOuterGAttributes=function(){return{className:""}},t.prototype.getNodeStyle=function(){return __assign$A(__assign$A({},this.graphModel.theme.baseNode),this.style)},t.prototype.getTextStyle=function(){var h=this.graphModel.theme.nodeText,E=this.properties.textStyle,R=E===void 0?{}:E;return __assign$A(__assign$A({},cloneDeep(h)),cloneDeep(R))},t.prototype.getRotateControlStyle=function(){var h=this.graphModel.theme.rotateControl;return cloneDeep(h)},t.prototype.getResizeControlStyle=function(){var h=this.graphModel.theme.resizeControl;return cloneDeep(h)},t.prototype.getResizeOutlineStyle=function(){var h=this.graphModel.theme.resizeOutline;return cloneDeep(h)},t.prototype.getAnchorStyle=function(h){var E=this.graphModel.theme.anchor;return cloneDeep(E)},t.prototype.getAnchorLineStyle=function(h){var E=this.graphModel.theme.anchorLine;return cloneDeep(E)},t.prototype.getOutlineStyle=function(){var h=this.graphModel.theme.outline;return cloneDeep(h)},t.prototype.isAllowConnectedAsSource=function(h,E,R,Y){var Z=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var ee=!0,te="",ne=0;ne<Z.length;ne++){var oe=Z[ne];if(!oe.validate.call(this,this,h,E,R,Y)){ee=!1,te=oe.message;break}}return{isAllPass:ee,msg:te}},t.prototype.getConnectedSourceRules=function(){return this.sourceRules},t.prototype.isAllowConnectedAsTarget=function(h,E,R,Y){var Z=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var ee=!0,te="",ne=0;ne<Z.length;ne++){var oe=Z[ne];if(!oe.validate.call(this,h,this,E,R,Y)){ee=!1,te=oe.message;break}}return{isAllPass:ee,msg:te}},t.prototype.isAllowMoveNode=function(h,E){var R,Y,Z=!0,ee=!0,te=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var ne=__values$1(te),oe=ne.next();!oe.done;oe=ne.next()){var ie=oe.value,ae=ie(this,h,E);if(!ae)return!1;if(typeof ae=="object"){var se=ae;if(!se.x&&!se.y)return!1;Z=Z&&se.x,ee=ee&&se.y}}}catch(ue){R={error:ue}}finally{try{oe&&!oe.done&&(Y=ne.return)&&Y.call(ne)}finally{if(R)throw R.error}}return{x:Z,y:ee}},t.prototype.getConnectedTargetRules=function(){return this.targetRules},t.prototype.getAnchorsByOffset=function(){var h=this,E=h.anchorsOffset,R=h.id,Y=h.x,Z=h.y;return E&&E.length>0?E.map(function(ee,te){return ee.length?(ee=ee,{id:"".concat(R,"_").concat(te),x:Y+ee[0],y:Z+ee[1]}):(ee=ee,__assign$A(__assign$A({},ee),{x:Y+ee.x,y:Z+ee.y,id:ee.id||"".concat(R,"_").concat(te)}))}):this.getDefaultAnchor()},t.prototype.getDefaultAnchor=function(){return[]},t.prototype.getTargetAnchor=function(h){return getClosestAnchor(h,this)},t.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(t.prototype,"anchors",{get:function(){var h=this.getAnchorsByOffset(),E=this,R=E.x,Y=E.y,Z=E.rotate;return h.forEach(function(ee){var te=ee.x,ne=ee.y,oe=__read$j(new Matrix([te,ne,1]).translate(-R,-Y).rotate(Z).translate(R,Y)[0],2),ie=oe[0],ae=oe[1];ee.x=ie,ee.y=ae}),h},enumerable:!1,configurable:!0}),t.prototype.getAnchorInfo=function(h){if(!isNil(h))for(var E=0;E<this.anchors.length;E++){var R=this.anchors[E];if(R.id===h)return R}},t.prototype.addNodeMoveRules=function(h){this.moveRules.includes(h)||this.moveRules.push(h)},t.prototype.isAllowMoveByXORY=function(h,E,R){var Y,Z;if(R)Y=!0,Z=!0;else{var ee=this.isAllowMoveNode(h,E);typeof ee=="boolean"?(Y=ee,Z=ee):(Y=ee.x,Z=ee.y)}return{isAllowMoveX:Y,isAllowMoveY:Z}},t.prototype.move=function(h,E,R){R===void 0&&(R=!1);var Y=this.isAllowMoveByXORY(h,E,R),Z=Y.isAllowMoveX,ee=Y.isAllowMoveY;return Z&&(this.x=this.x+h,this.text&&this.moveText(h,0)),ee&&(this.y=this.y+E,this.text&&this.moveText(0,E)),(Z||ee)&&(this.rotate=this._rotate),Z||ee},t.prototype.getMoveDistance=function(h,E,R){R===void 0&&(R=!1);var Y=this.isAllowMoveByXORY(h,E,R),Z=Y.isAllowMoveX,ee=Y.isAllowMoveY,te=0,ne=0;return Z&&h&&(this.x=this.x+h,this.text&&this.moveText(h,0),te=h),ee&&E&&(this.y=this.y+E,this.text&&this.moveText(0,E),ne=E),[te,ne]},t.prototype.moveTo=function(h,E,R){R===void 0&&(R=!1);var Y=h-this.x,Z=E-this.y;return!R&&!this.isAllowMoveNode(Y,Z)?!1:(this.text&&this.moveText(Y,Z),this.x=h,this.y=E,!0)},t.prototype.moveText=function(h,E){var R=this.text,Y=R.x,Z=R.y,ee=R.value,te=R.draggable,ne=R.editable;this.text={value:ee,editable:ne,draggable:te,x:Y+h,y:Z+E}},t.prototype.updateText=function(h){this.text=__assign$A(__assign$A({},toJS(this.text)),{value:h})},t.prototype.addNodeResizeRules=function(h){this.resizeRules.includes(h)||this.resizeRules.push(h)},t.prototype.isAllowResizeNode=function(h,E,R,Y){var Z,ee,te=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var ne=__values$1(te),oe=ne.next();!oe.done;oe=ne.next()){var ie=oe.value,ae=ie(this,h,E,R,Y);if(!ae)return!1}}catch(se){Z={error:se}}finally{try{oe&&!oe.done&&(ee=ne.return)&&ee.call(ne)}finally{if(Z)throw Z.error}}return!0},t.prototype.setSelected=function(h){h===void 0&&(h=!0),this.isSelected=h},t.prototype.setHovered=function(h){h===void 0&&(h=!0),this.isHovered=h,this.setIsShowAnchor(h)},t.prototype.setIsShowAnchor=function(h){h===void 0&&(h=!0),this.isShowAnchor=h},t.prototype.setRotatable=function(h){h===void 0&&(h=!0),this.rotatable=h},t.prototype.setResizable=function(h){h===void 0&&(h=!0),this.resizable=h},t.prototype.setHitable=function(h){h===void 0&&(h=!0),this.isHitable=h},t.prototype.setHittable=function(h){h===void 0&&(h=!0),this.isHittable=h},t.prototype.setElementState=function(h,E){this.state=h,this.additionStateData=E},t.prototype.updateProperties=function(h,E){var R=toJS(this.properties);this.properties=h,this.setAttributes(),this.graphModel.eventCenter.emit(EventType.NODE_PROPERTIES_CHANGE,{id:this.id,keys:E,preProperties:R,properties:h})},t.prototype.setProperty=function(h,E){var R=toJS(this.properties),Y=cloneDeep(R);set(Y,h,formatData(E)),this.updateProperties(Y,[h])},t.prototype.setProperties=function(h){var E=toJS(this.properties),R=__assign$A(__assign$A({},E),formatData(h)),Y=[];mapKeys(h,function(Z,ee){(has(E,ee)&&E[ee]!==Z||!has(E,ee))&&Y.push(ee)}),this.updateProperties(R,Y)},t.prototype.deleteProperty=function(h){delete this.properties[h],this.setAttributes()},t.prototype.setStyle=function(h,E){var R;this.style=__assign$A(__assign$A({},this.style),(R={},R[h]=formatData(E),R))},t.prototype.setStyles=function(h){this.style=__assign$A(__assign$A({},this.style),formatData(h))},t.prototype.updateStyles=function(h){this.style=__assign$A({},formatData(h))},t.prototype.setZIndex=function(h){h===void 0&&(h=1),this.zIndex=h},t.prototype.updateAttributes=function(h){assign(this,h)},t.BaseType=ElementType.NODE,__decorate$o([observable$1],t.prototype,"type",void 0),__decorate$o([observable$1],t.prototype,"x",void 0),__decorate$o([observable$1],t.prototype,"y",void 0),__decorate$o([observable$1],t.prototype,"textMode",void 0),__decorate$o([observable$1],t.prototype,"text",void 0),__decorate$o([observable$1],t.prototype,"properties",void 0),__decorate$o([observable$1],t.prototype,"_width",void 0),__decorate$o([observable$1],t.prototype,"_height",void 0),__decorate$o([observable$1],t.prototype,"anchorsOffset",void 0),__decorate$o([observable$1],t.prototype,"isSelected",void 0),__decorate$o([observable$1],t.prototype,"isHovered",void 0),__decorate$o([observable$1],t.prototype,"isShowAnchor",void 0),__decorate$o([observable$1],t.prototype,"isDragging",void 0),__decorate$o([observable$1],t.prototype,"isHitable",void 0),__decorate$o([observable$1],t.prototype,"isHittable",void 0),__decorate$o([observable$1],t.prototype,"draggable",void 0),__decorate$o([observable$1],t.prototype,"visible",void 0),__decorate$o([observable$1],t.prototype,"rotatable",void 0),__decorate$o([observable$1],t.prototype,"resizable",void 0),__decorate$o([observable$1],t.prototype,"zIndex",void 0),__decorate$o([observable$1],t.prototype,"state",void 0),__decorate$o([observable$1],t.prototype,"autoToFront",void 0),__decorate$o([observable$1],t.prototype,"style",void 0),__decorate$o([observable$1],t.prototype,"transform",void 0),__decorate$o([observable$1],t.prototype,"_rotate",void 0),__decorate$o([computed],t.prototype,"incoming",null),__decorate$o([computed],t.prototype,"outgoing",null),__decorate$o([action],t.prototype,"setTextMode",null),__decorate$o([action],t.prototype,"addNodeMoveRules",null),__decorate$o([action],t.prototype,"move",null),__decorate$o([action],t.prototype,"getMoveDistance",null),__decorate$o([action],t.prototype,"moveTo",null),__decorate$o([action],t.prototype,"moveText",null),__decorate$o([action],t.prototype,"updateText",null),__decorate$o([action],t.prototype,"addNodeResizeRules",null),__decorate$o([action],t.prototype,"setSelected",null),__decorate$o([action],t.prototype,"setHovered",null),__decorate$o([action],t.prototype,"setIsShowAnchor",null),__decorate$o([action],t.prototype,"setRotatable",null),__decorate$o([action],t.prototype,"setResizable",null),__decorate$o([action],t.prototype,"setHitable",null),__decorate$o([action],t.prototype,"setHittable",null),__decorate$o([action],t.prototype,"setElementState",null),__decorate$o([action],t.prototype,"setProperty",null),__decorate$o([action],t.prototype,"setProperties",null),__decorate$o([action],t.prototype,"deleteProperty",null),__decorate$o([action],t.prototype,"setStyle",null),__decorate$o([action],t.prototype,"setStyles",null),__decorate$o([action],t.prototype,"updateStyles",null),__decorate$o([action],t.prototype,"setZIndex",null),__decorate$o([action],t.prototype,"updateAttributes",null),t}(),__extends$A=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$z=function(){return __assign$z=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$z.apply(this,arguments)},__decorate$n=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},CircleNodeModel=function(t){__extends$A(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.CIRCLE_NODE,Y.r=50,Y.initNodeData(E),Y.setAttributes(),Y}return Object.defineProperty(h.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties.r;E&&(this.r=E)},h.prototype.getNodeStyle=function(){var E=t.prototype.getNodeStyle.call(this),R=this.graphModel.theme.circle,Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$z(__assign$z(__assign$z({},E),cloneDeep(R)),cloneDeep(Z))},h.prototype.getDefaultAnchor=function(){var E=this,R=E.x,Y=E.y,Z=E.r;return[{x:R,y:Y-Z,id:"".concat(this.id,"_0")},{x:R+Z,y:Y,id:"".concat(this.id,"_1")},{x:R,y:Y+Z,id:"".concat(this.id,"_2")},{x:R-Z,y:Y,id:"".concat(this.id,"_3")}]},h.prototype.resize=function(E){var R=E.width,Y=E.deltaX,Z=E.deltaY;return this.move(Y/2,Z/2),this.r=R,this.setProperties({r:R}),this.getData()},__decorate$n([observable$1],h.prototype,"r",void 0),__decorate$n([computed],h.prototype,"width",null),__decorate$n([computed],h.prototype,"height",null),h}(BaseNodeModel),__extends$z=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$y=function(){return __assign$y=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$y.apply(this,arguments)},__decorate$m=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$i=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},DiamondNodeModel=function(t){__extends$z(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.DIAMOND_NODE,Y.rx=30,Y.ry=50,Y.initNodeData(E),Y.setAttributes(),Y}return h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties,R=E.rx,Y=E.ry;R&&(this.rx=R),Y&&(this.ry=Y)},h.prototype.getNodeStyle=function(){var E=t.prototype.getNodeStyle.call(this),R=this.graphModel.theme.diamond,Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$y(__assign$y(__assign$y({},E),cloneDeep(R)),cloneDeep(Z))},Object.defineProperty(h.prototype,"points",{get:function(){var E=this,R=E.x,Y=E.y,Z=E.rx,ee=E.ry;return[[R,Y-ee],[R+Z,Y],[R,Y+ee],[R-Z,Y]]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"pointsPosition",{get:function(){return map(this.points,function(E){var R=__read$i(E,2),Y=R[0],Z=R[1];return{x:Y,y:Z}})},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"width",{get:function(){var E=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER;return forEach$3(this.points,function(Y){var Z=__read$i(Y,1),ee=Z[0];ee<E&&(E=ee),ee>R&&(R=ee)}),R-E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){var E=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER;return forEach$3(this.points,function(Y){var Z=__read$i(Y,2),ee=Z[1];ee<E&&(E=ee),ee>R&&(R=ee)}),R-E},enumerable:!1,configurable:!0}),h.prototype.getDefaultAnchor=function(){var E=this;return map(this.points,function(R,Y){var Z=__read$i(R,2),ee=Z[0],te=Z[1];return{x:ee,y:te,id:"".concat(E.id,"_").concat(Y)}})},h.prototype.resize=function(E){var R=E.width,Y=E.height,Z=E.deltaX,ee=E.deltaY;return this.move(Z/2,ee/2),this.rx=R,this.ry=Y,this.setProperties({rx:R,ry:Y}),this.getData()},__decorate$m([observable$1],h.prototype,"rx",void 0),__decorate$m([observable$1],h.prototype,"ry",void 0),__decorate$m([computed],h.prototype,"points",null),__decorate$m([computed],h.prototype,"pointsPosition",null),__decorate$m([computed],h.prototype,"width",null),__decorate$m([computed],h.prototype,"height",null),h}(BaseNodeModel),__extends$y=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$x=function(){return __assign$x=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$x.apply(this,arguments)},__decorate$l=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},EllipseNodeModel=function(t){__extends$y(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.ELLIPSE_NODE,Y.rx=30,Y.ry=45,Y.initNodeData(E),Y.setAttributes(),Y}return h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties,R=E.rx,Y=E.ry;R&&(this.rx=R),Y&&(this.ry=Y)},h.prototype.getNodeStyle=function(){var E=t.prototype.getNodeStyle.call(this),R=this.graphModel.theme.ellipse,Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$x(__assign$x(__assign$x({},E),cloneDeep(R)),cloneDeep(Z))},Object.defineProperty(h.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),h.prototype.getDefaultAnchor=function(){var E=this,R=E.x,Y=E.y,Z=E.rx,ee=E.ry;return[{x:R,y:Y-ee,id:"".concat(this.id,"_0")},{x:R+Z,y:Y,id:"".concat(this.id,"_1")},{x:R,y:Y+ee,id:"".concat(this.id,"_2")},{x:R-Z,y:Y,id:"".concat(this.id,"_3")}]},h.prototype.resize=function(E){var R=E.width,Y=E.height,Z=E.deltaX,ee=E.deltaY;return this.move(Z/2,ee/2),this.rx=R,this.ry=Y,this.setProperties({rx:R,ry:Y}),this.getData()},__decorate$l([observable$1],h.prototype,"rx",void 0),__decorate$l([observable$1],h.prototype,"ry",void 0),__decorate$l([computed],h.prototype,"width",null),__decorate$l([computed],h.prototype,"height",null),h}(BaseNodeModel),__extends$x=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$w=function(){return __assign$w=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$w.apply(this,arguments)},__decorate$k=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$h=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},PolygonNodeModel=function(t){__extends$x(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.POLYGON_NODE,Y.points=[[50,0],[100,50],[50,100],[0,50]],Y.initNodeData(E),Y.setAttributes(),Y}return h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties,R=E.points,Y=E.width,Z=E.height,ee=R||this.points;this.points=normalizePolygon(ee,Y,Z)},h.prototype.getNodeStyle=function(){var E=t.prototype.getNodeStyle.call(this),R=this.graphModel.theme.polygon,Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$w(__assign$w(__assign$w({},E),cloneDeep(R)),cloneDeep(Z))},Object.defineProperty(h.prototype,"pointsPosition",{get:function(){var E=this,R=E.x,Y=E.y,Z=E.width,ee=E.height;return this.points.map(function(te){return{x:te[0]+R-Z/2,y:te[1]+Y-ee/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"width",{get:function(){var E=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(Y){var Z=__read$h(Y,1),ee=Z[0];ee<E&&(E=ee),ee>R&&(R=ee)}),R-E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){var E=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(Y){var Z=__read$h(Y,2),ee=Z[1];ee<E&&(E=ee),ee>R&&(R=ee)}),R-E},enumerable:!1,configurable:!0}),h.prototype.getDefaultAnchor=function(){var E=this,R=this,Y=R.x,Z=R.y,ee=R.width,te=R.height,ne=R.points;return ne.map(function(oe,ie){var ae=__read$h(oe,2),se=ae[0],ue=ae[1];return{x:Y+se-ee/2,y:Z+ue-te/2,id:"".concat(E.id,"_").concat(ie)}})},h.prototype.resize=function(E){var R=this,Y=E.width,Z=E.height,ee=E.deltaX,te=E.deltaY;this.move(ee/2,te/2);var ne=map(this.points,function(oe){var ie=__read$h(oe,2),ae=ie[0],se=ie[1];return[ae*Y/R.width,se*Z/R.height]});return this.points=ne,this.properties.points=ne,this.getData()},__decorate$k([observable$1],h.prototype,"points",void 0),__decorate$k([computed],h.prototype,"pointsPosition",null),__decorate$k([computed],h.prototype,"width",null),__decorate$k([computed],h.prototype,"height",null),h}(BaseNodeModel),__extends$w=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$v=function(){return __assign$v=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$v.apply(this,arguments)},__decorate$j=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},RectNodeModel=function(t){__extends$w(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.RECT_NODE,Y.radius=0,Y.initNodeData(E),Y.setAttributes(),Y}return h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties,R=E.width,Y=E.height,Z=E.radius;isNil(R)||(this.width=R),isNil(Y)||(this.height=Y),isNil(Z)||(this.radius=Z)},h.prototype.getDefaultAnchor=function(){var E=this,R=E.x,Y=E.y,Z=E.width,ee=E.height;return[{x:R,y:Y-ee/2,id:"".concat(this.id,"_0")},{x:R+Z/2,y:Y,id:"".concat(this.id,"_1")},{x:R,y:Y+ee/2,id:"".concat(this.id,"_2")},{x:R-Z/2,y:Y,id:"".concat(this.id,"_3")}]},h.prototype.getNodeStyle=function(){var E=t.prototype.getNodeStyle.call(this),R=this.graphModel.theme.rect,Y=this.properties.style,Z=Y===void 0?{}:Y;return __assign$v(__assign$v(__assign$v({},E),cloneDeep(R)),cloneDeep(Z))},__decorate$j([observable$1],h.prototype,"radius",void 0),h}(BaseNodeModel),__extends$v=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$u=function(){return __assign$u=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$u.apply(this,arguments)},__decorate$i=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$g=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$5=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},TextNodeModel=function(t){__extends$v(h,t);function h(){var E=t.apply(this,__spreadArray$5([],__read$g(arguments),!1))||this;return E.modelType=ModelType.TEXT_NODE,E}return h.prototype.getTextStyle=function(){var E=t.prototype.getTextStyle.call(this),R=this.graphModel.theme.text,Y=this.properties.textStyle;return __assign$u(__assign$u(__assign$u({},E),cloneDeep(R)),cloneDeep(Y))},Object.defineProperty(h.prototype,"width",{get:function(){var E=String(this.text.value).split(/[\r\n]/g),R=this.getTextStyle().fontSize,Y=getSvgTextWidthHeight({rows:E,fontSize:R,rowsLength:E.length}).width;return Y},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){var E=String(this.text.value).split(/[\r\n]/g),R=this.getTextStyle().fontSize,Y=getSvgTextWidthHeight({rows:E,fontSize:R,rowsLength:E.length}).height;return Y},enumerable:!1,configurable:!0}),__decorate$i([computed],h.prototype,"width",null),__decorate$i([computed],h.prototype,"height",null),h}(BaseNodeModel),__extends$u=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),HtmlNodeModel=function(t){__extends$u(h,t);function h(E,R){var Y=t.call(this,E,R)||this;return Y.modelType=ModelType.HTML_NODE,Y.setAttributes(),Y}return h.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var E=this.properties,R=E.width,Y=E.height;R&&(this.width=R),Y&&(this.height=Y)},h.prototype.getDefaultAnchor=function(){var E=this,R=E.x,Y=E.y,Z=E.width,ee=E.height;return[{x:R,y:Y-ee/2,id:"".concat(this.id,"_0")},{x:R+Z/2,y:Y,id:"".concat(this.id,"_1")},{x:R,y:Y+ee/2,id:"".concat(this.id,"_2")},{x:R-Z/2,y:Y,id:"".concat(this.id,"_3")}]},h}(BaseNodeModel),__decorate$h=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},silentModeConfig={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},allKeys=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],EditConfigModel=function(){function t(h){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.textMode=TextMode.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=TextMode.TEXT,this.edgeTextMode=TextMode.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",assign(this,this.computeConfig(h))}return t.prototype.updateEditConfig=function(h){var E=this.computeConfig(h);assign(this,E)},t.prototype.computeConfig=function(h){var E=h.isSilentMode,R=h.textDraggable,Y=h.textMode,Z=h.textEdit,ee=h.adjustEdgeStartAndEnd,te={};if(E===!1&&assign(te,this.stagedConfig),E===!0&&E!==this.isSilentMode){var ne=pick(silentModeConfig,allKeys);this.stagedConfig=pick(this,allKeys),assign(te,ne)}isUndefined$1(Z)||assign(te,{nodeTextEdit:Z,edgeTextEdit:Z}),isUndefined$1(R)||assign(te,{nodeTextDraggable:R,edgeTextDraggable:R}),Y&&assign(te,{nodeTextMode:Y,edgeTextMode:Y}),isBoolean$1(ee)&&assign(te,{adjustEdgeStart:ee,adjustEdgeEnd:ee});var oe=pick(h,allKeys);return assign(te,oe)},t.prototype.updateTextMode=function(h){this.textMode=h,this.edgeTextMode=h,this.nodeTextMode=h},t.prototype.getConfig=function(){return pick(this,allKeys)},__decorate$h([observable$1],t.prototype,"isSilentMode",void 0),__decorate$h([observable$1],t.prototype,"stopZoomGraph",void 0),__decorate$h([observable$1],t.prototype,"stopMoveGraph",void 0),__decorate$h([observable$1],t.prototype,"stopScrollGraph",void 0),__decorate$h([observable$1],t.prototype,"textMode",void 0),__decorate$h([observable$1],t.prototype,"textEdit",void 0),__decorate$h([observable$1],t.prototype,"textDraggable",void 0),__decorate$h([observable$1],t.prototype,"nodeTextEdit",void 0),__decorate$h([observable$1],t.prototype,"nodeTextDraggable",void 0),__decorate$h([observable$1],t.prototype,"nodeTextMultiple",void 0),__decorate$h([observable$1],t.prototype,"nodeTextVertical",void 0),__decorate$h([observable$1],t.prototype,"nodeTextMode",void 0),__decorate$h([observable$1],t.prototype,"edgeTextMode",void 0),__decorate$h([observable$1],t.prototype,"edgeTextEdit",void 0),__decorate$h([observable$1],t.prototype,"edgeTextDraggable",void 0),__decorate$h([observable$1],t.prototype,"edgeTextMultiple",void 0),__decorate$h([observable$1],t.prototype,"edgeTextVertical",void 0),__decorate$h([observable$1],t.prototype,"hideAnchors",void 0),__decorate$h([observable$1],t.prototype,"allowRotate",void 0),__decorate$h([observable$1],t.prototype,"allowResize",void 0),__decorate$h([observable$1],t.prototype,"hoverOutline",void 0),__decorate$h([observable$1],t.prototype,"nodeSelectedOutline",void 0),__decorate$h([observable$1],t.prototype,"adjustNodePosition",void 0),__decorate$h([observable$1],t.prototype,"autoExpand",void 0),__decorate$h([observable$1],t.prototype,"adjustEdge",void 0),__decorate$h([observable$1],t.prototype,"adjustEdgeMiddle",void 0),__decorate$h([observable$1],t.prototype,"adjustEdgeStartAndEnd",void 0),__decorate$h([observable$1],t.prototype,"adjustEdgeStart",void 0),__decorate$h([observable$1],t.prototype,"adjustEdgeEnd",void 0),__decorate$h([observable$1],t.prototype,"edgeSelectedOutline",void 0),__decorate$h([action],t.prototype,"updateEditConfig",null),__decorate$h([action],t.prototype,"updateTextMode",null),t}(),WILDCARD="*",EventEmitter=function(){function t(){this._events={}}return t.prototype.on=function(h,E,R){var Y=this;h==null||h.split(",").forEach(function(Z){Z=Z.trim(),Y._events[Z]||(Y._events[Z]=[]),Y._events[Z].push({callback:E,once:!!R})})},t.prototype.once=function(h,E){var R=this;h==null||h.split(",").forEach(function(Y){Y=Y.trim(),R.on(Y,E,!0)})},t.prototype.emit=function(h,E){var R=this;h==null||h.split(",").forEach(function(Y){var Z=R._events[Y]||[],ee=R._events[WILDCARD]||[],te=function(ne){for(var oe=ne.length,ie=0;ie<oe;ie++)if(ne[ie]){var ae=ne[ie],se=ae.callback,ue=ae.once;ue&&(ne.splice(ie,1),ne.length===0&&delete R._events[Y],oe--,ie--),se.apply(R,[E])}};te(Z),te(ee)})},t.prototype.off=function(h,E){var R=this;h||(this._events={}),h.split(",").forEach(function(Y){if(!E)delete R._events[Y];else{for(var Z=R._events[Y]||[],ee=Z.length,te=0;te<ee;te++)Z[te].callback===E&&(Z.splice(te,1),ee--,te--);Z.length===0&&delete R._events[Y]}})},t.prototype.getEvents=function(){return this._events},t}(),__extends$t=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$t=function(){return __assign$t=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$t.apply(this,arguments)},__decorate$g=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},CanvasOverlay=function(t){__extends$t(h,t);function h(E){var R=t.call(this)||this;R.stepScrollX=0,R.stepScrollY=0,R.onDragging=function(te){var ne=te.deltaX,oe=te.deltaY;R.setState({isDragging:!0});var ie=R.props.graphModel,ae=ie.transformModel,se=ie.editConfigModel;se.stopMoveGraph!==!0&&ae.translate(ne,oe)},R.onDragEnd=function(){R.setState({isDragging:!1})},R.zoomHandler=function(te){var ne=R.props,oe=ne.graphModel,ie=oe.editConfigModel,ae=oe.transformModel,se=oe.gridSize,ue=ne.graphModel,fe=te.deltaX,le=te.deltaY;if(!ie.stopScrollGraph&&!te.ctrlKey&&!te.metaKey){if(te.preventDefault(),R.stepScrollX+=fe,R.stepScrollY+=le,Math.abs(R.stepScrollX)>=se){var de=R.stepScrollX%se,ce=R.stepScrollX-de;ae.translate(-ce*ae.SCALE_X,0),R.stepScrollX=de}if(Math.abs(R.stepScrollY)>=se){var pe=R.stepScrollY%se,he=R.stepScrollY-pe;ae.translate(0,-he*ae.SCALE_Y),R.stepScrollY=pe}return}if(!ie.stopZoomGraph){te.preventDefault();var ge=ue.getPointByClient({x:te.clientX,y:te.clientY}),ve=ge.canvasOverlayPosition,_e=ve.x,ye=ve.y;ae.zoom(te.deltaY<0,[_e,ye])}},R.clickHandler=function(te){var ne=te.target;if(ne.getAttribute("name")==="canvas-overlay"){var oe=R.props.graphModel,ie=oe.selectElements;ie.size>0&&oe.clearSelectElements(),oe.eventCenter.emit(EventType.BLANK_CLICK,{e:te})}},R.handleContextMenu=function(te){var ne=te.target;if(ne.getAttribute("name")==="canvas-overlay"){te.preventDefault();var oe=R.props.graphModel,ie=oe.getPointByClient({x:te.clientX,y:te.clientY});oe.eventCenter.emit(EventType.BLANK_CONTEXTMENU,{e:te,position:ie})}},R.mouseDownHandler=function(te){var ne=R.props.graphModel,oe=ne.eventCenter,ie=ne.editConfigModel,ae=ne.transformModel.SCALE_X,se=ne.gridSize,ue=te.target,fe=!ie.adjustEdge&&!ie.adjustNodePosition;(ue.getAttribute("name")==="canvas-overlay"||fe)&&(ie.stopMoveGraph!==!0?(R.stepDrag.setStep(se*ae),R.stepDrag.handleMouseDown(te)):oe.emit(EventType.BLANK_MOUSEDOWN,{e:te}),R.clickHandler(te))};var Y=E.graphModel,Z=Y.gridSize,ee=Y.eventCenter;return R.stepDrag=new StepDrag({onDragging:R.onDragging,onDragEnd:R.onDragEnd,step:Z,eventType:"BLANK",isStopPropagation:!1,eventCenter:ee,model:void 0}),R.state={isDragging:!1},R}return h.prototype.render=function(){var E=this.props.graphModel.transformModel,R=E.getTransformStyle().transform,Y=this.props,Z=Y.children,ee=Y.dnd,te=this.state.isDragging;return u("svg",__assign$t({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:te?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},ee.eventMap(),{children:u("g",{transform:R,children:Z})}))},h=__decorate$g([observer],h),h}(x),__extends$s=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$s=function(){return __assign$s=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$s.apply(this,arguments)},__decorate$f=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$f=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BezierAdjustAnchor=function(t){__extends$s(h,t);function h(){var E=t.call(this)||this;return E.onDragging=function(R){var Y=R.event,Z=E.props,ee=Z.graphModel,te=Z.bezierModel,ne=Z.type,oe=ee.getPointByClient({x:Y.clientX,y:Y.clientY}).canvasOverlayPosition,ie=oe.x,ae=oe.y;te.updateAdjustAnchor({x:ie,y:ae},ne),ee.eventCenter.emit(EventType.EDGE_ADJUST,{data:te.getData()})},E.onDragEnd=function(){var R=E.props.bezierModel;R.isDragging=!1},E.dragHandler=new StepDrag({onDragging:E.onDragging,onDragEnd:E.onDragEnd}),E}return h.prototype.render=function(){var E=this,R=this.props.position,Y=R.x,Z=R.y,ee=this.props.bezierModel,te=ee.getEdgeStyle().adjustAnchor;return u(Circle,__assign$s({className:"lf-bezier-adjust-anchor",x:Y,y:Z},te,{onMouseDown:function(ne){E.dragHandler.handleMouseDown(ne)}}))},h}(x),BezierAdjustOverlay=function(t){__extends$s(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getBezierAdjust=function(E,R){var Y=E.path,Z=E.id,ee=getBezierPoints(Y),te=__read$f(ee,4),ne=te[0],oe=te[1],ie=te[2],ae=te[3],se=E.getEdgeStyle().adjustLine,ue=[];return ue.push(u(Line,__assign$s({x1:ne.x,y1:ne.y,x2:oe.x,y2:oe.y},se))),ue.push(u(BezierAdjustAnchor,{position:oe,bezierModel:E,graphModel:R,type:"sNext"},"".concat(Z,"_ePre"))),ue.push(u(Line,__assign$s({x1:ae.x,y1:ae.y,x2:ie.x,y2:ie.y},se))),ue.push(u(BezierAdjustAnchor,{position:ie,bezierModel:E,graphModel:R,type:"ePre"},"".concat(Z,"_sNext"))),ue},h.prototype.selectedBezierEdge=function(){for(var E=this.props.graphModel,R=E.edges,Y=[],Z=0;Z<R.length;Z++){var ee=R[Z];ee.isSelected&&ee.modelType===ModelType.BEZIER_EDGE&&ee.draggable&&Y.push(this.getBezierAdjust(ee,E))}return Y},h.prototype.render=function(){return u("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},h=__decorate$f([observer],h),h}(x),__extends$r=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$e=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},BackgroundOverlay=function(t){__extends$r(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.render=function(){var E=this.props.background;return u("div",{className:"lf-background",children:u("div",{style:isObject$3(E)?E:{},className:"lf-background-area"})})},h=__decorate$e([observer],h),h}(x),__extends$q=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$d=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},Grid=function(t){__extends$q(h,t);function h(E){var R=t.call(this,E)||this;return R.id=createUuid(),R.gridOptions=R.props.graphModel.grid,R}return h.prototype.renderDot=function(){var E=this.gridOptions,R=E.config,Y=E.size,Z=Y===void 0?1:Y,ee=E.visible,te=R??{},ne=te.color,oe=te.thickness,ie=oe===void 0?2:oe,ae=Math.min(Math.max(2,ie),Z/4),se=ee?1:0;return u("g",{fill:ne,opacity:se,children:[u("circle",{cx:0,cy:0,r:ae/2}),u("circle",{cx:0,cy:Z,r:ae/2}),u("circle",{cx:Z,cy:0,r:ae/2}),u("circle",{cx:Z,cy:Z,r:ae/2})]})},h.prototype.renderMesh=function(){var E=this.gridOptions,R=E.config,Y=E.size,Z=Y===void 0?1:Y,ee=E.visible,te=R??{},ne=te.color,oe=te.thickness,ie=oe===void 0?1:oe,ae=Math.min(Math.max(1,ie),Z/2),se="M 0 0 H ".concat(Z," V ").concat(Z," H 0 Z"),ue=ee?1:0;return u("path",{d:se,stroke:ne,strokeWidth:ae/2,opacity:ue,fill:"transparent"})},h.prototype.render=function(){var E=this.props.graphModel.transformModel,R=this.gridOptions,Y=R.type,Z=R.size,ee=Z===void 0?1:Z,te=E.SCALE_X,ne=E.SKEW_Y,oe=E.SKEW_X,ie=E.SCALE_Y,ae=E.TRANSLATE_X,se=E.TRANSLATE_Y,ue=[te,ne,oe,ie,ae,se].join(","),fe="matrix(".concat(ue,")");return u("div",{className:"lf-grid",children:u("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[u("defs",{children:u("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:fe,x:"0",y:"0",width:ee,height:ee,children:[Y==="dot"&&this.renderDot(),Y==="mesh"&&this.renderMesh()]})}),u("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},h=__decorate$d([observer],h),h}(x);(function(t){t.defaultProps={size:DEFAULT_GRID_SIZE,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function h(E){var R=cloneDeep(t.defaultProps);return typeof E=="number"?assign(R,{size:E}):typeof E=="boolean"?assign(R,{visible:E}):assign(R,E)}t.getGridOptions=h})(Grid||(Grid={}));var __extends$p=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$c=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},ModificationOverlay=function(t){__extends$p(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.render=function(){var E=this.props.graphModel.transformModel,R=E.getTransformStyle().transform,Y=this.props.children;return u("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:u("g",{transform:R,children:Y})})},h=__decorate$c([observer],h),h}(x),__extends$o=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$r=function(){return __assign$r=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$r.apply(this,arguments)},__decorate$b=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},OutlineOverlay=function(t){__extends$o(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getNodesOutline=function(){var E=this.props.graphModel,R=E.nodes,Y=E.editConfigModel,Z=Y.hoverOutline,ee=Y.nodeSelectedOutline,te=[];return R.forEach(function(ne){if(ne.isHovered||ne.isSelected){var oe=ne.isHovered,ie=ne.isSelected,ae=ne.x,se=ne.y,ue=ne.width,fe=ne.height;if(ee&&ie||Z&&oe){var le=ne.getOutlineStyle(),de={};if(Object.keys(le).forEach(function(pe){pe!=="hover"&&(de[pe]=le[pe])}),oe){var ce=le.hover;de=__assign$r(__assign$r({},de),ce)}te.push(u(Rect,__assign$r({transform:ne.transform,className:"lf-outline-node",x:ae,y:se,width:ue+10,height:fe+10},de)))}}}),te},h.prototype.getEdgeOutline=function(){for(var E=this.props.graphModel,R=E.edges,Y=E.editConfigModel,Z=Y.edgeSelectedOutline,ee=Y.hoverOutline,te=[],ne=0;ne<R.length;ne++){var oe=R[ne];(Z&&oe.isSelected||ee&&oe.isHovered)&&(oe.modelType===ModelType.LINE_EDGE?te.push(this.getLineOutline(oe)):oe.modelType===ModelType.POLYLINE_EDGE?te.push(this.getPolylineOutline(oe)):oe.modelType===ModelType.BEZIER_EDGE&&te.push(this.getBezierOutline(oe)))}return te},h.prototype.getLineOutline=function(E){var R=E.startPoint,Y=E.endPoint,Z=(R.x+Y.x)/2,ee=(R.y+Y.y)/2,te=Math.abs(R.x-Y.x)+10,ne=Math.abs(R.y-Y.y)+10,oe=E.getOutlineStyle();return u(Rect,__assign$r({className:"lf-outline-edge",x:Z,y:ee,width:te,height:ne},oe))},h.prototype.getPolylineOutline=function(E){var R=E.points,Y=points2PointsList(R),Z=getBBoxOfPoints(Y,8),ee=Z.x,te=Z.y,ne=Z.width,oe=Z.height,ie=E.getOutlineStyle();return u(Rect,__assign$r({className:"lf-outline",x:ee,y:te,width:ne,height:oe},ie))},h.prototype.getBezierOutline=function(E){var R=E.path,Y=getBezierPoints(R),Z=getBBoxOfPoints(Y,8),ee=Z.x,te=Z.y,ne=Z.width,oe=Z.height,ie=E.getOutlineStyle();return u(Rect,__assign$r({className:"lf-outline",x:ee,y:te,width:ne,height:oe},ie))},h.prototype.render=function(){return u("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},h=__decorate$b([observer],h),h}(x),__extends$n=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$q=function(){return __assign$q=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$q.apply(this,arguments)},__decorate$a=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},SnaplineOverlay=function(t){__extends$n(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.render=function(){var E=this.props.snaplineModel,R=E??{},Y=R.position,Z=R.isShowHorizontal,ee=R.isShowVertical,te=E==null?void 0:E.getStyle(),ne=Y??{},oe=ne.x,ie=oe===void 0?0:oe,ae=ne.y,se=ae===void 0?0:ae,ue=__assign$q(__assign$q({x1:-1e5,y1:se,x2:1e5,y2:se},te),{stroke:Z?te==null?void 0:te.stroke:"none"}),fe=__assign$q(__assign$q({x1:ie,y1:-1e5,x2:ie,y2:1e5},te),{stroke:ee?te==null?void 0:te.stroke:"none"});return u("g",{className:"lf-snapline",children:[u(Line,__assign$q({},ue)),u(Line,__assign$q({},fe))]})},h=__decorate$a([observer],h),h}(x),__extends$m=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$9=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},ToolOverlay=function(t){__extends$m(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.componentDidMount=function(){this.triggerToolRender()},h.prototype.componentDidUpdate=function(){this.triggerToolRender()},h.prototype.getTools=function(){var E=this.props,R=E.tool,Y=E.graphModel,Z=Y.textEditElement,ee=R.getTools(),te=ee.map(function(ne){return g$2(ne,{textEditElement:Z,graphModel:Y,lf:R.instance})});return R.components=te,te},h.prototype.triggerToolRender=function(){var E=this.props,R=E.tool,Y=E.graphModel,Z=document.querySelector("#ToolOverlay_".concat(Y.flowId)),ee=R.getInstance();ee.components.forEach(function(te){return te(ee,Z)}),ee.components=[]},h.prototype.render=function(){var E=this.props.graphModel;return u("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(E.flowId),children:this.getTools()})},h=__decorate$9([observer],h),h}(x),__assign$p=function(){return __assign$p=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$p.apply(this,arguments)},__decorate$8=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__values=function(t){var h=typeof Symbol=="function"&&Symbol.iterator,E=h&&t[h],R=0;if(E)return E.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&R>=t.length&&(t=void 0),{value:t&&t[R++],done:!t}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$e=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$4=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},GraphModel=function(){function t(h){var E=this;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=OverlapMode.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var R=h.container,Y=h.partial,Z=h.background,ee=Z===void 0?{}:Z,te=h.grid,ne=h.idGenerator,oe=h.edgeGenerator,ie=h.animation,ae=h.customTrajectory;this.rootEl=R,this.partial=!!Y,this.background=ee,typeof te=="object"&&(this.gridSize=te.size||1),this.theme=setupTheme(h.style),this.grid=Grid.getGridOptions(te??!1),this.edgeType=h.edgeType||"polyline",this.animation=setupAnimation(ie),this.overlapMode=h.overlapMode||OverlapMode.DEFAULT,this.width=h.width||this.rootEl.getBoundingClientRect().width,this.height=h.height||this.rootEl.getBoundingClientRect().height;var se=new ResizeObserver(debounce(function(ue){var fe,le;try{for(var de=__values(ue),ce=de.next();!ce.done;ce=de.next()){var pe=ce.value;pe.target===E.rootEl&&(E.resize(),E.eventCenter.emit("graph:resize",{target:E.rootEl,contentRect:pe.contentRect}))}}catch(he){fe={error:he}}finally{try{ce&&!ce.done&&(le=de.return)&&le.call(de)}finally{if(fe)throw fe.error}}},16));se.observe(this.rootEl),this.waitCleanEffects.push(function(){se.disconnect()}),this.eventCenter=new EventEmitter,this.editConfigModel=new EditConfigModel(h),this.transformModel=new TransformModel(this.eventCenter,h),this.flowId=createUuid(),this.idGenerator=ne,this.edgeGenerator=createEdgeGenerator(this,oe),this.customTrajectory=ae}return Object.defineProperty(t.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(h,E,R){return h[E.id]={index:R,model:E},h},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(h,E,R){return h[E.id]={index:R,model:E},h},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modelsMap",{get:function(){return __spreadArray$4(__spreadArray$4([],__read$e(this.nodes),!1),__read$e(this.edges),!1).reduce(function(h,E){return h[E.id]=E,h},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortElements",{get:function(){for(var h=__spreadArray$4(__spreadArray$4([],__read$e(this.nodes),!1),__read$e(this.edges),!1).sort(function(te,ne){return te.zIndex-ne.zIndex}),E=[],R=[-DEFAULT_VISIBLE_SPACE,-DEFAULT_VISIBLE_SPACE],Y=[this.width+DEFAULT_VISIBLE_SPACE,this.height+DEFAULT_VISIBLE_SPACE],Z=0;Z<h.length;Z++){var ee=h[Z];ee.visible&&(!this.partial||ee.isSelected||this.isElementInArea(ee,R,Y,!1,!1))&&E.push(ee)}return E},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textEditElement",{get:function(){var h=this.nodes.find(function(R){return R.state===ElementState.TEXT_EDIT}),E=this.edges.find(function(R){return R.state===ElementState.TEXT_EDIT});return h||E},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectElements",{get:function(){var h=new Map;return this.nodes.forEach(function(E){E.isSelected&&h.set(E.id,E)}),this.edges.forEach(function(E){E.isSelected&&h.set(E.id,E)}),h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectNodes",{get:function(){var h=[];return this.nodes.forEach(function(E){E.isSelected&&h.push(E)}),h},enumerable:!1,configurable:!0}),t.prototype.getAreaElement=function(h,E,R,Y,Z){var ee=this;R===void 0&&(R=!0),Y===void 0&&(Y=!0),Z===void 0&&(Z=!1);var te=[];return forEach$3(__spreadArray$4(__spreadArray$4([],__read$e(this.nodes),!1),__read$e(this.edges),!1),function(ne){var oe=ee.isElementInArea(ne,h,E,R,Y);(!Z||ne.visible)&&oe&&te.push(ne)}),te},t.prototype.getModel=function(h){return this.modelMap.get(h)},t.prototype.getNodeModelById=function(h){var E;return this.fakeNode&&h===this.fakeNode.id?this.fakeNode:(E=this.nodesMap[h])===null||E===void 0?void 0:E.model},t.prototype.getPointByClient=function(h){var E=h.x,R=h.y,Y=this.rootEl.getBoundingClientRect(),Z={x:E-Y.left,y:R-Y.top},ee=__read$e(this.transformModel.HtmlPointToCanvasPoint([Z.x,Z.y]),2),te=ee[0],ne=ee[1],oe={x:te,y:ne};return{domOverlayPosition:Z,canvasOverlayPosition:oe}},t.prototype.isElementInArea=function(h,E,R,Y,Z){var ee;if(Y===void 0&&(Y=!0),Z===void 0&&(Z=!0),h.BaseType===ElementType.NODE){h=h;for(var te=getNodeBBox(h),ne=te.minX,oe=te.minY,ie=te.maxX,ae=te.maxY,se=[{x:ne,y:oe},{x:ie,y:oe},{x:ie,y:ae},{x:ne,y:ae}],ue=Z,fe=0;fe<se.length;fe++){var le=se[fe],de=le.x,ce=le.y;if(ee=__read$e(this.transformModel.CanvasPointToHtmlPoint([de,ce]),2),de=ee[0],ce=ee[1],isPointInArea([de,ce],E,R)!==Z){ue=!Z;break}}return ue}if(h.BaseType===ElementType.EDGE){h=h;var pe=h.startPoint,he=h.endPoint,ge=this.transformModel.CanvasPointToHtmlPoint([pe.x,pe.y]),ve=this.transformModel.CanvasPointToHtmlPoint([he.x,he.y]),_e=isPointInArea(ge,E,R),ye=isPointInArea(ve,E,R);return Y?_e&&ye:_e||ye}return!1},t.prototype.graphDataToModel=function(h){var E=this;if((!this.width||!this.height)&&this.resize(),!h){this.nodes=[],this.edges=[];return}if(h.nodes?this.nodes=map(h.nodes,function(Y){return E.getModelAfterSnapToGrid(Y)}):this.nodes=[],h.edges){var R=this.edgeType;this.edges=map(h.edges,function(Y){var Z,ee=E.getModel((Z=Y.type)!==null&&Z!==void 0?Z:R);if(!ee)throw new Error("找不到".concat(Y.type,"对应的边。"));var te=new ee(Y,E),ne=te.sourceNodeId,oe=te.targetNodeId,ie=te.sourceAnchorId,ae=ie===void 0?"":ie,se=te.targetAnchorId,ue=se===void 0?"":se,fe=te.startPoint,le=te.endPoint,de=te.text,ce=te.textPosition,pe=function(Te,Pe,Re,De){var je=Te==null?void 0:Te.anchors.find(function(Fe){return Fe.id===Pe});je&&!isEqual(je,Re)&&De(je)},he=E.getNodeModelById(ne),ge=E.getNodeModelById(oe);if(pe(he,ae,fe,te.updateStartPoint.bind(te)),pe(ge,ue,le,te.updateEndPoint.bind(te)),de){var ve=de.x,_e=de.y,ye=ce.x,me=ce.y;if(ve&&_e&&ye&&me){var Ee=ve-ye,Oe=_e-me;te.resetTextPosition(),te.moveText(Ee,Oe)}}return E.edgeModelMap.set(te.id,te),E.elementsModelMap.set(te.id,te),te})}else this.edges=[]},t.prototype.modelToGraphData=function(){var h=[];this.edges.forEach(function(R){var Y=R.getData();Y&&!R.virtual&&h.push(Y)});var E=[];return this.nodes.forEach(function(R){var Y=R.getData();Y&&!R.virtual&&E.push(Y)}),{nodes:E,edges:h}},t.prototype.modelToHistoryData=function(){for(var h=!1,E=[],R=0;R<this.nodes.length;R++){var Y=this.nodes[R];if(Y.isDragging){h=!0;break}else E.push(Y.getHistoryData())}if(h)return!1;for(var Z=!1,ee=[],te=0;te<this.edges.length;te++){var ne=this.edges[te];if(ne.isDragging){Z=!0;break}else ee.push(ne.getHistoryData())}return Z?!1:{nodes:E,edges:ee}},t.prototype.getEdgeModelById=function(h){var E;return(E=this.edgesMap[h])===null||E===void 0?void 0:E.model},t.prototype.getElement=function(h){return this.modelsMap[h]},t.prototype.getNodeEdges=function(h){for(var E=[],R=0;R<this.edges.length;R++){var Y=this.edges[R],Z=Y.sourceNodeId===h,ee=Y.targetNodeId===h;(Z||ee)&&E.push(Y)}return E},t.prototype.getSelectElements=function(h){h===void 0&&(h=!0);var E=this.selectElements,R={nodes:[],edges:[]};return E.forEach(function(Y){if(Y.BaseType===ElementType.NODE&&R.nodes.push(Y.getData()),Y.BaseType===ElementType.EDGE){var Z=Y.getData(),ee=E.get(Z.sourceNodeId)&&E.get(Z.targetNodeId);(h||ee)&&R.edges.push(Z)}}),R},t.prototype.updateAttributes=function(h,E){var R=this.getElement(h);R==null||R.updateAttributes(E)},t.prototype.changeNodeId=function(h,E){return E||(E=createUuid()),this.nodesMap[E]?(console.warn("当前流程图已存在节点".concat(E,", 修改失败")),""):this.nodesMap[h]?(this.edges.forEach(function(R){R.sourceNodeId===h&&(R.sourceNodeId=E),R.targetNodeId===h&&(R.targetNodeId=E)}),this.nodesMap[h].model.id=E,this.nodesMap[E]=this.nodesMap[h],E):(console.warn("当前流程图找不到节点".concat(h,", 修改失败")),"")},t.prototype.changeEdgeId=function(h,E){return E||(E=createUuid()),this.edgesMap[E]?(console.warn("当前流程图已存在边: ".concat(E,", 修改失败")),""):this.edgesMap[h]?(this.edges.forEach(function(R){R.id===h&&R.changeEdgeId(E)}),E):(console.warn("当前流程图找不到边: ".concat(E,", 修改失败")),"")},t.prototype.getTextModel=function(h){var E=this.editConfigModel,R=E.textMode,Y=E.nodeTextMode,Z=E.edgeTextMode;if(h.BaseType===ElementType.NODE)return h.textMode||Y||R||TextMode.TEXT;if(h.BaseType===ElementType.EDGE)return h.textMode||Z||R||TextMode.TEXT},t.prototype.setTextMode=function(h,E){this.editConfigModel.updateEditConfig({textMode:h})},t.prototype.setFakeNode=function(h){this.fakeNode=h},t.prototype.removeFakeNode=function(){this.fakeNode=null},t.prototype.setModel=function(h,E){return this.modelMap.set(h,E)},t.prototype.toFront=function(h){var E,R,Y,Z=((E=this.nodesMap[h])===null||E===void 0?void 0:E.model)||((R=this.edgesMap[h])===null||R===void 0?void 0:R.model);Z&&(this.overlapMode===OverlapMode.DEFAULT&&((Y=this.topElement)===null||Y===void 0||Y.setZIndex(),Z.setZIndex(ELEMENT_MAX_Z_INDEX),this.topElement=Z),this.overlapMode===OverlapMode.INCREASE&&this.setElementZIndex(h,"top"))},t.prototype.setElementZIndex=function(h,E){var R,Y,Z=((R=this.nodesMap[h])===null||R===void 0?void 0:R.model)||((Y=this.edgesMap[h])===null||Y===void 0?void 0:Y.model);if(Z){var ee=void 0;typeof E=="number"?ee=E:(E==="top"&&(ee=getZIndex()),E==="bottom"&&(ee=getMinIndex())),Z.setZIndex(ee)}},t.prototype.deleteNode=function(h){var E=this.nodesMap[h].model,R=E.getData();this.deleteEdgeBySource(h),this.deleteEdgeByTarget(h),this.nodes.splice(this.nodesMap[h].index,1),this.eventCenter.emit(EventType.NODE_DELETE,{data:R,model:E})},t.prototype.addNode=function(h,E,R){E===void 0&&(E=EventType.NODE_ADD);var Y=formatData(h),Z=Y.id;Z&&this.nodesMap[Z]&&delete Y.id;var ee=this.getModelAfterSnapToGrid(Y);this.nodes.push(ee);var te=ee.getData(),ne={data:te};return R&&(ne.e=R),this.eventCenter.emit(E,ne),ee},t.prototype.getModelAfterSnapToGrid=function(h){var E=this.getModel(h.type);if(!E)throw new Error("找不到".concat(h.type,"对应的节点，请确认是否已注册此类型节点。"));var R=h.x,Y=h.y;R&&Y&&(h.x=snapToGrid(R,this.gridSize),h.y=snapToGrid(Y,this.gridSize),typeof h.text=="object"&&h.text!==null&&(h.text.x+=h.x-R,h.text.y+=h.y-Y));var Z=new E(h,this);return this.nodeModelMap.set(Z.id,Z),this.elementsModelMap.set(Z.id,Z),Z},t.prototype.cloneNode=function(h){var E=this.getNodeModelById(h),R=E==null?void 0:E.getData();if(R){R.x+=30,R.y+=30,R.id="",typeof R.text=="object"&&R.text!==null&&(R.text.x+=30,R.text.y+=30);var Y=this.addNode(R);return Y.setSelected(!0),E==null||E.setSelected(!1),Y.getData()}},t.prototype.moveNode=function(h,E,R,Y){var Z;Y===void 0&&(Y=!1);var ee=this.nodesMap[h];if(!ee){console.warn("不存在id为".concat(h,"的节点"));return}var te=ee.model;Z=__read$e(te.getMoveDistance(E,R,Y),2),E=Z[0],R=Z[1],this.moveEdge(h,E,R)},t.prototype.moveNode2Coordinate=function(h,E,R,Y){Y===void 0&&(Y=!1);var Z=this.nodesMap[h];if(!Z){console.warn("不存在id为".concat(h,"的节点"));return}var ee=Z.model,te=ee.x,ne=ee.y,oe=E-te,ie=R-ne;this.moveNode(h,oe,ie,Y)},t.prototype.editText=function(h){this.setElementStateById(h,ElementState.TEXT_EDIT)},t.prototype.addEdge=function(h){var E=formatData(h),R=E.type;R||(R=this.edgeType),E.id&&this.edgesMap[E.id]&&delete E.id;var Y=this.getModel(R);if(!Y)throw new Error("找不到".concat(R,"对应的边，请确认是否已注册此类型边。"));var Z=new Y(__assign$p(__assign$p({},E),{type:R}),this);this.edgeModelMap.set(Z.id,Z),this.elementsModelMap.set(Z.id,Z);var ee=Z.getData();return this.edges.push(Z),this.eventCenter.emit(EventType.EDGE_ADD,{data:ee}),Z},t.prototype.moveEdge=function(h,E,R){for(var Y=0;Y<this.edges.length;Y++){var Z=this.edges[Y],ee=Z.textPosition,te=ee.x,ne=ee.y,oe=this.edges[Y].sourceNodeId===h,ie=this.edges[Y].targetNodeId===h;oe&&Z.moveStartPoint(E,R),ie&&Z.moveEndPoint(E,R),(oe||ie)&&this.handleEdgeTextMove(Z,te,ne)}},t.prototype.handleEdgeTextMove=function(h,E,R){var Y;if(h.customTextPosition){h.resetTextPosition();return}if(h.modelType===ModelType.POLYLINE_EDGE&&(!((Y=h.text)===null||Y===void 0)&&Y.value)){var Z=h.text,ee=getClosestPointOfPolyline(Z,h.points);h.moveText(ee.x-Z.x,ee.y-Z.y)}var te=h.textPosition,ne=te.x,oe=te.y;h.moveText(ne-E,oe-R)},t.prototype.deleteEdgeBySourceAndTarget=function(h,E){for(var R=0;R<this.edges.length;R++)if(this.edges[R].sourceNodeId===h&&this.edges[R].targetNodeId===E){var Y=this.edges[R].getData();this.edges.splice(R,1),R--,this.eventCenter.emit(EventType.EDGE_DELETE,{data:Y})}},t.prototype.deleteEdgeById=function(h){var E=this.edgesMap[h];if(E){var R=this.edgesMap[h].index,Y=this.edgesMap[h].model.getData();this.edges.splice(R,1),this.eventCenter.emit(EventType.EDGE_DELETE,{data:Y})}},t.prototype.deleteEdgeBySource=function(h){for(var E=0;E<this.edges.length;E++)if(this.edges[E].sourceNodeId===h){var R=this.edges[E].getData();this.edges.splice(E,1),E--,this.eventCenter.emit(EventType.EDGE_DELETE,{data:R})}},t.prototype.deleteEdgeByTarget=function(h){for(var E=0;E<this.edges.length;E++)if(this.edges[E].targetNodeId===h){var R=this.edges[E].getData();this.edges.splice(E,1),E--,this.eventCenter.emit(EventType.EDGE_DELETE,{data:R})}},t.prototype.setElementStateById=function(h,E,R){this.nodes.forEach(function(Y){Y.id===h?Y.setElementState(E,R):Y.setElementState(ElementState.DEFAULT)}),this.edges.forEach(function(Y){Y.id===h?Y.setElementState(E,R):Y.setElementState(ElementState.DEFAULT)})},t.prototype.updateText=function(h,E){var R=find(__spreadArray$4(__spreadArray$4([],__read$e(this.nodes),!1),__read$e(this.edges),!1),function(Y){return Y.id===h});R==null||R.updateText(E)},t.prototype.selectNodeById=function(h,E){var R;E===void 0&&(E=!1),E||this.clearSelectElements();var Y=(R=this.nodesMap[h])===null||R===void 0?void 0:R.model;Y==null||Y.setSelected(!0)},t.prototype.selectEdgeById=function(h,E){var R;E===void 0&&(E=!1),E||this.clearSelectElements();var Y=(R=this.edgesMap[h])===null||R===void 0?void 0:R.model;Y==null||Y.setSelected(!0)},t.prototype.selectElementById=function(h,E){E===void 0&&(E=!1),E||this.clearSelectElements();var R=this.getElement(h);R==null||R.setSelected(!0)},t.prototype.clearSelectElements=function(){var h;this.selectElements.forEach(function(E){E==null||E.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===OverlapMode.DEFAULT&&((h=this.topElement)===null||h===void 0||h.setZIndex())},t.prototype.moveNodes=function(h,E,R,Y){var Z,ee,te,ne=this;Y===void 0&&(Y=!1);for(var oe=h.reduce(function(he,ge){var ve,_e=(ve=ne.nodesMap[ge])===null||ve===void 0?void 0:ve.model;return _e&&(he[ge]=_e.getMoveDistance(E,R,Y)),he},{}),ie=0;ie<this.edges.length;ie++){var ae=this.edges[ie],se=ae.textPosition,ue=se.x,fe=se.y,le=oe[ae.sourceNodeId],de=oe[ae.targetNodeId],ce=void 0,pe=void 0;le&&de&&ae.modelType===ModelType.POLYLINE_EDGE?(Z=__read$e(le,2),ce=Z[0],pe=Z[1],ae.updatePointsList(ce,pe)):(le&&(ee=__read$e(le,2),ce=ee[0],pe=ee[1],ae.moveStartPoint(ce,pe)),de&&(te=__read$e(de,2),ce=te[0],pe=te[1],ae.moveEndPoint(ce,pe))),(le||de)&&this.handleEdgeTextMove(ae,ue,fe)}},t.prototype.addNodeMoveRules=function(h){this.nodeMoveRules.includes(h)||this.nodeMoveRules.push(h)},t.prototype.addNodeResizeRules=function(h){this.nodeResizeRules.includes(h)||this.nodeResizeRules.push(h)},t.prototype.setDefaultEdgeType=function(h){this.edgeType=h},t.prototype.changeNodeType=function(h,E){var R=this.getNodeModelById(h);if(!R){console.warn("找不到id为".concat(h,"的节点"));return}var Y=R.getData();Y.type=E;var Z=this.getModel(E);if(!Z)throw new Error("找不到".concat(E,"对应的节点，请确认是否已注册此类型节点。"));var ee=new Z(Y,this);this.nodes.splice(this.nodesMap[h].index,1,ee);var te=this.getNodeEdges(h);te.forEach(function(ne){if(ne.sourceNodeId===h){var oe=getNodeAnchorPosition(ee,ne.startPoint,ee.width,ee.height);ne.updateStartPoint(oe)}if(ne.targetNodeId===h){var oe=getNodeAnchorPosition(ee,ne.endPoint,ee.width,ee.height);ne.updateEndPoint(oe)}})},t.prototype.changeEdgeType=function(h,E){var R=this.getEdgeModelById(h);if(!R){console.warn("找不到id为".concat(h,"的边"));return}if(R.type!==E){var Y=R.getData();Y.type=E;var Z=this.getModel(E);if(!Z)throw new Error("找不到".concat(E,"对应的节点，请确认是否已注册此类型节点。"));delete Y.pointsList;var ee=new Z(Y,this);this.edges.splice(this.edgesMap[h].index,1,ee)}},t.prototype.getNodeIncomingEdge=function(h){var E=[];return this.edges.forEach(function(R){R.targetNodeId===h&&E.push(R)}),E},t.prototype.getNodeOutgoingEdge=function(h){var E=[];return this.edges.forEach(function(R){R.sourceNodeId===h&&E.push(R)}),E},t.prototype.getAnchorIncomingEdge=function(h){var E=[];return this.edges.forEach(function(R){R.targetAnchorId===h&&E.push(R)}),E},t.prototype.getAnchorOutgoingEdge=function(h){var E=[];return this.edges.forEach(function(R){R.sourceAnchorId===h&&E.push(R)}),E},t.prototype.getNodeIncomingNode=function(h){var E=this,R=[];return this.edges.forEach(function(Y){var Z;Y.targetNodeId===h&&R.push((Z=E.nodesMap[Y.sourceNodeId])===null||Z===void 0?void 0:Z.model)}),R},t.prototype.getNodeOutgoingNode=function(h){var E=this,R=[];return this.edges.forEach(function(Y){Y.sourceNodeId===h&&R.push(E.nodesMap[Y.targetNodeId].model)}),R},t.prototype.setTheme=function(h){this.theme=updateTheme(__assign$p(__assign$p({},this.theme),h))},t.prototype.updateGridOptions=function(h){merge$1(this.grid,h)},t.prototype.updateBackgroundOptions=function(h){isBoolean$1(h)||isBoolean$1(this.background)?this.background=h:this.background=__assign$p(__assign$p({},this.background),h)},t.prototype.resize=function(h,E){this.width=h||this.rootEl.getBoundingClientRect().width,this.height=E||this.rootEl.getBoundingClientRect().height,(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},t.prototype.clearData=function(){this.nodes=[],this.edges=[]},t.prototype.getVirtualRectSize=function(){var h=this.nodes,E=[],R=[];h.forEach(function(se){var ue=se.x,fe=se.y,le=se.width,de=se.height,ce=se.getNodeStyle().strokeWidth,pe=ce===void 0?0:ce,he=ue+le/2+pe,ge=ue-le/2-pe,ve=fe+de/2+pe,_e=fe-de/2-pe;E=E.concat([he,ge].filter(function(ye){return!Number.isNaN(ye)})),R=R.concat([ve,_e].filter(function(ye){return!Number.isNaN(ye)}))});var Y=Math.min.apply(Math,__spreadArray$4([],__read$e(E),!1)),Z=Math.max.apply(Math,__spreadArray$4([],__read$e(E),!1)),ee=Math.min.apply(Math,__spreadArray$4([],__read$e(R),!1)),te=Math.max.apply(Math,__spreadArray$4([],__read$e(R),!1)),ne=Z-Y||0,oe=te-ee||0,ie=Y+ne/2,ae=ee+oe/2;return{width:ne,height:oe,x:ie,y:ae}},t.prototype.translateCenter=function(){var h=this,E=h.nodes,R=h.width,Y=h.height,Z=h.rootEl,ee=h.transformModel;if(E.length){var te=R||Z.clientWidth,ne=Y||Z.clientHeight,oe=this.getVirtualRectSize(),ie=oe.x,ae=oe.y;ee.focusOn(ie,ae,te,ne)}},t.prototype.fitView=function(h,E){h===void 0&&(h=20),E===void 0&&(E=20);var R=this,Y=R.nodes,Z=R.width,ee=R.height,te=R.rootEl,ne=R.transformModel;if(Y.length){var oe=Z||te.clientWidth,ie=ee||te.clientHeight,ae=this.getVirtualRectSize(),se=ae.width,ue=ae.height,fe=ae.x,le=ae.y,de=(se+E)/oe,ce=(ue+h)/ie,pe=1/Math.max(de,ce),he=[oe/2,ie/2];ne.zoom(pe,he),ne.focusOn(fe,le,oe,ie)}},t.prototype.openEdgeAnimation=function(h){var E=this.getEdgeModelById(h);E==null||E.openEdgeAnimation()},t.prototype.closeEdgeAnimation=function(h){var E=this.getEdgeModelById(h);E==null||E.closeEdgeAnimation()},t.prototype.getPartial=function(){return this.partial},t.prototype.setPartial=function(h){this.partial=h},t.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(h){h()})}catch(h){console.warn("error on destroy GraphModel",h)}this.waitCleanEffects.length=0},__decorate$8([observable$1],t.prototype,"width",void 0),__decorate$8([observable$1],t.prototype,"height",void 0),__decorate$8([observable$1],t.prototype,"grid",void 0),__decorate$8([observable$1],t.prototype,"edgeType",void 0),__decorate$8([observable$1],t.prototype,"nodes",void 0),__decorate$8([observable$1],t.prototype,"edges",void 0),__decorate$8([observable$1],t.prototype,"fakeNode",void 0),__decorate$8([observable$1],t.prototype,"overlapMode",void 0),__decorate$8([observable$1],t.prototype,"background",void 0),__decorate$8([observable$1],t.prototype,"gridSize",void 0),__decorate$8([observable$1],t.prototype,"transformModel",void 0),__decorate$8([observable$1],t.prototype,"editConfigModel",void 0),__decorate$8([observable$1],t.prototype,"partial",void 0),__decorate$8([computed],t.prototype,"nodesMap",null),__decorate$8([computed],t.prototype,"edgesMap",null),__decorate$8([computed],t.prototype,"modelsMap",null),__decorate$8([computed],t.prototype,"sortElements",null),__decorate$8([computed],t.prototype,"textEditElement",null),__decorate$8([computed],t.prototype,"selectElements",null),__decorate$8([computed],t.prototype,"selectNodes",null),__decorate$8([action],t.prototype,"setTextMode",null),__decorate$8([action],t.prototype,"setFakeNode",null),__decorate$8([action],t.prototype,"removeFakeNode",null),__decorate$8([action],t.prototype,"setModel",null),__decorate$8([action],t.prototype,"toFront",null),__decorate$8([action],t.prototype,"setElementZIndex",null),__decorate$8([action],t.prototype,"deleteNode",null),__decorate$8([action],t.prototype,"addNode",null),__decorate$8([action],t.prototype,"cloneNode",null),__decorate$8([action],t.prototype,"moveNode",null),__decorate$8([action],t.prototype,"moveNode2Coordinate",null),__decorate$8([action],t.prototype,"editText",null),__decorate$8([action],t.prototype,"addEdge",null),__decorate$8([action],t.prototype,"moveEdge",null),__decorate$8([action],t.prototype,"deleteEdgeBySourceAndTarget",null),__decorate$8([action],t.prototype,"deleteEdgeById",null),__decorate$8([action],t.prototype,"deleteEdgeBySource",null),__decorate$8([action],t.prototype,"deleteEdgeByTarget",null),__decorate$8([action],t.prototype,"setElementStateById",null),__decorate$8([action],t.prototype,"updateText",null),__decorate$8([action],t.prototype,"selectNodeById",null),__decorate$8([action],t.prototype,"selectEdgeById",null),__decorate$8([action],t.prototype,"selectElementById",null),__decorate$8([action],t.prototype,"clearSelectElements",null),__decorate$8([action],t.prototype,"moveNodes",null),__decorate$8([action],t.prototype,"setDefaultEdgeType",null),__decorate$8([action],t.prototype,"changeNodeType",null),__decorate$8([action],t.prototype,"changeEdgeType",null),__decorate$8([action],t.prototype,"getNodeIncomingEdge",null),__decorate$8([action],t.prototype,"getNodeOutgoingEdge",null),__decorate$8([action],t.prototype,"getAnchorIncomingEdge",null),__decorate$8([action],t.prototype,"getAnchorOutgoingEdge",null),__decorate$8([action],t.prototype,"getNodeIncomingNode",null),__decorate$8([action],t.prototype,"getNodeOutgoingNode",null),__decorate$8([action],t.prototype,"setTheme",null),__decorate$8([action],t.prototype,"resize",null),__decorate$8([action],t.prototype,"clearData",null),__decorate$8([action],t.prototype,"translateCenter",null),__decorate$8([action],t.prototype,"fitView",null),__decorate$8([action],t.prototype,"openEdgeAnimation",null),__decorate$8([action],t.prototype,"closeEdgeAnimation",null),__decorate$8([action],t.prototype,"setPartial",null),t}(),__assign$o=function(){return __assign$o=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$o.apply(this,arguments)},__decorate$7=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},SnaplineModel=function(){function t(h){this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=h}return t.prototype.getStyle=function(){return __assign$o({},this.graphModel.theme.snapline)},t.prototype.getCenterSnapLine=function(h,E){for(var R=h.x,Y=h.y,Z=!1,ee=!1,te=0;te<E.length;te++){var ne=E[te];if(ne.id!==h.id&&(R===ne.x&&(Z=!0),Y===ne.y&&(ee=!0),Z&&ee))break}return{isShowVertical:Z,isShowHorizontal:ee,position:{x:R,y:Y}}},t.prototype.getHorizontalSnapline=function(h,E){var R=!1,Y=0,Z=h.id,ee;if(Z){var te=this.graphModel.fakeNode;if(te&&te.id===Z)ee=getNodeBBox(te);else{var ne=this.graphModel.getNodeModelById(Z);ne&&(ee=getNodeBBox(ne))}}for(var oe=0;oe<E.length;oe++){var ie=E[oe];if(ie.id!==h.id){var ae=getNodeBBox(ie);if(ae.minY===(ee==null?void 0:ee.minY)||ae.maxY===(ee==null?void 0:ee.minY)){R=!0,Y=ee.minY;break}if(ae.minY===(ee==null?void 0:ee.maxY)||ae.maxY===(ee==null?void 0:ee.maxY)){R=!0,Y=ee.maxY;break}}}return{isShowHorizontal:R,isShowVertical:this.isShowVertical,position:__assign$o(__assign$o({},this.position),{y:Y})}},t.prototype.getVerticalSnapline=function(h,E){var R=!1,Y=0,Z=h.id,ee;if(Z){var te=this.graphModel.fakeNode;if(te&&te.id===Z)ee=getNodeBBox(te);else{var ne=this.graphModel.getNodeModelById(Z);ne&&(ee=getNodeBBox(ne))}}for(var oe=0;oe<E.length;oe++){var ie=E[oe];if(ie.id!==h.id){var ae=getNodeBBox(ie);if(ae.minX===(ee==null?void 0:ee.minX)||ae.maxX===(ee==null?void 0:ee.minX)){R=!0,Y=ee.minX;break}if(ae.minX===(ee==null?void 0:ee.maxX)||ae.maxX===(ee==null?void 0:ee.maxX)){R=!0,Y=ee.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:R,position:__assign$o(__assign$o({},this.position),{x:Y})}},t.prototype.getSnapLinePosition=function(h,E){var R=this.getCenterSnapLine(h,E),Y=R.isShowHorizontal,Z=R.isShowVertical;if(!Y){var ee=this.getHorizontalSnapline(h,E);ee.isShowHorizontal&&(R.isShowHorizontal=ee.isShowHorizontal,R.position.y=ee.position.y)}if(!Z){var te=this.getVerticalSnapline(h,E);te.isShowVertical&&(R.isShowVertical=te.isShowVertical,R.position.x=te.position.x)}return R},t.prototype.setSnaplineInfo=function(h){var E=h.isShowHorizontal,R=h.isShowVertical,Y=h.position;this.position=Y,this.isShowHorizontal=E,this.isShowVertical=R},t.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},t.prototype.setNodeSnapLine=function(h){var E=this.graphModel.nodes,R=this.getSnapLinePosition(h,E);this.setSnaplineInfo(R)},__decorate$7([observable$1],t.prototype,"isShowHorizontal",void 0),__decorate$7([observable$1],t.prototype,"isShowVertical",void 0),__decorate$7([observable$1],t.prototype,"position",void 0),__decorate$7([action],t.prototype,"clearSnapline",null),__decorate$7([action],t.prototype,"setNodeSnapLine",null),t}(),__decorate$6=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$d=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},translateLimitsMap={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},TransformModel=function(){function t(h,E){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=h;var R=E.stopMoveGraph,Y=R===void 0?!1:R;this.updateTranslateLimits(Y)}return t.prototype.setZoomMiniSize=function(h){this.MINI_SCALE_SIZE=h},t.prototype.setZoomMaxSize=function(h){this.MAX_SCALE_SIZE=h},t.prototype.HtmlPointToCanvasPoint=function(h){var E=__read$d(h,2),R=E[0],Y=E[1];return[(R-this.TRANSLATE_X)/this.SCALE_X,(Y-this.TRANSLATE_Y)/this.SCALE_Y]},t.prototype.CanvasPointToHtmlPoint=function(h){var E=__read$d(h,2),R=E[0],Y=E[1];return[R*this.SCALE_X+this.TRANSLATE_X,Y*this.SCALE_Y+this.TRANSLATE_Y]},t.prototype.moveCanvasPointByHtml=function(h,E,R){var Y=__read$d(h,2),Z=Y[0],ee=Y[1];return[Z+E/this.SCALE_X,ee+R/this.SCALE_Y]},t.prototype.fixDeltaXY=function(h,E){return[h/this.SCALE_X,E/this.SCALE_Y]},t.prototype.getTransformStyle=function(){var h=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(h,")")}},t.prototype.zoom=function(h,E){h===void 0&&(h=!1);var R=this.SCALE_X,Y=this.SCALE_Y;return typeof h=="number"?(R=h,Y=h):h?(R+=this.ZOOM_SIZE,Y+=this.ZOOM_SIZE):(R-=this.ZOOM_SIZE,Y-=this.ZOOM_SIZE),R<this.MINI_SCALE_SIZE||R>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(E&&(this.TRANSLATE_X-=(R-this.SCALE_X)*E[0],this.TRANSLATE_Y-=(Y-this.SCALE_Y)*E[1]),this.SCALE_X=R,this.SCALE_Y=Y,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},t.prototype.emitGraphTransform=function(h){this.eventCenter.emit(EventType.GRAPH_TRANSFORM,{type:h,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},t.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},t.prototype.translate=function(h,E){this.TRANSLATE_X+h<=this.translateLimitMaxX&&this.TRANSLATE_X+h>=this.translateLimitMinX&&(this.TRANSLATE_X+=h),this.TRANSLATE_Y+E<=this.translateLimitMaxY&&this.TRANSLATE_Y+E>=this.translateLimitMinY&&(this.TRANSLATE_Y+=E),this.emitGraphTransform("translate")},t.prototype.focusOn=function(h,E,R,Y){var Z=__read$d(this.CanvasPointToHtmlPoint([h,E]),2),ee=Z[0],te=Z[1],ne=__read$d([R/2-ee,Y/2-te],2),oe=ne[0],ie=ne[1];this.TRANSLATE_X+=oe,this.TRANSLATE_Y+=ie,this.emitGraphTransform("focusOn")},t.prototype.updateTranslateLimits=function(h){var E;E=__read$d(Array.isArray(h)&&h.length===4?h:translateLimitsMap[h.toString()],4),this.translateLimitMinX=E[0],this.translateLimitMinY=E[1],this.translateLimitMaxX=E[2],this.translateLimitMaxY=E[3]},__decorate$6([observable$1],t.prototype,"SCALE_X",void 0),__decorate$6([observable$1],t.prototype,"SKEW_Y",void 0),__decorate$6([observable$1],t.prototype,"SKEW_X",void 0),__decorate$6([observable$1],t.prototype,"SCALE_Y",void 0),__decorate$6([observable$1],t.prototype,"TRANSLATE_X",void 0),__decorate$6([observable$1],t.prototype,"TRANSLATE_Y",void 0),__decorate$6([observable$1],t.prototype,"ZOOM_SIZE",void 0),__decorate$6([action],t.prototype,"zoom",null),__decorate$6([action],t.prototype,"resetZoom",null),__decorate$6([action],t.prototype,"translate",null),__decorate$6([action],t.prototype,"focusOn",null),t}(),__extends$l=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$5=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$c=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$3=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},Graph=function(t){__extends$l(h,t);function h(){var E=t.apply(this,__spreadArray$3([],__read$c(arguments),!1))||this;return E.handleResize=function(){E.props.graphModel.resize()},E.throttleResize=function(){return throttle$1(E.handleResize,200)},E}return h.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},h.prototype.componentDidUpdate=function(){var E=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(EventType.GRAPH_UPDATED,{data:E})},h.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},h.prototype.getComponent=function(E,R,Y){Y===void 0&&(Y="canvas-overlay");var Z=this.props.getView,ee=Z(E.type);return ee?u(ee,{model:E,graphModel:R,overlay:Y},E.id):null},h.prototype.render=function(){var E=this,R=this.props,Y=R.graphModel,Z=R.tool,ee=R.options,te=R.dnd,ne=R.snaplineModel,oe={};ee.width&&(oe.width="".concat(Y.width,"px")),ee.height&&(oe.height="".concat(Y.height,"px"));var ie=Y.fakeNode,ae=Y.editConfigModel,se=Y.background,ue=ae.adjustEdge;return u("div",{className:"lf-graph","flow-id":Y.flowId,style:oe,children:[u(CanvasOverlay,{graphModel:Y,dnd:te,children:[u("g",{className:"lf-base",children:map(Y.sortElements,function(fe){return E.getComponent(fe,Y)})}),ie?this.getComponent(ie,Y):""]}),u(ModificationOverlay,{graphModel:Y,children:[u(OutlineOverlay,{graphModel:Y}),ue?u(BezierAdjustOverlay,{graphModel:Y}):"",ee.snapline!==!1?u(SnaplineOverlay,{snaplineModel:ne}):""]}),u(ToolOverlay,{graphModel:Y,tool:Z}),se&&u(BackgroundOverlay,{background:se}),u(Grid,{graphModel:Y})]})},h=__decorate$5([observer],h),h}(x),__extends$k=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$n=function(){return __assign$n=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$n.apply(this,arguments)},__read$b=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},Anchor=function(t){__extends$k(h,t);function h(){var E=t.call(this)||this;return E.onDragStart=function(R){var Y=R.event,Z=E.props,ee=Z.anchorData,te=Z.nodeModel,ne=Z.graphModel;ne.selectNodeById(te.id),te.autoToFront&&ne.toFront(te.id),ne.eventCenter.emit(EventType.ANCHOR_DRAGSTART,{data:ee,e:Y,nodeModel:te}),E.setState({startX:ee.x,startY:ee.y,endX:ee.x,endY:ee.y})},E.onDragging=function(R){var Y=R.event,Z=E.props,ee=Z.graphModel,te=Z.nodeModel,ne=Z.anchorData,oe=ee.transformModel,ie=ee.eventCenter,ae=ee.width,se=ee.height,ue=ee.editConfigModel,fe=ue.autoExpand,le=ue.stopMoveGraph;if(Y){var de=Y.clientX,ce=Y.clientY,pe=ee.getPointByClient({x:de,y:ce}),he=pe.domOverlayPosition,ge=he.x,ve=he.y,_e=pe.canvasOverlayPosition,ye=_e.x,me=_e.y;E.t&&cancelRaf(E.t);var Ee=[],Oe=10;ge<10?Ee=[Oe,0]:ge+10>ae?Ee=[-Oe,0]:ve<10?Ee=[0,Oe]:ve+10>se&&(Ee=[0,-Oe]),E.setState({endX:ye,endY:me,dragging:!0}),E.moveAnchorEnd(ye,me),Ee.length>0&&!le&&fe&&(E.t=createRaf(function(){var Te=__read$b(Ee,2),Pe=Te[0],Re=Te[1];oe.translate(Pe,Re);var De=E.state,je=De.endX,Fe=De.endY;E.setState({endX:je-Pe,endY:Fe-Re}),E.moveAnchorEnd(je-Pe,Fe-Re)})),ie.emit(EventType.ANCHOR_DRAG,{data:ne,e:Y,nodeModel:te})}},E.onDragEnd=function(R){var Y=R.event;E.t&&cancelRaf(E.t);var Z=E.checkEnd(Y);E.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),E.sourceRuleResults.clear(),E.targetRuleResults.clear();var ee=E.props,te=ee.graphModel,ne=ee.nodeModel,oe=ee.anchorData;te.eventCenter.emit(EventType.ANCHOR_DRAGEND,{data:oe,e:Y,nodeModel:ne,edgeModel:Z??void 0})},E.checkEnd=function(R){var Y,Z=E.props,ee=Z.graphModel,te=Z.nodeModel,ne=Z.anchorData,oe=ne.x,ie=ne.y,ae=ne.id,se=E.state,ue=se.endX,fe=se.endY,le=se.dragging,de=targetNodeInfo({x:ue,y:fe},ee);if(E.preTargetNode&&E.preTargetNode.state!==ElementState.DEFAULT&&E.preTargetNode.setElementState(ElementState.DEFAULT),!!le&&de&&de.node){var ce=de.node,pe=de.anchor.id,he="".concat(te.id,"_").concat(ce.id,"_").concat(pe,"_").concat(ae),ge=E.sourceRuleResults.get(he)||{},ve=ge.isAllPass,_e=ge.msg,ye=E.targetRuleResults.get(he)||{},me=ye.isAllPass,Ee=ye.msg;if(ve&&me){ce.setElementState(ElementState.DEFAULT);var Oe=ee.getNodeModelById(de.node.id),Te=(Y=ee.edgeGenerator)===null||Y===void 0?void 0:Y.call(ee,te.getData(),Oe==null?void 0:Oe.getData()),Pe=ee.addEdge(__assign$n(__assign$n({},Te),{sourceNodeId:te.id,sourceAnchorId:ae,startPoint:{x:oe,y:ie},targetNodeId:de.node.id,targetAnchorId:de.anchor.id,endPoint:{x:de.anchor.x,y:de.anchor.y}})),Re=E.props.anchorData;return ee.eventCenter.emit(EventType.ANCHOR_DROP,{data:Re,e:R,nodeModel:te,edgeModel:Pe}),Pe}var De=ce.getData();return ee.eventCenter.emit(EventType.CONNECTION_NOT_ALLOWED,{data:De,msg:Ee||_e||"不允许添加连线"}),null}},E.sourceRuleResults=new Map,E.targetRuleResults=new Map,E.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},E.dragHandler=new StepDrag({onDragStart:E.onDragStart,onDragging:E.onDragging,onDragEnd:E.onDragEnd}),E}return h.prototype.getAnchorShape=function(){var E=this.props,R=E.anchorData,Y=E.style,Z=E.node,ee=Z.getAnchorShape(R);if(ee)return ee;var te=R.x,ne=R.y,oe=__assign$n(__assign$n({},Y),Y==null?void 0:Y.hover);return u("g",{children:[u(Circle,__assign$n({className:"lf-node-anchor-hover"},oe,{x:te,y:ne})),u(Circle,__assign$n({className:"lf-node-anchor"},Y,{x:te,y:ne}))]})},Object.defineProperty(h.prototype,"customTrajectory",{get:function(){var E=this.props.graphModel.customTrajectory;return E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"relateEdges",{get:function(){var E=this.props,R=E.graphModel,Y=R.getAnchorIncomingEdge,Z=R.getAnchorOutgoingEdge,ee=E.anchorData.id;return{incomingEdgeList:Y(ee),outgoingEdgeList:Z(ee)}},enumerable:!1,configurable:!0}),h.prototype.moveAnchorEnd=function(E,R){var Y,Z,ee=this.props,te=ee.graphModel,ne=ee.nodeModel,oe=ee.anchorData,ie=targetNodeInfo({x:E,y:R},te);if(ie){var ae=ie.node,se=ie.anchor.id;if(this.preTargetNode&&this.preTargetNode!==ie.node&&this.preTargetNode.setElementState(ElementState.DEFAULT),oe.id===se)return;this.preTargetNode=ae;var ue="".concat(ne.id,"_").concat(ae.id,"_").concat(se,"_").concat(oe.id);if(!this.targetRuleResults.has(ue)){var fe=ie.anchor,le=ne.isAllowConnectedAsSource(ae,oe,fe),de=ae.isAllowConnectedAsTarget(ne,oe,fe);this.sourceRuleResults.set(ue,formatAnchorConnectValidateData(le)),this.targetRuleResults.set(ue,formatAnchorConnectValidateData(de))}var ce=((Y=this.sourceRuleResults.get(ue))!==null&&Y!==void 0?Y:{}).isAllPass,pe=((Z=this.targetRuleResults.get(ue))!==null&&Z!==void 0?Z:{}).isAllPass;ce&&pe?ae.setElementState(ElementState.ALLOW_CONNECT):ae.setElementState(ElementState.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==ElementState.DEFAULT&&this.preTargetNode.setElementState(ElementState.DEFAULT)},h.prototype.isShowLine=function(){var E=this.state,R=E.startX,Y=E.startY,Z=E.endX,ee=E.endY,te=distance(R,Y,Z,ee);return te>10},h.prototype.render=function(){var E=this,R=this.state,Y=R.startX,Z=R.startY,ee=R.endX,te=R.endY,ne=this.props,oe=ne.anchorData.edgeAddable,ie=ne.edgeStyle;return u("g",{className:"lf-anchor",children:[u("g",{onMouseDown:function(ae){oe!==!1&&E.dragHandler.handleMouseDown(ae)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(__assign$n({sourcePoint:{x:Y,y:Z},targetPoint:{x:ee,y:te}},ie)):u(Line,__assign$n({x1:Y,y1:Z,x2:ee,y2:te},ie,{"pointer-events":"none"})))]})},h}(x),__extends$j=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$m=function(){return __assign$m=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$m.apply(this,arguments)},RotateControlPoint=function(t){__extends$j(h,t);function h(E){var R=t.call(this,E)||this;return R.style={},R.onDragging=function(Y){var Z,ee=Y.event,te=R.props,ne=te.graphModel,oe=te.nodeModel,ie=te.eventCenter,ae=ne.selectNodes,se=oe.x,ue=oe.y,fe=ee.clientX,le=ee.clientY,de=ne.getPointByClient({x:fe,y:le}).canvasOverlayPosition,ce=de.x,pe=de.y,he=new Vector(ce-se,pe-ue),ge=((Z=R.normal)===null||Z===void 0?void 0:Z.angle(he))-R.defaultAngle,ve=new TranslateMatrix(-se,-ue).rotate(ge).translate(se,ue).toString();oe.transform=ve,oe.rotate=ge;var _e=map(ae,function(me){return me.id});_e.indexOf(oe.id)===-1&&(_e=[oe.id]);var ye=reduce(_e,function(me,Ee){var Oe=ne.getNodeModelById(Ee);return me[Ee]=Oe==null?void 0:Oe.getMoveDistance(0,0,!1),me},{});_e.forEach(function(me){var Ee=ne.getNodeEdges(me);Ee.forEach(function(Oe){if(ye[Oe.sourceNodeId]){var Te=ne.getNodeModelById(Oe.sourceNodeId),Pe=Te.anchors.find(function(Re){return Re.id===Oe.sourceAnchorId});Oe.updateStartPoint(Pe)}if(ye[Oe.targetNodeId]){var Te=ne.getNodeModelById(Oe.targetNodeId),Pe=Te.anchors.find(function(je){return je.id===Oe.targetAnchorId});Oe.updateEndPoint(Pe)}})}),ie.emit(EventType.NODE_ROTATE,{e:ee,model:oe,data:oe.getData()})},R.style=E.style,R.stepperDrag=new StepDrag({onDragging:R.onDragging}),R}return h.prototype.render=function(){var E=this,R=this.props.nodeModel,Y=R.x,Z=R.y,ee=R.width,te=R.height,ne=Y+ee/2+20,oe=Z-te/2-20;return this.normal=new Vector(1,0),this.defaultAngle=this.normal.angle(new Vector(ne-Y,oe-Z)),R.defaultAngle=this.defaultAngle,u("g",{className:"lf-rotate-control",children:u("g",{onMouseDown:function(ie){E.stepperDrag.handleMouseDown(ie)},children:u(Circle,__assign$m({},this.style,{cx:ne,cy:oe}))})})},h}(x),classnames$1={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var h={}.hasOwnProperty;function E(){for(var Z="",ee=0;ee<arguments.length;ee++){var te=arguments[ee];te&&(Z=Y(Z,R(te)))}return Z}function R(Z){if(typeof Z=="string"||typeof Z=="number")return Z;if(typeof Z!="object")return"";if(Array.isArray(Z))return E.apply(null,Z);if(Z.toString!==Object.prototype.toString&&!Z.toString.toString().includes("[native code]"))return Z.toString();var ee="";for(var te in Z)h.call(Z,te)&&Z[te]&&(ee=Y(ee,te));return ee}function Y(Z,ee){return ee?Z?Z+" "+ee:Z+ee:Z}t.exports?(E.default=E,t.exports=E):window.classNames=E})()})(classnames$1);var classnamesExports=classnames$1.exports;const classnames=getDefaultExportFromCjs(classnamesExports);var __extends$i=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$l=function(){return __assign$l=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$l.apply(this,arguments)},__read$a=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BaseText=function(t){__extends$i(h,t);function h(E){var R=t.call(this)||this;R.mouseDownHandler=function(Z){var ee=R.props,te=ee.draggable,ne=ee.model,oe=ee.graphModel,ie=oe.editConfigModel.nodeTextDraggable;(te??ie)&&(R.stepperDrag.model=ne,R.stepperDrag.handleMouseDown(Z))},R.onDragging=function(Z){var ee=Z.deltaX,te=Z.deltaY,ne=R.props,oe=ne.model,ie=ne.graphModel.transformModel;if(ee||te){var ae=__read$a(ie.fixDeltaXY(ee,te),2),se=ae[0],ue=ae[1];oe.moveText(se,ue)}},R.dbClickHandler=function(){var Z=R.props,ee=Z.editable,te=Z.graphModel.eventCenter,ne=Z.model;ee&&ne.setElementState(ElementState.TEXT_EDIT),te.emit(EventType.TEXT_DBCLICK,{data:ne.text,model:ne})};var Y=E.draggable;return R.stepperDrag=new StepDrag({onDragging:R.onDragging,step:1,eventType:"TEXT",isStopPropagation:Y}),R}return h.prototype.getShape=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=Y.editConfigModel,ee=R.text,te=ee.value,ne=ee.x,oe=ee.y,ie=ee.editable,ae=ee.draggable,se={x:ne,y:oe,className:"",value:te},ue=R.getTextStyle(),fe=Z.nodeTextDraggable||ae;return u(Text,__assign$l({},se,ue,{className:classnames({"lf-element-text":ie,"lf-text-draggable":!ie&&fe,"lf-text-disabled":!ie&&!fe}),model:R}))},h.prototype.render=function(){var E=this.props.model.text;if(E)return u("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},h}(x),__extends$h=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$k=function(){return __assign$k=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$k.apply(this,arguments)},__read$9=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},LineText=function(t){__extends$h(h,t);function h(E){var R=t.call(this,E)||this;return R.setHoverOn=function(){R.setState({isHovered:!0})},R.setHoverOff=function(){R.setState({isHovered:!1})},R.state={isHovered:!1},R}return h.prototype.getBackground=function(){var E=this.state.isHovered,R=this.props.model,Y=R.text,Z=R.getTextStyle(),ee=Z.background||{};if(E&&Z.hover&&Z.hover.background&&(ee=__assign$k(__assign$k({},ee),Z.hover.background)),Y!=null&&Y.value&&(ee==null?void 0:ee.fill)!=="transparent"){var te=Z.fontSize,ne=Z.textWidth,oe=Z.lineHeight,ie=Z.overflowMode,ae=ee.wrapPadding,se=Y==null?void 0:Y.value.split(/[\r\n]/g),ue=se.length,fe=Y.x,le=Y.y,de={};if(ie==="autoWrap"&&ne){var ce=getHtmlTextHeight({rows:se,style:{fontSize:"".concat(te,"px"),width:"".concat(ne,"px"),lineHeight:oe,padding:ae},rowsLength:ue,className:"lf-get-text-height"});de=__assign$k(__assign$k({},ee),{x:fe,y:le,width:ne,height:ce})}else{var pe=getSvgTextSize({rows:se,rowsLength:ue,fontSize:te}),he=pe.width,ge=pe.height;if(ie==="ellipsis"&&(he=ne,ge=te+2),typeof ee.wrapPadding=="string"){var ve=ee.wrapPadding.split(",").filter(function(Me){return Me.trim()}).map(function(Me){return parseFloat(Me.trim())});if(ve.length>0&&ve.length<=4){if(ve.length===1){var _e=__read$9(ve,1),ye=_e[0];ve=[ye,ye,ye,ye]}else if(ve.length===2){var me=__read$9(ve,2),Ee=me[0],Oe=me[1];ve=[Ee,Oe,Ee,Oe]}else if(ve.length===3){var Te=__read$9(ve,3),Pe=Te[0],Oe=Te[1],Re=Te[2];ve=[Pe,Oe,Re,Oe]}var De=__read$9(ve,4),je=De[0],Fe=De[1],xe=De[2],Ne=De[3];he+=Fe+Ne,ge+=je+xe,fe=fe+(Fe-Ne)/2,le=le+(xe-je)/2}}de=__assign$k(__assign$k({},ee),{x:fe-1,y:le-1,width:he,height:ge})}return u(Rect,__assign$k({},de))}return null},h.prototype.getShape=function(){var E=this.props.model,R=E.text,Y=R.x,Z=R.y,ee=R.value;if(!ee)return null;var te=E.getTextStyle(),ne=__assign$k({x:Y,y:Z,value:ee,model:E,className:"lf-element-text"},te);return u("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),u(Text,__assign$k({},ne))]})},h}(BaseText),__extends$g=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$j=function(){return __assign$j=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$j.apply(this,arguments)},__rest$1=function(t,h){var E={};for(var R in t)Object.prototype.hasOwnProperty.call(t,R)&&h.indexOf(R)<0&&(E[R]=t[R]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,R=Object.getOwnPropertySymbols(t);Y<R.length;Y++)h.indexOf(R[Y])<0&&Object.prototype.propertyIsEnumerable.call(t,R[Y])&&(E[R[Y]]=t[R[Y]]);return E},__read$8=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BaseNode=function(t){__extends$g(h,t);function h(E){var R=t.call(this)||this;R.onDragStart=function(ne){var oe=ne.event,ie=R.props,ae=ie.model,se=ie.graphModel;if(oe){var ue=se.getPointByClient({x:oe.clientX,y:oe.clientY}).canvasOverlayPosition,fe=ue.x,le=ue.y;R.moveOffset={dx:ae.x-fe,dy:ae.y-le}}},R.onDragging=function(ne){var oe,ie,ae,se,ue=ne.event,fe=R.props,le=fe.model,de=fe.graphModel,ce=de.editConfigModel,pe=ce.stopMoveGraph,he=ce.autoExpand,ge=de.transformModel,ve=de.selectNodes,_e=de.width,ye=de.height,me=de.gridSize;le.isDragging=!0;var Ee=ue,Oe=Ee.clientX,Te=Ee.clientY,Pe=de.getPointByClient({x:Oe,y:Te}).canvasOverlayPosition,Re=Pe.x,De=Pe.y,je=__read$8(ge.CanvasPointToHtmlPoint([Re,De]),2),Fe=je[0],xe=je[1];if(Re=Re+((ie=(oe=R.moveOffset)===null||oe===void 0?void 0:oe.dx)!==null&&ie!==void 0?ie:0),De=De+((se=(ae=R.moveOffset)===null||ae===void 0?void 0:ae.dy)!==null&&se!==void 0?se:0),Re=snapToGrid(Re,me),De=snapToGrid(De,me),!_e||!ye){de.moveNode2Coordinate(le.id,Re,De);return}var Ne=Fe<0||xe<0||Fe>_e||xe>ye;if(!(he&&!pe&&Ne)){var Me=__read$8(ge.CanvasPointToHtmlPoint([Re-le.width/2,De-le.height/2]),2),Le=Me[0],Se=Me[1],we=__read$8(ge.CanvasPointToHtmlPoint([Re+le.width/2,De+le.height/2]),2),Ce=we[0],$e=we[1],Ie=Math.max(me,20),He=[];Le<0?He=[Ie,0]:Ce>de.width?He=[-Ie,0]:Se<0?He=[0,Ie]:$e>de.height&&(He=[0,-Ie]),R.t&&cancelRaf(R.t),le.transform=new TranslateMatrix(-Re,-De).rotate(le.rotate).translate(Re,De).toString();var Ae=ve.map(function(Be){return Be.id});Ae.indexOf(le.id)===-1&&(Ae=[le.id]),He.length>0&&!pe&&he?R.t=createRaf(function(){var Be=__read$8(He,2),Ue=Be[0],ke=Be[1];ge.translate(Ue??0,ke??0);var Ge=-(Ue??0)/ge.SCALE_X,ze=-(ke??0)/ge.SCALE_X;de.moveNodes(Ae,Ge,ze)}):de.moveNodes(Ae,Re-le.x,De-le.y)}},R.onDragEnd=function(){R.t&&cancelRaf(R.t);var ne=R.props.model;ne.isDragging=!1},R.onMouseOut=function(ne){isIe()&&R.setHoverOff(ne)},R.handleMouseUp=function(){var ne=R.props.model;R.mouseUpDrag=ne.isDragging},R.handleClick=function(ne){var oe=R.mouseUpDrag===!1;if(R.startTime){var ie=R.props,ae=ie.model,se=ie.graphModel;if(oe){var ue=ae.getData(),fe=se.getPointByClient({x:ne.clientX,y:ne.clientY}),le={data:ue,e:ne,position:fe,isSelected:!1,isMultiple:!1},de=ne.button===2,ce=ne.detail===2;if(!de){var pe=se.editConfigModel,he=isMultipleSelect(ne,pe);le.isMultiple=he,ae.isSelected&&!ce&&he?(le.isSelected=!1,ae.setSelected(!1)):(se.selectNodeById(ae.id,he),le.isSelected=!0,R.toFront()),ce?(pe.nodeTextEdit&&ae.text.editable&&pe.textMode===TextMode.TEXT&&(ae.setSelected(!1),se.setElementStateById(ae.id,ElementState.TEXT_EDIT)),se.eventCenter.emit(EventType.NODE_DBCLICK,le)):(se.eventCenter.emit(EventType.ELEMENT_CLICK,le),se.eventCenter.emit(EventType.NODE_CLICK,le))}}}},R.handleContextMenu=function(ne){ne.preventDefault();var oe=R.props,ie=oe.model,ae=oe.graphModel,se=ie.getData(),ue=ae.getPointByClient({x:ne.clientX,y:ne.clientY});ae.setElementStateById(ie.id,ElementState.SHOW_MENU,ue.domOverlayPosition),ie.isSelected||ae.selectNodeById(ie.id),ae.eventCenter.emit(EventType.NODE_CONTEXTMENU,{data:se,e:ne,position:ue}),R.toFront()},R.handleMouseDown=function(ne){var oe=R.props,ie=oe.model,ae=oe.graphModel;R.startTime=new Date().getTime();var se=ae.editConfigModel;se.adjustNodePosition&&ie.draggable&&R.stepDrag&&R.stepDrag.handleMouseDown(ne)},R.handleFocus=function(){var ne=R.props,oe=ne.model,ie=ne.graphModel;ie.eventCenter.emit(EventType.NODE_FOCUS,{data:oe.getData()})},R.handleBlur=function(){var ne=R.props,oe=ne.model,ie=ne.graphModel;ie.eventCenter.emit(EventType.NODE_BLUR,{data:oe.getData()})},R.setHoverOn=function(ne){var oe=R.props,ie=oe.model,ae=oe.graphModel;if(!ie.isHovered){var se=ie.getData();ie.setHovered(!0),ae.eventCenter.emit(EventType.NODE_MOUSEENTER,{data:se,e:ne})}},R.setHoverOff=function(ne){var oe=R.props,ie=oe.model,ae=oe.graphModel,se=ie.getData();ie.isHovered&&(ie.setHovered(!1),ae.eventCenter.emit(EventType.NODE_MOUSELEAVE,{data:se,e:ne}))};var Y=E.graphModel,Z=Y.gridSize,ee=Y.eventCenter,te=E.model;return R.stepDrag=new StepDrag({onDragStart:R.onDragStart,onDragging:R.onDragging,onDragEnd:R.onDragEnd,step:Z,eventType:"NODE",isStopPropagation:!1,eventCenter:ee,model:te}),R.modelDisposer=reaction(function(){return R.props},function(ne){ne&&ne.model&&R.stepDrag.setModel(ne.model)}),R}return h.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer()},h.prototype.componentDidMount=function(){},h.prototype.componentDidUpdate=function(){},h.prototype.getAnchorShape=function(E){return null},h.prototype.getAnchors=function(){var E=this,R=this.props,Y=R.model,Z=R.graphModel,ee=Y.isSelected,te=Y.isHitable,ne=Y.isDragging,oe=Y.isShowAnchor;return te&&(ee||oe)&&!ne?map(Y.anchors,function(ie,ae){var se=Y.getAnchorLineStyle(ie),ue=Y.getAnchorStyle(ie);return u(Anchor,{anchorData:ie,node:E,style:ue,edgeStyle:se,anchorIndex:ae,nodeModel:Y,graphModel:Z,setHoverOff:E.setHoverOff})}):[]},h.prototype.getRotateControl=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=Y.editConfigModel,ee=Z.isSilentMode,te=Z.allowRotate,ne=R.isSelected,oe=R.isHitable,ie=R.rotatable,ae=R.isHovered,se=te&&ie,ue=R.getRotateControlStyle();if(!ee&&oe&&(ne||ae)&&se)return u(RotateControlPoint,{graphModel:Y,nodeModel:R,eventCenter:Y.eventCenter,style:ue})},h.prototype.getResizeControl=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=Y.editConfigModel,ee=Z.isSilentMode,te=Z.allowResize,ne=R.isSelected,oe=R.isHitable,ie=R.resizable,ae=R.isHovered,se=te&&ie,ue=R.getResizeControlStyle();return!ee&&oe&&(ne||ae)&&se?u(ResizeControlGroup,{style:ue,model:R,graphModel:Y}):null},h.prototype.getText=function(){var E,R=this.props,Y=R.model,Z=R.graphModel,ee=Z.editConfigModel;if(ee.nodeTextMode!==TextMode.TEXT||Y.state===ElementState.TEXT_EDIT)return null;if(Y.text){var te=!1;return ee.nodeTextDraggable&&Y.text.draggable&&(te=!0),u(BaseText,{editable:ee.nodeTextEdit&&((E=Y.text.editable)!==null&&E!==void 0?E:!0),model:Y,graphModel:Z,draggable:te})}return null},h.prototype.getStateClassName=function(){var E=this.props.model,R=E.state,Y=E.isDragging,Z=E.isSelected,ee="lf-node";switch(R){case ElementState.ALLOW_CONNECT:ee+=" lf-node-allow";break;case ElementState.NOT_ALLOW_CONNECT:ee+=" lf-node-not-allow";break;default:ee+=" lf-node-default";break}return Y&&(ee+=" lf-dragging"),Z&&(ee+=" lf-node-selected"),ee},h.prototype.toFront=function(){var E=this.props,R=E.model,Y=E.graphModel;R.autoToFront&&Y.toFront(R.id)},h.prototype.render=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=Y.editConfigModel,ee=Z.hideAnchors,te=Z.adjustNodePosition,ne=Z.allowRotate,oe=Z.allowResize,ie=Y.gridSize,ae=Y.transformModel.SCALE_X,se=R.isHitable,ue=R.draggable,fe=R.transform,le=R.getOuterGAttributes(),de=le.className,ce=de===void 0?"":de,pe=__rest$1(le,["className"]),he=u("g",{className:"lf-node-content",children:[u("g",{transform:fe,children:[this.getShape(),this.getText(),ne&&this.getRotateControl(),oe&&this.getResizeControl()]}),!ee&&this.getAnchors()]}),ge;return se?(te&&ue&&this.stepDrag.setStep(ie*ae),ge=u("g",__assign$j({className:"".concat(this.getStateClassName()," ").concat(ce),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},pe,{children:he}))):ge=u("g",__assign$j({className:"".concat(this.getStateClassName()," ").concat(ce)},pe,{children:he})),ge},h.isObserved=!1,h}(x),__extends$f=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$i=function(){return __assign$i=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$i.apply(this,arguments)},RectNode=function(t){__extends$f(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getShape=function(){var E=this.props.model,R=E.getNodeStyle();return u(Rect,__assign$i({},R,{x:E.x,y:E.y,width:E.width,height:E.height,radius:E.radius}))},h}(BaseNode),__extends$e=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$h=function(){return __assign$h=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$h.apply(this,arguments)},CircleNode=function(t){__extends$e(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getShape=function(){var E=this.props.model,R=E.x,Y=E.y,Z=E.r,ee=E.getNodeStyle();return u(Circle,__assign$h({},ee,{x:R,y:Y,r:Z}))},h}(BaseNode),__extends$d=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$g=function(){return __assign$g=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$g.apply(this,arguments)},PolygonNode=function(t){__extends$d(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getShape=function(){var E=this.props.model,R=E,Y=R.x,Z=R.y,ee=R.width,te=R.height,ne=R.points,oe=E.getNodeStyle(),ie={transform:"matrix(1 0 0 1 ".concat(Y-ee/2," ").concat(Z-te/2,")")};return u("g",__assign$g({},ie,{children:u(Polygon,__assign$g({},oe,{points:ne,x:Y,y:Z}))}))},h}(BaseNode),__extends$c=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$f=function(){return __assign$f=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$f.apply(this,arguments)},DiamondNode=function(t){__extends$c(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getShape=function(){var E=this.props.model,R=E.getNodeStyle();return u("g",{children:u(Polygon,__assign$f({},R,{points:E.points,x:E.x,y:E.y}))})},h}(BaseNode),__extends$b=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$e=function(){return __assign$e=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$e.apply(this,arguments)},EllipseNode=function(t){__extends$b(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getShape=function(){var E=this.props.model,R=E.getNodeStyle();return u(Ellipse,__assign$e({},R,{x:E.x,y:E.y,rx:E.rx,ry:E.ry}))},h}(BaseNode),__extends$a=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$d=function(){return __assign$d=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$d.apply(this,arguments)},TextNode=function(t){__extends$a(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getBackground=function(){var E=this.props.model,R=E.getTextStyle(),Y=E.width,Z=E.height,ee=E.x,te=E.y,ne=__assign$d(__assign$d({},R.background),{x:ee,y:te,width:Y,height:Z});return u(Rect,__assign$d({},ne))},h.prototype.getResizeControl=function(){return null},h.prototype.getShape=function(){return u("g",{children:this.getBackground()})},h}(BaseNode),__extends$9=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$c=function(){return __assign$c=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$c.apply(this,arguments)},__read$7=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$2=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},HtmlNode=function(t){__extends$9(h,t);function h(){var E=t.apply(this,__spreadArray$2([],__read$7(arguments),!1))||this;return E.ref=b(),E}return Object.defineProperty(h.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),h.prototype.setHtml=function(E){E.appendChild(document.createElement("div"))},h.prototype.confirmUpdate=function(E){this.setHtml(E)},h.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},h.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},h.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},h.prototype.componentWillUnmount=function(){this.rootEl.innerHTML=""},h.prototype.getShape=function(){var E=this.props.model,R=E.x,Y=E.y,Z=E.height,ee=E.width,te=E.getNodeStyle();return this.currentProperties=JSON.stringify(E.properties),u("foreignObject",__assign$c({},te,{x:R-ee/2,y:Y-Z/2,width:ee,height:Z,ref:this.ref}))},h}(BaseNode),__extends$8=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$b=function(){return __assign$b=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$b.apply(this,arguments)},__rest=function(t,h){var E={};for(var R in t)Object.prototype.hasOwnProperty.call(t,R)&&h.indexOf(R)<0&&(E[R]=t[R]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,R=Object.getOwnPropertySymbols(t);Y<R.length;Y++)h.indexOf(R[Y])<0&&Object.prototype.propertyIsEnumerable.call(t,R[Y])&&(E[R[Y]]=t[R[Y]]);return E},__read$6=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},AdjustType;(function(t){t.SOURCE="SOURCE",t.TARGET="TARGET"})(AdjustType||(AdjustType={}));var AdjustPoint=function(t){__extends$8(h,t);function h(E){var R=t.call(this)||this;R.handleMouseDown=function(ne){R.stepDrag&&R.stepDrag.handleMouseDown(ne)},R.onDragStart=function(){var ne=R.props,oe=ne.x,ie=ne.y,ae=ne.edgeModel,se=ae.startPoint,ue=ae.endPoint,fe=ae.pointsList;R.oldEdge={startPoint:se,endPoint:ue,pointsList:fe},R.setState({endX:oe,endY:ie,dragging:!0})},R.onDragging=function(ne){var oe=ne.deltaX,ie=ne.deltaY,ae=R.state,se=ae.endX,ue=ae.endY,fe=R.props,le=fe.graphModel,de=fe.type,ce=le.transformModel,pe=le.editConfigModel,he=__read$6(ce.moveCanvasPointByHtml([se,ue],oe,ie),2),ge=he[0],ve=he[1];R.setState({endX:ge,endY:ve,dragging:!0});var _e=R.props.edgeModel,ye=targetNodeInfo({x:se,y:ue},le);if(ye&&ye.node&&R.isAllowAdjust(ye).pass){var me=_e.startPoint,Ee=_e.endPoint,Oe=_e.sourceNode,Te=_e.targetNode,Pe=de===AdjustType.SOURCE?{startPoint:{x:ye.anchor.x,y:ye.anchor.y},endPoint:{x:Ee.x,y:Ee.y},sourceNode:ye.node,targetNode:Te}:{startPoint:{x:me.x,y:me.y},endPoint:{x:ye.anchor.x,y:ye.anchor.y},sourceNode:Oe,targetNode:ye.node};_e.updateAfterAdjustStartAndEnd(Pe)}else de===AdjustType.SOURCE?_e.updateStartPoint({x:ge,y:ve}):_e.updateEndPoint({x:ge,y:ve});_e.text.value&&pe.adjustEdge&&_e.setText(Object.assign({},_e.text,_e.textPosition))},R.onDragEnd=function(ne){var oe,ie,ae,se=ne.event;try{R.setState({dragging:!1});var ue=R.props,fe=ue.graphModel,le=ue.edgeModel,de=ue.type,ce=R.state,pe=ce.endX,he=ce.endY,ge=ce.dragging,ve=targetNodeInfo({x:pe,y:he},fe);if(!ge)return;var _e=!1,ye=void 0;if(ve&&ve.node){var me=R.isAllowAdjust(ve),Ee=me.pass,Oe=me.msg,Te=me.newTargetNode;if(Ee){var Pe=le.getData(),Re=Pe.text,De=Pe.sourceAnchorId,je=De===void 0?"":De,Fe=Pe.targetAnchorId,xe=Fe===void 0?"":Fe,Ne=__rest(Pe,["text","sourceAnchorId","targetAnchorId"]);if(ye=__assign$b(__assign$b({sourceAnchorId:je,targetAnchorId:xe},Ne),{text:(Re==null?void 0:Re.value)||""}),de===AdjustType.SOURCE){var Me=fe.getNodeModelById(ve.node.id),Le=fe.getNodeModelById(le.targetNodeId),Se=(oe=fe.edgeGenerator)===null||oe===void 0?void 0:oe.call(fe,Me==null?void 0:Me.getData(),Le==null?void 0:Le.getData(),ye);ye=__assign$b(__assign$b({},Se),{sourceNodeId:ve.node.id,sourceAnchorId:ve.anchor.id,startPoint:{x:ve.anchor.x,y:ve.anchor.y},targetNodeId:le.targetNodeId,endPoint:__assign$b({},le.endPoint)}),le.sourceNodeId===ve.node.id&&le.sourceAnchorId===ve.anchor.id&&(_e=!0)}else if(de===AdjustType.TARGET){var Me=fe.getNodeModelById(le.sourceNodeId),Le=fe.getNodeModelById(ve.node.id),Se=(ie=fe.edgeGenerator)===null||ie===void 0?void 0:ie.call(fe,Me==null?void 0:Me.getData(),Le==null?void 0:Le.getData(),ye);ye=__assign$b(__assign$b({},Se),{sourceNodeId:le.sourceNodeId,startPoint:__assign$b({},le.startPoint),targetNodeId:ve.node.id,targetAnchorId:ve.anchor.id,endPoint:{x:ve.anchor.x,y:ve.anchor.y}}),le.targetNodeId===ve.node.id&&le.targetAnchorId===ve.anchor.id&&(_e=!0)}}else{_e=!0;var we=Te.getData();fe.eventCenter.emit(EventType.CONNECTION_NOT_ALLOWED,{data:we,msg:Oe})}}else _e=!0;if(_e)R.recoveryEdge();else{var Ce=le.getData();fe.deleteEdgeById(le.id);var $e=fe.addEdge(__assign$b({},ye));fe.eventCenter.emit(EventType.EDGE_EXCHANGE_NODE,{data:{newEdge:$e.getData(),oldEdge:Ce}})}(ae=R.preTargetNode)===null||ae===void 0||ae.setElementState(ElementState.DEFAULT)}finally{var fe=R.props.graphModel;fe.eventCenter.emit(EventType.ADJUST_POINT_DRAGEND,{e:se,data:R.stepDragData})}},R.recoveryEdge=function(){var ne=R.props.edgeModel,oe=R.oldEdge,ie=oe.startPoint,ae=oe.endPoint,se=oe.pointsList;ne.updateStartPoint(ie),ne.updateEndPoint(ae),ne.modelType!==ModelType.LINE_EDGE&&(ne.pointsList=se??[],ne.initPoints())},R.getAdjustPointStyle=function(){var ne=R.props.graphModel.theme,oe=ne.edgeAdjust;return oe},R.state={dragging:!1,endX:0,endY:0},R.targetRuleResults=new Map,R.sourceRuleResults=new Map;var Y=E.type,Z=E.edgeModel,ee=E.graphModel,te=ee.eventCenter;return R.stepDragData={type:Y,edgeData:Z.getData()},R.stepDrag=new StepDrag({onDragStart:R.onDragStart,onDragging:R.onDragging,onDragEnd:R.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:te,data:R.stepDragData}),R}return h.prototype.isAllowAdjust=function(E){var R=this.props,Y=R.edgeModel,Z=Y.id,ee=Y.sourceNode,te=Y.targetNode,ne=Y.sourceAnchorId,oe=Y.targetAnchorId,ie=R.type,ae,se,ue,fe;if(ie===AdjustType.SOURCE?(ae=E.node,se=te,ue=E.anchor,fe=te.getAnchorInfo(oe)):(ae=ee,se=E.node,fe=E.anchor,ue=ee.getAnchorInfo(ne)),this.preTargetNode&&this.preTargetNode!==E.node&&this.preTargetNode.setElementState(ElementState.DEFAULT),this.preTargetNode=E.node,fe.id===ue.id)return{pass:!1,msg:"",newTargetNode:se};var le="".concat(ae.id,"_").concat(se.id,"_").concat(ue.id,"_").concat(fe.id);if(!this.targetRuleResults.has(le)){var de=ae.isAllowConnectedAsSource(se,ue,fe,Z),ce=se.isAllowConnectedAsTarget(ae,ue,fe,Z);this.sourceRuleResults.set(le,formatAnchorConnectValidateData(de)),this.targetRuleResults.set(le,formatAnchorConnectValidateData(ce))}var pe=this.sourceRuleResults.get(le),he=pe.isAllPass,ge=pe.msg,ve=this.targetRuleResults.get(le),_e=ve.isAllPass,ye=ve.msg,me=he&&_e?ElementState.ALLOW_CONNECT:ElementState.NOT_ALLOW_CONNECT;return ie===AdjustType.SOURCE?ae.setElementState(me):se.setElementState(me),{pass:he&&_e,msg:ye||ge,newTargetNode:se}},h.prototype.render=function(){var E=this.props,R=E.x,Y=E.y,Z=E.getAdjustPointShape,ee=E.edgeModel,te=this.state.dragging;return u("g",{pointerEvents:te?"none":"",onMouseDown:this.handleMouseDown,children:te?"":Z(R,Y,ee)})},h}(x),__extends$7=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$a=function(){return __assign$a=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$a.apply(this,arguments)};(function(t){__extends$7(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getArrowAttributes=function(){var E=this.props,R=E.arrowInfo,Y=E.style,Z=R.start,ee=R.end,te={start:Z,end:ee,offset:Y.offset,verticalLength:Y.verticalLength,type:"end"},ne=getVerticalPointOfLine(te),oe=ne.leftX,ie=ne.leftY,ae=ne.rightX,se=ne.rightY;return __assign$a({d:"M".concat(oe," ").concat(ie," L").concat(ee.x," ").concat(ee.y," L").concat(ae," ").concat(se," z")},Y)},h.prototype.getShape=function(){var E=this.getArrowAttributes(),R=E.d,Y=E.strokeWidth,Z=E.stroke,ee=E.fill;return u(Path,{d:R,fill:ee,strokeWidth:Y,stroke:Z})},h.prototype.render=function(){return u("g",{className:"lf-arrow",children:this.getShape()})},h})(x);var __extends$6=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$9=function(){return __assign$9=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$9.apply(this,arguments)},__read$5=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BaseEdge=function(t){__extends$6(h,t);function h(){var E=t.call(this)||this;return E.textRef=b(),E.handleHover=function(R,Y){var Z=E.props,ee=Z.model,te=Z.graphModel.eventCenter;ee.setHovered(R);var ne=R?EventType.EDGE_MOUSEENTER:EventType.EDGE_MOUSELEAVE,oe=ee.getData();te.emit(ne,{data:oe,e:Y})},E.setHoverOn=function(R){var Y=E.props.model.isHovered;Y||(E.textRef&&E.textRef.current&&E.textRef.current.setHoverOn(),E.handleHover(!0,R))},E.setHoverOff=function(R){var Y=E.props.model.isHovered;Y&&(E.textRef&&E.textRef.current&&E.textRef.current.setHoverOff(),E.handleHover(!1,R))},E.handleContextMenu=function(R){R.preventDefault(),E.contextMenuTime=new Date().getTime(),E.clickTimer&&clearTimeout(E.clickTimer);var Y=E.props,Z=Y.model,ee=Y.graphModel,te=ee.getPointByClient({x:R.clientX,y:R.clientY});ee.setElementStateById(Z.id,ElementState.SHOW_MENU,te.domOverlayPosition),E.toFront(),Z.isSelected||ee.selectEdgeById(Z.id);var ne=Z==null?void 0:Z.getData();ee.eventCenter.emit(EventType.EDGE_CONTEXTMENU,{data:ne,e:R,position:te})},E.handleMouseDown=function(R){R.stopPropagation(),E.startTime=new Date().getTime()},E.handleMouseUp=function(){var R=E.props.model;E.mouseUpDrag=R.isDragging},E.handleClick=function(R){if(E.startTime&&!E.mouseUpDrag){var Y=R.button===2;if(!Y){var Z=R.detail===2,ee=E.props,te=ee.model,ne=ee.graphModel,oe=te==null?void 0:te.getData(),ie=ne.getPointByClient({x:R.clientX,y:R.clientY});if(Z){var ae=ne.editConfigModel,se=ne.textEditElement,ue=te.id,fe=te.text,le=te.modelType;if(se&&se.id===ue&&ne.setElementStateById(ue,ElementState.DEFAULT),ae.edgeTextEdit&&fe.editable&&(te.setSelected(!1),ne.setElementStateById(ue,ElementState.TEXT_EDIT)),le===ModelType.POLYLINE_EDGE){var de=te,ce=ne.getPointByClient({x:R.x,y:R.y}).canvasOverlayPosition,pe=ce.x,he=ce.y;de.dbClickPosition=getClosestPointOfPolyline({x:pe,y:he},de.points)}ne.eventCenter.emit(EventType.EDGE_DBCLICK,{data:oe,e:R,position:ie})}else ne.eventCenter.emit(EventType.ELEMENT_CLICK,{data:oe,e:R,position:ie}),ne.eventCenter.emit(EventType.EDGE_CLICK,{data:oe,e:R,position:ie});var ge=ne.editConfigModel;ne.selectEdgeById(te.id,isMultipleSelect(R,ge)),E.toFront()}}},E.handleFocus=function(){var R=E.props,Y=R.model,Z=R.graphModel;Z.eventCenter.emit(EventType.EDGE_FOCUS,{data:Y.getData()})},E.handleBlur=function(){var R=E.props,Y=R.model,Z=R.graphModel;Z.eventCenter.emit(EventType.EDGE_BLUR,{data:Y.getData()})},E}return h.prototype.getShape=function(){return u("g",{children:this.getEdge()})},h.prototype.getTextStyle=function(){},h.prototype.getText=function(){var E,R=this.props,Y=R.model,Z=R.graphModel,ee=Z.editConfigModel;if(ee.edgeTextMode!==TextMode.TEXT||Y.state===ElementState.TEXT_EDIT)return null;if(Y.text){var te=!1;return ee.edgeTextDraggable&&Y.text.draggable&&(te=!0),u(LineText,{ref:this.textRef,editable:ee.edgeTextEdit&&((E=Y.text.editable)!==null&&E!==void 0?E:!0),model:Y,graphModel:Z,draggable:te})}return null},h.prototype.getArrowInfo=function(){var E=this.props.model,R=E.startPoint,Y=E.endPoint,Z=E.isSelected,ee=this.state.hover;return{start:R,end:Y,hover:ee,isSelected:Z}},h.prototype.getLastTwoPoints=function(){var E=this.props.model,R=E.startPoint,Y=E.endPoint;return[R,Y]},h.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},h.prototype.getArrow=function(){var E=this.props.model,R=E.id,Y=E.getArrowStyle(),Z=Y.refY,ee=Z===void 0?0:Z,te=Y.refX,ne=te===void 0?2:te,oe=__read$5(this.getLastTwoPoints(),2),ie=oe[0],ae=oe[1],se="auto";return ie!==null&&ae!==null&&(se=degrees(getThetaOfVector({x:ae.x-ie.x,y:ae.y-ie.y,z:0}))),u("g",{children:u("defs",{children:[u("marker",{id:"marker-start-".concat(R),refX:-ne,refY:ee,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),u("marker",{id:"marker-end-".concat(R),refX:ne,refY:ee,overflow:"visible",orient:se,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},h.prototype.getStartArrow=function(){return u("path",{})},h.prototype.getEndArrow=function(){var E=this.props.model,R=E.getArrowStyle(),Y=R.stroke,Z=R.strokeWidth,ee=R.offset,te=R.verticalLength;return u("path",{stroke:Y,fill:Y,strokeWidth:Z,transform:"rotate(180)",d:"M 0 0 L ".concat(ee," -").concat(te," L ").concat(ee," ").concat(te," Z")})},h.prototype.getAdjustPointShape=function(E,R,Y){var Z=Y.getAdjustPointStyle();return u(Circle,__assign$9({className:"lf-edge-adjust-point"},Z,{x:E,y:R}))},h.prototype.getAdjustPoints=function(){var E=this.props,R=E.model,Y=E.graphModel,Z=Y.editConfigModel,ee=Z.adjustEdgeStartAndEnd,te=Z.adjustEdgeStart,ne=Z.adjustEdgeEnd,oe=R.getAdjustStart(),ie=R.getAdjustEnd();return u("g",{children:[ee&&te&&u(AdjustPoint,__assign$9({type:AdjustType.SOURCE},oe,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:R,graphModel:Y})),ee&&ne&&u(AdjustPoint,__assign$9({type:AdjustType.TARGET},ie,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:R,graphModel:Y}))]})},h.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},h.prototype.getAppendWidth=function(){return u("g",{})},h.prototype.getAppend=function(){return u("g",{className:"lf-edge-append",children:this.getAppendWidth()})},h.prototype.getEdge=function(){return null},h.prototype.toFront=function(){var E=this.props,R=E.graphModel,Y=E.model;R.toFront(Y.id)},h.prototype.render=function(){var E=this.props.model,R=E.isSelected,Y=E.isHitable,Z=E.isShowAdjustPoint;return u("g",{children:[u("g",{className:["lf-edge",!Y&&"pointer-none",R&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),Z&&R?this.getAdjustPoints():""]})},h.isObserved=!1,h}(x),__extends$5=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$8=function(){return __assign$8=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$8.apply(this,arguments)},__read$4=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},BezierEdge=function(t){__extends$5(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getEdge=function(){var E=this.props.model,R=E.getEdgeStyle(),Y=E,Z=Y.path,ee=Y.isAnimation,te=Y.arrowConfig,ne=E.getEdgeAnimationStyle(),oe=ne.strokeDasharray,ie=ne.stroke,ae=ne.strokeDashoffset,se=ne.animationName,ue=ne.animationDuration,fe=ne.animationIterationCount,le=ne.animationTimingFunction,de=ne.animationDirection;return u(Path,__assign$8({d:Z},R,te,ee?{strokeDasharray:oe,stroke:ie,style:{strokeDashoffset:ae,animationName:se,animationDuration:ue,animationIterationCount:fe,animationTimingFunction:le,animationDirection:de}}:{}))},h.prototype.getAppendWidth=function(){var E=this.props.model.path;return u(Path,{d:E,strokeWidth:10,stroke:"transparent",fill:"none"})},h.prototype.getArrowInfo=function(){var E=this.props.model,R=this.state.hover,Y=E.isSelected,Z=E.getArrowStyle().offset,ee=E.pointsList.map(function(ae){return{x:ae.x,y:ae.y}}),te=__read$4(getEndTangent(ee,Z),2),ne=te[0],oe=te[1],ie={start:ne,end:oe,hover:R,isSelected:Y};return ie},h.prototype.getLastTwoPoints=function(){var E=this.props.model,R=E.getArrowStyle().offset,Y=E.pointsList.map(function(Z){return{x:Z.x,y:Z.y}});return getEndTangent(Y,R)},h}(BaseEdge),__extends$4=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$7=function(){return __assign$7=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$7.apply(this,arguments)},LineEdge=function(t){__extends$4(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}return h.prototype.getEdge=function(){var E=this.props.model,R=E.startPoint,Y=E.endPoint,Z=E.isAnimation,ee=E.arrowConfig,te=E.getEdgeStyle(),ne=E.getEdgeAnimationStyle(),oe=ne.strokeDasharray,ie=ne.stroke,ae=ne.strokeDashoffset,se=ne.animationName,ue=ne.animationDuration,fe=ne.animationIterationCount,le=ne.animationTimingFunction,de=ne.animationDirection;return u(Line,__assign$7({},te,{x1:R.x,y1:R.y,x2:Y.x,y2:Y.y},ee,Z?{strokeDasharray:oe,stroke:ie,style:{strokeDashoffset:ae,animationName:se,animationDuration:ue,animationIterationCount:fe,animationTimingFunction:le,animationDirection:de}}:{}))},h.prototype.getAppendWidth=function(){var E=this.props.model,R=E.startPoint,Y=E.endPoint,Z={start:R,end:Y},ee=getAppendAttributes(Z),te=ee.d,ne=ee.strokeWidth,oe=ee.fill,ie=ee.strokeDasharray,ae=ee.stroke;return u(Path,{d:te,fill:oe,strokeWidth:ne,stroke:ae,strokeDasharray:ie})},h}(BaseEdge),__extends$3=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$6=function(){return __assign$6=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$6.apply(this,arguments)},__read$3=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},PolylineEdge=function(t){__extends$3(h,t);function h(){var E=t.call(this)||this;return E.onDragStart=function(){var R=E.props.model;R.dragAppendStart(),E.isShowAdjustPointTemp=R.isShowAdjustPoint,R.isShowAdjustPoint=!1},E.onDragging=function(R){var Y=R.deltaX,Z=R.deltaY,ee=E.props,te=ee.model,ne=ee.graphModel;E.isDragging=!0;var oe=ne.transformModel,ie=ne.editConfigModel,ae=__read$3(oe.fixDeltaXY(Y,Z),2),se=ae[0],ue=ae[1],fe=te,le=ie.adjustEdgeMiddle;le?E.appendInfo=fe.dragAppendSimple(E.appendInfo,{x:se,y:ue}):E.appendInfo=fe.dragAppend(E.appendInfo,{x:se,y:ue})},E.onDragEnd=function(){var R,Y=E.props,Z=Y.model,ee=Y.graphModel.eventCenter,te=Z;te.dragAppendEnd(),E.isDragging=!1,te.isShowAdjustPoint=(R=E.isShowAdjustPointTemp)!==null&&R!==void 0?R:!1,E.appendInfo=void 0,ee.emit(EventType.EDGE_ADJUST,{data:te.getData()})},E.beforeDragStart=function(R,Y){Y.draggable&&E.drag.handleMouseDown(R),E.appendInfo=Y},E.drag=new StepDrag({onDragStart:E.onDragStart,onDragging:E.onDragging,onDragEnd:E.onDragEnd,isStopPropagation:!1}),E}return h.prototype.getEdge=function(){var E=this.props.model,R=E.points,Y=E.isAnimation,Z=E.arrowConfig,ee=E.getEdgeStyle(),te=E.getEdgeAnimationStyle(),ne=te.strokeDasharray,oe=te.stroke,ie=te.strokeDashoffset,ae=te.animationName,se=te.animationDuration,ue=te.animationIterationCount,fe=te.animationTimingFunction,le=te.animationDirection;return u(Polyline,__assign$6({points:R},ee,Z,Y?{strokeDasharray:ne,stroke:oe,style:{strokeDashoffset:ie,animationName:ae,animationDuration:se,animationIterationCount:ue,animationTimingFunction:fe,animationDirection:le}}:{}))},h.prototype.getArrowInfo=function(){var E=this.props.model,R=E.points,Y=E.isSelected,Z=this.state.hover,ee=points2PointsList(R),te=ee[0],ne=ee[0];return ee.length>=2&&(te=ee[ee.length-2],ne=ee[ee.length-1]),{start:te,end:ne,hover:Z,isSelected:Y}},h.prototype.getLastTwoPoints=function(){var E=this.props.model,R=E.points,Y=points2PointsList(R),Z=Y[0],ee=Y[0];return Y.length>=2&&(Z=Y[Y.length-2],ee=Y[Y.length-1]),[Z,ee]},h.prototype.getAppendAttributes=function(E){var R=E.start,Y=E.end,Z;if(R.x===Y.x&&R.y===Y.y)Z="";else{var ee={start:R,end:Y,offset:10,verticalLength:5},te=getVerticalPointOfLine(__assign$6(__assign$6({},ee),{type:"start"})),ne=getVerticalPointOfLine(__assign$6(__assign$6({},ee),{type:"end"}));Z="M".concat(te.leftX," ").concat(te.leftY,`
      L`).concat(te.rightX," ").concat(te.rightY,`
      L`).concat(ne.rightX," ").concat(ne.rightY,`
      L`).concat(ne.leftX," ").concat(ne.leftY," z")}return{d:Z,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},h.prototype.getAppendShape=function(E){var R=this.getAppendAttributes(E),Y=R.d,Z=R.strokeWidth,ee=R.fill,te=R.strokeDasharray,ne=R.stroke;return u(Path,{d:Y,fill:ee,strokeWidth:Z,stroke:ne,strokeDasharray:te})},h.prototype.getAppendWidth=function(){for(var E=this,R=this.props,Y=R.model,Z=R.graphModel,ee=Y.pointsList,te=Y.draggable,ne=[],oe=ee.length,ie=function(ue){var fe="lf-polyline-append",le={start:{x:ee[ue].x,y:ee[ue].y},end:{x:ee[ue+1].x,y:ee[ue+1].y},startIndex:ue,endIndex:ue+1,direction:SegmentDirection.HORIZONTAL,draggable:!0},de=u("g",{className:fe,children:ae.getAppendShape(le)}),ce=Z.editConfigModel,pe=ce.adjustEdge,he=ce.adjustEdgeMiddle;if(pe&&te){var ge=le.startIndex,ve=le.endIndex,_e=he&&(ge===0||ve===oe-1);le.draggable=!_e,le.start.x===le.end.x?(le.draggable&&(fe+="-ew-resize"),le.direction=SegmentDirection.VERTICAL):le.start.y===le.end.y&&(le.draggable&&(fe+="-ns-resize"),le.direction=SegmentDirection.HORIZONTAL),de=u("g",{className:ae.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(ye){return E.beforeDragStart(ye,le)},children:u("g",{className:fe,children:ae.getAppendShape(le)})})}ne.push(de)},ae=this,se=0;se<oe-1;se++)ie(se);return u("g",{children:ne})},h}(BaseEdge),__assign$5=function(){return __assign$5=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$5.apply(this,arguments)},Dnd=function(){function t(h){var E=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){E.nodeConfig=null,window.document.removeEventListener("mouseup",E.stopDrag)},this.dragEnter=function(Y){!E.nodeConfig||E.fakeNode||(E.fakeNode=E.lf.createFakeNode(__assign$5(__assign$5({},E.nodeConfig),E.clientToLocalPoint({x:Y.clientX,y:Y.clientY}))))},this.onDragOver=function(Y){if(Y.preventDefault(),E.fakeNode){var Z=E.clientToLocalPoint({x:Y.clientX,y:Y.clientY}),ee=Z.x,te=Z.y;E.fakeNode.moveTo(ee,te);var ne=E.fakeNode.getData();E.lf.setNodeSnapLine(ne),E.lf.graphModel.eventCenter.emit(EventType.NODE_DND_DRAG,{data:ne,e:Y})}return!1},this.onDragLeave=function(){E.fakeNode&&(E.lf.removeNodeSnapLine(),E.lf.graphModel.removeFakeNode(),E.fakeNode=null)},this.onDrop=function(Y){!E.lf.graphModel||!Y||!E.nodeConfig||(E.lf.addNode(__assign$5(__assign$5({},E.nodeConfig),E.clientToLocalPoint({x:Y.clientX,y:Y.clientY})),EventType.NODE_DND_ADD,Y),Y.preventDefault(),Y.stopPropagation(),E.nodeConfig=null,E.lf.removeNodeSnapLine(),E.lf.graphModel.removeFakeNode(),E.fakeNode=null)};var R=h.lf;this.lf=R}return t.prototype.clientToLocalPoint=function(h){var E=h.x,R=h.y,Y=get$1(this.lf.options,["grid","size"]),Z=this.lf.graphModel.getPointByClient({x:E,y:R}),ee=Z.canvasOverlayPosition,te=ee.x,ne=ee.y;return{x:snapToGrid(te,Y),y:snapToGrid(ne,Y)}},t.prototype.startDrag=function(h){var E=this.lf.graphModel.editConfigModel;E!=null&&E.isSilentMode||(this.nodeConfig=h,window.document.addEventListener("mouseup",this.stopDrag))},t.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},t}();function snapline(t,h){t.on("node:mousemove",function(E){var R=E.data;h.setNodeSnapLine(R)}),t.on("node:mouseup",function(){h.clearSnapline()})}var __extends$2=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__assign$4=function(){return __assign$4=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$4.apply(this,arguments)},__decorate$4=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$2=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},TextEditTool=function(t){__extends$2(h,t);function h(E){var R=t.call(this,E)||this;return R.ref=b(),R.__prevText={type:"",text:"",id:""},R.keyupHandler=function(Y){var Z=R.props.graphModel.textEditElement;Y.key==="Enter"&&Y.altKey&&(Z==null||Z.setElementState(ElementState.DEFAULT))},R.inputHandler=function(Y){var Z=Y.target.innerText,ee=R.props.graphModel.textEditElement;ee&&(R.__prevText={type:ee.type,text:Z.replace(/(\r\n)+$|(\n)+$/,""),id:ee.id})},R.keydownHandler=function(Y){Y.stopPropagation()},R.state={style:{left:0,top:0}},R}return h.getDerivedStateFromProps=function(E){var R,Y=E.textEditElement,Z=E.graphModel,ee=Z.transformModel,te=Z.theme,ne=te.inputText,oe;if(Y){if(!(!((R=Y.text)===null||R===void 0)&&R.value)&&Y.BaseType===ElementType.EDGE){var ie=Y.text,ae=Y.textPosition,se=ae.x,ue=ae.y;ie.x=se,ie.y=ue,Y.setText(ie)}var fe={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(Y.BaseType===ElementType.EDGE){var le=te.edgeText,de=le.overflowMode,ce=le.lineHeight,pe=le.wrapPadding,he=le.textWidth;he&&de==="autoWrap"&&(oe=__assign$4(__assign$4({},fe),{width:he,minWidth:he,lineHeight:ce,padding:pe}))}else if(Y.BaseType===ElementType.NODE){var ge=te.nodeText,de=ge.overflowMode,ce=ge.lineHeight,pe=ge.wrapPadding,he=ge.textWidth,ve=Y.width,_e=Y.modelType,ye=Y.textWidth,me=ye||he||ve;(_e!==ModelType.TEXT_NODE&&de==="autoWrap"||_e===ModelType.TEXT_NODE&&he)&&(oe=__assign$4(__assign$4({},fe),{width:me,minWidth:me,lineHeight:ce,padding:pe}))}var Ee=Y.text,Oe=Ee.x,Te=Ee.y,Pe=__read$2(ee.CanvasPointToHtmlPoint([Oe,Te]),2),Re=Pe[0],De=Pe[1];return{style:__assign$4(__assign$4({left:Re,top:De},oe),ne)}}return null},h.prototype.componentDidUpdate=function(){var E=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var R=this.__prevText,Y=R.text,Z=R.id;E.updateText(Z,Y),E.eventCenter.emit(EventType.TEXT_UPDATE,{data:__assign$4({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},h.prototype.placeCaretAtEnd=function(E){if(window.getSelection!==void 0&&document.createRange!==void 0){var R=document.createRange();R.selectNodeContents(E),R.collapse(!1);var Y=window.getSelection();Y==null||Y.removeAllRanges(),Y==null||Y.addRange(R)}},h.prototype.render=function(){var E,R=this.props.graphModel.textEditElement,Y=this.state.style;return R?u("div",{contentEditable:!0,className:"lf-text-input",style:Y,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(E=R.text)===null||E===void 0?void 0:E.value},R.id):null},h.toolName="text-edit-tool",h=__decorate$4([observer],h),h}(x),__extends$1=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Object.prototype.hasOwnProperty.call(Y,Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}(),__decorate$3=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},__read$1=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray$1=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},MultipleSelect=function(t){__extends$1(h,t);function h(E){var R=t.call(this,E)||this;R.handleMouseDown=function(te){R.stepDrag.handleMouseDown(te)},R.handleWheelEvent=function(te){var ne,oe;te.preventDefault();var ie=te.deltaX,ae=te.deltaY,se=te.clientX,ue=te.clientY,fe=te.ctrlKey,le=new WheelEvent("wheel",{deltaX:ie,deltaY:ae,clientX:se,clientY:ue,ctrlKey:fe});(oe=(ne=R.props.lf.container)===null||ne===void 0?void 0:ne.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||oe===void 0||oe.dispatchEvent(le)},R.onDragging=function(te){var ne=te.deltaX,oe=te.deltaY,ie=R.props,ae=ie.graphModel,se=ie.lf,ue=se.getTransform(),fe=ue.SCALE_X,le=ue.SCALE_Y,de=ae.getSelectElements(!0);ae.moveNodes(de.nodes.map(function(ce){return ce.id}),ne/fe,oe/le)},R.handleContextMenu=function(te){te.preventDefault();var ne=R.props,oe=ne.graphModel,ie=ne.graphModel,ae=ie.eventCenter,se=ie.selectElements,ue=oe.getPointByClient({x:te.clientX,y:te.clientY}),fe={nodes:[],edges:[]},le=__spreadArray$1([],__read$1(se.values()),!1);le.forEach(function(de){de.BaseType===ElementType.NODE&&fe.nodes.push(de.getData()),de.BaseType===ElementType.EDGE&&fe.edges.push(de.getData())}),ae.emit(EventType.SELECTION_CONTEXTMENU,{data:fe,e:te,position:ue})};var Y=E.graphModel,Z=Y.gridSize,ee=Y.eventCenter;return R.stepDrag=new StepDrag({onDragging:R.onDragging,step:Z,eventType:"SELECTION",eventCenter:ee}),R}return h.prototype.render=function(){var E,R,Y=this.props.graphModel,Z=Y.selectElements,ee=Y.transformModel,te=this.props.lf.getTransform(),ne=te.SCALE_X,oe=te.SCALE_Y;if(!(Z.size<=1)){var ie=Number.MAX_SAFE_INTEGER,ae=Number.MAX_SAFE_INTEGER,se=Number.MIN_SAFE_INTEGER,ue=Number.MIN_SAFE_INTEGER;Z.forEach(function(le){var de;le.BaseType===ElementType.NODE&&(de=getNodeOutline(le)),le.BaseType===ElementType.EDGE&&(de=getEdgeOutline(le)),de!==void 0&&(ie=Math.min(ie,de.x),ae=Math.min(ae,de.y),se=Math.max(se,de.x1),ue=Math.max(ue,de.y1))}),E=__read$1(ee.CanvasPointToHtmlPoint([ie,ae]),2),ie=E[0],ae=E[1],R=__read$1(ee.CanvasPointToHtmlPoint([se,ue]),2),se=R[0],ue=R[1];var fe={left:"".concat(ie-20*ne/2,"px"),top:"".concat(ae-20*oe/2,"px"),width:"".concat(se-ie+20*ne,"px"),height:"".concat(ue-ae+20*oe,"px"),"border-width":"".concat(2*ne,"px")};return u("div",{className:"lf-multiple-select",style:fe,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},h.toolName="multiple-select-tool",h=__decorate$3([observer],h),h}(x),__decorate$2=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},defaultTools=[TextEditTool,MultipleSelect],Tool=function(){function t(h){var E=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=h,forEach$3(defaultTools,function(Z){E.isDisabled(Z.toolName)||E.registerTool(Z.toolName,Z)});var R=h.graphModel,Y=R.eventCenter;Y.on("".concat(EventType.GRAPH_TRANSFORM,",").concat(EventType.NODE_CLICK,",").concat(EventType.BLANK_CLICK," "),function(){var Z,ee=R.textEditElement,te=R.editConfigModel,ne=te.edgeTextEdit,oe=te.nodeTextEdit;(ne||oe)&&ee&&((Z=R.textEditElement)===null||Z===void 0||Z.setElementState(ElementState.DEFAULT))})}return t.prototype.isDisabled=function(h){var E;return((E=this.instance.options.disabledTools)===null||E===void 0?void 0:E.indexOf(h))!==-1},t.prototype.registerTool=function(h,E){this.toolMap.set(h,E)},t.prototype.disableTool=function(h){var E=this.toolMap.get(h);if(E)return this.disabledToolMap.set(h,E),this.toolMap.delete(h),!0;throw new Error("禁用失败，不存在名为 ${tool} 的工具")},t.prototype.enableTool=function(h){var E=this.disabledToolMap.get(h);if(E)return this.toolMap.set(h,E),this.disabledToolMap.delete(h),!0;throw new Error("不存在名为 ${tool} 的工具")},t.prototype.getTools=function(){return Array.from(this.toolMap.values())},t.prototype.getInstance=function(){return this.instance},__decorate$2([observable$1],t.prototype,"toolMap",void 0),__decorate$2([action],t.prototype,"disableTool",null),__decorate$2([action],t.prototype,"enableTool",null),t}();function fail$1(t){throw new Error("[mobx-utils] "+t)}function invariant(t,h){h===void 0&&(h="Illegal state"),t||fail$1(h)}var deepFields=function(t){return t&&t!==Object.prototype&&Object.getOwnPropertyNames(t).concat(deepFields(Object.getPrototypeOf(t))||[])},distinctDeepFields=function(t){var h=deepFields(t),E=h.filter(function(R,Y){return h.indexOf(R)===Y});return E},getAllMethodsAndProperties=function(t){return distinctDeepFields(t).filter(function(h){return h!=="constructor"&&!~h.indexOf("__")})},PENDING="pending",FULFILLED="fulfilled",REJECTED="rejected";function caseImpl(t){switch(this.state){case PENDING:return t.pending&&t.pending(this.value);case REJECTED:return t.rejected&&t.rejected(this.value);case FULFILLED:return t.fulfilled?t.fulfilled(this.value):this.value}}function fromPromise(t,h){if(invariant(arguments.length<=2,"fromPromise expects up to two arguments"),invariant(typeof t=="function"||typeof t=="object"&&t&&typeof t.then=="function","Please pass a promise or function to fromPromise"),t.isPromiseBasedObservable===!0)return t;typeof t=="function"&&(t=new Promise(t));var E=t;t.then(action("observableFromPromise-resolve",function(Y){E.value=Y,E.state=FULFILLED}),action("observableFromPromise-reject",function(Y){E.value=Y,E.state=REJECTED})),E.isPromiseBasedObservable=!0,E.case=caseImpl;var R=h&&h.state===FULFILLED?h.value:void 0;return extendObservable(E,{value:R,state:PENDING},{},{deep:!1}),E}(function(t){t.reject=action("fromPromise.reject",function(E){var R=t(Promise.reject(E));return R.state=REJECTED,R.value=E,R});function h(E){E===void 0&&(E=void 0);var R=t(Promise.resolve(E));return R.state=FULFILLED,R.value=E,R}t.resolve=action("fromPromise.resolve",h)})(fromPromise||(fromPromise={}));var __decorate=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z};(function(){function t(h,E){var R=this;runInAction(function(){R.current=E,R.subscription=h.subscribe(R)})}return t.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},t.prototype.next=function(h){this.current=h},t.prototype.complete=function(){this.dispose()},t.prototype.error=function(h){this.current=h,this.dispose()},__decorate([observable$1.ref],t.prototype,"current",void 0),__decorate([action.bound],t.prototype,"next",null),__decorate([action.bound],t.prototype,"complete",null),__decorate([action.bound],t.prototype,"error",null),t})();var __assign$3=function(){return __assign$3=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$3.apply(this,arguments)},__decorate$1=function(t,h,E,R){var Y=arguments.length,Z=Y<3?h:R===null?R=Object.getOwnPropertyDescriptor(h,E):R,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(t,h,E,R);else for(var te=t.length-1;te>=0;te--)(ee=t[te])&&(Z=(Y<3?ee(Z):Y>3?ee(h,E,Z):ee(h,E))||Z);return Y>3&&Z&&Object.defineProperty(h,E,Z),Z},RESERVED_NAMES=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function t(h){var E=this;this.model=h,this.localValues=observable$1.map({}),this.localComputedValues=observable$1.map({}),this.isPropertyDirty=function(R){return E.localValues.has(R)},invariant(isObservableObject(h),"createViewModel expects an observable object"),getAllMethodsAndProperties(h).forEach(function(R){if(!(R===$mobx||R==="__mobxDidRunLazyInitializers")){if(invariant(RESERVED_NAMES.indexOf(R)===-1,"The propertyname "+R+" is reserved and cannot be used with viewModels"),isComputedProp(h,R)){var Y=getAdministration(h,R).derivation;E.localComputedValues.set(R,computed(Y.bind(E)))}var Z=Object.getOwnPropertyDescriptor(h,R),ee=Z?{enumerable:Z.enumerable}:{};Object.defineProperty(E,R,__assign$3(__assign$3({},ee),{configurable:!0,get:function(){return isComputedProp(h,R)?E.localComputedValues.get(R).get():E.isPropertyDirty(R)?E.localValues.get(R):E.model[R]},set:action(function(te){te!==E.model[R]?E.localValues.set(R,te):E.localValues.delete(R)})}))}})}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),t.prototype.submit=function(){var h=this;keys$1(this.localValues).forEach(function(E){var R=h.localValues.get(E),Y=h.model[E];isObservableArray(Y)?Y.replace(R):isObservableMap(Y)?(Y.clear(),Y.merge(R)):isComputed(R)||(h.model[E]=R)}),this.localValues.clear()},t.prototype.reset=function(){this.localValues.clear()},t.prototype.resetProperty=function(h){this.localValues.delete(h)},__decorate$1([computed],t.prototype,"isDirty",null),__decorate$1([computed],t.prototype,"changedValues",null),__decorate$1([action.bound],t.prototype,"submit",null),__decorate$1([action.bound],t.prototype,"reset",null),__decorate$1([action.bound],t.prototype,"resetProperty",null),t})();function buildPath(t){if(!t)return"ROOT";for(var h=[];t.parent;)h.push(t.path),t=t.parent;return h.reverse().join("/")}function isRecursivelyObservable(t){return isObservableObject(t)||isObservableArray(t)||isObservableMap(t)}function deepObserve(t,h){var E=new WeakMap;function R(te){var ne=E.get(te.object);Y(te,ne),h(te,buildPath(ne),t)}function Y(te,ne){switch(te.type){case"add":Z(te.newValue,ne,te.name);break;case"update":ee(te.oldValue),Z(te.newValue,ne,te.name||""+te.index);break;case"remove":case"delete":ee(te.oldValue);break;case"splice":te.removed.map(ee),te.added.forEach(function(ae,se){return Z(ae,ne,""+(te.index+se))});for(var oe=te.index+te.addedCount;oe<te.object.length;oe++)if(isRecursivelyObservable(te.object[oe])){var ie=E.get(te.object[oe]);ie&&(ie.path=""+oe)}break}}function Z(te,ne,oe){if(isRecursivelyObservable(te)){var ie=E.get(te);if(ie){if(ie.parent!==ne||ie.path!==oe)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+buildPath(ne)+"/"+oe+"',")+(" but it already exists at '"+buildPath(ie.parent)+"/"+ie.path+"'"))}else{var ae={parent:ne,path:oe,dispose:observe(te,R)};E.set(te,ae),entries(te).forEach(function(se){var ue=se[0],fe=se[1];return Z(fe,ae,ue)})}}}function ee(te){if(isRecursivelyObservable(te)){var ne=E.get(te);if(!ne)return;E.delete(te),ne.dispose(),values(te).forEach(ee)}}return Z(t,void 0,""),function(){ee(t)}}var __extends=function(){var t=function(h,E){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,Y){R.__proto__=Y}||function(R,Y){for(var Z in Y)Y.hasOwnProperty(Z)&&(R[Z]=Y[Z])},t(h,E)};return function(h,E){t(h,E);function R(){this.constructor=h}h.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}}();(function(t){__extends(h,t);function h(E,R,Y){var Z=Y===void 0?{}:Y,ee=Z.name,te=ee===void 0?"ogm"+(Math.random()*1e3|0):ee,ne=Z.keyToName,oe=ne===void 0?function(se){return""+se}:ne,ie=t.call(this)||this;ie._keyToName=oe,ie._groupBy=R,ie._ogmInfoKey=Symbol("ogmInfo"+te),ie._base=E;for(var ae=0;ae<E.length;ae++)ie._addItem(E[ae]);return ie._disposeBaseObserver=observe(ie._base,function(se){if(se.type==="splice")transaction(function(){for(var ue=0,fe=se.removed;ue<fe.length;ue++){var le=fe[ue];ie._removeItem(le)}for(var de=0,ce=se.added;de<ce.length;de++){var pe=ce[de];ie._addItem(pe)}});else if(se.type==="update")transaction(function(){ie._removeItem(se.oldValue),ie._addItem(se.newValue)});else throw new Error("illegal state")}),ie}return h.prototype.clear=function(){throw new Error("not supported")},h.prototype.delete=function(E){throw new Error("not supported")},h.prototype.set=function(E,R){throw new Error("not supported")},h.prototype.dispose=function(){this._disposeBaseObserver();for(var E=0;E<this._base.length;E++){var R=this._base[E],Y=R[this._ogmInfoKey];Y.reaction(),delete R[this._ogmInfoKey]}},h.prototype._getGroupArr=function(E){var R=t.prototype.get.call(this,E);return R===void 0&&(R=observable$1([],{name:"GroupArray["+this._keyToName(E)+"]",deep:!1}),t.prototype.set.call(this,E,R)),R},h.prototype._removeFromGroupArr=function(E,R){var Y=t.prototype.get.call(this,E);Y.length===1?t.prototype.delete.call(this,E):(R===Y.length-1||(Y[R]=Y[Y.length-1],Y[R][this._ogmInfoKey].groupArrIndex=R),Y.length--)},h.prototype._addItem=function(E){var R=this,Y=this._groupBy(E),Z=this._getGroupArr(Y),ee={groupByValue:Y,groupArrIndex:Z.length,reaction:reaction(function(){return R._groupBy(E)},function(te,ne){var oe=E[R._ogmInfoKey];R._removeFromGroupArr(oe.groupByValue,oe.groupArrIndex);var ie=R._getGroupArr(te),ae=ie.length;ie.push(E),oe.groupByValue=te,oe.groupArrIndex=ae})};Object.defineProperty(E,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:ee}),Z.push(E)},h.prototype._removeItem=function(E){var R=E[this._ogmInfoKey];this._removeFromGroupArr(R.groupByValue,R.groupArrIndex),R.reaction(),delete E[this._ogmInfoKey]},h})(ObservableMap),Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var __assign$2=function(){return __assign$2=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$2.apply(this,arguments)},History=function(){function t(h){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=h}return t.prototype.add=function(h){isEqual(last(this.undos),h)||(this.undos.push(h),isEqual(this.curData,h)||(this.redos=[]),this.eventCenter.emit(EventType.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},t.prototype.undoAble=function(){return this.undos.length>1},t.prototype.undo=function(){if(this.undoAble()){var h=this.undos.pop();this.redos.push(h);var E=this.undos.pop();return this.curData=cloneDeep(E),E}},t.prototype.redoAble=function(){return this.redos.length>0},t.prototype.redo=function(){if(this.redoAble()){var h=this.redos.pop();return this.curData=cloneDeep(h),h}},t.prototype.watch=function(h){var E=this;this.stopWatch&&this.stopWatch(),this.undos.push(h.modelToGraphData()),this.stopWatch=deepObserve(h,debounce(function(){var R=h.modelToHistoryData();R&&E.add(__assign$2({},R))},this.waitTime))},t}(),mousetrap={exports:{}};(function(t){(function(h,E,R){if(!h)return;for(var Y={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},Z={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ee={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},te={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},ne,oe=1;oe<20;++oe)Y[111+oe]="f"+oe;for(oe=0;oe<=9;++oe)Y[oe+96]=oe.toString();function ie(ye,me,Ee){if(ye.addEventListener){ye.addEventListener(me,Ee,!1);return}ye.attachEvent("on"+me,Ee)}function ae(ye){if(ye.type=="keypress"){var me=String.fromCharCode(ye.which);return ye.shiftKey||(me=me.toLowerCase()),me}return Y[ye.which]?Y[ye.which]:Z[ye.which]?Z[ye.which]:String.fromCharCode(ye.which).toLowerCase()}function se(ye,me){return ye.sort().join(",")===me.sort().join(",")}function ue(ye){var me=[];return ye.shiftKey&&me.push("shift"),ye.altKey&&me.push("alt"),ye.ctrlKey&&me.push("ctrl"),ye.metaKey&&me.push("meta"),me}function fe(ye){if(ye.preventDefault){ye.preventDefault();return}ye.returnValue=!1}function le(ye){if(ye.stopPropagation){ye.stopPropagation();return}ye.cancelBubble=!0}function de(ye){return ye=="shift"||ye=="ctrl"||ye=="alt"||ye=="meta"}function ce(){if(!ne){ne={};for(var ye in Y)ye>95&&ye<112||Y.hasOwnProperty(ye)&&(ne[Y[ye]]=ye)}return ne}function pe(ye,me,Ee){return Ee||(Ee=ce()[ye]?"keydown":"keypress"),Ee=="keypress"&&me.length&&(Ee="keydown"),Ee}function he(ye){return ye==="+"?["+"]:(ye=ye.replace(/\+{2}/g,"+plus"),ye.split("+"))}function ge(ye,me){var Ee,Oe,Te,Pe=[];for(Ee=he(ye),Te=0;Te<Ee.length;++Te)Oe=Ee[Te],te[Oe]&&(Oe=te[Oe]),me&&me!="keypress"&&ee[Oe]&&(Oe=ee[Oe],Pe.push("shift")),de(Oe)&&Pe.push(Oe);return me=pe(Oe,Pe,me),{key:Oe,modifiers:Pe,action:me}}function ve(ye,me){return ye===null||ye===E?!1:ye===me?!0:ve(ye.parentNode,me)}function _e(ye){var me=this;if(ye=ye||E,!(me instanceof _e))return new _e(ye);me.target=ye,me._callbacks={},me._directMap={};var Ee={},Oe,Te=!1,Pe=!1,Re=!1;function De(Se){Se=Se||{};var we=!1,Ce;for(Ce in Ee){if(Se[Ce]){we=!0;continue}Ee[Ce]=0}we||(Re=!1)}function je(Se,we,Ce,$e,Ie,He){var Ae,Be,Ue=[],ke=Ce.type;if(!me._callbacks[Se])return[];for(ke=="keyup"&&de(Se)&&(we=[Se]),Ae=0;Ae<me._callbacks[Se].length;++Ae)if(Be=me._callbacks[Se][Ae],!(!$e&&Be.seq&&Ee[Be.seq]!=Be.level)&&ke==Be.action&&(ke=="keypress"&&!Ce.metaKey&&!Ce.ctrlKey||se(we,Be.modifiers))){var Ge=!$e&&Be.combo==Ie,ze=$e&&Be.seq==$e&&Be.level==He;(Ge||ze)&&me._callbacks[Se].splice(Ae,1),Ue.push(Be)}return Ue}function Fe(Se,we,Ce,$e){me.stopCallback(we,we.target||we.srcElement,Ce,$e)||Se(we,Ce)===!1&&(fe(we),le(we))}me._handleKey=function(Se,we,Ce){var $e=je(Se,we,Ce),Ie,He={},Ae=0,Be=!1;for(Ie=0;Ie<$e.length;++Ie)$e[Ie].seq&&(Ae=Math.max(Ae,$e[Ie].level));for(Ie=0;Ie<$e.length;++Ie){if($e[Ie].seq){if($e[Ie].level!=Ae)continue;Be=!0,He[$e[Ie].seq]=1,Fe($e[Ie].callback,Ce,$e[Ie].combo,$e[Ie].seq);continue}Be||Fe($e[Ie].callback,Ce,$e[Ie].combo)}var Ue=Ce.type=="keypress"&&Pe;Ce.type==Re&&!de(Se)&&!Ue&&De(He),Pe=Be&&Ce.type=="keydown"};function xe(Se){typeof Se.which!="number"&&(Se.which=Se.keyCode);var we=ae(Se);if(we){if(Se.type=="keyup"&&Te===we){Te=!1;return}me.handleKey(we,ue(Se),Se)}}function Ne(){clearTimeout(Oe),Oe=setTimeout(De,1e3)}function Me(Se,we,Ce,$e){Ee[Se]=0;function Ie(ke){return function(){Re=ke,++Ee[Se],Ne()}}function He(ke){Fe(Ce,ke,Se),$e!=="keyup"&&(Te=ae(ke)),setTimeout(De,10)}for(var Ae=0;Ae<we.length;++Ae){var Be=Ae+1===we.length,Ue=Be?He:Ie($e||ge(we[Ae+1]).action);Le(we[Ae],Ue,$e,Se,Ae)}}function Le(Se,we,Ce,$e,Ie){me._directMap[Se+":"+Ce]=we,Se=Se.replace(/\s+/g," ");var He=Se.split(" "),Ae;if(He.length>1){Me(Se,He,we,Ce);return}Ae=ge(Se,Ce),me._callbacks[Ae.key]=me._callbacks[Ae.key]||[],je(Ae.key,Ae.modifiers,{type:Ae.action},$e,Se,Ie),me._callbacks[Ae.key][$e?"unshift":"push"]({callback:we,modifiers:Ae.modifiers,action:Ae.action,seq:$e,level:Ie,combo:Se})}me._bindMultiple=function(Se,we,Ce){for(var $e=0;$e<Se.length;++$e)Le(Se[$e],we,Ce)},ie(ye,"keypress",xe),ie(ye,"keydown",xe),ie(ye,"keyup",xe)}_e.prototype.bind=function(ye,me,Ee){var Oe=this;return ye=ye instanceof Array?ye:[ye],Oe._bindMultiple.call(Oe,ye,me,Ee),Oe},_e.prototype.unbind=function(ye,me){var Ee=this;return Ee.bind.call(Ee,ye,function(){},me)},_e.prototype.trigger=function(ye,me){var Ee=this;return Ee._directMap[ye+":"+me]&&Ee._directMap[ye+":"+me]({},ye),Ee},_e.prototype.reset=function(){var ye=this;return ye._callbacks={},ye._directMap={},ye},_e.prototype.stopCallback=function(ye,me){var Ee=this;if((" "+me.className+" ").indexOf(" mousetrap ")>-1||ve(me,Ee.target))return!1;if("composedPath"in ye&&typeof ye.composedPath=="function"){var Oe=ye.composedPath()[0];Oe!==ye.target&&(me=Oe)}return me.tagName=="INPUT"||me.tagName=="SELECT"||me.tagName=="TEXTAREA"||me.isContentEditable},_e.prototype.handleKey=function(){var ye=this;return ye._handleKey.apply(ye,arguments)},_e.addKeycodes=function(ye){for(var me in ye)ye.hasOwnProperty(me)&&(Y[me]=ye[me]);ne=null},_e.init=function(){var ye=_e(E);for(var me in ye)me.charAt(0)!=="_"&&(_e[me]=function(Ee){return function(){return ye[Ee].apply(ye,arguments)}}(me))},_e.init(),h.Mousetrap=_e,t.exports&&(t.exports=_e)})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(mousetrap);var mousetrapExports=mousetrap.exports;const Mousetrap=getDefaultExportFromCjs(mousetrapExports);var __assign$1=function(){return __assign$1=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign$1.apply(this,arguments)},selected=null;function translateNodeData(t,h){return t.x+=h,t.y+=h,isEmpty$1(t.text)||(t.text.x+=h,t.text.y+=h),t}function translateEdgeData(t,h){return t.startPoint&&(t.startPoint.x+=h,t.startPoint.y+=h),t.endPoint&&(t.endPoint.x+=h,t.endPoint.y+=h),t.pointsList&&t.pointsList.length>0&&t.pointsList.forEach(function(E){E.x+=h,E.y+=h}),isEmpty$1(t.text)||(t.text.x+=h,t.text.y+=h),t}var TRANSLATION_DISTANCE=40,CHILDREN_TRANSLATION_DISTANCE=40;function initDefaultShortcut(t,h){var E=t.keyboard,R=E.options.keyboard;E.on(["cmd + c","ctrl + c"],function(){if(CHILDREN_TRANSLATION_DISTANCE=TRANSLATION_DISTANCE,!(R!=null&&R.enabled)||h.textEditElement)return!0;var Y=t.options.guards,Z=h.getSelectElements(!1),ee=Y&&Y.beforeClone?Y.beforeClone(Z):!0;return!ee||Z.nodes.length===0&&Z.edges.length===0?(selected=null,!0):(selected=Z,selected.nodes.forEach(function(te){return translateNodeData(te,TRANSLATION_DISTANCE)}),selected.edges.forEach(function(te){return translateEdgeData(te,TRANSLATION_DISTANCE)}),!1)}),E.on(["cmd + v","ctrl + v"],function(){if(!(R!=null&&R.enabled)||h.textEditElement)return!0;if(selected&&(selected.nodes||selected.edges)){t.clearSelectElements();var Y=t.addElements(selected,CHILDREN_TRANSLATION_DISTANCE);if(!Y)return!0;Y.nodes.forEach(function(Z){return t.selectElementById(Z.id,!0)}),Y.edges.forEach(function(Z){return t.selectElementById(Z.id,!0)}),selected.nodes.forEach(function(Z){return translateNodeData(Z,TRANSLATION_DISTANCE)}),selected.edges.forEach(function(Z){return translateEdgeData(Z,TRANSLATION_DISTANCE)}),CHILDREN_TRANSLATION_DISTANCE=CHILDREN_TRANSLATION_DISTANCE+TRANSLATION_DISTANCE}return!1}),E.on(["cmd + z","ctrl + z"],function(){return!(R!=null&&R.enabled)||h.textEditElement?!0:(t.undo(),!1)}),E.on(["cmd + y","ctrl + y"],function(){return!(R!=null&&R.enabled)||h.textEditElement?!0:(t.redo(),!1)}),E.on(["backspace"],function(){if(!(R!=null&&R.enabled)||h.textEditElement)return!0;var Y=h.getSelectElements(!0);return t.clearSelectElements(),Y.edges.forEach(function(Z){return Z.id&&t.deleteEdge(Z.id)}),Y.nodes.forEach(function(Z){return Z.id&&t.deleteNode(Z.id)}),!1})}var Keyboard=function(){function t(h){h.keyboard||(h.keyboard={enabled:!1}),this.options=h;var E=h.lf;this.target=E.container,this.mousetrap=new Mousetrap(this.target),h.keyboard.enabled&&!E.options.isSilentMode&&this.enable(!0)}return t.prototype.initShortcuts=function(){var h=this,E,R=((E=this.options.keyboard)!==null&&E!==void 0?E:{}).shortcuts;if(R)if(isArray$2(R))R.forEach(function(te){var ne=te.keys,oe=te.callback,ie=te.action;return h.on(ne,oe,ie)});else{var Y=R.keys,Z=R.callback,ee=R.action;this.on(Y,Z,ee)}},t.prototype.on=function(h,E,R){this.mousetrap.bind(this.getKeys(h),E,R)},Object.defineProperty(t.prototype,"disabled",{get:function(){var h,E;return((E=(h=this.options)===null||h===void 0?void 0:h.keyboard)===null||E===void 0?void 0:E.enabled)!==!0},enumerable:!1,configurable:!0}),t.prototype.off=function(h,E){this.mousetrap.unbind(this.getKeys(h),E)},t.prototype.enable=function(h){(this.disabled||h)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},t.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},t.prototype.getKeys=function(h){var E=this;return(Array.isArray(h)?h:[h]).map(function(R){return E.formatKey(R)})},t.prototype.formatKey=function(h){return h.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},t}(),__assign=function(){return __assign=Object.assign||function(t){for(var h,E=1,R=arguments.length;E<R;E++){h=arguments[E];for(var Y in h)Object.prototype.hasOwnProperty.call(h,Y)&&(t[Y]=h[Y])}return t},__assign.apply(this,arguments)},__read=function(t,h){var E=typeof Symbol=="function"&&t[Symbol.iterator];if(!E)return t;var R=E.call(t),Y,Z=[],ee;try{for(;(h===void 0||h-- >0)&&!(Y=R.next()).done;)Z.push(Y.value)}catch(te){ee={error:te}}finally{try{Y&&!Y.done&&(E=R.return)&&E.call(R)}finally{if(ee)throw ee.error}}return Z},__spreadArray=function(t,h,E){if(E||arguments.length===2)for(var R=0,Y=h.length,Z;R<Y;R++)(Z||!(R in h))&&(Z||(Z=Array.prototype.slice.call(h,0,R)),Z[R]=h[R]);return t.concat(Z||Array.prototype.slice.call(h))},pluginFlag=Symbol("plugin registered by Logicflow.use"),LogicFlow=function(){function t(h){var E=this,R;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(oe,ie){return E.viewMap.set(oe,ie)},this.getView=function(oe){return E.viewMap.get(oe)};var Y=Options.get(h),Z=Y.container,ee=Y.width,te=Y.height;this.options=Y,this.container=this.initContainer(Z,ee,te),this.graphModel=new GraphModel(__assign(__assign({},Y),{container:this.container})),this.plugins=(R=Y.plugins)!==null&&R!==void 0?R:[];var ne=this.graphModel.eventCenter;this.tool=new Tool(this),this.dnd=new Dnd({lf:this}),this.history=new History(ne),this.keyboard=new Keyboard({lf:this,keyboard:Y.keyboard}),Y.snapline!==!1&&(this.snaplineModel=new SnaplineModel(this.graphModel),snapline(ne,this.snaplineModel)),Y.isSilentMode||(initDefaultShortcut(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(Y.disabledPlugins)}return t.prototype.initContainer=function(h,E,R){var Y=document.createElement("div");return Y.style.position="relative",Y.style.width=E?"".concat(E,"px"):"100%",Y.style.height=R?"".concat(R,"px"):"100%",h.innerHTML="",h.appendChild(Y),Y},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return t.toStringTag},enumerable:!1,configurable:!0}),t.prototype.register=function(h,E,R){if(R===void 0&&(R=!0),typeof h!="string"){this.registerElement(h);return}var Y={BaseEdge,BaseEdgeModel,BaseNode,BaseNodeModel,RectNode,RectNodeModel,CircleNode,CircleNodeModel,PolygonNode,PolygonNodeModel,TextNode,TextNodeModel,LineEdge,LineEdgeModel,DiamondNode,DiamondNodeModel,PolylineEdge,PolylineEdgeModel,BezierEdge,BezierEdgeModel,EllipseNode,EllipseNodeModel,HtmlNode,HtmlNodeModel,h:g$2,type:h};if(this.viewMap.forEach(function(oe){var ie=oe.extendKey;ie&&(Y[ie]=oe)}),this.graphModel.modelMap.forEach(function(oe){var ie=oe.extendKey;ie&&(Y[ie]=oe)}),E){var Z=E(Y),ee=Z.view,te=Z.model,ne=ee;R&&!ne.isObserved&&(ne.isObserved=!0,ne=observer(ne)),this.setView(h,ne),this.graphModel.setModel(h,te)}},t.prototype.registerElement=function(h){var E=h.view;h.isObserverView!==!1&&!E.isObserved&&(E.isObserved=!0,E=observer(E)),this.setView(h.type,E),this.graphModel.setModel(h.type,h.model)},t.prototype.batchRegister=function(h){var E=this;h===void 0&&(h=[]),forEach$3(h,function(R){E.registerElement(R)})},t.prototype.defaultRegister=function(){var h=[{type:"rect",view:RectNode,model:RectNodeModel},{type:"circle",view:CircleNode,model:CircleNodeModel},{type:"polygon",view:PolygonNode,model:PolygonNodeModel},{type:"text",view:TextNode,model:TextNodeModel},{type:"ellipse",view:EllipseNode,model:EllipseNodeModel},{type:"diamond",view:DiamondNode,model:DiamondNodeModel},{type:"html",view:HtmlNode,model:HtmlNodeModel},{type:"line",view:LineEdge,model:LineEdgeModel},{type:"polyline",view:PolylineEdge,model:PolylineEdgeModel},{type:"bezier",view:BezierEdge,model:BezierEdgeModel}];this.batchRegister(h)},t.prototype.addNode=function(h,E,R){return E===void 0&&(E=EventType.NODE_ADD),this.graphModel.addNode(h,E,R)},t.prototype.deleteNode=function(h){var E=this.graphModel.getNodeModelById(h);if(!E)return!1;var R=E.getData(),Y=this.options.guards,Z=Y!=null&&Y.beforeDelete?Y.beforeDelete(R):!0;return Z&&this.graphModel.deleteNode(h),Z},t.prototype.cloneNode=function(h){var E=this.graphModel.getNodeModelById(h),R=E==null?void 0:E.getData();if(R){var Y=this.options.guards,Z=Y!=null&&Y.beforeClone?Y.beforeClone(R):!0;if(Z)return this.graphModel.cloneNode(h)}},t.prototype.changeNodeId=function(h,E){return this.graphModel.changeNodeId(h,E)},t.prototype.changeNodeType=function(h,E){this.graphModel.changeNodeType(h,E)},t.prototype.getNodeModelById=function(h){return this.graphModel.getNodeModelById(h)},t.prototype.getNodeDataById=function(h){var E=this.getNodeModelById(h);return E==null?void 0:E.getData()},t.prototype.getNodeIncomingEdge=function(h){return this.graphModel.getNodeIncomingEdge(h)},t.prototype.getNodeOutgoingEdge=function(h){return this.graphModel.getNodeOutgoingEdge(h)},t.prototype.getNodeIncomingNode=function(h){return this.graphModel.getNodeIncomingNode(h)},t.prototype.getNodeOutgoingNode=function(h){return this.graphModel.getNodeOutgoingNode(h)},t.prototype.createFakeNode=function(h){var E=this.graphModel.modelMap.get(h.type);if(!E)return console.warn("不存在为".concat(h.type,"类型的节点")),null;var R=new E(__assign(__assign({},h),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(R),R},t.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},t.prototype.setNodeSnapLine=function(h){var E;(E=this.snaplineModel)===null||E===void 0||E.setNodeSnapLine(h)},t.prototype.removeNodeSnapLine=function(){var h;(h=this.snaplineModel)===null||h===void 0||h.clearSnapline()},t.prototype.setDefaultEdgeType=function(h){this.graphModel.setDefaultEdgeType(h)},t.prototype.addEdge=function(h){return this.graphModel.addEdge(h)},t.prototype.getEdgeDataById=function(h){var E=this.getEdgeModelById(h);return E==null?void 0:E.getData()},t.prototype.getEdgeModelById=function(h){return this.graphModel.getEdgeModelById(h)},t.prototype.getEdgeModels=function(h){var E=h.sourceNodeId,R=h.targetNodeId,Y=[],Z=this.graphModel.edges;return E&&R?forEach$3(Z,function(ee){ee.sourceNodeId===E&&ee.targetNodeId===R&&Y.push(ee)}):E?forEach$3(Z,function(ee){ee.sourceNodeId===E&&Y.push(ee)}):R&&forEach$3(Z,function(ee){ee.targetNodeId===R&&Y.push(ee)}),Y},t.prototype.changeEdgeId=function(h,E){return this.graphModel.changeEdgeId(h,E)},t.prototype.changeEdgeType=function(h,E){this.graphModel.changeEdgeType(h,E)},t.prototype.deleteEdge=function(h){var E=this.graphModel.getEdgeModelById(h);if(!E)return!1;var R=E.getData(),Y=this.options.guards,Z=Y!=null&&Y.beforeDelete?Y.beforeDelete(R):!0;return Z&&this.graphModel.deleteEdgeById(h),Z},t.prototype.deleteEdgeByNodeId=function(h){var E=h.sourceNodeId,R=h.targetNodeId;E&&R?this.graphModel.deleteEdgeBySourceAndTarget(E,R):E?this.graphModel.deleteEdgeBySource(E):R&&this.graphModel.deleteEdgeByTarget(R)},t.prototype.getNodeEdges=function(h){return this.graphModel.getNodeEdges(h)},t.prototype.addElements=function(h,E){var R=this,Y=h.nodes,Z=h.edges;E===void 0&&(E=40),console.log("distance",E);var ee={},te={nodes:[],edges:[]};return forEach$3(Y,function(ne){var oe=ne.id,ie=R.addNode(ne);oe&&(ee[oe]=ie.id),te.nodes.push(ie)}),forEach$3(Z,function(ne){var oe=ne.sourceNodeId,ie=ne.targetNodeId;ee[oe]&&(oe=ee[oe]),ee[ie]&&(ie=ee[ie]);var ae=R.graphModel.addEdge(__assign(__assign({},ne),{sourceNodeId:oe,targetNodeId:ie}));te.edges.push(ae)}),te},t.prototype.selectElementById=function(h,E,R){E===void 0&&(E=!1),R===void 0&&(R=!0),this.graphModel.selectElementById(h,E),!E&&R&&this.graphModel.toFront(h)},t.prototype.getSelectElements=function(h){return h===void 0&&(h=!0),this.graphModel.getSelectElements(h)},t.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},t.prototype.getModelById=function(h){return this.graphModel.getElement(h)},t.prototype.getDataById=function(h){var E;return(E=this.graphModel.getElement(h))===null||E===void 0?void 0:E.getData()},t.prototype.deleteElement=function(h){var E,R,Y,Z=this.getModelById(h);if(!Z)return!1;var ee=(E={},E[ElementType.NODE]=this.deleteNode,E[ElementType.EDGE]=this.deleteEdge,E);return(Y=(R=ee[Z.BaseType])===null||R===void 0?void 0:R.call(this,h))!==null&&Y!==void 0?Y:!1},t.prototype.setElementZIndex=function(h,E){return this.graphModel.setElementZIndex(h,E)},t.prototype.getAreaElement=function(h,E,R,Y,Z){return R===void 0&&(R=!0),Y===void 0&&(Y=!0),Z===void 0&&(Z=!1),this.graphModel.getAreaElement(h,E,R,Y,Z).map(function(ee){return ee.getData()})},t.prototype.setProperties=function(h,E){var R;(R=this.graphModel.getElement(h))===null||R===void 0||R.setProperties(formatData(E))},t.prototype.getProperties=function(h){var E;return(E=this.graphModel.getElement(h))===null||E===void 0?void 0:E.getProperties()},t.prototype.deleteProperty=function(h,E){var R;(R=this.graphModel.getElement(h))===null||R===void 0||R.deleteProperty(E)},t.prototype.updateAttributes=function(h,E){this.graphModel.updateAttributes(h,E)},t.prototype.editText=function(h){this.graphModel.editText(h)},t.prototype.updateText=function(h,E){this.graphModel.updateText(h,E)},t.prototype.updateEditConfig=function(h){var E=this.graphModel,R=E.editConfigModel,Y=E.transformModel;R.updateEditConfig(h),(h==null?void 0:h.stopMoveGraph)!==void 0&&Y.updateTranslateLimits(h.stopMoveGraph),h!=null&&h.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0)},t.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},t.prototype.setTheme=function(h){this.graphModel.setTheme(h)},t.prototype.focusByElement=function(h){var E=void 0,R=this.getNodeModelById(h);if(R){var Y=R.getData(),Z=Y.x,ee=Y.y;E={x:Z,y:ee}}var te=this.getEdgeModelById(h);if(te){var ne=te.textPosition,Z=ne.x,ee=ne.y;E={x:Z,y:ee}}E&&this.focusByCoordinate(E)},t.prototype.focusByCoordinate=function(h){var E=this.graphModel,R=E.transformModel,Y=E.width,Z=E.height,ee=h.x,te=h.y;R.focusOn(ee,te,Y,Z)},t.prototype.focusOn=function(h){if(typeof h=="string")this.focusByElement(h);else if("x"in h&&"y"in h)this.focusByCoordinate(h);else{var E=h.id,R=h.coordinate;E&&this.focusByElement(E),R&&this.focusByCoordinate(R)}},t.prototype.resize=function(h,E){this.graphModel.resize(h,E),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},t.prototype.toFront=function(h){this.graphModel.toFront(h)},t.prototype.getPointByClient=function(h,E){if(typeof h=="object")return this.graphModel.getPointByClient(h);if(typeof E=="number")return this.graphModel.getPointByClient({x:h,y:E})},t.prototype.getGraphData=function(){for(var h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];var R=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,__spreadArray([R],__read(h),!1)):R},t.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},t.prototype.clearData=function(){this.graphModel.clearData()},t.prototype.renderRawData=function(h){this.graphModel.graphDataToModel(formatData(h)),this.options.history!==!1&&this.history.watch(this.graphModel),X(u(Graph,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(EventType.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},t.prototype.render=function(h){var E=cloneDeep(h);this.adapterIn&&(E=this.adapterIn(E)),this.renderRawData(E)},t.prototype.undo=function(){if(this.history.undoAble()){var h=formatData(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(h)}},t.prototype.redo=function(){if(this.history.redoAble()){var h=formatData(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(h)}},t.prototype.zoom=function(h,E){var R=this.graphModel.transformModel;return R.zoom(h,E)},t.prototype.resetZoom=function(){var h=this.graphModel.transformModel;h.resetZoom()},t.prototype.setZoomMiniSize=function(h){var E=this.graphModel.transformModel;E.setZoomMiniSize(h)},t.prototype.setZoomMaxSize=function(h){var E=this.graphModel.transformModel;E.setZoomMaxSize(h)},t.prototype.getTransform=function(){var h=this.graphModel.transformModel,E=h.SCALE_X,R=h.SCALE_Y,Y=h.TRANSLATE_X,Z=h.TRANSLATE_Y;return{SCALE_X:E,SCALE_Y:R,TRANSLATE_X:Y,TRANSLATE_Y:Z}},t.prototype.translate=function(h,E){var R=this.graphModel.transformModel;R.translate(h,E)},t.prototype.resetTranslate=function(){var h=this.graphModel.transformModel,E=h.TRANSLATE_X,R=h.TRANSLATE_Y;this.translate(-E,-R)},t.prototype.translateCenter=function(){this.graphModel.translateCenter()},t.prototype.fitView=function(h,E){E===void 0&&(E=h),this.graphModel.fitView(h,E)},t.prototype.openEdgeAnimation=function(h){this.graphModel.openEdgeAnimation(h)},t.prototype.closeEdgeAnimation=function(h){this.graphModel.closeEdgeAnimation(h)},t.prototype.on=function(h,E){this.graphModel.eventCenter.on(h,E)},t.prototype.off=function(h,E){this.graphModel.eventCenter.off(h,E)},t.prototype.once=function(h,E){this.graphModel.eventCenter.once(h,E)},t.prototype.emit=function(h,E){this.graphModel.eventCenter.emit(h,E)},t.use=function(h,E){var R,Y=h.pluginName;if(!Y)throw new Error("请给插件指定 pluginName!");this.extensions.set(Y,(R={},R[pluginFlag]=pluginFlag,R.extension=h,R.props=E,R))},t.prototype.installPlugins=function(h){var E=this;h===void 0&&(h=[]);var R=Array.from(t.extensions,function(Z){var ee=__read(Z,2),te=ee[1];return te}),Y=__spreadArray(__spreadArray([],__read(this.plugins),!1),__read(R),!1);forEach$3(Y,function(Z){var ee,te;pluginFlag in Z?(ee=Z.extension,te=Z.props):ee=Z;var ne=ee==null?void 0:ee.pluginName;indexOf(h,ne)===-1&&E.installPlugin(ee,te)})},t.prototype.installPlugin=function(h,E){var R,Y;if("pluginName"in h&&"install"in h){var Z=h.pluginName,ee=h.install,te=h.render;Z&&(ee&&ee.call(h,this,t),te&&this.components.push(te.bind(h)),this.extension[Z]=h);return}var ne=h,oe=ne.pluginName,ie=new ne({lf:this,LogicFlow:t,props:E,options:(Y=(R=this.options.pluginsOptions)===null||R===void 0?void 0:R[oe])!==null&&Y!==void 0?Y:{}});ie.render&&this.components.push(ie.render.bind(ie)),this.extension[oe]=ie},t.prototype.destroy=function(){this.graphModel.destroy()},t.extensions=new Map,t}();(function(t){t.toStringTag="LF.".concat(t.name)})(LogicFlow||(LogicFlow={}));function observer(t){return observer$1(t)}const toString$1=t=>Object.prototype.toString.call(t),is=(t,h)=>toString$1(t)===`[object ${h}]`,isNull=t=>t===null,isString$3=t=>is(t,"String"),isObject$2=t=>!isNull(t)&&is(t,"Object"),isArray$1=t=>Array.isArray(t),isMap=t=>t instanceof Map,isSet=t=>t instanceof Set,isEmpty=t=>isNull(t)?!0:isArray$1(t)||isString$3(t)?t.length===0:isMap(t)||isSet(t)?t.size===0:isObject$2(t)?Object.keys(t).length===0:!0;class Runner{constructor(){be(this,"nodes",[{type:"CommonNode",model:CommonNode,x:0,y:0},{type:"StartNode",model:StartNode,x:0,y:0},{type:"ComponentNode",model:ComponentNode,x:0,y:0}]);be(this,"snapshootWindow",window)}registerWindow(h){this.snapshootWindow=h}registerNode(h){const E=this.nodes.concat(h);this.nodes=E.reduce((R,Y)=>R.find(ee=>ee.type===Y.type)?R:R.concat([Y]),[])}async execute(h,E){var ee,te;console.log("runner:开始执行",h);const R=new Engine({context:E,debug:!0});this.nodes.forEach(ne=>{R.register({type:ne.type,model:ne.model})}),R.load({graphData:h,globalData:{},startNodeType:((te=(ee=h==null?void 0:h.nodes)==null?void 0:ee[0])==null?void 0:te.type)||"StartNode"});const Y=await R.execute();console.log("runner:",Y);const Z=await R.getExecutionRecord(Y.executionId);console.log(Z),R.destroy()}getRenderSchema(){return this.snapshootWindow.__RENDER_PAGE_STATE__}async executeLifeCycle(h,E,R,Y){var ne,oe;const ee=this.getRenderSchema().flows||[],te=((oe=(ne=E==null?void 0:E.lifeCycles)==null?void 0:ne[h])==null?void 0:oe.flowIdList)||[];if(te&&(te!=null&&te.length)){console.log("runner,flowIdList:",te);for(let ie=0;ie<te.length;ie++){const ae=te[ie],se=ee.find(ue=>ue.code===ae);se&&await this.execute(se.data,{pageInstance:R,schema:E,args:Y})}}}async executeFunction(h,E,R,Y){const Z=E.schema;if(Z){const te=this.getRenderSchema().flows||[],ne=get$1(Z.props,h,{}),oe=(ne==null?void 0:ne.flowIdList)||[];if(oe&&(oe!=null&&oe.length)){console.log("runner,flowIdList:",oe);for(let ie=0;ie<oe.length;ie++){const ae=oe[ie],se=te.find(ue=>ue.code===ae);se&&await this.execute(se.data,{pageInstance:R,schema:Z,args:Y})}}}}}class Adapter{constructor(){be(this,"runtime");be(this,"builtinModules",["Component","PureComponent","createElement","createContext","forwardRef","findDOMNode"]);be(this,"env");be(this,"renderers");be(this,"configProvider");this.initRuntime()}initRuntime(){const h=class{constructor(){be(this,"state");be(this,"props");be(this,"refs");be(this,"context")}setState(){}forceUpdate(){}render(){}},E=class{constructor(){be(this,"state");be(this,"props");be(this,"refs");be(this,"context")}setState(){}forceUpdate(){}render(){}},R=()=>{},Y=()=>{},Z=()=>{},ee=()=>{};this.runtime={Component:h,PureComponent:E,createElement:R,createContext:Y,forwardRef:Z,findDOMNode:ee}}setRuntime(h){this.isValidRuntime(h)&&(this.runtime=h)}isValidRuntime(h){return typeof h!="object"||Array.isArray(h)?!1:this.builtinModules.every(E=>{const R=!!h[E];if(!R)throw new Error(`runtime is invalid, module '${E}' does not exist`);return R})}getRuntime(){return this.runtime}setEnv(h){this.env=h}isReact(){return this.env==="react"}setRenderers(h){this.renderers=h}getRenderers(){return this.renderers||{}}setConfigProvider(h){this.configProvider=h}getConfigProvider(){return this.configProvider}}const adapter=new Adapter;function contextFactory(){const{createContext:t}=adapter.getRuntime();let h=window.__appContext;return h||(h=t({}),window.__appContext=h),h}function divFactory(){var E;const{PureComponent:t,createElement:h}=adapter.getRuntime();return E=class extends t{render(){return h("div",this.props)}},be(E,"displayName","Div"),be(E,"version","0.0.0"),E}var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function t(R,Y,Z,ee,te,ne){if(ne!==ReactPropTypesSecret){var oe=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw oe.name="Invariant Violation",oe}}t.isRequired=t;function h(){return t}var E={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:h,element:t,elementType:t,instanceOf:h,node:t,objectOf:h,oneOf:h,oneOfType:h,shape:h,exact:h,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return E.PropTypes=E,E};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs(propTypesExports);function visualDomFactory(){var E;const{PureComponent:t,createElement:h}=adapter.getRuntime();return E=class extends t{render(){const{children:Y,cell:Z,title:ee,label:te,text:ne,__componentName:oe}=this.props;let ie=Y;return Z&&typeof Z=="function"&&(ie=Z()),h("div",{className:"visual-dom"},h("div",{className:"panel-container"},[h("span",{className:"title"},ee||te||ne||oe),h("div",{className:"content"},ie)]))}},be(E,"displayName","VisualDom"),be(E,"propTypes",{children:PropTypes.oneOfType([PropTypes.element,PropTypes.arrayOf(PropTypes.element)])}),be(E,"defaultProps",{children:null}),E}function isFunction$1(t){return typeof t=="function"}function createErrorClass(t){var h=function(R){Error.call(R),R.stack=new Error().stack},E=t(h);return E.prototype=Object.create(Error.prototype),E.prototype.constructor=E,E}var UnsubscriptionError=createErrorClass(function(t){return function(E){t(this),this.message=E?E.length+` errors occurred during unsubscription:
`+E.map(function(R,Y){return Y+1+") "+R.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=E}});function arrRemove(t,h){if(t){var E=t.indexOf(h);0<=E&&t.splice(E,1)}}var Subscription=function(){function t(h){this.initialTeardown=h,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var h,E,R,Y,Z;if(!this.closed){this.closed=!0;var ee=this._parentage;if(ee)if(this._parentage=null,Array.isArray(ee))try{for(var te=__values$3(ee),ne=te.next();!ne.done;ne=te.next()){var oe=ne.value;oe.remove(this)}}catch(le){h={error:le}}finally{try{ne&&!ne.done&&(E=te.return)&&E.call(te)}finally{if(h)throw h.error}}else ee.remove(this);var ie=this.initialTeardown;if(isFunction$1(ie))try{ie()}catch(le){Z=le instanceof UnsubscriptionError?le.errors:[le]}var ae=this._finalizers;if(ae){this._finalizers=null;try{for(var se=__values$3(ae),ue=se.next();!ue.done;ue=se.next()){var fe=ue.value;try{execFinalizer(fe)}catch(le){Z=Z??[],le instanceof UnsubscriptionError?Z=__spreadArray$b(__spreadArray$b([],__read$B(Z)),__read$B(le.errors)):Z.push(le)}}}catch(le){R={error:le}}finally{try{ue&&!ue.done&&(Y=se.return)&&Y.call(se)}finally{if(R)throw R.error}}}if(Z)throw new UnsubscriptionError(Z)}},t.prototype.add=function(h){var E;if(h&&h!==this)if(this.closed)execFinalizer(h);else{if(h instanceof t){if(h.closed||h._hasParent(this))return;h._addParent(this)}(this._finalizers=(E=this._finalizers)!==null&&E!==void 0?E:[]).push(h)}},t.prototype._hasParent=function(h){var E=this._parentage;return E===h||Array.isArray(E)&&E.includes(h)},t.prototype._addParent=function(h){var E=this._parentage;this._parentage=Array.isArray(E)?(E.push(h),E):E?[E,h]:h},t.prototype._removeParent=function(h){var E=this._parentage;E===h?this._parentage=null:Array.isArray(E)&&arrRemove(E,h)},t.prototype.remove=function(h){var E=this._finalizers;E&&arrRemove(E,h),h instanceof t&&h._removeParent(this)},t.EMPTY=function(){var h=new t;return h.closed=!0,h}(),t}(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(t){return t instanceof Subscription||t&&"closed"in t&&isFunction$1(t.remove)&&isFunction$1(t.add)&&isFunction$1(t.unsubscribe)}function execFinalizer(t){isFunction$1(t)?t():t.unsubscribe()}var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider={setTimeout:function(t,h){for(var E=[],R=2;R<arguments.length;R++)E[R-2]=arguments[R];return setTimeout.apply(void 0,__spreadArray$b([t,h],__read$B(E)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function reportUnhandledError(t){timeoutProvider.setTimeout(function(){throw t})}function noop$1(){}function errorContext(t){t()}var Subscriber=function(t){__extends$I(h,t);function h(E){var R=t.call(this)||this;return R.isStopped=!1,E?(R.destination=E,isSubscription(E)&&E.add(R)):R.destination=EMPTY_OBSERVER,R}return h.create=function(E,R,Y){return new SafeSubscriber(E,R,Y)},h.prototype.next=function(E){this.isStopped||this._next(E)},h.prototype.error=function(E){this.isStopped||(this.isStopped=!0,this._error(E))},h.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},h.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},h.prototype._next=function(E){this.destination.next(E)},h.prototype._error=function(E){try{this.destination.error(E)}finally{this.unsubscribe()}},h.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},h}(Subscription),_bind=Function.prototype.bind;function bind$1(t,h){return _bind.call(t,h)}var ConsumerObserver=function(){function t(h){this.partialObserver=h}return t.prototype.next=function(h){var E=this.partialObserver;if(E.next)try{E.next(h)}catch(R){handleUnhandledError(R)}},t.prototype.error=function(h){var E=this.partialObserver;if(E.error)try{E.error(h)}catch(R){handleUnhandledError(R)}else handleUnhandledError(h)},t.prototype.complete=function(){var h=this.partialObserver;if(h.complete)try{h.complete()}catch(E){handleUnhandledError(E)}},t}(),SafeSubscriber=function(t){__extends$I(h,t);function h(E,R,Y){var Z=t.call(this)||this,ee;if(isFunction$1(E)||!E)ee={next:E??void 0,error:R??void 0,complete:Y??void 0};else{var te;Z&&config.useDeprecatedNextContext?(te=Object.create(E),te.unsubscribe=function(){return Z.unsubscribe()},ee={next:E.next&&bind$1(E.next,te),error:E.error&&bind$1(E.error,te),complete:E.complete&&bind$1(E.complete,te)}):ee=E}return Z.destination=new ConsumerObserver(ee),Z}return h}(Subscriber);function handleUnhandledError(t){reportUnhandledError(t)}function defaultErrorHandler(t){throw t}var EMPTY_OBSERVER={closed:!0,next:noop$1,error:defaultErrorHandler,complete:noop$1},observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function identity(t){return t}function pipeFromArray(t){return t.length===0?identity:t.length===1?t[0]:function(E){return t.reduce(function(R,Y){return Y(R)},E)}}var Observable=function(){function t(h){h&&(this._subscribe=h)}return t.prototype.lift=function(h){var E=new t;return E.source=this,E.operator=h,E},t.prototype.subscribe=function(h,E,R){var Y=this,Z=isSubscriber(h)?h:new SafeSubscriber(h,E,R);return errorContext(function(){var ee=Y,te=ee.operator,ne=ee.source;Z.add(te?te.call(Z,ne):ne?Y._subscribe(Z):Y._trySubscribe(Z))}),Z},t.prototype._trySubscribe=function(h){try{return this._subscribe(h)}catch(E){h.error(E)}},t.prototype.forEach=function(h,E){var R=this;return E=getPromiseCtor(E),new E(function(Y,Z){var ee=new SafeSubscriber({next:function(te){try{h(te)}catch(ne){Z(ne),ee.unsubscribe()}},error:Z,complete:Y});R.subscribe(ee)})},t.prototype._subscribe=function(h){var E;return(E=this.source)===null||E===void 0?void 0:E.subscribe(h)},t.prototype[observable]=function(){return this},t.prototype.pipe=function(){for(var h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];return pipeFromArray(h)(this)},t.prototype.toPromise=function(h){var E=this;return h=getPromiseCtor(h),new h(function(R,Y){var Z;E.subscribe(function(ee){return Z=ee},function(ee){return Y(ee)},function(){return R(Z)})})},t.create=function(h){return new t(h)},t}();function getPromiseCtor(t){var h;return(h=t??config.Promise)!==null&&h!==void 0?h:Promise}function isObserver(t){return t&&isFunction$1(t.next)&&isFunction$1(t.error)&&isFunction$1(t.complete)}function isSubscriber(t){return t&&t instanceof Subscriber||isObserver(t)&&isSubscription(t)}var ObjectUnsubscribedError=createErrorClass(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Subject=function(t){__extends$I(h,t);function h(){var E=t.call(this)||this;return E.closed=!1,E.currentObservers=null,E.observers=[],E.isStopped=!1,E.hasError=!1,E.thrownError=null,E}return h.prototype.lift=function(E){var R=new AnonymousSubject(this,this);return R.operator=E,R},h.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},h.prototype.next=function(E){var R=this;errorContext(function(){var Y,Z;if(R._throwIfClosed(),!R.isStopped){R.currentObservers||(R.currentObservers=Array.from(R.observers));try{for(var ee=__values$3(R.currentObservers),te=ee.next();!te.done;te=ee.next()){var ne=te.value;ne.next(E)}}catch(oe){Y={error:oe}}finally{try{te&&!te.done&&(Z=ee.return)&&Z.call(ee)}finally{if(Y)throw Y.error}}}})},h.prototype.error=function(E){var R=this;errorContext(function(){if(R._throwIfClosed(),!R.isStopped){R.hasError=R.isStopped=!0,R.thrownError=E;for(var Y=R.observers;Y.length;)Y.shift().error(E)}})},h.prototype.complete=function(){var E=this;errorContext(function(){if(E._throwIfClosed(),!E.isStopped){E.isStopped=!0;for(var R=E.observers;R.length;)R.shift().complete()}})},h.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(h.prototype,"observed",{get:function(){var E;return((E=this.observers)===null||E===void 0?void 0:E.length)>0},enumerable:!1,configurable:!0}),h.prototype._trySubscribe=function(E){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,E)},h.prototype._subscribe=function(E){return this._throwIfClosed(),this._checkFinalizedStatuses(E),this._innerSubscribe(E)},h.prototype._innerSubscribe=function(E){var R=this,Y=this,Z=Y.hasError,ee=Y.isStopped,te=Y.observers;return Z||ee?EMPTY_SUBSCRIPTION:(this.currentObservers=null,te.push(E),new Subscription(function(){R.currentObservers=null,arrRemove(te,E)}))},h.prototype._checkFinalizedStatuses=function(E){var R=this,Y=R.hasError,Z=R.thrownError,ee=R.isStopped;Y?E.error(Z):ee&&E.complete()},h.prototype.asObservable=function(){var E=new Observable;return E.source=this,E},h.create=function(E,R){return new AnonymousSubject(E,R)},h}(Observable),AnonymousSubject=function(t){__extends$I(h,t);function h(E,R){var Y=t.call(this)||this;return Y.destination=E,Y.source=R,Y}return h.prototype.next=function(E){var R,Y;(Y=(R=this.destination)===null||R===void 0?void 0:R.next)===null||Y===void 0||Y.call(R,E)},h.prototype.error=function(E){var R,Y;(Y=(R=this.destination)===null||R===void 0?void 0:R.error)===null||Y===void 0||Y.call(R,E)},h.prototype.complete=function(){var E,R;(R=(E=this.destination)===null||E===void 0?void 0:E.complete)===null||R===void 0||R.call(E)},h.prototype._subscribe=function(E){var R,Y;return(Y=(R=this.source)===null||R===void 0?void 0:R.subscribe(E))!==null&&Y!==void 0?Y:EMPTY_SUBSCRIPTION},h}(Subject);new Subject,new Subject;const excludePropertyNames=["$$typeof","render","defaultProps","props","length","prototype","name","caller","callee","arguments"];function cloneEnumerableProperty(t,h,E=excludePropertyNames){return Object.keys(h).filter(Y=>!E.includes(Y)).forEach(Y=>{t[Y]=h[Y]}),t}const hasSymbol=typeof Symbol=="function"&&Symbol.for,REACT_FORWARD_REF_TYPE=hasSymbol?Symbol.for("react.forward_ref"):60112,REACT_MEMO_TYPE=hasSymbol?Symbol.for("react.memo"):60115;function isReactClass(t){return t?!!(t.prototype&&(t.prototype.isReactComponent||t.prototype instanceof require$$0.Component)):!1}function isForwardRefType(t){return!t||!(t!=null&&t.$$typeof)?!1:(t==null?void 0:t.$$typeof)===REACT_FORWARD_REF_TYPE}function isMemoType(t){return!t||!(t!=null&&t.$$typeof)?!1:t.$$typeof===REACT_MEMO_TYPE}function isReactComponent(t){return t?!!(isReactClass(t)||typeof t=="function"||isForwardRefType(t)||isMemoType(t)):!1}function isObject$1(t){return t!==null&&typeof t=="object"}function isJSExpression(t){return isObject$1(t)?t.type==="JSExpression"&&t.extType!=="function":!1}function isString$2(t){return{}.toString.call(t)==="[object String]"}function inSameDomain$1(){try{return window.parent!==window&&window.parent.location.host===window.location.host}catch{return!1}}function parseExpression$1(t,h,E=!1){let R,Y,Z,ee;typeof t=="object"&&h===void 0?(R=t.str,Y=t.self,Z=t.thisRequired,ee=t.errCallback,t.logScope):(R=t,Y=h,Z=E);try{const te=['"use strict";',"var __self = arguments[0];"];te.push("return ");let ne;if(ne=(R.value||"").trim(),ne=ne.replace(/this(\W|$)/g,(ie,ae)=>`__self${ae}`),ne=te.join(`
`)+ne,inSameDomain$1()&&window.parent.__newFunc)return window.parent.__newFunc(ne)(Y);const oe=`with(${Z?"{}":"$scope || {}"}) { ${ne} }`;return new Function("$scope",oe)(Y)}catch(te){ee==null||ee(te);return}}function forEach$2(t,h,E){!t||Array.isArray(t)||isString$2(t)||typeof t!="object"||Object.keys(t).forEach(R=>h.call(E,t[R],R))}function parseData$1(t,h,E={}){if(isJSExpression(t))return parseExpression$1({str:t,self:h,thisRequired:E.thisRequiredInJSE,logScope:E.logScope,errCallback:E==null?void 0:E.errCallback});if(typeof t=="string")return t.trim();if(Array.isArray(t))return t.map(R=>parseData$1(R,h,E));if(typeof t=="function")return t.bind(h);if(typeof t=="object"){if(!t)return t;const R={};return forEach$2(t,(Y,Z)=>{Z.startsWith("__")||(R[Z]=parseData$1(Y,h,E))}),R}return t}const levels={debug:-1,log:0,info:0,warn:1,error:2},bizNameColors=["#daa569","#00ffff","#385e0f","#7fffd4","#00c957","#b0e0e6","#4169e1","#6a5acd","#87ceeb","#ffff00","#e3cf57","#ff9912","#eb8e55","#ffe384","#40e0d0","#a39480","#d2691e","#ff7d40","#f0e68c","#bc8f8f","#c76114","#734a12","#5e2612","#0000ff","#3d59ab","#1e90ff","#03a89e","#33a1c9","#a020f0","#a066d3","#da70d6","#dda0dd","#688e23","#2e8b57"],bodyColors={debug:"#fadb14",log:"#8c8c8c",info:"#52c41a",warn:"#fa8c16",error:"#ff4d4f"},levelMarks={debug:"debug",log:"log",info:"info",warn:"warn",error:"error"},outputFunction={debug:console.log,log:console.log,info:console.log,warn:console.warn,error:console.error},bizNameColorConfig={},shouldOutput=(t,h="warn",E,R)=>{const Y=levels[h]<=levels[t],Z=R==="*"||E.indexOf(R)>-1;return Y&&Z},output=(t,h)=>(...E)=>{var R;return(R=outputFunction[t])==null?void 0:R.apply(console,getLogArgs(E,h,t))},getColor=t=>{if(!bizNameColorConfig[t]){const h=bizNameColors[Object.keys(bizNameColorConfig).length%bizNameColors.length];bizNameColorConfig[t]=h}return bizNameColorConfig[t]},getLogArgs=(t,h,E)=>{const R=getColor(h),Y=bodyColors[E],Z=t[0];let ee=`%c[${h}]%c[${levelMarks[E]}]:`;Z.forEach(ne=>{isObject$1(ne)?ee+="%o":ee+="%s"});let te=[ee,`color: ${R}`,`color: ${Y}`];return te=te.concat(Z),te},parseLogConf=(t,h)=>{if(!t)return{level:h.level,bizName:h.bizName};if(t.indexOf(":")>-1){const E=t.split(":");return{level:E[0],bizName:E[1]||"*"}}return{level:t,bizName:"*"}},defaultOptions={level:"warn",bizName:"*"};class Logger{constructor(h){be(this,"bizName");be(this,"targetBizName");be(this,"targetLevel");h={...defaultOptions,...h};const E=location||{},R=(/__(?:logConf|logLevel)__=([^#/&]*)/.exec(E.href)||[])[1],Y=parseLogConf(R,h);this.bizName=h.bizName,this.targetBizName=Y.bizName,this.targetLevel=Y.level}debug(...h){if(shouldOutput("debug",this.targetLevel,this.bizName,this.targetBizName))return output("debug",this.bizName)(h)}log(...h){if(shouldOutput("log",this.targetLevel,this.bizName,this.targetBizName))return output("log",this.bizName)(h)}info(...h){if(shouldOutput("info",this.targetLevel,this.bizName,this.targetBizName))return output("info",this.bizName)(h)}warn(...h){if(shouldOutput("warn",this.targetLevel,this.bizName,this.targetBizName))return output("warn",this.bizName)(h)}error(...h){if(shouldOutput("error",this.targetLevel,this.bizName,this.targetBizName))return output("error",this.bizName)(h)}}function getLogger(t){return new Logger(t)}var IPublicEnumTransformStage=(t=>(t.Render="render",t.Serilize="serilize",t.Save="save",t.Clone="clone",t.Init="init",t.Upgrade="upgrade",t))(IPublicEnumTransformStage||{});const Rerender="node.edit.rerender.time";function isInnerJsFunction(t){return isObject$1(t)?t.type==="JSExpression"&&t.extType==="function":!1}function isJSFunction(t){return isObject$1(t)?t.type==="JSFunction"||isInnerJsFunction(t):!1}function checkPropTypes(t,h,E,R){return!0}function isI18nData(t){return isObject$1(t)?t.type==="i18n":!1}const logger$2=new Logger({level:"warn",bizName:"renderer"});function memoize(t,h){var E=h&&h.cache?h.cache:cacheDefault,R=h&&h.serializer?h.serializer:serializerDefault,Y=h&&h.strategy?h.strategy:strategyDefault;return Y(t,{cache:E,serializer:R})}function isPrimitive(t){return t==null||typeof t=="number"||typeof t=="boolean"}function monadic(t,h,E,R){var Y=isPrimitive(R)?R:E(R),Z=h.get(Y);return typeof Z>"u"&&(Z=t.call(this,R),h.set(Y,Z)),Z}function variadic(t,h,E){var R=Array.prototype.slice.call(arguments,3),Y=E(R),Z=h.get(Y);return typeof Z>"u"&&(Z=t.apply(this,R),h.set(Y,Z)),Z}function assemble(t,h,E,R,Y){return E.bind(h,t,R,Y)}function strategyDefault(t,h){var E=t.length===1?monadic:variadic;return assemble(t,this,E,h.cache.create(),h.serializer)}function strategyVariadic(t,h){return assemble(t,this,variadic,h.cache.create(),h.serializer)}function strategyMonadic(t,h){return assemble(t,this,monadic,h.cache.create(),h.serializer)}var serializerDefault=function(){return JSON.stringify(arguments)};function ObjectWithoutPrototypeCache(){this.cache=Object.create(null)}ObjectWithoutPrototypeCache.prototype.get=function(t){return this.cache[t]},ObjectWithoutPrototypeCache.prototype.set=function(t,h){this.cache[t]=h};var cacheDefault={create:function(){return new ObjectWithoutPrototypeCache}},strategies={variadic:strategyVariadic,monadic:strategyMonadic},ErrorKind;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(ErrorKind||(ErrorKind={}));var TYPE;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(TYPE||(TYPE={}));var SKELETON_TYPE;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(SKELETON_TYPE||(SKELETON_TYPE={}));function isLiteralElement(t){return t.type===TYPE.literal}function isArgumentElement(t){return t.type===TYPE.argument}function isNumberElement(t){return t.type===TYPE.number}function isDateElement(t){return t.type===TYPE.date}function isTimeElement(t){return t.type===TYPE.time}function isSelectElement(t){return t.type===TYPE.select}function isPluralElement(t){return t.type===TYPE.plural}function isPoundElement(t){return t.type===TYPE.pound}function isTagElement(t){return t.type===TYPE.tag}function isNumberSkeleton(t){return!!(t&&typeof t=="object"&&t.type===SKELETON_TYPE.number)}function isDateTimeSkeleton(t){return!!(t&&typeof t=="object"&&t.type===SKELETON_TYPE.dateTime)}var SPACE_SEPARATOR_REGEX=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,DATE_TIME_REGEX=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function parseDateTimeSkeleton(t){var h={};return t.replace(DATE_TIME_REGEX,function(E){var R=E.length;switch(E[0]){case"G":h.era=R===4?"long":R===5?"narrow":"short";break;case"y":h.year=R===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":h.month=["numeric","2-digit","short","long","narrow"][R-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":h.day=["numeric","2-digit"][R-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":h.weekday=R===4?"long":R===5?"narrow":"short";break;case"e":if(R<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");h.weekday=["short","long","narrow","short"][R-4];break;case"c":if(R<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");h.weekday=["short","long","narrow","short"][R-4];break;case"a":h.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":h.hourCycle="h12",h.hour=["numeric","2-digit"][R-1];break;case"H":h.hourCycle="h23",h.hour=["numeric","2-digit"][R-1];break;case"K":h.hourCycle="h11",h.hour=["numeric","2-digit"][R-1];break;case"k":h.hourCycle="h24",h.hour=["numeric","2-digit"][R-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":h.minute=["numeric","2-digit"][R-1];break;case"s":h.second=["numeric","2-digit"][R-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":h.timeZoneName=R<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),h}var WHITE_SPACE_REGEX=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function parseNumberSkeletonFromString(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var h=t.split(WHITE_SPACE_REGEX).filter(function(se){return se.length>0}),E=[],R=0,Y=h;R<Y.length;R++){var Z=Y[R],ee=Z.split("/");if(ee.length===0)throw new Error("Invalid number skeleton");for(var te=ee[0],ne=ee.slice(1),oe=0,ie=ne;oe<ie.length;oe++){var ae=ie[oe];if(ae.length===0)throw new Error("Invalid number skeleton")}E.push({stem:te,options:ne})}return E}function icuUnitToEcma(t){return t.replace(/^(.*?)-/,"")}var FRACTION_PRECISION_REGEX=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,SIGNIFICANT_PRECISION_REGEX=/^(@+)?(\+|#+)?[rs]?$/g,INTEGER_WIDTH_REGEX=/(\*)(0+)|(#+)(0+)|(0+)/g,CONCISE_INTEGER_WIDTH_REGEX=/^(0+)$/;function parseSignificantPrecision(t){var h={};return t[t.length-1]==="r"?h.roundingPriority="morePrecision":t[t.length-1]==="s"&&(h.roundingPriority="lessPrecision"),t.replace(SIGNIFICANT_PRECISION_REGEX,function(E,R,Y){return typeof Y!="string"?(h.minimumSignificantDigits=R.length,h.maximumSignificantDigits=R.length):Y==="+"?h.minimumSignificantDigits=R.length:R[0]==="#"?h.maximumSignificantDigits=R.length:(h.minimumSignificantDigits=R.length,h.maximumSignificantDigits=R.length+(typeof Y=="string"?Y.length:0)),""}),h}function parseSign(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function parseConciseScientificAndEngineeringStem(t){var h;if(t[0]==="E"&&t[1]==="E"?(h={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(h={notation:"scientific"},t=t.slice(1)),h){var E=t.slice(0,2);if(E==="+!"?(h.signDisplay="always",t=t.slice(2)):E==="+?"&&(h.signDisplay="exceptZero",t=t.slice(2)),!CONCISE_INTEGER_WIDTH_REGEX.test(t))throw new Error("Malformed concise eng/scientific notation");h.minimumIntegerDigits=t.length}return h}function parseNotationOptions(t){var h={},E=parseSign(t);return E||h}function parseNumberSkeleton(t){for(var h={},E=0,R=t;E<R.length;E++){var Y=R[E];switch(Y.stem){case"percent":case"%":h.style="percent";continue;case"%x100":h.style="percent",h.scale=100;continue;case"currency":h.style="currency",h.currency=Y.options[0];continue;case"group-off":case",_":h.useGrouping=!1;continue;case"precision-integer":case".":h.maximumFractionDigits=0;continue;case"measure-unit":case"unit":h.style="unit",h.unit=icuUnitToEcma(Y.options[0]);continue;case"compact-short":case"K":h.notation="compact",h.compactDisplay="short";continue;case"compact-long":case"KK":h.notation="compact",h.compactDisplay="long";continue;case"scientific":h=__assign$R(__assign$R(__assign$R({},h),{notation:"scientific"}),Y.options.reduce(function(ne,oe){return __assign$R(__assign$R({},ne),parseNotationOptions(oe))},{}));continue;case"engineering":h=__assign$R(__assign$R(__assign$R({},h),{notation:"engineering"}),Y.options.reduce(function(ne,oe){return __assign$R(__assign$R({},ne),parseNotationOptions(oe))},{}));continue;case"notation-simple":h.notation="standard";continue;case"unit-width-narrow":h.currencyDisplay="narrowSymbol",h.unitDisplay="narrow";continue;case"unit-width-short":h.currencyDisplay="code",h.unitDisplay="short";continue;case"unit-width-full-name":h.currencyDisplay="name",h.unitDisplay="long";continue;case"unit-width-iso-code":h.currencyDisplay="symbol";continue;case"scale":h.scale=parseFloat(Y.options[0]);continue;case"rounding-mode-floor":h.roundingMode="floor";continue;case"rounding-mode-ceiling":h.roundingMode="ceil";continue;case"rounding-mode-down":h.roundingMode="trunc";continue;case"rounding-mode-up":h.roundingMode="expand";continue;case"rounding-mode-half-even":h.roundingMode="halfEven";continue;case"rounding-mode-half-down":h.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":h.roundingMode="halfExpand";continue;case"integer-width":if(Y.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");Y.options[0].replace(INTEGER_WIDTH_REGEX,function(ne,oe,ie,ae,se,ue){if(oe)h.minimumIntegerDigits=ie.length;else{if(ae&&se)throw new Error("We currently do not support maximum integer digits");if(ue)throw new Error("We currently do not support exact integer digits")}return""});continue}if(CONCISE_INTEGER_WIDTH_REGEX.test(Y.stem)){h.minimumIntegerDigits=Y.stem.length;continue}if(FRACTION_PRECISION_REGEX.test(Y.stem)){if(Y.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");Y.stem.replace(FRACTION_PRECISION_REGEX,function(ne,oe,ie,ae,se,ue){return ie==="*"?h.minimumFractionDigits=oe.length:ae&&ae[0]==="#"?h.maximumFractionDigits=ae.length:se&&ue?(h.minimumFractionDigits=se.length,h.maximumFractionDigits=se.length+ue.length):(h.minimumFractionDigits=oe.length,h.maximumFractionDigits=oe.length),""});var Z=Y.options[0];Z==="w"?h=__assign$R(__assign$R({},h),{trailingZeroDisplay:"stripIfInteger"}):Z&&(h=__assign$R(__assign$R({},h),parseSignificantPrecision(Z)));continue}if(SIGNIFICANT_PRECISION_REGEX.test(Y.stem)){h=__assign$R(__assign$R({},h),parseSignificantPrecision(Y.stem));continue}var ee=parseSign(Y.stem);ee&&(h=__assign$R(__assign$R({},h),ee));var te=parseConciseScientificAndEngineeringStem(Y.stem);te&&(h=__assign$R(__assign$R({},h),te))}return h}var timeData={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function getBestPattern(t,h){for(var E="",R=0;R<t.length;R++){var Y=t.charAt(R);if(Y==="j"){for(var Z=0;R+1<t.length&&t.charAt(R+1)===Y;)Z++,R++;var ee=1+(Z&1),te=Z<2?1:3+(Z>>1),ne="a",oe=getDefaultHourSymbolFromLocale(h);for((oe=="H"||oe=="k")&&(te=0);te-- >0;)E+=ne;for(;ee-- >0;)E=oe+E}else Y==="J"?E+="H":E+=Y}return E}function getDefaultHourSymbolFromLocale(t){var h=t.hourCycle;if(h===void 0&&t.hourCycles&&t.hourCycles.length&&(h=t.hourCycles[0]),h)switch(h){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var E=t.language,R;E!=="root"&&(R=t.maximize().region);var Y=timeData[R||""]||timeData[E||""]||timeData["".concat(E,"-001")]||timeData["001"];return Y[0]}var _a,SPACE_SEPARATOR_START_REGEX=new RegExp("^".concat(SPACE_SEPARATOR_REGEX.source,"*")),SPACE_SEPARATOR_END_REGEX=new RegExp("".concat(SPACE_SEPARATOR_REGEX.source,"*$"));function createLocation(t,h){return{start:t,end:h}}var hasNativeStartsWith=!!String.prototype.startsWith&&"_a".startsWith("a",1),hasNativeFromCodePoint=!!String.fromCodePoint,hasNativeFromEntries=!!Object.fromEntries,hasNativeCodePointAt=!!String.prototype.codePointAt,hasTrimStart=!!String.prototype.trimStart,hasTrimEnd=!!String.prototype.trimEnd,hasNativeIsSafeInteger=!!Number.isSafeInteger,isSafeInteger=hasNativeIsSafeInteger?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},REGEX_SUPPORTS_U_AND_Y=!0;try{var re=RE("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");REGEX_SUPPORTS_U_AND_Y=((_a=re.exec("a"))===null||_a===void 0?void 0:_a[0])==="a"}catch(t){REGEX_SUPPORTS_U_AND_Y=!1}var startsWith=hasNativeStartsWith?function(h,E,R){return h.startsWith(E,R)}:function(h,E,R){return h.slice(R,R+E.length)===E},fromCodePoint=hasNativeFromCodePoint?String.fromCodePoint:function(){for(var h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];for(var R="",Y=h.length,Z=0,ee;Y>Z;){if(ee=h[Z++],ee>1114111)throw RangeError(ee+" is not a valid code point");R+=ee<65536?String.fromCharCode(ee):String.fromCharCode(((ee-=65536)>>10)+55296,ee%1024+56320)}return R},fromEntries=hasNativeFromEntries?Object.fromEntries:function(h){for(var E={},R=0,Y=h;R<Y.length;R++){var Z=Y[R],ee=Z[0],te=Z[1];E[ee]=te}return E},codePointAt=hasNativeCodePointAt?function(h,E){return h.codePointAt(E)}:function(h,E){var R=h.length;if(!(E<0||E>=R)){var Y=h.charCodeAt(E),Z;return Y<55296||Y>56319||E+1===R||(Z=h.charCodeAt(E+1))<56320||Z>57343?Y:(Y-55296<<10)+(Z-56320)+65536}},trimStart=hasTrimStart?function(h){return h.trimStart()}:function(h){return h.replace(SPACE_SEPARATOR_START_REGEX,"")},trimEnd=hasTrimEnd?function(h){return h.trimEnd()}:function(h){return h.replace(SPACE_SEPARATOR_END_REGEX,"")};function RE(t,h){return new RegExp(t,h)}var matchIdentifierAtIndex;if(REGEX_SUPPORTS_U_AND_Y){var IDENTIFIER_PREFIX_RE_1=RE("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");matchIdentifierAtIndex=function(h,E){var R;IDENTIFIER_PREFIX_RE_1.lastIndex=E;var Y=IDENTIFIER_PREFIX_RE_1.exec(h);return(R=Y[1])!==null&&R!==void 0?R:""}}else matchIdentifierAtIndex=function(h,E){for(var R=[];;){var Y=codePointAt(h,E);if(Y===void 0||_isWhiteSpace(Y)||_isPatternSyntax(Y))break;R.push(Y),E+=Y>=65536?2:1}return fromCodePoint.apply(void 0,R)};var Parser=function(){function t(h,E){E===void 0&&(E={}),this.message=h,this.position={offset:0,line:1,column:1},this.ignoreTag=!!E.ignoreTag,this.locale=E.locale,this.requiresOtherClause=!!E.requiresOtherClause,this.shouldParseSkeletons=!!E.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(h,E,R){for(var Y=[];!this.isEOF();){var Z=this.char();if(Z===123){var ee=this.parseArgument(h,R);if(ee.err)return ee;Y.push(ee.val)}else{if(Z===125&&h>0)break;if(Z===35&&(E==="plural"||E==="selectordinal")){var te=this.clonePosition();this.bump(),Y.push({type:TYPE.pound,location:createLocation(te,this.clonePosition())})}else if(Z===60&&!this.ignoreTag&&this.peek()===47){if(R)break;return this.error(ErrorKind.UNMATCHED_CLOSING_TAG,createLocation(this.clonePosition(),this.clonePosition()))}else if(Z===60&&!this.ignoreTag&&_isAlpha(this.peek()||0)){var ee=this.parseTag(h,E);if(ee.err)return ee;Y.push(ee.val)}else{var ee=this.parseLiteral(h,E);if(ee.err)return ee;Y.push(ee.val)}}}return{val:Y,err:null}},t.prototype.parseTag=function(h,E){var R=this.clonePosition();this.bump();var Y=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:TYPE.literal,value:"<".concat(Y,"/>"),location:createLocation(R,this.clonePosition())},err:null};if(this.bumpIf(">")){var Z=this.parseMessage(h+1,E,!0);if(Z.err)return Z;var ee=Z.val,te=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!_isAlpha(this.char()))return this.error(ErrorKind.INVALID_TAG,createLocation(te,this.clonePosition()));var ne=this.clonePosition(),oe=this.parseTagName();return Y!==oe?this.error(ErrorKind.UNMATCHED_CLOSING_TAG,createLocation(ne,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:TYPE.tag,value:Y,children:ee,location:createLocation(R,this.clonePosition())},err:null}:this.error(ErrorKind.INVALID_TAG,createLocation(te,this.clonePosition())))}else return this.error(ErrorKind.UNCLOSED_TAG,createLocation(R,this.clonePosition()))}else return this.error(ErrorKind.INVALID_TAG,createLocation(R,this.clonePosition()))},t.prototype.parseTagName=function(){var h=this.offset();for(this.bump();!this.isEOF()&&_isPotentialElementNameChar(this.char());)this.bump();return this.message.slice(h,this.offset())},t.prototype.parseLiteral=function(h,E){for(var R=this.clonePosition(),Y="";;){var Z=this.tryParseQuote(E);if(Z){Y+=Z;continue}var ee=this.tryParseUnquoted(h,E);if(ee){Y+=ee;continue}var te=this.tryParseLeftAngleBracket();if(te){Y+=te;continue}break}var ne=createLocation(R,this.clonePosition());return{val:{type:TYPE.literal,value:Y,location:ne},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!_isAlphaOrSlash(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(h){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(h==="plural"||h==="selectordinal")break;return null;default:return null}this.bump();var E=[this.char()];for(this.bump();!this.isEOF();){var R=this.char();if(R===39)if(this.peek()===39)E.push(39),this.bump();else{this.bump();break}else E.push(R);this.bump()}return fromCodePoint.apply(void 0,E)},t.prototype.tryParseUnquoted=function(h,E){if(this.isEOF())return null;var R=this.char();return R===60||R===123||R===35&&(E==="plural"||E==="selectordinal")||R===125&&h>0?null:(this.bump(),fromCodePoint(R))},t.prototype.parseArgument=function(h,E){var R=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE,createLocation(R,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(ErrorKind.EMPTY_ARGUMENT,createLocation(R,this.clonePosition()));var Y=this.parseIdentifierIfPossible().value;if(!Y)return this.error(ErrorKind.MALFORMED_ARGUMENT,createLocation(R,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE,createLocation(R,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:TYPE.argument,value:Y,location:createLocation(R,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE,createLocation(R,this.clonePosition())):this.parseArgumentOptions(h,E,Y,R);default:return this.error(ErrorKind.MALFORMED_ARGUMENT,createLocation(R,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var h=this.clonePosition(),E=this.offset(),R=matchIdentifierAtIndex(this.message,E),Y=E+R.length;this.bumpTo(Y);var Z=this.clonePosition(),ee=createLocation(h,Z);return{value:R,location:ee}},t.prototype.parseArgumentOptions=function(h,E,R,Y){var Z,ee=this.clonePosition(),te=this.parseIdentifierIfPossible().value,ne=this.clonePosition();switch(te){case"":return this.error(ErrorKind.EXPECT_ARGUMENT_TYPE,createLocation(ee,ne));case"number":case"date":case"time":{this.bumpSpace();var oe=null;if(this.bumpIf(",")){this.bumpSpace();var ie=this.clonePosition(),ae=this.parseSimpleArgStyleIfPossible();if(ae.err)return ae;var se=trimEnd(ae.val);if(se.length===0)return this.error(ErrorKind.EXPECT_ARGUMENT_STYLE,createLocation(this.clonePosition(),this.clonePosition()));var ue=createLocation(ie,this.clonePosition());oe={style:se,styleLocation:ue}}var fe=this.tryParseArgumentClose(Y);if(fe.err)return fe;var le=createLocation(Y,this.clonePosition());if(oe&&startsWith(oe==null?void 0:oe.style,"::",0)){var de=trimStart(oe.style.slice(2));if(te==="number"){var ae=this.parseNumberSkeletonFromString(de,oe.styleLocation);return ae.err?ae:{val:{type:TYPE.number,value:R,location:le,style:ae.val},err:null}}else{if(de.length===0)return this.error(ErrorKind.EXPECT_DATE_TIME_SKELETON,le);var ce=de;this.locale&&(ce=getBestPattern(de,this.locale));var se={type:SKELETON_TYPE.dateTime,pattern:ce,location:oe.styleLocation,parsedOptions:this.shouldParseSkeletons?parseDateTimeSkeleton(ce):{}},pe=te==="date"?TYPE.date:TYPE.time;return{val:{type:pe,value:R,location:le,style:se},err:null}}}return{val:{type:te==="number"?TYPE.number:te==="date"?TYPE.date:TYPE.time,value:R,location:le,style:(Z=oe==null?void 0:oe.style)!==null&&Z!==void 0?Z:null},err:null}}case"plural":case"selectordinal":case"select":{var he=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(ErrorKind.EXPECT_SELECT_ARGUMENT_OPTIONS,createLocation(he,__assign$R({},he)));this.bumpSpace();var ge=this.parseIdentifierIfPossible(),ve=0;if(te!=="select"&&ge.value==="offset"){if(!this.bumpIf(":"))return this.error(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,createLocation(this.clonePosition(),this.clonePosition()));this.bumpSpace();var ae=this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,ErrorKind.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(ae.err)return ae;this.bumpSpace(),ge=this.parseIdentifierIfPossible(),ve=ae.val}var _e=this.tryParsePluralOrSelectOptions(h,te,E,ge);if(_e.err)return _e;var fe=this.tryParseArgumentClose(Y);if(fe.err)return fe;var ye=createLocation(Y,this.clonePosition());return te==="select"?{val:{type:TYPE.select,value:R,options:fromEntries(_e.val),location:ye},err:null}:{val:{type:TYPE.plural,value:R,options:fromEntries(_e.val),offset:ve,pluralType:te==="plural"?"cardinal":"ordinal",location:ye},err:null}}default:return this.error(ErrorKind.INVALID_ARGUMENT_TYPE,createLocation(ee,ne))}},t.prototype.tryParseArgumentClose=function(h){return this.isEOF()||this.char()!==125?this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE,createLocation(h,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var h=0,E=this.clonePosition();!this.isEOF();){var R=this.char();switch(R){case 39:{this.bump();var Y=this.clonePosition();if(!this.bumpUntil("'"))return this.error(ErrorKind.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,createLocation(Y,this.clonePosition()));this.bump();break}case 123:{h+=1,this.bump();break}case 125:{if(h>0)h-=1;else return{val:this.message.slice(E.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(E.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(h,E){var R=[];try{R=parseNumberSkeletonFromString(h)}catch{return this.error(ErrorKind.INVALID_NUMBER_SKELETON,E)}return{val:{type:SKELETON_TYPE.number,tokens:R,location:E,parsedOptions:this.shouldParseSkeletons?parseNumberSkeleton(R):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(h,E,R,Y){for(var Z,ee=!1,te=[],ne=new Set,oe=Y.value,ie=Y.location;;){if(oe.length===0){var ae=this.clonePosition();if(E!=="select"&&this.bumpIf("=")){var se=this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR,ErrorKind.INVALID_PLURAL_ARGUMENT_SELECTOR);if(se.err)return se;ie=createLocation(ae,this.clonePosition()),oe=this.message.slice(ae.offset,this.offset())}else break}if(ne.has(oe))return this.error(E==="select"?ErrorKind.DUPLICATE_SELECT_ARGUMENT_SELECTOR:ErrorKind.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,ie);oe==="other"&&(ee=!0),this.bumpSpace();var ue=this.clonePosition();if(!this.bumpIf("{"))return this.error(E==="select"?ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,createLocation(this.clonePosition(),this.clonePosition()));var fe=this.parseMessage(h+1,E,R);if(fe.err)return fe;var le=this.tryParseArgumentClose(ue);if(le.err)return le;te.push([oe,{value:fe.val,location:createLocation(ue,this.clonePosition())}]),ne.add(oe),this.bumpSpace(),Z=this.parseIdentifierIfPossible(),oe=Z.value,ie=Z.location}return te.length===0?this.error(E==="select"?ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR:ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR,createLocation(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!ee?this.error(ErrorKind.MISSING_OTHER_CLAUSE,createLocation(this.clonePosition(),this.clonePosition())):{val:te,err:null}},t.prototype.tryParseDecimalInteger=function(h,E){var R=1,Y=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(R=-1);for(var Z=!1,ee=0;!this.isEOF();){var te=this.char();if(te>=48&&te<=57)Z=!0,ee=ee*10+(te-48),this.bump();else break}var ne=createLocation(Y,this.clonePosition());return Z?(ee*=R,isSafeInteger(ee)?{val:ee,err:null}:this.error(E,ne)):this.error(h,ne)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var h=this.position.offset;if(h>=this.message.length)throw Error("out of bound");var E=codePointAt(this.message,h);if(E===void 0)throw Error("Offset ".concat(h," is at invalid UTF-16 code unit boundary"));return E},t.prototype.error=function(h,E){return{val:null,err:{kind:h,message:this.message,location:E}}},t.prototype.bump=function(){if(!this.isEOF()){var h=this.char();h===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=h<65536?1:2)}},t.prototype.bumpIf=function(h){if(startsWith(this.message,h,this.offset())){for(var E=0;E<h.length;E++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(h){var E=this.offset(),R=this.message.indexOf(h,E);return R>=0?(this.bumpTo(R),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(h){if(this.offset()>h)throw Error("targetOffset ".concat(h," must be greater than or equal to the current offset ").concat(this.offset()));for(h=Math.min(h,this.message.length);;){var E=this.offset();if(E===h)break;if(E>h)throw Error("targetOffset ".concat(h," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&_isWhiteSpace(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var h=this.char(),E=this.offset(),R=this.message.charCodeAt(E+(h>=65536?2:1));return R??null},t}();function _isAlpha(t){return t>=97&&t<=122||t>=65&&t<=90}function _isAlphaOrSlash(t){return _isAlpha(t)||t===47}function _isPotentialElementNameChar(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function _isWhiteSpace(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function _isPatternSyntax(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function pruneLocation(t){t.forEach(function(h){if(delete h.location,isSelectElement(h)||isPluralElement(h))for(var E in h.options)delete h.options[E].location,pruneLocation(h.options[E].value);else isNumberElement(h)&&isNumberSkeleton(h.style)||(isDateElement(h)||isTimeElement(h))&&isDateTimeSkeleton(h.style)?delete h.style.location:isTagElement(h)&&pruneLocation(h.children)})}function parse(t,h){h===void 0&&(h={}),h=__assign$R({shouldParseSkeletons:!0,requiresOtherClause:!0},h);var E=new Parser(t,h).parse();if(E.err){var R=SyntaxError(ErrorKind[E.err.kind]);throw R.location=E.err.location,R.originalMessage=E.err.message,R}return h!=null&&h.captureLocation||pruneLocation(E.val),E.val}var ErrorCode;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(ErrorCode||(ErrorCode={}));var FormatError=function(t){__extends$I(h,t);function h(E,R,Y){var Z=t.call(this,E)||this;return Z.code=R,Z.originalMessage=Y,Z}return h.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},h}(Error),InvalidValueError=function(t){__extends$I(h,t);function h(E,R,Y,Z){return t.call(this,'Invalid values for "'.concat(E,'": "').concat(R,'". Options are "').concat(Object.keys(Y).join('", "'),'"'),ErrorCode.INVALID_VALUE,Z)||this}return h}(FormatError),InvalidValueTypeError=function(t){__extends$I(h,t);function h(E,R,Y){return t.call(this,'Value for "'.concat(E,'" must be of type ').concat(R),ErrorCode.INVALID_VALUE,Y)||this}return h}(FormatError),MissingValueError=function(t){__extends$I(h,t);function h(E,R){return t.call(this,'The intl string context variable "'.concat(E,'" was not provided to the string "').concat(R,'"'),ErrorCode.MISSING_VALUE,R)||this}return h}(FormatError),PART_TYPE;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(PART_TYPE||(PART_TYPE={}));function mergeLiteral(t){return t.length<2?t:t.reduce(function(h,E){var R=h[h.length-1];return!R||R.type!==PART_TYPE.literal||E.type!==PART_TYPE.literal?h.push(E):R.value+=E.value,h},[])}function isFormatXMLElementFn(t){return typeof t=="function"}function formatToParts(t,h,E,R,Y,Z,ee){if(t.length===1&&isLiteralElement(t[0]))return[{type:PART_TYPE.literal,value:t[0].value}];for(var te=[],ne=0,oe=t;ne<oe.length;ne++){var ie=oe[ne];if(isLiteralElement(ie)){te.push({type:PART_TYPE.literal,value:ie.value});continue}if(isPoundElement(ie)){typeof Z=="number"&&te.push({type:PART_TYPE.literal,value:E.getNumberFormat(h).format(Z)});continue}var ae=ie.value;if(!(Y&&ae in Y))throw new MissingValueError(ae,ee);var se=Y[ae];if(isArgumentElement(ie)){(!se||typeof se=="string"||typeof se=="number")&&(se=typeof se=="string"||typeof se=="number"?String(se):""),te.push({type:typeof se=="string"?PART_TYPE.literal:PART_TYPE.object,value:se});continue}if(isDateElement(ie)){var ue=typeof ie.style=="string"?R.date[ie.style]:isDateTimeSkeleton(ie.style)?ie.style.parsedOptions:void 0;te.push({type:PART_TYPE.literal,value:E.getDateTimeFormat(h,ue).format(se)});continue}if(isTimeElement(ie)){var ue=typeof ie.style=="string"?R.time[ie.style]:isDateTimeSkeleton(ie.style)?ie.style.parsedOptions:R.time.medium;te.push({type:PART_TYPE.literal,value:E.getDateTimeFormat(h,ue).format(se)});continue}if(isNumberElement(ie)){var ue=typeof ie.style=="string"?R.number[ie.style]:isNumberSkeleton(ie.style)?ie.style.parsedOptions:void 0;ue&&ue.scale&&(se=se*(ue.scale||1)),te.push({type:PART_TYPE.literal,value:E.getNumberFormat(h,ue).format(se)});continue}if(isTagElement(ie)){var fe=ie.children,le=ie.value,de=Y[le];if(!isFormatXMLElementFn(de))throw new InvalidValueTypeError(le,"function",ee);var ce=formatToParts(fe,h,E,R,Y,Z),pe=de(ce.map(function(ve){return ve.value}));Array.isArray(pe)||(pe=[pe]),te.push.apply(te,pe.map(function(ve){return{type:typeof ve=="string"?PART_TYPE.literal:PART_TYPE.object,value:ve}}))}if(isSelectElement(ie)){var he=ie.options[se]||ie.options.other;if(!he)throw new InvalidValueError(ie.value,se,Object.keys(ie.options),ee);te.push.apply(te,formatToParts(he.value,h,E,R,Y));continue}if(isPluralElement(ie)){var he=ie.options["=".concat(se)];if(!he){if(!Intl.PluralRules)throw new FormatError(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,ErrorCode.MISSING_INTL_API,ee);var ge=E.getPluralRules(h,{type:ie.pluralType}).select(se-(ie.offset||0));he=ie.options[ge]||ie.options.other}if(!he)throw new InvalidValueError(ie.value,se,Object.keys(ie.options),ee);te.push.apply(te,formatToParts(he.value,h,E,R,Y,se-(ie.offset||0)));continue}}return mergeLiteral(te)}function mergeConfig$1(t,h){return h?__assign$R(__assign$R(__assign$R({},t||{}),h||{}),Object.keys(t).reduce(function(E,R){return E[R]=__assign$R(__assign$R({},t[R]),h[R]||{}),E},{})):t}function mergeConfigs(t,h){return h?Object.keys(t).reduce(function(E,R){return E[R]=mergeConfig$1(t[R],h[R]),E},__assign$R({},t)):t}function createFastMemoizeCache(t){return{create:function(){return{get:function(h){return t[h]},set:function(h,E){t[h]=E}}}}}function createDefaultFormatters(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:memoize(function(){for(var h,E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];return new((h=Intl.NumberFormat).bind.apply(h,__spreadArray$b([void 0],E,!1)))},{cache:createFastMemoizeCache(t.number),strategy:strategies.variadic}),getDateTimeFormat:memoize(function(){for(var h,E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];return new((h=Intl.DateTimeFormat).bind.apply(h,__spreadArray$b([void 0],E,!1)))},{cache:createFastMemoizeCache(t.dateTime),strategy:strategies.variadic}),getPluralRules:memoize(function(){for(var h,E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];return new((h=Intl.PluralRules).bind.apply(h,__spreadArray$b([void 0],E,!1)))},{cache:createFastMemoizeCache(t.pluralRules),strategy:strategies.variadic})}}var IntlMessageFormat=function(){function t(h,E,R,Y){E===void 0&&(E=t.defaultLocale);var Z=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(ne){var oe=Z.formatToParts(ne);if(oe.length===1)return oe[0].value;var ie=oe.reduce(function(ae,se){return!ae.length||se.type!==PART_TYPE.literal||typeof ae[ae.length-1]!="string"?ae.push(se.value):ae[ae.length-1]+=se.value,ae},[]);return ie.length<=1?ie[0]||"":ie},this.formatToParts=function(ne){return formatToParts(Z.ast,Z.locales,Z.formatters,Z.formats,ne,void 0,Z.message)},this.resolvedOptions=function(){var ne;return{locale:((ne=Z.resolvedLocale)===null||ne===void 0?void 0:ne.toString())||Intl.NumberFormat.supportedLocalesOf(Z.locales)[0]}},this.getAst=function(){return Z.ast},this.locales=E,this.resolvedLocale=t.resolveLocale(E),typeof h=="string"){if(this.message=h,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var ee=Y||{};ee.formatters;var te=__rest$4(ee,["formatters"]);this.ast=t.__parse(h,__assign$R(__assign$R({},te),{locale:this.resolvedLocale}))}else this.ast=h;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=mergeConfigs(t.formats,R),this.formatters=Y&&Y.formatters||createDefaultFormatters(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(h){if(!(typeof Intl.Locale>"u")){var E=Intl.NumberFormat.supportedLocalesOf(h);return E.length>0?new Intl.Locale(E[0]):new Intl.Locale(typeof h=="string"?h:h[0])}},t.__parse=parse,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t}();const name="@lowcode-set-up-platform/renderer-core",version$1="2.1.8",description="",main="./src/index.ts",module$1="./src/index.ts",scripts={test:'echo "Error: no test specified" && exit 1',build:"vite build"},type="module",keywords=[],author="lowcode-set-up-platformXZF",license="ISC",dependencies={"prop-types":"^15.7.2",debug:"^4.1.1","@types/debug":"^4.1.12","@types/prop-types":"^15.7.12","@lowcode-set-up-platform/dsl":"workspace:^","@lowcode-set-up-platform/component-loader":"workspace:^","@lowcode-set-up-platform/shared":"workspace:^","intl-messageformat":"^10.5.14","fetch-jsonp":"^1.3.0","whatwg-fetch":"^3.6.20"},publishCustomConfig={main:"./lib/index.js",module:"./lib/index.esm.js",exports:{".":{import:{development:"./lib/index.esm.js",production:"./lib/index.esm.js"},require:"./lib/index.js",default:"./lib/index.esm.js"}},types:"./lib/index.d.ts"},pkg={name,version:version$1,description,main,module:module$1,scripts,type,keywords,author,license,dependencies,publishCustomConfig};window.sdkVersion=pkg.version;const EXPRESSION_TYPE={JSEXPRESSION:"JSExpression",JSFUNCTION:"JSFunction",JSSLOT:"JSSlot",JSBLOCK:"JSBlock",I18N:"i18n"};function isSchema(t){if(isEmpty(t))return!1;if(t.componentName==="Leaf"||t.componentName==="Slot")return!0;if(Array.isArray(t))return t.every(E=>isSchema(E));const h=E=>E?isJSExpression(E)?!0:typeof t.props=="object"&&!Array.isArray(E):!1;return!!(t.componentName&&h(t.props))}function isFileSchema(t){return isSchema(t)?["Page","Block","Component"].includes(t.componentName):!1}function inSameDomain(){try{return window.parent!==window&&window.parent.location.host===window.location.host}catch{return!1}}function getFileCssName(t){return t?`lce-${t.replace(/([A-Z])/g,"-$1").toLowerCase()}`.split("-").filter(E=>!!E).join("-"):void 0}function isJSSlot(t){return!t||typeof t!="object"||Array.isArray(t)?!1:[EXPRESSION_TYPE.JSSLOT,EXPRESSION_TYPE.JSBLOCK].includes(t.type)}function getValue(t,h,E={}){if(Array.isArray(t)||isEmpty(t)||typeof t!="object")return E;const R=h.split(".").reduce((Y,Z)=>Y&&Y[Z],t);return R===void 0?E:R}function getI18n(t,h={},E="zh-CN",R={}){return!R||!R[E]||!R[E][t]?"":new IntlMessageFormat(R[E][t],E).format(h)}function transformArrayToMap(t,h,E=!0){if(isEmpty(t)||!Array.isArray(t))return{};const R={};return t.forEach(Y=>{const Z=Y[h];Y[h]!==void 0&&(R[Z]&&!E||(R[Z]=Y))}),R}function transformStringToFunction(t){return typeof t!="string"?t:inSameDomain()&&window.parent.__newFunc?window.parent.__newFunc(`"use strict"; return ${t}`)():new Function(`"use strict"; return ${t}`)()}function parseExpression(t,h,E=!1){let R,Y,Z,ee;typeof t=="object"&&h===void 0?(R=t.str,Y=t.self,Z=t.thisRequired,ee=t.logScope):(R=t,Y=h,Z=E);try{const te=['"use strict";',"var __self = arguments[0];"];te.push("return ");let ne;if(ne=(R.value||"").trim(),ne=ne.replace(/this(\W|$)/g,(ie,ae)=>`__self${ae}`),ne=te.join(`
`)+ne,inSameDomain()&&window.parent.__newFunc)return window.parent.__newFunc(ne)(Y);const oe=`with(${Z?"{}":"$scope || {}"}) { ${ne} }`;return new Function("$scope",oe)(Y)}catch(te){logger$2.error(`${ee||""} parseExpression.error`,te,R,(Y==null?void 0:Y.__self)??Y);return}}function parseThisRequiredExpression(t,h){return parseExpression(t,h,!0)}function capitalizeFirstLetter(t){return!t||!isString$1(t)||t.length===0?t:t[0].toUpperCase()+t.slice(1)}function isString$1(t){return{}.toString.call(t)==="[object String]"}function isVariable(t){return!t||Array.isArray(t)?!1:typeof t=="object"&&(t==null?void 0:t.type)==="variable"}function parseI18n(t,h){return parseExpression({type:EXPRESSION_TYPE.JSEXPRESSION,value:`this.i18n('${t.key}')`},h)}function forEach$1(t,h,E){!t||Array.isArray(t)||isString$1(t)||typeof t!="object"||Object.keys(t).forEach(R=>h.call(E,t[R],R))}function parseData(t,h,E={}){if(isJSExpression(t))return parseExpression({str:t,self:h,thisRequired:E.thisRequiredInJSE,logScope:E.logScope});if(isI18nData(t))return parseI18n(t,h);if(typeof t=="string")return t.trim();if(Array.isArray(t))return t.map(R=>parseData(R,h,E));if(typeof t=="function")return t.bind(h);if(typeof t=="object"){if(!t)return t;const R={};return forEach$1(t,(Y,Z)=>{Z.startsWith("__")||(R[Z]=parseData(Y,h,E))}),R}return t}function serializeParams(t){const h=[];return forEach$1(t,(E,R)=>{E==null||E===""||(typeof E=="object"?h.push(`${R}=${encodeURIComponent(JSON.stringify(E))}`):h.push(`${R}=${encodeURIComponent(E)}`))}),h.join("&")}var g=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},support={searchParams:"URLSearchParams"in g,iterable:"Symbol"in g&&"iterator"in Symbol,blob:"FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in g,arrayBuffer:"ArrayBuffer"in g};function isDataView(t){return t&&DataView.prototype.isPrototypeOf(t)}if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView$1=ArrayBuffer.isView||function(t){return t&&viewClasses.indexOf(Object.prototype.toString.call(t))>-1};function normalizeName(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function normalizeValue$1(t){return typeof t!="string"&&(t=String(t)),t}function iteratorFor(t){var h={next:function(){var E=t.shift();return{done:E===void 0,value:E}}};return support.iterable&&(h[Symbol.iterator]=function(){return h}),h}function Headers(t){this.map={},t instanceof Headers?t.forEach(function(h,E){this.append(E,h)},this):Array.isArray(t)?t.forEach(function(h){if(h.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+h.length);this.append(h[0],h[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(h){this.append(h,t[h])},this)}Headers.prototype.append=function(t,h){t=normalizeName(t),h=normalizeValue$1(h);var E=this.map[t];this.map[t]=E?E+", "+h:h},Headers.prototype.delete=function(t){delete this.map[normalizeName(t)]},Headers.prototype.get=function(t){return t=normalizeName(t),this.has(t)?this.map[t]:null},Headers.prototype.has=function(t){return this.map.hasOwnProperty(normalizeName(t))},Headers.prototype.set=function(t,h){this.map[normalizeName(t)]=normalizeValue$1(h)},Headers.prototype.forEach=function(t,h){for(var E in this.map)this.map.hasOwnProperty(E)&&t.call(h,this.map[E],E,this)},Headers.prototype.keys=function(){var t=[];return this.forEach(function(h,E){t.push(E)}),iteratorFor(t)},Headers.prototype.values=function(){var t=[];return this.forEach(function(h){t.push(h)}),iteratorFor(t)},Headers.prototype.entries=function(){var t=[];return this.forEach(function(h,E){t.push([E,h])}),iteratorFor(t)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);function consumed(t){if(!t._noBody){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}}function fileReaderReady(t){return new Promise(function(h,E){t.onload=function(){h(t.result)},t.onerror=function(){E(t.error)}})}function readBlobAsArrayBuffer(t){var h=new FileReader,E=fileReaderReady(h);return h.readAsArrayBuffer(t),E}function readBlobAsText(t){var h=new FileReader,E=fileReaderReady(h),R=/charset=([A-Za-z0-9_-]+)/.exec(t.type),Y=R?R[1]:"utf-8";return h.readAsText(t,Y),E}function readArrayBufferAsText(t){for(var h=new Uint8Array(t),E=new Array(h.length),R=0;R<h.length;R++)E[R]=String.fromCharCode(h[R]);return E.join("")}function bufferClone(t){if(t.slice)return t.slice(0);var h=new Uint8Array(t.byteLength);return h.set(new Uint8Array(t)),h.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:support.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:support.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():support.arrayBuffer&&support.blob&&isDataView(t)?(this._bodyArrayBuffer=bufferClone(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||isArrayBufferView$1(t))?this._bodyArrayBuffer=bufferClone(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var t=consumed(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=consumed(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(support.blob)return this.blob().then(readBlobAsArrayBuffer);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var t=consumed(this);if(t)return t;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}var methods=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function normalizeMethod(t){var h=t.toUpperCase();return methods.indexOf(h)>-1?h:t}function Request$1(t,h){if(!(this instanceof Request$1))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');h=h||{};var E=h.body;if(t instanceof Request$1){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,h.headers||(this.headers=new Headers(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!E&&t._bodyInit!=null&&(E=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=h.credentials||this.credentials||"same-origin",(h.headers||!this.headers)&&(this.headers=new Headers(h.headers)),this.method=normalizeMethod(h.method||this.method||"GET"),this.mode=h.mode||this.mode||null,this.signal=h.signal||this.signal||function(){if("AbortController"in g){var Z=new AbortController;return Z.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(E),(this.method==="GET"||this.method==="HEAD")&&(h.cache==="no-store"||h.cache==="no-cache")){var R=/([?&])_=[^&]*/;if(R.test(this.url))this.url=this.url.replace(R,"$1_="+new Date().getTime());else{var Y=/\?/;this.url+=(Y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Request$1.prototype.clone=function(){return new Request$1(this,{body:this._bodyInit})};function decode(t){var h=new FormData;return t.trim().split("&").forEach(function(E){if(E){var R=E.split("="),Y=R.shift().replace(/\+/g," "),Z=R.join("=").replace(/\+/g," ");h.append(decodeURIComponent(Y),decodeURIComponent(Z))}}),h}function parseHeaders$1(t){var h=new Headers,E=t.replace(/\r?\n[\t ]+/g," ");return E.split("\r").map(function(R){return R.indexOf(`
`)===0?R.substr(1,R.length):R}).forEach(function(R){var Y=R.split(":"),Z=Y.shift().trim();if(Z){var ee=Y.join(":").trim();try{h.append(Z,ee)}catch(te){console.warn("Response "+te.message)}}}),h}Body.call(Request$1.prototype);function Response$1(t,h){if(!(this instanceof Response$1))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(h||(h={}),this.type="default",this.status=h.status===void 0?200:h.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=h.statusText===void 0?"":""+h.statusText,this.headers=new Headers(h.headers),this.url=h.url||"",this._initBody(t)}Body.call(Response$1.prototype),Response$1.prototype.clone=function(){return new Response$1(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response$1.error=function(){var t=new Response$1(null,{status:200,statusText:""});return t.ok=!1,t.status=0,t.type="error",t};var redirectStatuses=[301,302,303,307,308];Response$1.redirect=function(t,h){if(redirectStatuses.indexOf(h)===-1)throw new RangeError("Invalid status code");return new Response$1(null,{status:h,headers:{location:t}})};var DOMException=g.DOMException;try{new DOMException}catch(t){DOMException=function(h,E){this.message=h,this.name=E;var R=Error(h);this.stack=R.stack},DOMException.prototype=Object.create(Error.prototype),DOMException.prototype.constructor=DOMException}function fetch$1(t,h){return new Promise(function(E,R){var Y=new Request$1(t,h);if(Y.signal&&Y.signal.aborted)return R(new DOMException("Aborted","AbortError"));var Z=new XMLHttpRequest;function ee(){Z.abort()}Z.onload=function(){var oe={statusText:Z.statusText,headers:parseHeaders$1(Z.getAllResponseHeaders()||"")};Y.url.indexOf("file://")===0&&(Z.status<200||Z.status>599)?oe.status=200:oe.status=Z.status,oe.url="responseURL"in Z?Z.responseURL:oe.headers.get("X-Request-URL");var ie="response"in Z?Z.response:Z.responseText;setTimeout(function(){E(new Response$1(ie,oe))},0)},Z.onerror=function(){setTimeout(function(){R(new TypeError("Network request failed"))},0)},Z.ontimeout=function(){setTimeout(function(){R(new TypeError("Network request timed out"))},0)},Z.onabort=function(){setTimeout(function(){R(new DOMException("Aborted","AbortError"))},0)};function te(oe){try{return oe===""&&g.location.href?g.location.href:oe}catch{return oe}}if(Z.open(Y.method,te(Y.url),!0),Y.credentials==="include"?Z.withCredentials=!0:Y.credentials==="omit"&&(Z.withCredentials=!1),"responseType"in Z&&(support.blob?Z.responseType="blob":support.arrayBuffer&&(Z.responseType="arraybuffer")),h&&typeof h.headers=="object"&&!(h.headers instanceof Headers||g.Headers&&h.headers instanceof g.Headers)){var ne=[];Object.getOwnPropertyNames(h.headers).forEach(function(oe){ne.push(normalizeName(oe)),Z.setRequestHeader(oe,normalizeValue$1(h.headers[oe]))}),Y.headers.forEach(function(oe,ie){ne.indexOf(ie)===-1&&Z.setRequestHeader(ie,oe)})}else Y.headers.forEach(function(oe,ie){Z.setRequestHeader(ie,oe)});Y.signal&&(Y.signal.addEventListener("abort",ee),Z.onreadystatechange=function(){Z.readyState===4&&Y.signal.removeEventListener("abort",ee)}),Z.send(typeof Y._bodyInit>"u"?null:Y._bodyInit)})}fetch$1.polyfill=!0,g.fetch||(g.fetch=fetch$1,g.Headers=Headers,g.Request=Request$1,g.Response=Response$1);var fetchJsonp$1={exports:{}};(function(t,h){(function(E,R){R(h,t)})(commonjsGlobal$1,function(E,R){var Y={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function Z(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function ee(oe){try{delete window[oe]}catch{window[oe]=void 0}}function te(oe){var ie=document.getElementById(oe);ie&&document.getElementsByTagName("head")[0].removeChild(ie)}function ne(oe){var ie=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],ae=oe,se=ie.timeout||Y.timeout,ue=ie.jsonpCallback||Y.jsonpCallback,fe=void 0;return new Promise(function(le,de){var ce=ie.jsonpCallbackFunction||Z(),pe=ue+"_"+ce;window[ce]=function(ge){le({ok:!0,json:function(){return Promise.resolve(ge)}}),fe&&clearTimeout(fe),te(pe),ee(ce)},ae+=ae.indexOf("?")===-1?"?":"&";var he=document.createElement("script");he.setAttribute("src",""+ae+ue+"="+ce),ie.charset&&he.setAttribute("charset",ie.charset),ie.nonce&&he.setAttribute("nonce",ie.nonce),ie.referrerPolicy&&he.setAttribute("referrerPolicy",ie.referrerPolicy),ie.crossorigin&&he.setAttribute("crossorigin","true"),he.id=pe,document.getElementsByTagName("head")[0].appendChild(he),fe=setTimeout(function(){de(new Error("JSONP request to "+oe+" timed out")),ee(ce),te(pe),window[ce]=function(){ee(ce)}},se),he.onerror=function(){de(new Error("JSONP request to "+oe+" failed")),ee(ce),te(pe),fe&&clearTimeout(fe)}})}R.exports=ne})})(fetchJsonp$1,fetchJsonp$1.exports);var fetchJsonpExports=fetchJsonp$1.exports;const fetchJsonp=getDefaultExportFromCjs(fetchJsonpExports);function buildUrl(t,h){const E=serializeParams(h);return E?t.indexOf("?")>0?`${t}&${E}`:`${t}?${E}`:t}function get(t,h={},E={},R={}){const Y={Accept:"application/json",...E},Z=buildUrl(t,h);return request(Z,"GET",null,Y,R)}function post(t,h={},E={},R={}){const Y={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",...E},Z=Y["Content-Type"].indexOf("application/json")>-1||Array.isArray(h)?JSON.stringify(h):serializeParams(h);return request(t,"POST",Z,Y,R)}function request(t,h="GET",E,R={},Y={}){let Z=R||{},ee=E;return(h==="PUT"||h==="DELETE")&&(Z={Accept:"application/json","Content-Type":"application/json",...Z},ee=JSON.stringify(ee||{})),new Promise((te,ne)=>{Y.timeout&&setTimeout(()=>{ne(new Error("timeout"))},Y.timeout),fetch(t,{method:h,credentials:"include",headers:Z,body:ee,...Y}).then(oe=>{switch(oe.status){case 200:case 201:case 202:return oe.json();case 204:return h==="DELETE"?{success:!0}:{__success:!1,code:oe.status};case 400:case 401:case 403:case 404:case 406:case 410:case 422:case 500:return oe.json().then(ie=>({__success:!1,code:oe.status,data:ie})).catch(()=>({__success:!1,code:oe.status}))}return null}).then(oe=>{if(!oe){ne(oe);return}oe.__success!==!1?te(oe):(delete oe.__success,ne(oe))}).catch(oe=>{ne(oe)})})}function jsonp(t,h={},E={}){return new Promise((R,Y)=>{const Z={timeout:5e3,...E},ee=buildUrl(t,h);fetchJsonp(ee,Z).then(te=>{te.json()}).then(te=>{te?R(te):Y()}).catch(te=>{Y(te)})})}const DS_STATUS={INIT:"init",LOADING:"loading",LOADED:"loaded",ERROR:"error"};function doRequest(t,h){let{uri:E,url:R,method:Y="GET",headers:Z,params:ee,...te}=h;if(te=te||{},t==="jsonp")return jsonp(E,ee,te);if(t==="fetch")switch(Y.toUpperCase()){case"GET":return get(E,ee,Z,te);case"POST":return post(E,ee,Z,te);default:return request(E,Y,ee,Z,te)}logger$2.log(`Engine default dataSource does not support type:[${t}] dataSource request!`,h)}class DataHelper{constructor(h,E,R,Y){be(this,"host");be(this,"config");be(this,"parser");be(this,"ajaxList");be(this,"ajaxMap");be(this,"dataSourceMap");be(this,"appHelper");this.host=h,this.config=E||{},this.parser=Y,this.ajaxList=(E==null?void 0:E.list)||[],this.ajaxMap=transformArrayToMap(this.ajaxList,"id"),this.dataSourceMap=this.generateDataSourceMap(),this.appHelper=R}updateConfig(h={}){this.config=h,this.ajaxList=(h==null?void 0:h.list)||[];const E=transformArrayToMap(this.ajaxList,"id");return Object.keys(this.ajaxMap).forEach(R=>{E[R]||delete this.dataSourceMap[R]}),this.ajaxMap=E,this.ajaxList.forEach(R=>{this.dataSourceMap[R.id]||(this.dataSourceMap[R.id]={status:DS_STATUS.INIT,load:(...Y)=>this.getDataSource(R.id,...Y)})}),this.dataSourceMap}generateDataSourceMap(){const h={};return this.ajaxList.forEach(E=>{h[E.id]={status:DS_STATUS.INIT,load:(...R)=>this.getDataSource(E.id,...R)}}),h}updateDataSourceMap(h,E,R){this.dataSourceMap[h].error=R||void 0,this.dataSourceMap[h].data=E,this.dataSourceMap[h].status=R?DS_STATUS.ERROR:DS_STATUS.LOADED}getInitDataSourseConfigs(){return this.parser(this.ajaxList).filter(E=>E.isInit===!0?(this.dataSourceMap[E.id].status=DS_STATUS.LOADING,!0):!1)}getInitData(){const h=this.getInitDataSourseConfigs();return this.asyncDataHandler(h).then(E=>{const{dataHandler:R}=this.config;return this.handleData(null,R,E,null)})}getDataSource(h,E,R,Y){const Z=this.parser(this.ajaxMap[h]),ee=Z.options||{};let te=Y,ne=R;typeof R=="function"&&(te=R,ne={});const{headers:oe,...ie}=ne||{};if(!Z){logger$2.warn(`getDataSource API named ${h} not exist`);return}return this.asyncDataHandler([{...Z,options:{...ee,params:Array.isArray(ee.params)||Array.isArray(E)?E||ee.params:{...ee.params,...E},headers:{...ee.headers,...oe},...ie}}]).then(ae=>{try{te&&te(ae&&ae[h])}catch(se){logger$2.error("load请求回调函数报错",se)}return ae&&ae[h]}).catch(ae=>{try{te&&te(null,ae)}catch(se){logger$2.error("load请求回调函数报错",se)}return ae})}asyncDataHandler(h){return new Promise((E,R)=>{const Y=[];h.forEach(ee=>{const{id:te,type:ne}=ee;!te||!ne||ne==="legao"||Y.push(ee)}),Y.length===0&&E({});const Z={};Promise.all(Y.map(ee=>new Promise(te=>{const{type:ne,id:oe,dataHandler:ie,options:ae}=ee,se=(fe,le)=>{Z[oe]=this.handleData(oe,ie,fe,le),this.updateDataSourceMap(oe,Z[oe],le),te({})},ue=(fe,le)=>{var de;(de=doRequest(fe,le))==null||de.then(ce=>{se(ce,void 0)}).catch(ce=>{se(void 0,ce)})};this.dataSourceMap[oe].status=DS_STATUS.LOADING,ue(ne,ae)}))).then(()=>{E(Z)}).catch(ee=>{R(ee)})})}handleData(h,E,R,Y){let Z=E;if(isJSFunction(E)&&(Z=transformStringToFunction(E.value)),!Z||typeof Z!="function")return R;try{return Z.call(this.host,R,Y)}catch(ee){h?logger$2.error(`[${h}]单个请求数据处理函数运行出错`,ee):logger$2.error("请求数据处理函数运行出错",ee)}}}function patchDidCatch(t,{baseRenderer:h}){if(t.patchedCatch)return;t.patchedCatch=!0;const{PureComponent:E}=adapter.getRuntime(),R=t.prototype.componentDidCatch;t.prototype.componentDidCatch=function(te,ne){this.setState({engineRenderError:!0,error:te}),R&&typeof R=="function"&&R.call(this,te,ne)};const{engine:Y}=h.context,Z=t.prototype.render;if(t.prototype.render=function(){return this.state&&this.state.engineRenderError?(this.state.engineRenderError=!1,Y.createElement(Y.getFaultComponent(),{...this.props,error:this.state.error,componentName:this.props._componentName})):Z.call(this)},!(t.prototype instanceof E)){const ee=t.prototype.shouldComponentUpdate;t.prototype.shouldComponentUpdate=function(te,ne){return ne&&ne.engineRenderError?!0:ee?ee.call(this,te,ne):!0}}}const cache$1=new Map;function compWrapper(t,h){var te,ne,oe,ie;const{createElement:E,Component:R,forwardRef:Y}=adapter.getRuntime();if((te=t==null?void 0:t.prototype)!=null&&te.isReactComponent||(ne=t==null?void 0:t.prototype)!=null&&ne.setState||(t==null?void 0:t.prototype)instanceof R)return patchDidCatch(t,h),t;if(cache$1.has(h.schema.id)&&((oe=cache$1.get(h.schema.id))==null?void 0:oe.Comp)===t)return(ie=cache$1.get(h.schema.id))==null?void 0:ie.WrapperComponent;class Z extends R{render(){return E(t,{...this.props,ref:this.props.forwardRef})}}Z.displayName=t.displayName,patchDidCatch(Z,h);const ee=cloneEnumerableProperty(Y((ae,se)=>E(Z,{...ae,forwardRef:se})),t);return cache$1.set(h.schema.id,{WrapperComponent:ee,Comp:t}),ee}class LeafCache{constructor(h,E){be(this,"component",new Map);be(this,"state",new Map);be(this,"event",new Map);be(this,"ref",new Map);this.documentId=h,this.device=E}}let cache;function initRerenderEvent({schema:t,__debug:h,container:E,getNode:R}){var ee,te,ne,oe,ie;const Y=R==null?void 0:R(t.id);if(!Y||(ee=cache.event.get(t.id))!=null&&ee.clear||Y===cache.event.get(t.id))return;(te=cache.event.get(t.id))==null||te.dispose.forEach(ae=>ae&&ae());const Z=debounce(()=>{E.rerender()},20);cache.event.set(t.id,{clear:!1,leaf:Y,dispose:[(ne=Y==null?void 0:Y.onPropChange)==null?void 0:ne.call(Y,()=>{E.autoRepaintNode&&(h(`${t.componentName}[${t.id}] leaf not render in SimulatorRendererView, leaf onPropsChange make rerender`),Z())}),(oe=Y==null?void 0:Y.onChildrenChange)==null?void 0:oe.call(Y,()=>{E.autoRepaintNode&&(h(`${t.componentName}[${t.id}] leaf not render in SimulatorRendererView, leaf onChildrenChange make rerender`),Z())}),(ie=Y==null?void 0:Y.onVisibleChange)==null?void 0:ie.call(Y,()=>{E.autoRepaintNode&&(h(`${t.componentName}[${t.id}] leaf not render in SimulatorRendererView, leaf onVisibleChange make rerender`),Z())})]})}function clearRerenderEvent(t){var h,E,R;(h=cache.event.get(t))!=null&&h.clear||((R=(E=cache.event.get(t))==null?void 0:E.dispose)==null||R.forEach(Y=>Y&&Y()),cache.event.set(t,{clear:!0,dispose:[]}))}function leafWrapper(t,{schema:h,baseRenderer:E,componentInfo:R,scope:Y}){var me,Ee,Oe,Te,Pe,Re,De;const{__debug:Z,__getComponentProps:ee,__getSchemaChildrenVirtualDom:te,__parseData:ne}=E,{engine:oe}=E.context,ie=(me=E.props)==null?void 0:me.__host,ae=((Ee=E.props)==null?void 0:Ee.documentId)??"",se=((Oe=E.props)==null?void 0:Oe.device)??"",ue=(Te=E.props)==null?void 0:Te.getNode,fe=(Pe=E.props)==null?void 0:Pe.__container,le=(Re=E.props)==null?void 0:Re.setSchemaChangedSymbol,de=(De=ie==null?void 0:ie.designer)==null?void 0:De.editor,ce=adapter.getRuntime(),{forwardRef:pe,createElement:he}=ce,ge=ce.Component,ve=h.id;if((!cache||ae&&ae!==cache.documentId||se&&se!==cache.device)&&(cache==null||cache.event.forEach(je=>{var Fe;(Fe=je.dispose)==null||Fe.forEach(xe=>xe&&xe())}),cache=new LeafCache(ae,se)),isReactComponent(t)||logger$2.error(`${h.componentName} component may be has errors: `,t),initRerenderEvent({schema:h,__debug:Z,container:fe,getNode:ue}),ae&&cache.component.has(ve)&&cache.component.get(ve).Comp===t)return cache.component.get(ve).LeafWrapper;class _e extends ge{constructor(xe,Ne){super(xe,Ne);be(this,"recordInfo",{});be(this,"curEventLeaf");be(this,"disposeFunctions",[]);be(this,"__component_tag","leafWrapper");be(this,"renderUnitInfo");be(this,"makeUnitRenderDebounced",debounce(()=>{var Se,we,Ce;this.beforeRender("MinimalRenderUnit");const xe=(we=(Se=this.leaf)==null?void 0:Se.export)==null?void 0:we.call(Se,IPublicEnumTransformStage.Render);if(!xe)return;const Ne=ee(xe,Y,t,R),Me=te(xe,Y,t),Le={nodeProps:Ne,nodeChildren:Me,childrenInState:!0};"children"in Ne&&(Le.nodeChildren=Ne.children),Z(`${(Ce=this.leaf)==null?void 0:Ce.componentName}(${this.props.componentId}) MinimalRenderUnit Render!`),this.setState(Le)},20));be(this,"recordTime",()=>{var Le,Se,we,Ce,$e;if(!this.recordInfo.startTime)return;const xe=Date.now(),Ne=(we=(Se=(Le=ie==null?void 0:ie.designer)==null?void 0:Le.currentDocument)==null?void 0:Se.getNodeCount)==null?void 0:we.call(Se),Me=((Ce=this.recordInfo.node)==null?void 0:Ce.componentName)||(($e=this.leaf)==null?void 0:$e.componentName)||"UnknownComponent";de==null||de.eventBus.emit(Rerender,{componentName:Me,time:xe-this.recordInfo.startTime,type:this.recordInfo.type,nodeCount:Ne}),this.recordInfo.startTime=null});be(this,"makeUnitRender",()=>{this.makeUnitRenderDebounced()});Z(`${h.componentName}[${this.props.componentId}] leaf render in SimulatorRendererView`),clearRerenderEvent(ve),this.curEventLeaf=this.leaf,cache.ref.set(ve,{makeUnitRender:this.makeUnitRender});let Me=cache.state.get(ve);(!Me||Me.__tag!==xe.__tag)&&(Me=this.getDefaultState(xe)),this.state=Me}get autoRepaintNode(){return fe==null?void 0:fe.autoRepaintNode}componentDidUpdate(){this.recordTime()}componentDidMount(){const xe=this.leaf;this.initOnPropsChangeEvent(xe),this.initOnChildrenChangeEvent(xe),this.initOnVisibleChangeEvent(xe),this.recordTime()}getDefaultState(xe){var Le,Se;const{hidden:Ne=!1,condition:Me=!0}=xe.__inner__||((Se=(Le=this.leaf)==null?void 0:Le.export)==null?void 0:Se.call(Le,IPublicEnumTransformStage.Render))||{};return{nodeChildren:null,childrenInState:!1,visible:!Ne,condition:ne==null?void 0:ne(Me,Y),nodeCacheProps:{},nodeProps:{}}}setState(xe){cache.state.set(ve,{...this.state,...xe,__tag:this.props.__tag}),super.setState(xe)}beforeRender(xe,Ne){this.recordInfo.startTime=Date.now(),this.recordInfo.type=xe,this.recordInfo.node=Ne,le==null||le(!0)}judgeMiniUnitRender(){var Me;this.renderUnitInfo||this.getRenderUnitInfo();const xe=this.renderUnitInfo||{singleRender:!0};if(xe.singleRender)return;const Ne=cache.ref.get(xe.minimalUnitId);if(!Ne){Z("Cant find minimalRenderUnit ref! This make rerender!"),fe==null||fe.rerender();return}Z(`${(Me=this.leaf)==null?void 0:Me.componentName}(${this.props.componentId}) need render, make its minimalRenderUnit ${xe.minimalUnitName}(${xe.minimalUnitId})`),Ne.makeUnitRender()}getRenderUnitInfo(xe=this.leaf){var Ne,Me;!xe||typeof xe.isRoot!="function"||(xe.isRootNode&&(this.renderUnitInfo={singleRender:!0,...this.renderUnitInfo||{}}),xe.componentMeta.isMinimalRenderUnit&&(this.renderUnitInfo={minimalUnitId:xe.id,minimalUnitName:xe.componentName,singleRender:!1}),xe.hasLoop()&&(this.renderUnitInfo={minimalUnitId:(Ne=xe==null?void 0:xe.parent)==null?void 0:Ne.id,minimalUnitName:(Me=xe==null?void 0:xe.parent)==null?void 0:Me.componentName,singleRender:!1}),xe.parent&&this.getRenderUnitInfo(xe.parent))}componentWillReceiveProps(xe){const{componentId:Ne}=xe;if(xe.__tag===this.props.__tag)return null;const Me=ue==null?void 0:ue(Ne);Me&&this.curEventLeaf&&Me!==this.curEventLeaf&&(this.disposeFunctions.forEach(we=>we()),this.disposeFunctions=[],this.initOnChildrenChangeEvent(Me),this.initOnPropsChangeEvent(Me),this.initOnVisibleChangeEvent(Me),this.curEventLeaf=Me);const{visible:Le,...Se}=this.getDefaultState(xe);this.setState(Se)}initOnPropsChangeEvent(xe=this.leaf){var Le;const Ne=debounce(Se=>{var Be,Ue;const{key:we,newValue:Ce=null}=Se,$e=xe;if(we==="___condition___"){const{condition:ke=!0}=((Be=this.leaf)==null?void 0:Be.export(IPublicEnumTransformStage.Render))||{},Ge=ne==null?void 0:ne(ke,Y);Z(`key is ___condition___, change condition value to [${ke}]`),this.setState({condition:Ge});return}if(we==="___loop___"){Z("key is ___loop___, render a page!"),fe==null||fe.rerender(),cache.component.delete(ve);return}this.beforeRender("PropsChanged");const{state:Ie}=this,{nodeCacheProps:He}=Ie,Ae=ee((Ue=$e==null?void 0:$e.export)==null?void 0:Ue.call($e,IPublicEnumTransformStage.Render),Y,t,R);we&&!(we in Ae)&&we in this.props&&(He[we]=Ce),Z(`${xe==null?void 0:xe.componentName}[${this.props.componentId}] component trigger onPropsChange!`,Ae,He,we,Ce),this.setState("children"in Ae?{nodeChildren:Ae.children,nodeProps:Ae,childrenInState:!0,nodeCacheProps:He}:{nodeProps:Ae,nodeCacheProps:He}),this.judgeMiniUnitRender()}),Me=(Le=xe==null?void 0:xe.onPropChange)==null?void 0:Le.call(xe,Se=>{this.autoRepaintNode&&Ne(Se)});Me&&this.disposeFunctions.push(Me)}initOnVisibleChangeEvent(xe=this.leaf){var Me;const Ne=(Me=xe==null?void 0:xe.onVisibleChange)==null?void 0:Me.call(xe,Le=>{this.autoRepaintNode&&this.state.visible!==Le&&(Z(`${xe==null?void 0:xe.componentName}[${this.props.componentId}] component trigger onVisibleChange(${Le}) event`),this.beforeRender("VisibleChanged"),this.setState({visible:Le}),this.judgeMiniUnitRender())});Ne&&this.disposeFunctions.push(Ne)}initOnChildrenChangeEvent(xe=this.leaf){var Me;const Ne=(Me=xe==null?void 0:xe.onChildrenChange)==null?void 0:Me.call(xe,Le=>{var $e;if(!this.autoRepaintNode)return;const{type:Se,node:we}=Le||{};this.beforeRender(`ChildChanged-${Se}`,we);const Ce=te(($e=xe==null?void 0:xe.export)==null?void 0:$e.call(xe,IPublicEnumTransformStage.Render),Y,t);Z(`${h.componentName}[${this.props.componentId}] component trigger onChildrenChange event`,Ce),this.setState({nodeChildren:Ce,childrenInState:!0}),this.judgeMiniUnitRender()});Ne&&this.disposeFunctions.push(Ne)}componentWillUnmount(){this.disposeFunctions.forEach(xe=>xe())}get hasChildren(){return this.state.childrenInState?!0:"children"in this.props}get children(){return this.state.childrenInState?this.state.nodeChildren:this.props.children&&!Array.isArray(this.props.children)?[this.props.children]:this.props.children&&this.props.children.length?this.props.children:this.props.children}get leaf(){var xe;if(!((xe=this.props._leaf)!=null&&xe.isMock))return ue==null?void 0:ue(ve)}render(){if(!this.state.visible||!this.state.condition)return null;const{forwardedRef:xe,...Ne}=this.props,Me={...Ne,...this.state.nodeCacheProps||{},...this.state.nodeProps||{},children:[],__id:this.props.componentId,ref:xe};return delete Me.__inner__,this.hasChildren?oe.createElement(t,Me,this.children):oe.createElement(t,Me)}}be(_e,"displayName",h.componentName);let ye=pe((je,Fe)=>he(_e,{...je,forwardedRef:Fe}));return ye=cloneEnumerableProperty(ye,t),ye.displayName=t.displayName,cache.component.set(ve,{LeafWrapper:ye,Comp:t}),ye}function isUseLoop(t,h){return isJSExpression(t)||!h?!0:Array.isArray(t)?t.length>0:!1}function executeLifeCycleMethod(t,h,E,R,Y){var te,ne;if(!t||!isSchema(h)||!E)return;let ee=getValue(h,"lifeCycles",{})[E];if(ee){if((isJSExpression(ee)||isJSFunction(ee))&&(ee=Y?parseThisRequiredExpression(ee,t):parseExpression(ee,t)),typeof ee!="function"){logger$2.error(`生命周期${E}类型不符`,ee);return}try{const{FlowRunner:oe}=adapter.getRuntime(),ie=oe==null?void 0:oe();return(ne=(te=ie==null?void 0:ie.runner)==null?void 0:te.executeLifeCycle)==null||ne.call(te,E,h,t,R),ee.apply(t,R)}catch(oe){logger$2.error(`[${h.componentName}]生命周期${E}出错`,oe)}}}function getSchemaChildren(t){if(!t)return;if(!t.props)return t.children;if(!t.children)return t.props.children;if(!t.props.children)return t.children;let h=[].concat(t.children);return Array.isArray(t.props.children)?h=h.concat(t.props.children):h.push(t.props.children),h}function baseRendererFactory(){var se;const{BaseRenderer:t}=adapter.getRenderers();if(t)return t;const{Component:h,createElement:E,FlowRunner:R}=adapter.getRuntime(),Y=divFactory(),Z=visualDomFactory(),ee=contextFactory(),te={EXTEND:"extend",BORDER:"border",PREVIEW:"preview"},ne=["Dialog","Overlay","Animate","ConfigProvider"],oe="item",ie="index";let ae=0;return se=class extends h{constructor(le,de){var ce;super(le,de);be(this,"i18n");be(this,"getLocale");be(this,"setLocale");be(this,"dataSourceMap",{});be(this,"__namespace","base");be(this,"__compScopes",{});be(this,"__instanceMap",{});be(this,"__dataHelper");be(this,"__customMethodsList",[]);be(this,"__parseExpression");be(this,"__ref");be(this,"__styleElement");be(this,"reloadDataSource",()=>new Promise((le,de)=>{if(this.__debug("reload data source"),!this.__dataHelper)return le({});this.__dataHelper.getInitData().then(ce=>{if(isEmpty(ce))return this.forceUpdate(),le({});this.setState(ce,le)}).catch(ce=>{de(ce)})}));be(this,"__executeLifeCycleMethod",(le,de)=>{executeLifeCycleMethod(this,this.props.__schema,le,de,this.props.thisRequiredInJSE)});be(this,"_getComponentView",le=>{const{__components:de}=this.props;if(de)return de[le]});be(this,"__bindCustomMethods",le=>{const{__schema:de}=le,ce=Object.keys(de.methods||{})||[];(this.__customMethodsList||[]).forEach(pe=>{ce.includes(pe)||delete this[pe]}),this.__customMethodsList=ce,forEach$1(de.methods,(pe,he)=>{let ge=pe;if((isJSExpression(ge)||isJSFunction(ge))&&(ge=this.__parseExpression(ge,this)),typeof ge!="function"){logger$2.error(`custom method ${he} can not be parsed to a valid function`,ge);return}this[he]=ge.bind(this)})});be(this,"__generateCtx",le=>{const{pageContext:de,compContext:ce}=this.context,pe={page:de,component:ce,...le};forEach$1(pe,(he,ge)=>{this[ge]=he})});be(this,"__parseData",(le,de)=>{const{__ctx:ce,thisRequiredInJSE:pe,componentName:he}=this.props;return parseData(le,de||ce||this,{thisRequiredInJSE:pe,logScope:he})});be(this,"__initDataSource",le=>{var ge;if(!le)return;const de=le.__schema||{},ce={list:[]},pe=de.dataSource||ce;if(!!!((ge=le.__appHelper)!=null&&ge.requestHandlersMap)){const ve=le.__appHelper;this.__dataHelper=new DataHelper(this,pe,ve,_e=>this.__parseData(_e)),this.dataSourceMap=this.__dataHelper.dataSourceMap,this.reloadDataSource=()=>new Promise((_e,ye)=>{if(this.__debug("reload data source"),!this.__dataHelper)return _e({});this.__dataHelper.getInitData().then(me=>{if(isEmpty(me))return _e({});this.setState(me,_e)}).catch(me=>{ye(me)})})}});be(this,"__initI18nAPIs",()=>{this.i18n=(le,de={})=>{const{locale:ce,messages:pe}=this.props;return getI18n(le,de,ce,pe)},this.getLocale=()=>this.props.locale,this.setLocale=le=>{var ce,pe,he;const de=(he=(pe=(ce=this.appHelper)==null?void 0:ce.utils)==null?void 0:pe.i18n)==null?void 0:he.setLocale;if(!de||typeof de!="function"){logger$2.warn("initI18nAPIs Failed, i18n only works when appHelper.utils.i18n.setLocale() exists");return}return de(le)}});be(this,"__writeCss",le=>{const de=getValue(le.__schema,"css","");this.__debug("create this.styleElement with css",de);let ce=this.__styleElement;this.__styleElement||(ce=document.createElement("style"),ce.type="text/css",ce.setAttribute("from","style-sheet"),(document.head||document.getElementsByTagName("head")[0]).appendChild(ce),this.__styleElement=ce,this.__debug("this.styleElement is created",this.__styleElement)),ce.innerHTML!==de&&(ce.innerHTML=de)});be(this,"__render",()=>{var ce;const le=this.props.__schema;this.__executeLifeCycleMethod("render"),this.__writeCss(this.props);const{engine:de}=this.context;de&&(de.props.onCompGetCtx(le,this),this.__designModeIsDesign&&(this.__bindCustomMethods(this.props),this.dataSourceMap=(ce=this.__dataHelper)==null?void 0:ce.updateConfig(le.dataSource)))});be(this,"__getRef",le=>{var pe;const{engine:de}=this.context,{__schema:ce}=this.props;le&&((pe=de==null?void 0:de.props)==null||pe.onCompGetRef(ce,le)),this.__ref=le});be(this,"__createDom",()=>{const{__schema:le,__ctx:de,__components:ce={}}=this.props,he={props:{...le.defaultProps,...this.props}};he.__proto__=de||this;const ge=getSchemaChildren(le),ve=ce[le.componentName];ve||this.__debug(`${le.componentName} is invalid!`);const _e={schema:le,Comp:this.__getHOCWrappedComponent(ve,le,he)};return this.__createVirtualDom(ge,he,_e)});be(this,"__createVirtualDom",(le,de,ce,pe="")=>{var _e,ye,me,Ee,Oe,Te,Pe,Re,De;if(le==null)return null;let he=de,ge=le;const{engine:ve}=this.context||{};if(!ve)return this.__debug("this.context.engine is invalid!"),null;try{const{__appHelper:je,__components:Fe={}}=this.props||{};if(isJSExpression(ge))return this.__parseExpression(ge,he);if(isI18nData(ge))return parseI18n(ge,he);if(isJSSlot(ge))return this.__createVirtualDom(ge.value,he,ce);if(typeof ge=="string")return ge;if(typeof ge=="number"||typeof ge=="boolean")return String(ge);if(Array.isArray(ge))return ge.length===1?this.__createVirtualDom(ge[0],he,ce):ge.map((Ae,Be)=>{var Ue;return this.__createVirtualDom(Ae,he,ce,(Ue=Ae==null?void 0:Ae.__ctx)!=null&&Ue.lceKey?"":String(Be))});if(ge.$$typeof)return ge;const xe=getSchemaChildren(ge);if(!ge.componentName){logger$2.error("The componentName in the schema is invalid, please check the schema: ",ge);return}if(ge.componentName==="Fragment"&&xe){const Ae=isJSExpression(xe)?this.__parseExpression(xe,he):xe;return this.__createVirtualDom(Ae,he,ce)}if(ge.componentName==="Text"&&typeof((_e=ge.props)==null?void 0:_e.text)=="string"){const Ae=(ye=ge.props)==null?void 0:ye.text;ge={...ge},ge.children=[Ae]}if(!isSchema(ge))return null;let Ne=Fe[ge.componentName]||((Ee=(me=this.props.__container)==null?void 0:me.components)==null?void 0:Ee[ge.componentName]);const Me=isFileSchema(ge)?{__schema:ge,__appHelper:je,__components:Fe}:{};if(!Ne)return logger$2.error(`${ge.componentName} component is not found in components list! component list is:`,Fe||((Oe=this.props.__container)==null?void 0:Oe.components)),ve.createElement(ve.getNotFoundComponent(),{componentName:ge.componentName,componentId:ge.id,enableStrictNotFoundMode:ve.props.enableStrictNotFoundMode,ref:Ae=>{var Be;Ae&&((Be=ve.props)==null||Be.onCompGetRef(ge,Ae))}},this.__getSchemaChildrenVirtualDom(ge,he,Ne));if(ge.loop!=null){const Ae=this.__parseData(ge.loop,he);if(Array.isArray(Ae)&&Ae.length===0)return null;if(isUseLoop(Ae,this.__designModeIsDesign))return this.__createLoopVirtualDom({...ge,loop:Ae},he,ce,pe)}const Le=ge.condition==null?!0:this.__parseData(ge.condition,he),Se=this.__designModeIsDesign;if(!Le&&!Se)return null;let we="";if(Ne.generateScope){const Ae=this.__parseExpression((Te=ge.props)==null?void 0:Te.key,he);Ae?we=Ae:ge.__ctx?we=ge.__ctx.lceKey+(pe!==void 0?`_${pe}`:""):(ge.__ctx={lceKey:`lce${++ae}`},we=ge.__ctx.lceKey),this.__compScopes[we]||(this.__compScopes[we]=Ne.generateScope(this,ge))}if(we&&this.__compScopes[we]){const Ae={...this.__compScopes[we]};Ae.__proto__=he,he=Ae}(Pe=ve.props)!=null&&Pe.designMode&&(Me.__designMode=ve.props.designMode),this.__designModeIsDesign&&(Me.__tag=Math.random());const Ce={},$e=this.__getComponentProps(ge,he,Ne,{...Ce,props:transformArrayToMap(Ce.props,"name")})||{};this.__componentHOCs.forEach(Ae=>{Ne=Ae(Ne,{schema:ge,componentInfo:Ce,baseRenderer:this,scope:he})}),Me.ref=Ae=>{var Ue;this.$($e.fieldId||$e.ref,Ae);const Be=$e.ref;Be&&typeof Be=="string"&&(this[Be]=Ae),Ae&&((Ue=ve.props)==null||Ue.onCompGetRef(ge,Ae))},we&&this.__compScopes[we]&&($e.__scope=this.__compScopes[we]),(Re=ge==null?void 0:ge.__ctx)!=null&&Re.lceKey?(isFileSchema(ge)||(De=ve.props)==null||De.onCompGetCtx(ge,he),$e.key=$e.key||`${ge.__ctx.lceKey}_${ge.__ctx.idx||0}_${pe!==void 0?pe:""}`):(typeof pe=="number"||typeof pe=="string")&&!$e.key&&($e.key=pe),$e.__id=ge.id,$e.key||($e.key=$e.__id);const Ie=this.__getSchemaChildrenVirtualDom(ge,he,Ne,Le),He=Ae=>ve.createElement(Ne,Ae,Ie);if(ve&&[te.EXTEND,te.BORDER].includes(ve.props.designMode)){if(ne.includes(ge.componentName)){const{ref:Ae,...Be}=Me;return E(Y,{ref:Ae,__designMode:ve.props.designMode},He({...$e,...Be}))}if(Ce!=null&&Ce.parentRule){const Ae=Ce.parentRule.split(","),{schema:Be={componentName:""},Comp:Ue}=ce;!Ae.includes(Be.componentName)||Ue!==Fe[Be.componentName]?($e.__componentName=ge.componentName,Ne=Z):$e.__disableDesignMode=!0}}return He({...$e,...Me,__inner__:{hidden:ge.hidden,condition:Le}})}catch(je){return ve.createElement(ve.getFaultComponent(),{error:je,schema:ge,self:he,parentInfo:ce,idx:pe})}});be(this,"__getSchemaChildrenVirtualDom",(le,de,ce,pe=!0)=>{let he=pe?getSchemaChildren(le):null;const ge=[];return he&&(Array.isArray(he)||(he=[he]),he.forEach(ve=>{const _e=this.__createVirtualDom(isJSExpression(ve)?this.__parseExpression(ve,de):ve,de,{schema:le,Comp:ce});ge.push(_e)})),ge&&ge.length>0?ge:null});be(this,"__getComponentProps",(le,de,ce,pe)=>le?this.__parseProps(le==null?void 0:le.props,de,"",{schema:le,Comp:ce,componentInfo:{...pe||{},props:transformArrayToMap((pe||{}).props,"name")}})||{}:{});be(this,"__createLoopVirtualDom",(le,de,ce,pe)=>{if(isFileSchema(le))return logger$2.warn("file type not support Loop"),null;if(!Array.isArray(le.loop))return null;const he=le.loopArgs&&le.loopArgs[0]||oe,ge=le.loopArgs&&le.loopArgs[1]||ie,{loop:ve}=le;return ve.map((_e,ye)=>{var Ee,Oe;const me={[he]:_e,[ge]:ye};return me.__proto__=de,this.__createVirtualDom({...le,loop:void 0,props:{...le.props,key:isJSExpression((Ee=le.props)==null?void 0:Ee.key)?(Oe=le.props)==null?void 0:Oe.key:null}},me,ce,pe?`${pe}_${ye}`:ye)})});be(this,"__parseProps",(le,de,ce,pe)=>{var Pe,Re,De,je,Fe,xe,Ne,Me,Le;let he=le;const{schema:ge,Comp:ve,componentInfo:_e={}}=pe,ye=getValue(_e.props,ce),me=(Pe=ye==null?void 0:ye.extra)==null?void 0:Pe.propType,Ee=Se=>me?checkPropTypes(Se,ce,me,_e.name)?Se:void 0:Se,Oe=(Se,we)=>{if(isEmpty(we)){const Ce=this.__createVirtualDom(Se,de,{schema:ge,Comp:ve});return Ee(Ce)}return Ee((...Ce)=>{const $e={};return Array.isArray(we)&&we.length&&we.forEach((Ie,He)=>{typeof Ie=="string"?$e[Ie]=Ce[He]:Ie&&typeof Ie=="object"&&($e[Ie.name]=Ce[He])}),$e.__proto__=de,de.__createVirtualDom(Se,$e,{schema:ge,Comp:ve})})};if(isJSExpression(he)&&(he=this.__parseExpression(he,de),!isSchema(he)&&!isJSSlot(he)))return Ee(he);const Te=Se=>Se[Se.use||this.getLocale&&this.getLocale()||"zh-CN"];if(isI18nData(he)){const Se=Te(he);if(Se)he=Se;else return parseI18n(he,de)}if(isVariable(he)&&(he=he.value,isI18nData(he)&&(he=Te(he))),isJSFunction(he)){const Se=R==null?void 0:R(),we=transformStringToFunction(he.value);he=(...Ce)=>{var $e,Ie,He;($e=we==null?void 0:we.call)==null||$e.call(we,de,...Ce),(He=(Ie=Se==null?void 0:Se.runner)==null?void 0:Ie.executeFunction)==null||He.call(Ie,`${ce}`,pe,de,Ce)}}if(isJSSlot(he)){const{params:Se,value:we}=he;return!isSchema(we)||isEmpty(we)?void 0:Oe(we,Se)}if(isSchema(he)){const Se=(ye==null?void 0:ye.type)==="ReactNode"&&((Re=ye==null?void 0:ye.props)==null?void 0:Re.type)==="function",we=(ye==null?void 0:ye.type)==="Mixin"&&((je=(De=ye==null?void 0:ye.props)==null?void 0:De.types)==null?void 0:je.indexOf("ReactNode"))>-1&&((xe=(Fe=ye==null?void 0:ye.props)==null?void 0:Fe.reactNodeProps)==null?void 0:xe.type)==="function";let Ce=null;return Se?Ce=(Ne=ye==null?void 0:ye.props)==null?void 0:Ne.params:we&&(Ce=(Le=(Me=ye==null?void 0:ye.props)==null?void 0:Me.reactNodeProps)==null?void 0:Le.params),Oe(he,Ce)}if(Array.isArray(he))return Ee(he.map((Se,we)=>this.__parseProps(Se,de,ce?`${ce}.${we}`:`${we}`,pe)));if(typeof he=="function")return Ee(he.bind(de));if(he&&typeof he=="object"){if(he.$$typeof)return Ee(he);const Se={};return forEach$1(he,(we,Ce)=>{if(Ce.startsWith("__")){Se[Ce]=we;return}Se[Ce]=this.__parseProps(we,de,ce?`${ce}.${Ce}`:Ce,pe)}),Ee(Se)}return Ee(he)});be(this,"__debug",(...le)=>{logger$2.debug(...le)});be(this,"__renderContextProvider",(le,de)=>E(ee.Provider,{value:{...this.context,blockContext:this,...le||{}},children:de||this.__createDom()}));be(this,"__renderContextConsumer",le=>E(ee.Consumer,{},le));be(this,"__checkSchema",(le,de=[])=>{let ce=de;typeof ce=="string"&&(ce=[ce]);const he=[capitalizeFirstLetter(this.__namespace),...ce];return!isSchema(le)||!he.includes((le==null?void 0:le.componentName)??"")});this.context=de,this.__parseExpression=(pe,he)=>parseExpression({str:pe,self:he,thisRequired:le==null?void 0:le.thisRequiredInJSE,logScope:le.componentName}),this.__beforeInit(le),this.__init(le),this.__afterInit(le),this.__debug(`constructor - ${(ce=le==null?void 0:le.__schema)==null?void 0:ce.fileName}`)}__beforeInit(le){}__init(le){this.__compScopes={},this.__instanceMap={},this.__bindCustomMethods(le),this.__initI18nAPIs()}__afterInit(le){}static getDerivedStateFromProps(le,de){const ce=executeLifeCycleMethod(this,le==null?void 0:le.__schema,"getDerivedStateFromProps",[le,de],le.thisRequiredInJSE);return ce===void 0?null:ce}async getSnapshotBeforeUpdate(...le){var de,ce;this.__executeLifeCycleMethod("getSnapshotBeforeUpdate",le),this.__debug(`getSnapshotBeforeUpdate - ${(ce=(de=this.props)==null?void 0:de.__schema)==null?void 0:ce.fileName}`)}async componentDidMount(...le){var de,ce;this.reloadDataSource().then(()=>{}),this.__executeLifeCycleMethod("componentDidMount",le),this.__debug(`componentDidMount - ${(ce=(de=this.props)==null?void 0:de.__schema)==null?void 0:ce.fileName}`)}async componentDidUpdate(...le){this.__executeLifeCycleMethod("componentDidUpdate",le),this.__debug(`componentDidUpdate - ${this.props.__schema.fileName}`)}async componentWillUnmount(...le){var de,ce;this.__executeLifeCycleMethod("componentWillUnmount",le),this.__debug(`componentWillUnmount - ${(ce=(de=this.props)==null?void 0:de.__schema)==null?void 0:ce.fileName}`)}async componentDidCatch(...le){this.__executeLifeCycleMethod("componentDidCatch",le),logger$2.warn(le)}shouldComponentUpdate(){var le,de,ce,pe;return(de=(le=this.props).getSchemaChangedSymbol)!=null&&de.call(le)&&((ce=this.props.__container)!=null&&ce.rerender)?((pe=this.props.__container)==null||pe.rerender(),!1):!0}forceUpdate(){this.shouldComponentUpdate()&&super.forceUpdate()}get __componentHOCs(){return this.__designModeIsDesign?[leafWrapper,compWrapper]:[compWrapper]}get __designModeIsDesign(){var de;const{engine:le}=this.context||{};return((de=le==null?void 0:le.props)==null?void 0:de.designMode)==="design"}$(le,de){return this.__instanceMap=this.__instanceMap||{},!le||typeof le!="string"?this.__instanceMap:(de&&(this.__instanceMap[le]=de),this.__instanceMap[le])}__getHOCWrappedComponent(le,de,ce){let pe=le;return this.__componentHOCs.forEach(he=>{pe=he(pe||Y,{schema:de,componentInfo:{},baseRenderer:this,scope:ce})}),pe}__renderComp(le,de){console.log("OriginalComp",le),console.log("ctxProps",de);let ce=le;const{__schema:pe,__ctx:he}=this.props,ge={};ge.__proto__=he||this,ce=this.__getHOCWrappedComponent(ce,pe,ge);const ve=this.__parseProps(pe==null?void 0:pe.props,ge,"",{schema:pe,Comp:ce,componentInfo:{}}),{className:_e}=ve,ye={},{engine:me}=this.context||{};if(!me)return null;this.__designModeIsDesign&&(ye.__tag=Math.random());const Ee=me.createElement(ce,{...ve,...this.props,ref:this.__getRef,className:classnames(getFileCssName(pe==null?void 0:pe.fileName),_e,this.props.className),__id:pe==null?void 0:pe.id,...ye},this.__createDom());return this.__renderContextProvider(de,Ee)}__renderContent(le){const{__schema:de}=this.props,ce=this.__parseData(de.props),pe=classnames(`lce-${this.__namespace}`,getFileCssName(de.fileName),ce.className,this.props.className),he={...ce.style||{},...typeof this.props.style=="object"?this.props.style:{}},ge=this.props.id||ce.id;return E("div",{ref:this.__getRef,className:pe,id:ge,style:he},le)}get appHelper(){return this.props.__appHelper}get requestHandlersMap(){var le;return(le=this.appHelper)==null?void 0:le.requestHandlersMap}get utils(){var le;return(le=this.appHelper)==null?void 0:le.utils}get constants(){var le;return(le=this.appHelper)==null?void 0:le.constants}get history(){var le;return(le=this.appHelper)==null?void 0:le.history}get location(){var le;return(le=this.appHelper)==null?void 0:le.location}get match(){var le;return(le=this.appHelper)==null?void 0:le.match}render(){return null}},be(se,"displayName","BaseRenderer"),be(se,"defaultProps",{__schema:{}}),be(se,"contextType",ee),se}const logger$1=getLogger({level:"warn",bizName:"renderer-core:page"});function pageRendererFactory(){var h;const t=baseRendererFactory();return h=class extends t{constructor(){super(...arguments);be(this,"__namespace","page")}__afterInit(Y,...Z){this.__generateCtx({page:this});const ee=Y.__schema||{};this.state=this.__parseData(ee.state||{}),this.__initDataSource(Y),this.__executeLifeCycleMethod("constructor",[Y,...Z])}async componentDidUpdate(Y,Z,ee){var ne;const{__ctx:te}=this.props;if(JSON.stringify(Y.__schema.state)!=JSON.stringify(this.props.__schema.state)){const oe=this.__parseData(this.props.__schema.state,te);this.setState(oe)}(ne=super.componentDidUpdate)==null||ne.call(this,Y,Z,ee)}setState(Y,Z){logger$1.info("page set state",Y),super.setState(Y,Z)}render(){const{__schema:Y,__components:Z}=this.props;if(this.__checkSchema(Y))return"页面schema结构异常！";this.__debug(`${h.displayName} render - ${Y.fileName}`),this.__bindCustomMethods(this.props),this.__initDataSource(this.props),this.__generateCtx({page:this}),this.__render();const{Page:ee}=Z;return ee?this.__renderComp(ee,{pageContext:this}):this.__renderContent(this.__renderContextProvider({pageContext:this}))}},be(h,"displayName","PageRenderer"),h}function componentRendererFactory(){var h;const t=baseRendererFactory();return h=class extends t{constructor(){super(...arguments);be(this,"__namespace","component")}__afterInit(Y){this.__generateCtx({component:this});const Z=Y.__schema||{};this.state=this.__parseData(Z.state||{}),this.__initDataSource(Y),this.__executeLifeCycleMethod("constructor",arguments)}render(){var ne;const{__schema:Y,__components:Z}=this.props;if(this.__checkSchema(Y))return"自定义组件 schema 结构异常！";this.__debug(`${h.displayName} render - ${Y.fileName}`),this.__generateCtx({component:this}),this.__render();const ee=this.__parseData((ne=Y.props)==null?void 0:ne.noContainer);if(this.__bindCustomMethods(this.props),ee)return this.__renderContextProvider({compContext:this});const te=Z==null?void 0:Z[Y==null?void 0:Y.componentName];return te?this.__renderComp(te,this.__renderContextProvider({compContext:this})):this.__renderContent(this.__renderContextProvider({compContext:this}))}},be(h,"displayName","CompRenderer"),h}function blockRendererFactory(){var h;const t=baseRendererFactory();return h=class extends t{constructor(){super(...arguments);be(this,"__namespace","block")}__afterInit(Y){this.__generateCtx({});const Z=Y.__schema||{};this.state=this.__parseData(Z.state||{}),this.__initDataSource(Y),this.__executeLifeCycleMethod("constructor",[...arguments])}render(){const{__schema:Y,__components:Z}=this.props;if(this.__checkSchema(Y,"Div"))return"区块 schema 结构异常！";this.__debug(`${h.displayName} render - ${Y==null?void 0:Y.fileName}`),this.__generateCtx({}),this.__render();const{Block:ee}=Z;return ee?this.__renderComp(ee,{}):this.__renderContent(this.__renderContextProvider())}},be(h,"displayName","BlockRenderer"),h}function addonRendererFactory(){var h;const t=baseRendererFactory();return h=class extends t{constructor(){super(...arguments);be(this,"__namespace","addon");be(this,"addonKey");be(this,"appHelper");be(this,"open");be(this,"close")}__afterInit(Y){var ee;this.__generateCtx({component:this});const Z=Y.__schema||{};if(this.state=this.__parseData(Z.state||{}),isEmpty(Y.config)||!((ee=Y.config)!=null&&ee.addonKey)){logger$2.warn("lce addon has wrong config"),this.setState({__hasError:!0});return}this.addonKey=Y.config.addonKey,this.appHelper.addons=this.appHelper.addons||{},this.appHelper.addons[this.addonKey]=this,this.__initDataSource(Y),this.open=this.open||(()=>{}),this.close=this.close||(()=>{}),this.__executeLifeCycleMethod("constructor",[...arguments])}async componentWillUnmount(){var Z;(Z=super.componentWillUnmount)==null||Z.apply(this,[...arguments]);const Y=this.props.config||{};Y&&this.appHelper.addons&&delete this.appHelper.addons[Y.addonKey]}get utils(){const{utils:Y={}}=this.context.config||{};return{...this.appHelper.utils,...Y}}render(){const{__schema:Y}=this.props;return this.__checkSchema(Y)?"插件 schema 结构异常！":(this.__debug(`${h.displayName} render - ${Y.fileName}`),this.__generateCtx({component:this}),this.__render(),this.__renderContent(this.__renderContextProvider({compContext:this})))}},be(h,"displayName","AddonRenderer"),be(h,"propTypes",{config:PropTypes.object,__schema:PropTypes.object}),be(h,"defaultProps",{config:{},__schema:{}}),h}function tempRendererFactory(){var h;const t=baseRendererFactory();return h=class extends t{constructor(){super(...arguments);be(this,"__namespace","temp");be(this,"cacheSetState")}__init(){this.state={},this.cacheSetState={}}async componentDidMount(){const Y=this.props.__ctx;if(!Y)return;const{setState:Z}=Y;this.cacheSetState=Z,Y.setState=(...ee)=>{Z.call(Y,...ee),setTimeout(()=>this.forceUpdate(),0)},this.__debug(`componentDidMount - ${this.props.__schema.fileName}`)}async componentDidUpdate(){this.__debug(`componentDidUpdate - ${this.props.__schema.fileName}`)}async componentWillUnmount(){const Y=this.props.__ctx;!Y||!this.cacheSetState||(Y.setState=this.cacheSetState,delete this.cacheSetState,this.__debug(`componentWillUnmount - ${this.props.__schema.fileName}`))}async componentDidCatch(Y){logger$2.warn(Y),this.__debug(`componentDidCatch - ${this.props.__schema.fileName}`)}render(){const{__schema:Y,__ctx:Z}=this.props;return this.__checkSchema(Y)?"下钻编辑 schema 结构异常！":(this.__debug(`${h.displayName} render - ${Y==null?void 0:Y.fileName}`),this.__renderContent(this.__renderContextProvider({__ctx:Z})))}},be(h,"displayName","TempRenderer"),h}var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var t=1e3,h=t*60,E=h*60,R=E*24,Y=R*7,Z=R*365.25;ms=function(ie,ae){ae=ae||{};var se=typeof ie;if(se==="string"&&ie.length>0)return ee(ie);if(se==="number"&&isFinite(ie))return ae.long?ne(ie):te(ie);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(ie))};function ee(ie){if(ie=String(ie),!(ie.length>100)){var ae=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(ie);if(ae){var se=parseFloat(ae[1]),ue=(ae[2]||"ms").toLowerCase();switch(ue){case"years":case"year":case"yrs":case"yr":case"y":return se*Z;case"weeks":case"week":case"w":return se*Y;case"days":case"day":case"d":return se*R;case"hours":case"hour":case"hrs":case"hr":case"h":return se*E;case"minutes":case"minute":case"mins":case"min":case"m":return se*h;case"seconds":case"second":case"secs":case"sec":case"s":return se*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return se;default:return}}}}function te(ie){var ae=Math.abs(ie);return ae>=R?Math.round(ie/R)+"d":ae>=E?Math.round(ie/E)+"h":ae>=h?Math.round(ie/h)+"m":ae>=t?Math.round(ie/t)+"s":ie+"ms"}function ne(ie){var ae=Math.abs(ie);return ae>=R?oe(ie,ae,R,"day"):ae>=E?oe(ie,ae,E,"hour"):ae>=h?oe(ie,ae,h,"minute"):ae>=t?oe(ie,ae,t,"second"):ie+" ms"}function oe(ie,ae,se,ue){var fe=ae>=se*1.5;return Math.round(ie/se)+" "+ue+(fe?"s":"")}return ms}function setup(t){E.debug=E,E.default=E,E.coerce=ne,E.disable=Z,E.enable=Y,E.enabled=ee,E.humanize=requireMs(),E.destroy=oe,Object.keys(t).forEach(ie=>{E[ie]=t[ie]}),E.names=[],E.skips=[],E.formatters={};function h(ie){let ae=0;for(let se=0;se<ie.length;se++)ae=(ae<<5)-ae+ie.charCodeAt(se),ae|=0;return E.colors[Math.abs(ae)%E.colors.length]}E.selectColor=h;function E(ie){let ae,se=null,ue,fe;function le(...de){if(!le.enabled)return;const ce=le,pe=Number(new Date),he=pe-(ae||pe);ce.diff=he,ce.prev=ae,ce.curr=pe,ae=pe,de[0]=E.coerce(de[0]),typeof de[0]!="string"&&de.unshift("%O");let ge=0;de[0]=de[0].replace(/%([a-zA-Z%])/g,(_e,ye)=>{if(_e==="%%")return"%";ge++;const me=E.formatters[ye];if(typeof me=="function"){const Ee=de[ge];_e=me.call(ce,Ee),de.splice(ge,1),ge--}return _e}),E.formatArgs.call(ce,de),(ce.log||E.log).apply(ce,de)}return le.namespace=ie,le.useColors=E.useColors(),le.color=E.selectColor(ie),le.extend=R,le.destroy=E.destroy,Object.defineProperty(le,"enabled",{enumerable:!0,configurable:!1,get:()=>se!==null?se:(ue!==E.namespaces&&(ue=E.namespaces,fe=E.enabled(ie)),fe),set:de=>{se=de}}),typeof E.init=="function"&&E.init(le),le}function R(ie,ae){const se=E(this.namespace+(typeof ae>"u"?":":ae)+ie);return se.log=this.log,se}function Y(ie){E.save(ie),E.namespaces=ie,E.names=[],E.skips=[];let ae;const se=(typeof ie=="string"?ie:"").split(/[\s,]+/),ue=se.length;for(ae=0;ae<ue;ae++)se[ae]&&(ie=se[ae].replace(/\*/g,".*?"),ie[0]==="-"?E.skips.push(new RegExp("^"+ie.slice(1)+"$")):E.names.push(new RegExp("^"+ie+"$")))}function Z(){const ie=[...E.names.map(te),...E.skips.map(te).map(ae=>"-"+ae)].join(",");return E.enable(""),ie}function ee(ie){if(ie[ie.length-1]==="*")return!0;let ae,se;for(ae=0,se=E.skips.length;ae<se;ae++)if(E.skips[ae].test(ie))return!1;for(ae=0,se=E.names.length;ae<se;ae++)if(E.names[ae].test(ie))return!0;return!1}function te(ie){return ie.toString().substring(2,ie.toString().length-2).replace(/\.\*\?$/,"*")}function ne(ie){return ie instanceof Error?ie.stack||ie.message:ie}function oe(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return E.enable(E.load()),E}var common=setup;(function(t,h){h.formatArgs=R,h.save=Y,h.load=Z,h.useColors=E,h.storage=ee(),h.destroy=(()=>{let ne=!1;return()=>{ne||(ne=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function E(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let ne;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(ne=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(ne[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function R(ne){if(ne[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+ne[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const oe="color: "+this.color;ne.splice(1,0,oe,"color: inherit");let ie=0,ae=0;ne[0].replace(/%[a-zA-Z%]/g,se=>{se!=="%%"&&(ie++,se==="%c"&&(ae=ie))}),ne.splice(ae,0,oe)}h.log=console.debug||console.log||(()=>{});function Y(ne){try{ne?h.storage.setItem("debug",ne):h.storage.removeItem("debug")}catch{}}function Z(){let ne;try{ne=h.storage.getItem("debug")}catch{}return!ne&&typeof process<"u"&&"env"in process&&(ne=process.env.DEBUG),ne}function ee(){try{return localStorage}catch{}}t.exports=common(h);const{formatters:te}=t.exports;te.j=function(ne){try{return JSON.stringify(ne)}catch(oe){return"[UnexpectedJSONParseError]: "+oe.message}}})(browser,browser.exports);var browserExports=browser.exports;const Debug=getDefaultExportFromCjs(browserExports);function rendererFactory(){var se;const{PureComponent:t,Component:h,createElement:E,findDOMNode:R}=adapter.getRuntime(),Y=adapter.getRenderers(),Z=baseRendererFactory(),ee=contextFactory(),te=divFactory(),ne=adapter.getConfigProvider()||te,oe=Debug("renderer:entry");class ie extends t{render(){var fe;return logger$2.error(`%c${this.props.componentName||""} 组件渲染异常, 异常原因: ${((fe=this.props.error)==null?void 0:fe.message)||this.props.error||"未知"}`,"color: #ff0000;"),E(te,{style:{width:"100%",height:"50px",lineHeight:"50px",textAlign:"center",fontSize:"15px",color:"#ff0000",border:"2px solid #ff0000"}},`${this.props.componentName||""} 组件渲染异常，请查看控制台日志`)}}class ae extends t{render(){return this.props.enableStrictNotFoundMode?`${this.props.componentName||""} Component Not Found`:E(te,this.props,this.props.children||`${this.props.componentName||""} Component Not Found`)}}return se=class extends h{constructor(le,de){var ce;super(le,de);be(this,"state",{});be(this,"__ref");be(this,"__getRef",le=>{var de,ce;this.__ref=le,le&&((ce=(de=this.props).onCompGetRef)==null||ce.call(de,this.props.schema,le))});this.state={},oe(`entry.constructor - ${(ce=le==null?void 0:le.schema)==null?void 0:ce.componentName}`)}async componentDidMount(){oe(`entry.componentDidMount - ${this.props.schema&&this.props.schema.componentName}`)}async componentDidUpdate(){var le,de;oe(`entry.componentDidUpdate - ${(de=(le=this.props)==null?void 0:le.schema)==null?void 0:de.componentName}`)}async componentWillUnmount(){var le,de;oe(`entry.componentWillUnmount - ${(de=(le=this.props)==null?void 0:le.schema)==null?void 0:de.componentName}`)}componentDidCatch(le){this.state.engineRenderError=!0,this.state.error=le}shouldComponentUpdate(le){return!le.suspended}isValidComponent(le){return le}createElement(le,de,ce){return(this.props.customCreateElement||E)(le,de,ce)}getNotFoundComponent(){return this.props.notFoundComponent||ae}getFaultComponent(){const{faultComponent:le,faultComponentMap:de,schema:ce}=this.props;if(de){const{componentName:pe}=ce;return de[pe]||le||ie}return le||ie}getComp(){const{schema:le,components:de}=this.props,{componentName:ce}=le;let he={...Y,...de}[ce]||Y[`${ce}Renderer`];return he&&he.prototype&&(he.prototype instanceof Z||(he=Y[`${ce}Renderer`])),he}render(){const{schema:le,designMode:de,appHelper:ce,components:pe}=this.props;if(isEmpty(le))return null;if(le.componentName!=="Div"&&!isFileSchema(le))return logger$2.error("The root component name needs to be one of Page、Block、Component, please check the schema: ",le),"模型结构异常";oe("entry.render");const he={...Y,...pe},ge=this.getComp();return this.state&&this.state.engineRenderError?E(this.getFaultComponent(),{...this.props,error:this.state.error}):ge?E(ee.Provider,{value:{appHelper:ce,components:he,engine:this}},E(ne,{device:this.props.device,locale:this.props.locale},E(ge,{key:le.__ctx&&`${le.__ctx.lceKey}_${le.__ctx.idx||"0"}`,ref:this.__getRef,__appHelper:ce,__components:he,__schema:le,__designMode:de,...this.props}))):null}},be(se,"displayName","Renderer"),be(se,"defaultProps",{appHelper:void 0,components:{},designMode:"",suspended:!1,schema:{},onCompGetRef:()=>{},onCompGetCtx:()=>{},thisRequiredInJSE:!0}),be(se,"findDOMNode",R),se}const logger=getLogger({level:"info",bizName:"renderer:entry"});logger.log("window.React====== get run time",window.React),logger.log("window.ReactDOM====== get run time",window.ReactDOM),logger.log("window.LogicflowRender====== get run time",window.LogicflowRender),window.React||(logger.log("window.React====== set run time"),window.React=require$$0),window.ReactDOM||(window.ReactDOM=ReactDOM),window.LogicflowRender||(window.LogicflowRender={runner:Runner}),console.log(window.React,window.ReactDOM,window.LogicflowRender),adapter.setRuntime({FlowRunner:()=>window.LogicflowRender,Component:window.React.Component,PureComponent:window.React.PureComponent,createContext:window.React.createContext,createElement:window.React.createElement,forwardRef:window.React.forwardRef,findDOMNode:window.ReactDOM.findDOMNode}),adapter.setRenderers({PageRenderer:pageRendererFactory(),ComponentRenderer:componentRendererFactory(),BlockRenderer:blockRendererFactory(),AddonRenderer:addonRendererFactory(),TempRenderer:tempRendererFactory(),DivRenderer:blockRendererFactory()});function factory(){const t=rendererFactory();return class extends t{constructor(R,Y){super(R,Y);be(this,"props");be(this,"context");be(this,"setState");be(this,"forceUpdate");be(this,"refs")}isValidComponent(R){var Y;return((Y=R==null?void 0:R.prototype)==null?void 0:Y.isReactComponent)||(R==null?void 0:R.prototype)instanceof require$$0.Component}}}const ReactRenderer=factory();function bind(t,h){return function(){return t.apply(h,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,kindOf=(t=>h=>{const E=toString.call(h);return t[E]||(t[E]=E.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=t=>(t=t.toLowerCase(),h=>kindOf(h)===t),typeOfTest=t=>h=>typeof h===t,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(t){return t!==null&&!isUndefined(t)&&t.constructor!==null&&!isUndefined(t.constructor)&&isFunction(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(t){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(t):h=t&&t.buffer&&isArrayBuffer(t.buffer),h}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=t=>t!==null&&typeof t=="object",isBoolean=t=>t===!0||t===!1,isPlainObject=t=>{if(kindOf(t)!=="object")return!1;const h=getPrototypeOf(t);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=t=>isObject(t)&&isFunction(t.pipe),isFormData=t=>{let h;return t&&(typeof FormData=="function"&&t instanceof FormData||isFunction(t.append)&&((h=kindOf(t))==="formdata"||h==="object"&&isFunction(t.toString)&&t.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(t,h,{allOwnKeys:E=!1}={}){if(t===null||typeof t>"u")return;let R,Y;if(typeof t!="object"&&(t=[t]),isArray(t))for(R=0,Y=t.length;R<Y;R++)h.call(null,t[R],R,t);else{const Z=E?Object.getOwnPropertyNames(t):Object.keys(t),ee=Z.length;let te;for(R=0;R<ee;R++)te=Z[R],h.call(null,t[te],te,t)}}function findKey(t,h){h=h.toLowerCase();const E=Object.keys(t);let R=E.length,Y;for(;R-- >0;)if(Y=E[R],h===Y.toLowerCase())return Y;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=t=>!isUndefined(t)&&t!==_global;function merge(){const{caseless:t}=isContextDefined(this)&&this||{},h={},E=(R,Y)=>{const Z=t&&findKey(h,Y)||Y;isPlainObject(h[Z])&&isPlainObject(R)?h[Z]=merge(h[Z],R):isPlainObject(R)?h[Z]=merge({},R):isArray(R)?h[Z]=R.slice():h[Z]=R};for(let R=0,Y=arguments.length;R<Y;R++)arguments[R]&&forEach(arguments[R],E);return h}const extend=(t,h,E,{allOwnKeys:R}={})=>(forEach(h,(Y,Z)=>{E&&isFunction(Y)?t[Z]=bind(Y,E):t[Z]=Y},{allOwnKeys:R}),t),stripBOM=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits=(t,h,E,R)=>{t.prototype=Object.create(h.prototype,R),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:h.prototype}),E&&Object.assign(t.prototype,E)},toFlatObject=(t,h,E,R)=>{let Y,Z,ee;const te={};if(h=h||{},t==null)return h;do{for(Y=Object.getOwnPropertyNames(t),Z=Y.length;Z-- >0;)ee=Y[Z],(!R||R(ee,t,h))&&!te[ee]&&(h[ee]=t[ee],te[ee]=!0);t=E!==!1&&getPrototypeOf(t)}while(t&&(!E||E(t,h))&&t!==Object.prototype);return h},endsWith=(t,h,E)=>{t=String(t),(E===void 0||E>t.length)&&(E=t.length),E-=h.length;const R=t.indexOf(h,E);return R!==-1&&R===E},toArray=t=>{if(!t)return null;if(isArray(t))return t;let h=t.length;if(!isNumber(h))return null;const E=new Array(h);for(;h-- >0;)E[h]=t[h];return E},isTypedArray=(t=>h=>t&&h instanceof t)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(t,h)=>{const R=(t&&t[Symbol.iterator]).call(t);let Y;for(;(Y=R.next())&&!Y.done;){const Z=Y.value;h.call(t,Z[0],Z[1])}},matchAll=(t,h)=>{let E;const R=[];for(;(E=t.exec(h))!==null;)R.push(E);return R},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(E,R,Y){return R.toUpperCase()+Y}),hasOwnProperty=(({hasOwnProperty:t})=>(h,E)=>t.call(h,E))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(t,h)=>{const E=Object.getOwnPropertyDescriptors(t),R={};forEach(E,(Y,Z)=>{let ee;(ee=h(Y,Z,t))!==!1&&(R[Z]=ee||Y)}),Object.defineProperties(t,R)},freezeMethods=t=>{reduceDescriptors(t,(h,E)=>{if(isFunction(t)&&["arguments","caller","callee"].indexOf(E)!==-1)return!1;const R=t[E];if(isFunction(R)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not rewrite read-only method '"+E+"'")})}})},toObjectSet=(t,h)=>{const E={},R=Y=>{Y.forEach(Z=>{E[Z]=!0})};return isArray(t)?R(t):R(String(t).split(h)),E},noop=()=>{},toFiniteNumber=(t,h)=>t!=null&&Number.isFinite(t=+t)?t:h,ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT,ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(t=16,h=ALPHABET.ALPHA_DIGIT)=>{let E="";const{length:R}=h;for(;t--;)E+=h[Math.random()*R|0];return E};function isSpecCompliantForm(t){return!!(t&&isFunction(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const toJSONObject=t=>{const h=new Array(10),E=(R,Y)=>{if(isObject(R)){if(h.indexOf(R)>=0)return;if(!("toJSON"in R)){h[Y]=R;const Z=isArray(R)?[]:{};return forEach(R,(ee,te)=>{const ne=E(ee,Y+1);!isUndefined(ne)&&(Z[te]=ne)}),h[Y]=void 0,Z}}return R};return E(t,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=t=>t&&(isObject(t)||isFunction(t))&&isFunction(t.then)&&isFunction(t.catch),_setImmediate=((t,h)=>t?setImmediate:h?((E,R)=>(_global.addEventListener("message",({source:Y,data:Z})=>{Y===_global&&Z===E&&R.length&&R.shift()()},!1),Y=>{R.push(Y),_global.postMessage(E,"*")}))(`axios@${Math.random()}`,[]):E=>setTimeout(E))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,ALPHABET,generateString,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap};function AxiosError(t,h,E,R,Y){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",h&&(this.code=h),E&&(this.config=E),R&&(this.request=R),Y&&(this.response=Y,this.status=Y.status?Y.status:null)}utils$1.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{descriptors[t]={value:t}}),Object.defineProperties(AxiosError,descriptors),Object.defineProperty(prototype$1,"isAxiosError",{value:!0}),AxiosError.from=(t,h,E,R,Y,Z)=>{const ee=Object.create(prototype$1);return utils$1.toFlatObject(t,ee,function(ne){return ne!==Error.prototype},te=>te!=="isAxiosError"),AxiosError.call(ee,t.message,h,E,R,Y),ee.cause=t,ee.name=t.name,Z&&Object.assign(ee,Z),ee};const httpAdapter=null;function isVisitable(t){return utils$1.isPlainObject(t)||utils$1.isArray(t)}function removeBrackets(t){return utils$1.endsWith(t,"[]")?t.slice(0,-2):t}function renderKey(t,h,E){return t?t.concat(h).map(function(Y,Z){return Y=removeBrackets(Y),!E&&Z?"["+Y+"]":Y}).join(E?".":""):h}function isFlatArray(t){return utils$1.isArray(t)&&!t.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function(h){return/^is[A-Z]/.test(h)});function toFormData(t,h,E){if(!utils$1.isObject(t))throw new TypeError("target must be an object");h=h||new FormData,E=utils$1.toFlatObject(E,{metaTokens:!0,dots:!1,indexes:!1},!1,function(le,de){return!utils$1.isUndefined(de[le])});const R=E.metaTokens,Y=E.visitor||ie,Z=E.dots,ee=E.indexes,ne=(E.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(h);if(!utils$1.isFunction(Y))throw new TypeError("visitor must be a function");function oe(fe){if(fe===null)return"";if(utils$1.isDate(fe))return fe.toISOString();if(!ne&&utils$1.isBlob(fe))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(fe)||utils$1.isTypedArray(fe)?ne&&typeof Blob=="function"?new Blob([fe]):Buffer.from(fe):fe}function ie(fe,le,de){let ce=fe;if(fe&&!de&&typeof fe=="object"){if(utils$1.endsWith(le,"{}"))le=R?le:le.slice(0,-2),fe=JSON.stringify(fe);else if(utils$1.isArray(fe)&&isFlatArray(fe)||(utils$1.isFileList(fe)||utils$1.endsWith(le,"[]"))&&(ce=utils$1.toArray(fe)))return le=removeBrackets(le),ce.forEach(function(he,ge){!(utils$1.isUndefined(he)||he===null)&&h.append(ee===!0?renderKey([le],ge,Z):ee===null?le:le+"[]",oe(he))}),!1}return isVisitable(fe)?!0:(h.append(renderKey(de,le,Z),oe(fe)),!1)}const ae=[],se=Object.assign(predicates,{defaultVisitor:ie,convertValue:oe,isVisitable});function ue(fe,le){if(!utils$1.isUndefined(fe)){if(ae.indexOf(fe)!==-1)throw Error("Circular reference detected in "+le.join("."));ae.push(fe),utils$1.forEach(fe,function(ce,pe){(!(utils$1.isUndefined(ce)||ce===null)&&Y.call(h,ce,utils$1.isString(pe)?pe.trim():pe,le,se))===!0&&ue(ce,le?le.concat(pe):[pe])}),ae.pop()}}if(!utils$1.isObject(t))throw new TypeError("data must be an object");return ue(t),h}function encode$1(t){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(R){return h[R]})}function AxiosURLSearchParams(t,h){this._pairs=[],t&&toFormData(t,this,h)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(h,E){this._pairs.push([h,E])},prototype.toString=function(h){const E=h?function(R){return h.call(this,R,encode$1)}:encode$1;return this._pairs.map(function(Y){return E(Y[0])+"="+E(Y[1])},"").join("&")};function encode(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(t,h,E){if(!h)return t;const R=E&&E.encode||encode;utils$1.isFunction(E)&&(E={serialize:E});const Y=E&&E.serialize;let Z;if(Y?Z=Y(h,E):Z=utils$1.isURLSearchParams(h)?h.toString():new AxiosURLSearchParams(h,E).toString(R),Z){const ee=t.indexOf("#");ee!==-1&&(t=t.slice(0,ee)),t+=(t.indexOf("?")===-1?"?":"&")+Z}return t}class InterceptorManager{constructor(){this.handlers=[]}use(h,E,R){return this.handlers.push({fulfilled:h,rejected:E,synchronous:R?R.synchronous:!1,runWhen:R?R.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){utils$1.forEach(this.handlers,function(R){R!==null&&h(R)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(t,h){return toFormData(t,new platform.classes.URLSearchParams,Object.assign({visitor:function(E,R,Y,Z){return platform.isNode&&utils$1.isBuffer(E)?(this.append(R,E.toString("base64")),!1):Z.defaultVisitor.apply(this,arguments)}},h))}function parsePropPath(t){return utils$1.matchAll(/\w+|\[(\w*)]/g,t).map(h=>h[0]==="[]"?"":h[1]||h[0])}function arrayToObject(t){const h={},E=Object.keys(t);let R;const Y=E.length;let Z;for(R=0;R<Y;R++)Z=E[R],h[Z]=t[Z];return h}function formDataToJSON(t){function h(E,R,Y,Z){let ee=E[Z++];if(ee==="__proto__")return!0;const te=Number.isFinite(+ee),ne=Z>=E.length;return ee=!ee&&utils$1.isArray(Y)?Y.length:ee,ne?(utils$1.hasOwnProp(Y,ee)?Y[ee]=[Y[ee],R]:Y[ee]=R,!te):((!Y[ee]||!utils$1.isObject(Y[ee]))&&(Y[ee]=[]),h(E,R,Y[ee],Z)&&utils$1.isArray(Y[ee])&&(Y[ee]=arrayToObject(Y[ee])),!te)}if(utils$1.isFormData(t)&&utils$1.isFunction(t.entries)){const E={};return utils$1.forEachEntry(t,(R,Y)=>{h(parsePropPath(R),Y,E,0)}),E}return null}function stringifySafely(t,h,E){if(utils$1.isString(t))try{return(h||JSON.parse)(t),utils$1.trim(t)}catch(R){if(R.name!=="SyntaxError")throw R}return(0,JSON.stringify)(t)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(h,E){const R=E.getContentType()||"",Y=R.indexOf("application/json")>-1,Z=utils$1.isObject(h);if(Z&&utils$1.isHTMLForm(h)&&(h=new FormData(h)),utils$1.isFormData(h))return Y?JSON.stringify(formDataToJSON(h)):h;if(utils$1.isArrayBuffer(h)||utils$1.isBuffer(h)||utils$1.isStream(h)||utils$1.isFile(h)||utils$1.isBlob(h)||utils$1.isReadableStream(h))return h;if(utils$1.isArrayBufferView(h))return h.buffer;if(utils$1.isURLSearchParams(h))return E.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let te;if(Z){if(R.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(h,this.formSerializer).toString();if((te=utils$1.isFileList(h))||R.indexOf("multipart/form-data")>-1){const ne=this.env&&this.env.FormData;return toFormData(te?{"files[]":h}:h,ne&&new ne,this.formSerializer)}}return Z||Y?(E.setContentType("application/json",!1),stringifySafely(h)):h}],transformResponse:[function(h){const E=this.transitional||defaults.transitional,R=E&&E.forcedJSONParsing,Y=this.responseType==="json";if(utils$1.isResponse(h)||utils$1.isReadableStream(h))return h;if(h&&utils$1.isString(h)&&(R&&!this.responseType||Y)){const ee=!(E&&E.silentJSONParsing)&&Y;try{return JSON.parse(h)}catch(te){if(ee)throw te.name==="SyntaxError"?AxiosError.from(te,AxiosError.ERR_BAD_RESPONSE,this,null,this.response):te}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],t=>{defaults.headers[t]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=t=>{const h={};let E,R,Y;return t&&t.split(`
`).forEach(function(ee){Y=ee.indexOf(":"),E=ee.substring(0,Y).trim().toLowerCase(),R=ee.substring(Y+1).trim(),!(!E||h[E]&&ignoreDuplicateOf[E])&&(E==="set-cookie"?h[E]?h[E].push(R):h[E]=[R]:h[E]=h[E]?h[E]+", "+R:R)}),h},$internals=Symbol("internals");function normalizeHeader(t){return t&&String(t).trim().toLowerCase()}function normalizeValue(t){return t===!1||t==null?t:utils$1.isArray(t)?t.map(normalizeValue):String(t)}function parseTokens(t){const h=Object.create(null),E=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let R;for(;R=E.exec(t);)h[R[1]]=R[2];return h}const isValidHeaderName=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function matchHeaderValue(t,h,E,R,Y){if(utils$1.isFunction(R))return R.call(this,h,E);if(Y&&(h=E),!!utils$1.isString(h)){if(utils$1.isString(R))return h.indexOf(R)!==-1;if(utils$1.isRegExp(R))return R.test(h)}}function formatHeader(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,E,R)=>E.toUpperCase()+R)}function buildAccessors(t,h){const E=utils$1.toCamelCase(" "+h);["get","set","has"].forEach(R=>{Object.defineProperty(t,R+E,{value:function(Y,Z,ee){return this[R].call(this,h,Y,Z,ee)},configurable:!0})})}class AxiosHeaders{constructor(h){h&&this.set(h)}set(h,E,R){const Y=this;function Z(te,ne,oe){const ie=normalizeHeader(ne);if(!ie)throw new Error("header name must be a non-empty string");const ae=utils$1.findKey(Y,ie);(!ae||Y[ae]===void 0||oe===!0||oe===void 0&&Y[ae]!==!1)&&(Y[ae||ne]=normalizeValue(te))}const ee=(te,ne)=>utils$1.forEach(te,(oe,ie)=>Z(oe,ie,ne));if(utils$1.isPlainObject(h)||h instanceof this.constructor)ee(h,E);else if(utils$1.isString(h)&&(h=h.trim())&&!isValidHeaderName(h))ee(parseHeaders(h),E);else if(utils$1.isHeaders(h))for(const[te,ne]of h.entries())Z(ne,te,R);else h!=null&&Z(E,h,R);return this}get(h,E){if(h=normalizeHeader(h),h){const R=utils$1.findKey(this,h);if(R){const Y=this[R];if(!E)return Y;if(E===!0)return parseTokens(Y);if(utils$1.isFunction(E))return E.call(this,Y,R);if(utils$1.isRegExp(E))return E.exec(Y);throw new TypeError("parser must be boolean|regexp|function")}}}has(h,E){if(h=normalizeHeader(h),h){const R=utils$1.findKey(this,h);return!!(R&&this[R]!==void 0&&(!E||matchHeaderValue(this,this[R],R,E)))}return!1}delete(h,E){const R=this;let Y=!1;function Z(ee){if(ee=normalizeHeader(ee),ee){const te=utils$1.findKey(R,ee);te&&(!E||matchHeaderValue(R,R[te],te,E))&&(delete R[te],Y=!0)}}return utils$1.isArray(h)?h.forEach(Z):Z(h),Y}clear(h){const E=Object.keys(this);let R=E.length,Y=!1;for(;R--;){const Z=E[R];(!h||matchHeaderValue(this,this[Z],Z,h,!0))&&(delete this[Z],Y=!0)}return Y}normalize(h){const E=this,R={};return utils$1.forEach(this,(Y,Z)=>{const ee=utils$1.findKey(R,Z);if(ee){E[ee]=normalizeValue(Y),delete E[Z];return}const te=h?formatHeader(Z):String(Z).trim();te!==Z&&delete E[Z],E[te]=normalizeValue(Y),R[te]=!0}),this}concat(...h){return this.constructor.concat(this,...h)}toJSON(h){const E=Object.create(null);return utils$1.forEach(this,(R,Y)=>{R!=null&&R!==!1&&(E[Y]=h&&utils$1.isArray(R)?R.join(", "):R)}),E}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([h,E])=>h+": "+E).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(h){return h instanceof this?h:new this(h)}static concat(h,...E){const R=new this(h);return E.forEach(Y=>R.set(Y)),R}static accessor(h){const R=(this[$internals]=this[$internals]={accessors:{}}).accessors,Y=this.prototype;function Z(ee){const te=normalizeHeader(ee);R[te]||(buildAccessors(Y,ee),R[te]=!0)}return utils$1.isArray(h)?h.forEach(Z):Z(h),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils$1.reduceDescriptors(AxiosHeaders.prototype,({value:t},h)=>{let E=h[0].toUpperCase()+h.slice(1);return{get:()=>t,set(R){this[E]=R}}}),utils$1.freezeMethods(AxiosHeaders);function transformData(t,h){const E=this||defaults,R=h||E,Y=AxiosHeaders.from(R.headers);let Z=R.data;return utils$1.forEach(t,function(te){Z=te.call(E,Z,Y.normalize(),h?h.status:void 0)}),Y.normalize(),Z}function isCancel(t){return!!(t&&t.__CANCEL__)}function CanceledError(t,h,E){AxiosError.call(this,t??"canceled",AxiosError.ERR_CANCELED,h,E),this.name="CanceledError"}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});function settle(t,h,E){const R=E.config.validateStatus;!E.status||!R||R(E.status)?t(E):h(new AxiosError("Request failed with status code "+E.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(E.status/100)-4],E.config,E.request,E))}function parseProtocol(t){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return h&&h[1]||""}function speedometer(t,h){t=t||10;const E=new Array(t),R=new Array(t);let Y=0,Z=0,ee;return h=h!==void 0?h:1e3,function(ne){const oe=Date.now(),ie=R[Z];ee||(ee=oe),E[Y]=ne,R[Y]=oe;let ae=Z,se=0;for(;ae!==Y;)se+=E[ae++],ae=ae%t;if(Y=(Y+1)%t,Y===Z&&(Z=(Z+1)%t),oe-ee<h)return;const ue=ie&&oe-ie;return ue?Math.round(se*1e3/ue):void 0}}function throttle(t,h){let E=0,R=1e3/h,Y,Z;const ee=(oe,ie=Date.now())=>{E=ie,Y=null,Z&&(clearTimeout(Z),Z=null),t.apply(null,oe)};return[(...oe)=>{const ie=Date.now(),ae=ie-E;ae>=R?ee(oe,ie):(Y=oe,Z||(Z=setTimeout(()=>{Z=null,ee(Y)},R-ae)))},()=>Y&&ee(Y)]}const progressEventReducer=(t,h,E=3)=>{let R=0;const Y=speedometer(50,250);return throttle(Z=>{const ee=Z.loaded,te=Z.lengthComputable?Z.total:void 0,ne=ee-R,oe=Y(ne),ie=ee<=te;R=ee;const ae={loaded:ee,total:te,progress:te?ee/te:void 0,bytes:ne,rate:oe||void 0,estimated:oe&&te&&ie?(te-ee)/oe:void 0,event:Z,lengthComputable:te!=null,[h?"download":"upload"]:!0};t(ae)},E)},progressEventDecorator=(t,h)=>{const E=t!=null;return[R=>h[0]({lengthComputable:E,total:t,loaded:R}),h[1]]},asyncDecorator=t=>(...h)=>utils$1.asap(()=>t(...h)),isURLSameOrigin=platform.hasStandardBrowserEnv?((t,h)=>E=>(E=new URL(E,platform.origin),t.protocol===E.protocol&&t.host===E.host&&(h||t.port===E.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(t,h,E,R,Y,Z){const ee=[t+"="+encodeURIComponent(h)];utils$1.isNumber(E)&&ee.push("expires="+new Date(E).toGMTString()),utils$1.isString(R)&&ee.push("path="+R),utils$1.isString(Y)&&ee.push("domain="+Y),Z===!0&&ee.push("secure"),document.cookie=ee.join("; ")},read(t){const h=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function combineURLs(t,h){return h?t.replace(/\/?\/$/,"")+"/"+h.replace(/^\/+/,""):t}function buildFullPath(t,h){return t&&!isAbsoluteURL(h)?combineURLs(t,h):h}const headersToObject=t=>t instanceof AxiosHeaders?{...t}:t;function mergeConfig(t,h){h=h||{};const E={};function R(oe,ie,ae,se){return utils$1.isPlainObject(oe)&&utils$1.isPlainObject(ie)?utils$1.merge.call({caseless:se},oe,ie):utils$1.isPlainObject(ie)?utils$1.merge({},ie):utils$1.isArray(ie)?ie.slice():ie}function Y(oe,ie,ae,se){if(utils$1.isUndefined(ie)){if(!utils$1.isUndefined(oe))return R(void 0,oe,ae,se)}else return R(oe,ie,ae,se)}function Z(oe,ie){if(!utils$1.isUndefined(ie))return R(void 0,ie)}function ee(oe,ie){if(utils$1.isUndefined(ie)){if(!utils$1.isUndefined(oe))return R(void 0,oe)}else return R(void 0,ie)}function te(oe,ie,ae){if(ae in h)return R(oe,ie);if(ae in t)return R(void 0,oe)}const ne={url:Z,method:Z,data:Z,baseURL:ee,transformRequest:ee,transformResponse:ee,paramsSerializer:ee,timeout:ee,timeoutMessage:ee,withCredentials:ee,withXSRFToken:ee,adapter:ee,responseType:ee,xsrfCookieName:ee,xsrfHeaderName:ee,onUploadProgress:ee,onDownloadProgress:ee,decompress:ee,maxContentLength:ee,maxBodyLength:ee,beforeRedirect:ee,transport:ee,httpAgent:ee,httpsAgent:ee,cancelToken:ee,socketPath:ee,responseEncoding:ee,validateStatus:te,headers:(oe,ie,ae)=>Y(headersToObject(oe),headersToObject(ie),ae,!0)};return utils$1.forEach(Object.keys(Object.assign({},t,h)),function(ie){const ae=ne[ie]||Y,se=ae(t[ie],h[ie],ie);utils$1.isUndefined(se)&&ae!==te||(E[ie]=se)}),E}const resolveConfig=t=>{const h=mergeConfig({},t);let{data:E,withXSRFToken:R,xsrfHeaderName:Y,xsrfCookieName:Z,headers:ee,auth:te}=h;h.headers=ee=AxiosHeaders.from(ee),h.url=buildURL(buildFullPath(h.baseURL,h.url),t.params,t.paramsSerializer),te&&ee.set("Authorization","Basic "+btoa((te.username||"")+":"+(te.password?unescape(encodeURIComponent(te.password)):"")));let ne;if(utils$1.isFormData(E)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)ee.setContentType(void 0);else if((ne=ee.getContentType())!==!1){const[oe,...ie]=ne?ne.split(";").map(ae=>ae.trim()).filter(Boolean):[];ee.setContentType([oe||"multipart/form-data",...ie].join("; "))}}if(platform.hasStandardBrowserEnv&&(R&&utils$1.isFunction(R)&&(R=R(h)),R||R!==!1&&isURLSameOrigin(h.url))){const oe=Y&&Z&&cookies.read(Z);oe&&ee.set(Y,oe)}return h},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(t){return new Promise(function(E,R){const Y=resolveConfig(t);let Z=Y.data;const ee=AxiosHeaders.from(Y.headers).normalize();let{responseType:te,onUploadProgress:ne,onDownloadProgress:oe}=Y,ie,ae,se,ue,fe;function le(){ue&&ue(),fe&&fe(),Y.cancelToken&&Y.cancelToken.unsubscribe(ie),Y.signal&&Y.signal.removeEventListener("abort",ie)}let de=new XMLHttpRequest;de.open(Y.method.toUpperCase(),Y.url,!0),de.timeout=Y.timeout;function ce(){if(!de)return;const he=AxiosHeaders.from("getAllResponseHeaders"in de&&de.getAllResponseHeaders()),ve={data:!te||te==="text"||te==="json"?de.responseText:de.response,status:de.status,statusText:de.statusText,headers:he,config:t,request:de};settle(function(ye){E(ye),le()},function(ye){R(ye),le()},ve),de=null}"onloadend"in de?de.onloadend=ce:de.onreadystatechange=function(){!de||de.readyState!==4||de.status===0&&!(de.responseURL&&de.responseURL.indexOf("file:")===0)||setTimeout(ce)},de.onabort=function(){de&&(R(new AxiosError("Request aborted",AxiosError.ECONNABORTED,t,de)),de=null)},de.onerror=function(){R(new AxiosError("Network Error",AxiosError.ERR_NETWORK,t,de)),de=null},de.ontimeout=function(){let ge=Y.timeout?"timeout of "+Y.timeout+"ms exceeded":"timeout exceeded";const ve=Y.transitional||transitionalDefaults;Y.timeoutErrorMessage&&(ge=Y.timeoutErrorMessage),R(new AxiosError(ge,ve.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,t,de)),de=null},Z===void 0&&ee.setContentType(null),"setRequestHeader"in de&&utils$1.forEach(ee.toJSON(),function(ge,ve){de.setRequestHeader(ve,ge)}),utils$1.isUndefined(Y.withCredentials)||(de.withCredentials=!!Y.withCredentials),te&&te!=="json"&&(de.responseType=Y.responseType),oe&&([se,fe]=progressEventReducer(oe,!0),de.addEventListener("progress",se)),ne&&de.upload&&([ae,ue]=progressEventReducer(ne),de.upload.addEventListener("progress",ae),de.upload.addEventListener("loadend",ue)),(Y.cancelToken||Y.signal)&&(ie=he=>{de&&(R(!he||he.type?new CanceledError(null,t,de):he),de.abort(),de=null)},Y.cancelToken&&Y.cancelToken.subscribe(ie),Y.signal&&(Y.signal.aborted?ie():Y.signal.addEventListener("abort",ie)));const pe=parseProtocol(Y.url);if(pe&&platform.protocols.indexOf(pe)===-1){R(new AxiosError("Unsupported protocol "+pe+":",AxiosError.ERR_BAD_REQUEST,t));return}de.send(Z||null)})},composeSignals=(t,h)=>{const{length:E}=t=t?t.filter(Boolean):[];if(h||E){let R=new AbortController,Y;const Z=function(oe){if(!Y){Y=!0,te();const ie=oe instanceof Error?oe:this.reason;R.abort(ie instanceof AxiosError?ie:new CanceledError(ie instanceof Error?ie.message:ie))}};let ee=h&&setTimeout(()=>{ee=null,Z(new AxiosError(`timeout ${h} of ms exceeded`,AxiosError.ETIMEDOUT))},h);const te=()=>{t&&(ee&&clearTimeout(ee),ee=null,t.forEach(oe=>{oe.unsubscribe?oe.unsubscribe(Z):oe.removeEventListener("abort",Z)}),t=null)};t.forEach(oe=>oe.addEventListener("abort",Z));const{signal:ne}=R;return ne.unsubscribe=()=>utils$1.asap(te),ne}},streamChunk=function*(t,h){let E=t.byteLength;if(E<h){yield t;return}let R=0,Y;for(;R<E;)Y=R+h,yield t.slice(R,Y),R=Y},readBytes=async function*(t,h){for await(const E of readStream(t))yield*streamChunk(E,h)},readStream=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const h=t.getReader();try{for(;;){const{done:E,value:R}=await h.read();if(E)break;yield R}}finally{await h.cancel()}},trackStream=(t,h,E,R)=>{const Y=readBytes(t,h);let Z=0,ee,te=ne=>{ee||(ee=!0,R&&R(ne))};return new ReadableStream({async pull(ne){try{const{done:oe,value:ie}=await Y.next();if(oe){te(),ne.close();return}let ae=ie.byteLength;if(E){let se=Z+=ae;E(se)}ne.enqueue(new Uint8Array(ie))}catch(oe){throw te(oe),oe}},cancel(ne){return te(ne),Y.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(t=>h=>t.encode(h))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),test=(t,...h)=>{try{return!!t(...h)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let t=!1;const h=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!h}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(t=>t.body)};isFetchSupported&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!resolvers[h]&&(resolvers[h]=utils$1.isFunction(t[h])?E=>E[h]():(E,R)=>{throw new AxiosError(`Response type '${h}' is not supported`,AxiosError.ERR_NOT_SUPPORT,R)})})})(new Response);const getBodyLength=async t=>{if(t==null)return 0;if(utils$1.isBlob(t))return t.size;if(utils$1.isSpecCompliantForm(t))return(await new Request(platform.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(t)||utils$1.isArrayBuffer(t))return t.byteLength;if(utils$1.isURLSearchParams(t)&&(t=t+""),utils$1.isString(t))return(await encodeText(t)).byteLength},resolveBodyLength=async(t,h)=>{const E=utils$1.toFiniteNumber(t.getContentLength());return E??getBodyLength(h)},fetchAdapter=isFetchSupported&&(async t=>{let{url:h,method:E,data:R,signal:Y,cancelToken:Z,timeout:ee,onDownloadProgress:te,onUploadProgress:ne,responseType:oe,headers:ie,withCredentials:ae="same-origin",fetchOptions:se}=resolveConfig(t);oe=oe?(oe+"").toLowerCase():"text";let ue=composeSignals([Y,Z&&Z.toAbortSignal()],ee),fe;const le=ue&&ue.unsubscribe&&(()=>{ue.unsubscribe()});let de;try{if(ne&&supportsRequestStream&&E!=="get"&&E!=="head"&&(de=await resolveBodyLength(ie,R))!==0){let ve=new Request(h,{method:"POST",body:R,duplex:"half"}),_e;if(utils$1.isFormData(R)&&(_e=ve.headers.get("content-type"))&&ie.setContentType(_e),ve.body){const[ye,me]=progressEventDecorator(de,progressEventReducer(asyncDecorator(ne)));R=trackStream(ve.body,DEFAULT_CHUNK_SIZE,ye,me)}}utils$1.isString(ae)||(ae=ae?"include":"omit");const ce="credentials"in Request.prototype;fe=new Request(h,{...se,signal:ue,method:E.toUpperCase(),headers:ie.normalize().toJSON(),body:R,duplex:"half",credentials:ce?ae:void 0});let pe=await fetch(fe);const he=supportsResponseStream&&(oe==="stream"||oe==="response");if(supportsResponseStream&&(te||he&&le)){const ve={};["status","statusText","headers"].forEach(Ee=>{ve[Ee]=pe[Ee]});const _e=utils$1.toFiniteNumber(pe.headers.get("content-length")),[ye,me]=te&&progressEventDecorator(_e,progressEventReducer(asyncDecorator(te),!0))||[];pe=new Response(trackStream(pe.body,DEFAULT_CHUNK_SIZE,ye,()=>{me&&me(),le&&le()}),ve)}oe=oe||"text";let ge=await resolvers[utils$1.findKey(resolvers,oe)||"text"](pe,t);return!he&&le&&le(),await new Promise((ve,_e)=>{settle(ve,_e,{data:ge,headers:AxiosHeaders.from(pe.headers),status:pe.status,statusText:pe.statusText,config:t,request:fe})})}catch(ce){throw le&&le(),ce&&ce.name==="TypeError"&&/fetch/i.test(ce.message)?Object.assign(new AxiosError("Network Error",AxiosError.ERR_NETWORK,t,fe),{cause:ce.cause||ce}):AxiosError.from(ce,ce&&ce.code,t,fe)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(t,h)=>{if(t){try{Object.defineProperty(t,"name",{value:h})}catch{}Object.defineProperty(t,"adapterName",{value:h})}});const renderReason=t=>`- ${t}`,isResolvedHandle=t=>utils$1.isFunction(t)||t===null||t===!1,adapters={getAdapter:t=>{t=utils$1.isArray(t)?t:[t];const{length:h}=t;let E,R;const Y={};for(let Z=0;Z<h;Z++){E=t[Z];let ee;if(R=E,!isResolvedHandle(E)&&(R=knownAdapters[(ee=String(E)).toLowerCase()],R===void 0))throw new AxiosError(`Unknown adapter '${ee}'`);if(R)break;Y[ee||"#"+Z]=R}if(!R){const Z=Object.entries(Y).map(([te,ne])=>`adapter ${te} `+(ne===!1?"is not supported by the environment":"is not available in the build"));let ee=h?Z.length>1?`since :
`+Z.map(renderReason).join(`
`):" "+renderReason(Z[0]):"as no adapter specified";throw new AxiosError("There is no suitable adapter to dispatch the request "+ee,"ERR_NOT_SUPPORT")}return R},adapters:knownAdapters};function throwIfCancellationRequested(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new CanceledError(null,t)}function dispatchRequest(t){return throwIfCancellationRequested(t),t.headers=AxiosHeaders.from(t.headers),t.data=transformData.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(t.adapter||defaults.adapter)(t).then(function(R){return throwIfCancellationRequested(t),R.data=transformData.call(t,t.transformResponse,R),R.headers=AxiosHeaders.from(R.headers),R},function(R){return isCancel(R)||(throwIfCancellationRequested(t),R&&R.response&&(R.response.data=transformData.call(t,t.transformResponse,R.response),R.response.headers=AxiosHeaders.from(R.response.headers))),Promise.reject(R)})}const VERSION="1.7.9",validators$1={};["object","boolean","number","function","string","symbol"].forEach((t,h)=>{validators$1[t]=function(R){return typeof R===t||"a"+(h<1?"n ":" ")+t}});const deprecatedWarnings={};validators$1.transitional=function(h,E,R){function Y(Z,ee){return"[Axios v"+VERSION+"] Transitional option '"+Z+"'"+ee+(R?". "+R:"")}return(Z,ee,te)=>{if(h===!1)throw new AxiosError(Y(ee," has been removed"+(E?" in "+E:"")),AxiosError.ERR_DEPRECATED);return E&&!deprecatedWarnings[ee]&&(deprecatedWarnings[ee]=!0,console.warn(Y(ee," has been deprecated since v"+E+" and will be removed in the near future"))),h?h(Z,ee,te):!0}},validators$1.spelling=function(h){return(E,R)=>(console.warn(`${R} is likely a misspelling of ${h}`),!0)};function assertOptions(t,h,E){if(typeof t!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const R=Object.keys(t);let Y=R.length;for(;Y-- >0;){const Z=R[Y],ee=h[Z];if(ee){const te=t[Z],ne=te===void 0||ee(te,Z,t);if(ne!==!0)throw new AxiosError("option "+Z+" must be "+ne,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(E!==!0)throw new AxiosError("Unknown option "+Z,AxiosError.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(h){this.defaults=h,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(h,E){try{return await this._request(h,E)}catch(R){if(R instanceof Error){let Y={};Error.captureStackTrace?Error.captureStackTrace(Y):Y=new Error;const Z=Y.stack?Y.stack.replace(/^.+\n/,""):"";try{R.stack?Z&&!String(R.stack).endsWith(Z.replace(/^.+\n.+\n/,""))&&(R.stack+=`
`+Z):R.stack=Z}catch{}}throw R}}_request(h,E){typeof h=="string"?(E=E||{},E.url=h):E=h||{},E=mergeConfig(this.defaults,E);const{transitional:R,paramsSerializer:Y,headers:Z}=E;R!==void 0&&validator.assertOptions(R,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),Y!=null&&(utils$1.isFunction(Y)?E.paramsSerializer={serialize:Y}:validator.assertOptions(Y,{encode:validators.function,serialize:validators.function},!0)),validator.assertOptions(E,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),E.method=(E.method||this.defaults.method||"get").toLowerCase();let ee=Z&&utils$1.merge(Z.common,Z[E.method]);Z&&utils$1.forEach(["delete","get","head","post","put","patch","common"],fe=>{delete Z[fe]}),E.headers=AxiosHeaders.concat(ee,Z);const te=[];let ne=!0;this.interceptors.request.forEach(function(le){typeof le.runWhen=="function"&&le.runWhen(E)===!1||(ne=ne&&le.synchronous,te.unshift(le.fulfilled,le.rejected))});const oe=[];this.interceptors.response.forEach(function(le){oe.push(le.fulfilled,le.rejected)});let ie,ae=0,se;if(!ne){const fe=[dispatchRequest.bind(this),void 0];for(fe.unshift.apply(fe,te),fe.push.apply(fe,oe),se=fe.length,ie=Promise.resolve(E);ae<se;)ie=ie.then(fe[ae++],fe[ae++]);return ie}se=te.length;let ue=E;for(ae=0;ae<se;){const fe=te[ae++],le=te[ae++];try{ue=fe(ue)}catch(de){le.call(this,de);break}}try{ie=dispatchRequest.call(this,ue)}catch(fe){return Promise.reject(fe)}for(ae=0,se=oe.length;ae<se;)ie=ie.then(oe[ae++],oe[ae++]);return ie}getUri(h){h=mergeConfig(this.defaults,h);const E=buildFullPath(h.baseURL,h.url);return buildURL(E,h.params,h.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],function(h){Axios.prototype[h]=function(E,R){return this.request(mergeConfig(R||{},{method:h,url:E,data:(R||{}).data}))}}),utils$1.forEach(["post","put","patch"],function(h){function E(R){return function(Z,ee,te){return this.request(mergeConfig(te||{},{method:h,headers:R?{"Content-Type":"multipart/form-data"}:{},url:Z,data:ee}))}}Axios.prototype[h]=E(),Axios.prototype[h+"Form"]=E(!0)});class CancelToken{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let E;this.promise=new Promise(function(Z){E=Z});const R=this;this.promise.then(Y=>{if(!R._listeners)return;let Z=R._listeners.length;for(;Z-- >0;)R._listeners[Z](Y);R._listeners=null}),this.promise.then=Y=>{let Z;const ee=new Promise(te=>{R.subscribe(te),Z=te}).then(Y);return ee.cancel=function(){R.unsubscribe(Z)},ee},h(function(Z,ee,te){R.reason||(R.reason=new CanceledError(Z,ee,te),E(R.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const E=this._listeners.indexOf(h);E!==-1&&this._listeners.splice(E,1)}toAbortSignal(){const h=new AbortController,E=R=>{h.abort(R)};return this.subscribe(E),h.signal.unsubscribe=()=>this.unsubscribe(E),h.signal}static source(){let h;return{token:new CancelToken(function(Y){h=Y}),cancel:h}}}function spread(t){return function(E){return t.apply(null,E)}}function isAxiosError(t){return utils$1.isObject(t)&&t.isAxiosError===!0}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach(([t,h])=>{HttpStatusCode[h]=t});function createInstance(t){const h=new Axios(t),E=bind(Axios.prototype.request,h);return utils$1.extend(E,Axios.prototype,h,{allOwnKeys:!0}),utils$1.extend(E,h,null,{allOwnKeys:!0}),E.create=function(Y){return createInstance(mergeConfig(t,Y))},E}const axios=createInstance(defaults);axios.Axios=Axios,axios.CanceledError=CanceledError,axios.CancelToken=CancelToken,axios.isCancel=isCancel,axios.VERSION=VERSION,axios.toFormData=toFormData,axios.AxiosError=AxiosError,axios.Cancel=axios.CanceledError,axios.all=function(h){return Promise.all(h)},axios.spread=spread,axios.isAxiosError=isAxiosError,axios.mergeConfig=mergeConfig,axios.AxiosHeaders=AxiosHeaders,axios.formToJSON=t=>formDataToJSON(utils$1.isHTMLForm(t)?new FormData(t):t),axios.getAdapter=adapters.getAdapter,axios.HttpStatusCode=HttpStatusCode,axios.default=axios;function getUrlParams(t){let h=window.location.href;if(window!=null&&window.__lowcode_building__)try{h=window.parent.location.href}catch{}let E="";if(h.includes("?")?E=h.split("?")[1]:h.includes("#")&&h.includes("?")&&(E=h.split("#")[1].split("?")[1]),!E)return t?null:{};const R=E.split("&").reduce((Y,Z)=>{const[ee,te]=Z.split("=");return Y[decodeURIComponent(ee)]=decodeURIComponent(te||""),Y},{});return t?R[t]||null:R}function getDevice(){return{viewport:{width:window.innerWidth,height:window.innerHeight}}}function getAppHelper(){return{utils:{request:axios,getUrlParams,getDevice,isJSExpression,parseData:parseData$1},constants:{router:{params:getUrlParams()},device:getDevice()}}}const DefaultSchema={componentsMap:[],componentsTree:[],flows:[],packagesMap:[],version:""},RenderView=require$$0.forwardRef((t,h)=>{const{schema:E=DefaultSchema,components:R={},customCreateElement:Y,designMode:Z}=t,{componentsTree:ee=[]}=E,te=require$$0.useRef(),ne=Y?{customCreateElement:Y}:{};return Z&&(ne.othersConfig=ne),require$$0.useImperativeHandle(h,()=>({updateCompProps:(oe,ie)=>{console.log(oe,ie)},getRenderRef:()=>te.current})),jsxRuntimeExports.jsx(ReactRenderer,{schema:ee==null?void 0:ee[0],components:R,appHelper:getAppHelper(),...ne,onCompGetCtx:(oe,ie)=>{te.current=ie},customCreateElement:Y},t.renderKey||(ee==null?void 0:ee[0].version))});var ERR_MESSAGE=(t=>(t.Dependency_Empty="组件依赖为空",t.Component_Is_Ready="该组件已经加载",t.Component_Not_Found="组件找不到",t))(ERR_MESSAGE||{});const DEFAULT_CDN_DOMAIN="https://qiniu.canyuegongzi.xyz",EditorType="umd",NPM_CONFIG={organization:"",npmPrefix:"",DEFAULT_CDN_DOMAIN_BASE_URL:"/npm",DEFAULT_CDN_DOMAIN,scriptFileName:t=>`${t||"index"}.production.js`,styleFileName:t=>`${t||"style"}.css`,materialSourceType:EditorType},COMPONENT_APP_UMD="MyLib",COMPONENT_APP_VERSION_DEFAULT="1.0.0",CACHE_LOAD_MAP=new Map,CACHE_CSS_MAP=new Map;class LoadService{constructor(t){be(this,"url","");be(this,"options",{componentName:COMPONENT_APP_UMD,version:COMPONENT_APP_VERSION_DEFAULT,window,cross:!1});be(this,"hostWindow");this.options=t,this.hostWindow=t.window||window}importScript(t,h={}){const{format:E="UMD"}=this.options;if(E==="UMD")return this.importScriptUmdVersion2(t,h);if(E==="ES")return this.importScriptEs(t)}importScriptEs(url){const name=this.options.componentName||COMPONENT_APP_UMD;return new Promise(resolve=>CACHE_LOAD_MAP.get(url)?resolve(CACHE_LOAD_MAP.get(url)):fetch(url).then(t=>t.text()).then(text=>{eval(`${text}`);const Com=this.hostWindow[name].default?this.hostWindow[name].default:this.hostWindow[name];CACHE_LOAD_MAP.set(url,Com),resolve(Com)}))}importScriptUmd(url){const name=this.options.componentName||COMPONENT_APP_UMD;return new Promise(resolve=>CACHE_LOAD_MAP.get(url)?resolve(CACHE_LOAD_MAP.get(url)):fetch(url).then(t=>t.text()).then(text=>{eval(`${text}`);const Com=this.hostWindow[name].default?this.hostWindow[name].default:this.hostWindow[name];CACHE_LOAD_MAP.set(url,Com),resolve(Com)}))}importScriptUmdVersion2(t,h={}){return new Promise((E,R)=>{const Y=this.hostWindow.document.querySelector(`script[src="${t}"]`),Z=(ee,te)=>{const ne=ee.type==="load"?"ready":"error";te==null||te.setAttribute("data-status",ne)};if(Y)(Y.getAttribute("data-status")||"ready")==="ready"?E(Y):(Y.addEventListener("load",te=>{Z(te,Y),E(Y)}),Y.addEventListener("error",te=>{Z(te,Y),R(te)}));else{const ee=this.hostWindow.document.createElement("script");ee.src=t,Object.keys(h).forEach(te=>{ee[te]=h[te]}),this.options.cross&&ee.setAttribute("crossorigin","anonymous"),ee.setAttribute("data-status","loading"),this.hostWindow.document.body.appendChild(ee),ee.addEventListener("load",te=>{Z(te,ee),E(ee)}),ee.addEventListener("error",te=>{Z(te,ee),R(te)})}})}cssToDom(t){const h=this.hostWindow.document.createElement("style");return h.textContent=t,h}importStyle(t){return new Promise(async(h,E)=>{try{let R="";CACHE_CSS_MAP.get(t)?R=CACHE_CSS_MAP.get(t):(R=await(await fetch(t)).text(),CACHE_CSS_MAP.set(t,R)),h(this.cssToDom(R))}catch(R){E(R)}})}}class ComponentDependency{constructor(h,E={cross:!0}){be(this,"sandboxVersion",!1);be(this,"componentMap");be(this,"hostWindow");be(this,"options");this.componentMap=new Map,this.hostWindow=h||window,this.options=E}formatSourceUrl(h,E,R=!1){const Y=[],Z=[];return Y.push(`${NPM_CONFIG.DEFAULT_CDN_DOMAIN}${NPM_CONFIG.DEFAULT_CDN_DOMAIN_BASE_URL}/${h}/${E}/${NPM_CONFIG.materialSourceType}/${NPM_CONFIG.scriptFileName(h)}`),R||Z.push(`${NPM_CONFIG.DEFAULT_CDN_DOMAIN}${NPM_CONFIG.DEFAULT_CDN_DOMAIN_BASE_URL}/${h}/${E}/${NPM_CONFIG.materialSourceType}/${NPM_CONFIG.styleFileName()}`),{js:Y,style:Z}}async getComponent(h,E){var Y;if(!E||!h)return()=>null;const R=this.componentMap.get(h);return(Y=R==null?void 0:R[E])==null?void 0:Y.component}async setComponent(h,E,R,Y){if(this.componentMap.has(h)){const Z=this.componentMap.get(h)||{};Z[E]||(Z[E]={name:h,libName:R,component:Y,version:E},this.componentMap.set(h,Z))}else this.componentMap.set(h,{[E]:{name:h,libName:R,component:Y,version:E}})}deleteComponent(h,E,R){if(R===!0)return this.componentMap.delete(h);const Y=this.componentMap.get(h)||{};Y[E]&&delete Y[E],this.componentMap.set(h,Y)}loadRemoteComponent(h,E,R){return new Promise(async(Y,Z)=>{var ne,oe,ie,ae,se,ue,fe,le;if(!R.scriptsList||R.scriptsList.length===0||!R.libName){const de=new Error(ERR_MESSAGE.Dependency_Empty);return(oe=(ne=R==null?void 0:R.lifecycle)==null?void 0:ne.onFailure)==null||oe.call(ne,de),Z(de)}let ee=R.content;if(ee||(ee=()=>this.hostWindow),await this.getComponent(h,E)){const de=new Error(ERR_MESSAGE.Component_Is_Ready);return(ae=(ie=R==null?void 0:R.lifecycle)==null?void 0:ie.onFailure)==null||ae.call(ie,de),Z(new Error(ERR_MESSAGE.Component_Is_Ready))}try{const{scriptsList:de=[],styleList:ce=[]}=R,pe=[],he=[],ge=new LoadService({enableSandbox:!0,window:this.hostWindow,cross:this.options.cross}),ve=[],_e=[];for(let Te=0;Te<(ce==null?void 0:ce.length);Te++)ve.push(ge.importStyle(ce[Te]));for(let Te=0;Te<(de==null?void 0:de.length);Te++)_e.push(ge.importScript(de[Te]));const ye=await Promise.all(ve),me=await Promise.all(_e);for(let Te=0;Te<ye.length;Te++){const Pe=ye[Te];he.push(Pe),this.hostWindow.document.head.appendChild(Pe)}for(let Te=0;Te<me.length;Te++){const Pe=me[Te];pe.push(Pe)}const Oe=ee()[R.libName];await this.setComponent(h,E,R.libName,Oe),Y({scriptDom:pe,styleDom:he,component:Oe}),(ue=(se=R==null?void 0:R.lifecycle)==null?void 0:se.onSuccess)==null||ue.call(se,Oe)}catch(de){return console.log(de),(le=(fe=R==null?void 0:R.lifecycle)==null?void 0:fe.onFailure)==null||le.call(fe,de),Z(de)}})}async parseComponentsMap(h){return new Promise(async E=>{const R={};for(let Y=0;Y<h.length;Y++){const{componentName:Z,version:ee,destructuring:te,exportName:ne}=h[Y],oe=()=>te?this.hostWindow[ne]:this.hostWindow;let ie=await this.getComponent(h[Y].package,ee);if(!ie)if(this.sandboxVersion||window.__building__||!oe()[ne]){const{js:ae,style:se}=this.formatSourceUrl(h[Y].package,h[Y].version,!1);await this.loadRemoteComponent(h[Y].package,ee,{styleList:se,scriptsList:ae,libName:Z,lifecycle:{onSuccess:ue=>{},onFailure:ue=>{}},content:oe})}else{const ae=oe()[ne];await this.setComponent(h[Y].package,ee,ne,ae)}ie=await this.getComponent(h[Y].package,ee),R[Z]=ie}E(R)})}loadRemoteLib(h){return new Promise(async(E,R)=>{var Y,Z,ee,te,ne,oe;if(!h.scriptsList||h.scriptsList.length===0||!h.libName){const ie=new Error(ERR_MESSAGE.Dependency_Empty);return(Z=(Y=h==null?void 0:h.lifecycle)==null?void 0:Y.onFailure)==null||Z.call(Y,ie),R(ie)}try{const{scriptsList:ie=[],styleList:ae=[]}=h,se=[],ue=[],fe=new LoadService({enableSandbox:!0,window:this.hostWindow,cross:this.options.cross}),le=[],de=[];for(let he=0;he<(ae==null?void 0:ae.length);he++)le.push(fe.importStyle(ae[he]));for(let he=0;he<(ie==null?void 0:ie.length);he++)de.push(fe.importScript(ie[he]));const ce=await Promise.all(le),pe=await Promise.all(de);for(let he=0;he<ce.length;he++){const ge=ce[he];ue.push(ge),this.hostWindow.document.head.appendChild(ge)}for(let he=0;he<pe.length;he++){const ge=pe[he];se.push(ge)}E({scriptDom:se,styleDom:ue}),(te=(ee=h==null?void 0:h.lifecycle)==null?void 0:ee.onSuccess)==null||te.call(ee)}catch(ie){return console.log(ie),(oe=(ne=h==null?void 0:h.lifecycle)==null?void 0:ne.onFailure)==null||oe.call(ne,ie),R(ie)}})}async parsePackagesMap(h){return new Promise(async E=>{for(let R=0;R<h.length;R++){const{exportName:Y}=h[R];if(!this.hostWindow[Y]){const{js:Z,style:ee}=this.formatSourceUrl(h[R].package,h[R].version,!0);await this.loadRemoteLib({styleList:ee,scriptsList:Z,libName:Y,lifecycle:{onSuccess:te=>{},onFailure:te=>{}}})}}E(!0)})}}const RenderContext=require$$0.createContext({}),PageRender=require$$0.forwardRef((t,h)=>{const{schema:E=window.__RENDER_PAGE_STATE__,customCreateElement:R}=t,[Y,Z]=require$$0.useState({}),{componentsMap:ee=[],componentsTree:te=[],packagesMap:ne=[]}=E||{},[oe,ie]=require$$0.useState(!1),ae=require$$0.useRef();return require$$0.useEffect(()=>{window.PageComponentDependency||(window.PageComponentDependency=window.PageComponentDependency=new ComponentDependency(window)),(async()=>{if(ne!=null&&ne.length&&await window.PageComponentDependency.parsePackagesMap(ne),ee!=null&&ee.length){const se=await window.PageComponentDependency.parseComponentsMap(ee);console.log(se),Z(se)}ie(!0)})()},[ee,ne]),require$$0.useImperativeHandle(h,()=>({updateCompProps:(se,ue)=>{console.log(se,ue)},getRenderRef:()=>{var se,ue;return(ue=(se=ae==null?void 0:ae.current)==null?void 0:se.getRenderRef)==null?void 0:ue.call(se)}})),oe?jsxRuntimeExports.jsx(RenderContext.Provider,{value:{},children:jsxRuntimeExports.jsx(RenderView,{designMode:"live",renderKey:te==null?void 0:te[0].version,schema:E,components:Y,ref:ae,customCreateElement:R})}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})}),version="2.1.8";exports.PageRender=PageRender,exports.RenderView=RenderView,exports.version=version,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
